import{j as e,ap as I,$ as ve,a0 as Be,a1 as J,a2 as x,a3 as Ne,a4 as f,q as m,m as g,X as Fe,a7 as De,r as t,u as Ee,t as C,an as Le,C as Re,e as Ae,f as Ue,M as ze,g as Me,s as Ie,ao as Z,V as ee,o as ae,h as $e,N as se,Q as le,S as te,T as ne,W as ie,a as He,b as Ye,c as Oe}from"./index-DAwD_DDx.js";import{S as Pe}from"./SupplierModal-Dr3iiJ8M.js";import{c as M}from"./cil-cloud-upload-Ca9_6_ej.js";const qe=({suppliers:j,onSupplierClick:B,onUpdate:N,onDelete:F,loading:y})=>{const D=(n,d)=>{n.stopPropagation(),F(d)},u=(n,d)=>{n.stopPropagation(),N(d)};return y?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(I,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Yükleniyor..."})]}):!j||j.length===0?e.jsx("div",{className:"text-center p-5",children:e.jsx("p",{className:"text-muted",children:"Tedarikçi bulunamadı."})}):e.jsxs(ve,{hover:!0,responsive:!0,children:[e.jsx(Be,{children:e.jsxs(J,{children:[e.jsx(x,{children:"Tedarikçi Adı/Unvanı"}),e.jsx(x,{children:"Telefon"}),e.jsx(x,{children:"Sınıflandırma"}),e.jsx(x,{children:"Açık Bakiye"}),e.jsx(x,{children:"Çek/Senet Bakiyesi"}),e.jsx(x,{width:"120",className:"text-center",children:"İşlemler"})]})}),e.jsx(Ne,{children:j.map(n=>e.jsxs(J,{onClick:()=>B(n),style:{cursor:"pointer"},children:[e.jsxs(f,{children:[e.jsx("strong",{children:n.name}),n.email&&e.jsx("div",{className:"small text-muted",children:n.email})]}),e.jsx(f,{children:n.phone||"-"}),e.jsx(f,{children:e.jsx("span",{className:"badge bg-info text-white",children:n.classification||"Sınıflandırılmamış"})}),e.jsx(f,{children:e.jsxs("span",{className:n.openBalance>0?"text-danger fw-bold":"",children:[n.openBalance.toLocaleString("tr-TR")," TRY"]})}),e.jsx(f,{children:e.jsxs("span",{className:n.chequeBondBalance>0?"text-warning fw-bold":"",children:[n.chequeBondBalance.toLocaleString("tr-TR")," TRY"]})}),e.jsxs(f,{className:"text-center",children:[e.jsx(m,{size:"sm",className:"me-1",style:{backgroundColor:"#FFC107",border:"none",color:"white",padding:"4px 8px"},title:"Düzenle",onClick:d=>u(d,n),children:e.jsx(g,{icon:Fe,size:"sm"})}),e.jsx(m,{size:"sm",style:{backgroundColor:"#DC3545",border:"none",color:"white",padding:"4px 8px"},title:"Sil",onClick:d=>D(d,n.id),children:e.jsx(g,{icon:De,size:"sm"})})]})]},n.id))})]})},k="https://speedsofttest.com/api",Ve=()=>{const[j,B]=t.useState([]),[N,F]=t.useState([]),[y,D]=t.useState([]),[u,n]=t.useState(!1),[d,$]=t.useState(null),[b,H]=t.useState(!0),[E,re]=t.useState(""),[Y,oe]=t.useState("all"),[O,ce]=t.useState(""),[de,w]=t.useState(!1),[P,q]=t.useState(null),[L,W]=t.useState(!1),[me,R]=t.useState(!1),[G,A]=t.useState(null),[he,S]=t.useState(!1),[U,T]=t.useState(null),[z,_]=t.useState(!1),ue=t.useRef(),V=Ee(),o=t.useCallback((a,i="success")=>{const l=e.jsxs(He,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Ye,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:i==="error"?"Hata":"Başarılı"})}),e.jsx(Oe,{children:a})]},Date.now());B(r=>[...r,l])},[]),K=t.useCallback(async(a,i)=>{var l,r,s,v;try{const{data:c}=await C.get(a),h=(Array.isArray(c)?c:[c]).filter(Te=>Te.durumu===1);return i(h),console.log(`fetchData (${a}) sonucu:`,h),h}catch(c){return console.error(`fetchData Hatası (${a}):`,{message:c.message,status:(l=c.response)==null?void 0:l.status,data:(r=c.response)==null?void 0:r.data}),o(((v=(s=c.response)==null?void 0:s.data)==null?void 0:v.message)||"Veriler yüklenemedi.","error"),[]}},[o]),xe=(a,i)=>{const l=a.tedarikciSiniflandirmaId?i.find(s=>s.id===a.tedarikciSiniflandirmaId):null,r=(l==null?void 0:l.adi)||"Bilinmiyor";return a.tedarikciSiniflandirmaId&&!l&&console.warn(`Sınıflandırma bulunamadı (Tedarikçi ID: ${a.id}, Sınıflandırma ID: ${a.tedarikciSiniflandirmaId})`),{id:a.id,name:a.unvan||"Bilinmiyor",openBalance:a.acilisBakiyesi||0,chequeBondBalance:0,phone:a.telefon||"",classification:r,email:a.email||"",address:a.adres||"",taxOffice:a.vergiDairesi||"",taxOrIdNumber:a.vergiNo||"",accountingCode:a.kodu||"",note:a.aciklama||"",currency:a.paraBirimi||"TRY",dueDate:a.vadeGun||"",isTaxExempt:a.vergiMuaf||!1,bankInfo:a.bankaBilgileri||"",contactPerson:a.yetkiliKisi||"",otherContact:a.diger||"",tedarikciSiniflandirmaId:a.tedarikciSiniflandirmaId}},p=t.useCallback(async()=>{var a,i,l,r;n(!0);try{const s=await K(`${k}/tedarikciSiniflandirma/get-all`,D);s.length||console.warn("Sınıflandırmalar boş, veri tutarsızlığı olabilir.");const v=b?`${k}/tedarikci/tedarikci-get-all`:`${k}/tedarikci/tedarikci-get-allaktif`,{data:c}=await C.get(v);console.log("Tedarikçi verileri:",c);const X=c.filter(h=>h.durumu===1).map(h=>xe(h,s));F(X),$(null),o("Tedarikçiler başarıyla yüklendi.","success")}catch(s){console.error("Tedarikçi Yükleme Hatası:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(i=s.response)==null?void 0:i.data}),$(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Tedarikçiler yüklenemedi."),o("Tedarikçiler yüklenemedi.","error")}finally{n(!1)}},[b,K,o]),fe=a=>{A(a),R(!0)},ke=a=>{T(a),S(!0)},ge=async()=>{var a,i,l,r;if(U){_(!0);try{console.log("Silme isteği gönderiliyor: ID =",U);const s=await C.delete(`${k}/tedarikci/tedarikci-delete/${U}`,{headers:{accept:"*/*"}});if(s.status===200||s.status===204)o("Tedarikçi başarıyla silindi.","success"),await p();else throw new Error("Silme işlemi başarısız")}catch(s){console.error("Silme Hatası:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(i=s.response)==null?void 0:i.data}),o(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Tedarikçi silinemedi. Lütfen tekrar deneyin.","error")}finally{_(!1),S(!1),T(null)}}},je=a=>{G&&(R(!1),A(null),p())},pe=a=>{V(`/app/supplier-detail/${a.id}`,{state:{supplier:a}})},Ce=()=>{V("/app/supplier-new")},ye=()=>{w(!0)},be=async()=>{var a,i;try{const l=await C.get(`${k}/tedarikci/download-template`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([l.data])),s=document.createElement("a");s.href=r,s.setAttribute("download","tedarikci_sablonu.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r),o("Excel şablonu başarıyla indirildi.","success")}catch(l){o(((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Excel şablonu indirilemedi.","error")}},we=a=>{q(a.target.files[0])},Se=async()=>{var a,i;if(!P){o("Lütfen bir Excel dosyası seçin.","error");return}W(!0);try{const l=new FormData;l.append("file",P),await C.post(`${k}/tedarikci/upload-excel`,l,{headers:{"Content-Type":"multipart/form-data",accept:"*/*"}}),await p(),o("Excel dosyası başarıyla yüklendi.","success"),w(!1),q(null)}catch(l){o(((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Excel dosyası yüklenemedi.","error")}finally{W(!1)}};t.useEffect(()=>{p()},[p]);const Q=N.filter(a=>a.name.toLowerCase().includes(O.toLowerCase())).filter(a=>E?a.classification===E:!0).filter(a=>Y==="balance"?a.openBalance>0||a.chequeBondBalance>0:!0);return e.jsxs(Le,{children:[e.jsx(Re,{ref:ue,placement:"top-end",className:"p-3",children:j}),e.jsxs(Ae,{className:"mb-3",children:[e.jsxs(Ue,{children:[e.jsxs(m,{color:"success",style:{color:"white",marginRight:"10px",marginBottom:"15px"},onClick:Ce,children:[e.jsx(g,{icon:ze})," Yeni Tedarikçi Ekle"]}),e.jsxs(m,{color:"primary",style:{color:"white",marginRight:"10px",marginBottom:"15px"},onClick:ye,children:[e.jsx(g,{icon:M})," Excel'den Tedarikçi Yükle"]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",color:"#2965A8",padding:"5px 10px",borderRadius:"4px",fontWeight:"bold",fontSize:"14px",maxHeight:"35px",maxWidth:"200px",textAlign:"center",margin:"10px 15px 0 0"},children:["Toplam Tedarikçi: ",Q.length]})]}),e.jsxs(Me,{className:"my-3",children:[e.jsx(Ie,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex flex-row justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(Z,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterAll",autoComplete:"off",label:"Tüm Tedarikçiler",checked:b,onChange:()=>H(!0)}),e.jsx(Z,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterActive",autoComplete:"off",label:"Aktif Tedarikçiler",checked:!b,onChange:()=>H(!1)})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(ee,{value:E,onChange:a=>re(a.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"",children:"Tüm Sınıflandırmalar"}),y.map(a=>e.jsx("option",{value:a.adi,children:a.adi},a.id))]}),e.jsxs(ee,{value:Y,onChange:a=>oe(a.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"all",children:"Hepsini Göster"}),e.jsx("option",{value:"balance",children:"Bakiyesi Olanları Göster"})]})]}),e.jsx(ae,{type:"text",placeholder:"Tedarikçi ara...",value:O,onChange:a=>ce(a.target.value),style:{width:"200px"},className:"ms-2"})]})}),e.jsxs($e,{children:[d&&e.jsx("p",{className:"text-danger",children:d}),e.jsx(qe,{suppliers:Q,onSupplierClick:pe,onUpdate:fe,onDelete:ke,loading:u})]})]}),e.jsxs(se,{size:"lg",visible:de,backdrop:"static",keyboard:!1,onClose:()=>w(!1),children:[e.jsx(le,{children:e.jsx(te,{children:"Excel ile Tedarikçi Yükleme"})}),e.jsxs(ne,{children:[e.jsxs(m,{color:"primary",style:{color:"white"},onClick:be,disabled:u,children:[e.jsx(g,{icon:M})," Excel Şablonu İndir"]}),e.jsx("p",{className:"mt-3",children:"Tedarikçilerinizi tek tek tanımlamak yerine, Excel şablonunu indirin ve doldurun."}),e.jsx(ae,{type:"file",accept:".xlsx,.xls",onChange:we,className:"mb-3"}),e.jsx(m,{color:"success",style:{color:"white"},onClick:Se,disabled:L||u,children:L?e.jsx(I,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:M})," Excel Şablonu Yükle"]})})]}),e.jsx(ie,{children:e.jsx(m,{color:"secondary",onClick:()=>w(!1),disabled:L||u,children:"İptal"})})]}),e.jsx(Pe,{visible:me,onClose:()=>{R(!1),A(null)},onSubmit:je,supplier:G,addToast:o,classifications:y}),e.jsxs(se,{visible:he,onClose:()=>{S(!1),T(null)},backdrop:"static",children:[e.jsx(le,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},children:e.jsx(te,{children:"Silme Onayı"})}),e.jsx(ne,{children:e.jsx("p",{children:"Bu tedarikçiyi silmek istediğinizden emin misiniz?"})}),e.jsxs(ie,{children:[e.jsx(m,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},onClick:ge,disabled:z,children:z?e.jsx(I,{size:"sm"}):"Tamam"}),e.jsx(m,{style:{backgroundColor:"var(--secondary-color)",color:"var(--white-color)"},onClick:()=>{S(!1),T(null)},disabled:z,children:"İptal"})]})]})]})};export{Ve as default};
