import{ah as Te,J as we,u as Ie,r as c,j as e,g as v,s as A,h as M,q as y,C as De,e as X,f as B,m as ve,X as Ae,B as Me,D as Be,E as $e,F as Le,o as Z,$ as Ne,a0 as Fe,a1 as ee,a2 as j,a3 as Ee,a4 as k,N as U,Q as z,S as G,T as H,V as se,W as O,t as b,a as Pe,b as Re,c as We}from"./index-DvA_wB1j.js";import{W as qe}from"./WarehouseModal-DMvBjeny.js";const C="https://speedsofttest.com/api",Ge=()=>{var Q;const{id:w}=Te(),{state:R}=we(),I=Ie(),[t,J]=c.useState((R==null?void 0:R.warehouse)||null),[$,W]=c.useState([]),[D,ae]=c.useState(""),[Y,re]=c.useState([]),[h,u]=c.useState(!1),[oe,ne]=c.useState([]),[le,q]=c.useState(!1),[te,L]=c.useState(!1),[ie,N]=c.useState(!1),[de,F]=c.useState(!1),[m,E]=c.useState(null),[x,g]=c.useState(""),[S,P]=c.useState(""),ce=c.useRef();c.useEffect(()=>{(async()=>{try{const r=JSON.parse(localStorage.getItem("user"))||{id:null,username:"Unknown",email:"Unknown"};console.log("Logged-in user data:",{id:r.id,username:r.username,email:r.email})}catch(r){console.error("Error fetching user data:",r.message)}})()},[]);const i=(s,r="success")=>{const n=Date.now(),o=e.jsxs(Pe,{autohide:!0,visible:!0,delay:5e3,className:r==="error"?"bg-danger text-white":"bg-success text-white",children:[e.jsx(Re,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:r==="error"?"Hata":"Başarılı"})}),e.jsx(We,{children:s})]},n);return ne(a=>[...Array.isArray(a)?a:[],o]),n},ue=async s=>{var r,n,o;try{if(u(!0),console.log("Fetching warehouse with ID:",s),!s||isNaN(s))throw new Error("Geçersiz depo ID'si.");const{data:a}=await b.get(`${C}/depo/get-by-id/${s}`);if(console.log("Warehouse API response (depo/get-by-id):",a),!a||a.durumu!==1)throw new Error("Depo bulunamadı veya aktif değil.");J({id:a.id,adi:a.adi||"Bilinmeyen Depo"}),await K(a.id)}catch(a){console.error("Depo yükleme hatası:",((r=a.response)==null?void 0:r.data)||a.message),i(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.message)||"Depo yüklenemedi.","error"),I("/app/warehouses")}finally{u(!1)}},he=async()=>{var s,r,n;try{const{data:o}=await b.get(`${C}/depo/get-all`);console.log("Warehouses API response (depo/get-all):",o);const a=Array.isArray(o)?o.filter(l=>l.durumu===1&&l.id!==parseInt((t==null?void 0:t.id)||w)):(o==null?void 0:o.durumu)===1&&o.id!==parseInt((t==null?void 0:t.id)||w)?[o]:[];re(a)}catch(o){console.error("Depolar yükleme hatası:",((s=o.response)==null?void 0:s.data)||o.message),i(((n=(r=o.response)==null?void 0:r.data)==null?void 0:n.message)||"Depolar yüklenemedi.","error")}},K=async s=>{var r,n,o,a;try{u(!0),console.log("Fetching products for depoId:",s);const{data:l}=await b.get(`${C}/depo/depolardaki-urunstoklar/${s}`);if(console.log("Stock API response (depo/depolardaki-urunstoklar):",l),!Array.isArray(l))throw new Error("Stok verisi dizi formatında değil.");const p=l.filter(f=>f.durumu===1);console.log("Active stocks:",p);const _=p.map(f=>{var V;try{const d=f.urun;console.log(`Product data for urunId ${f.urunId}:`,d);const be=(d==null?void 0:d.alisFiyat)||0,Ce=(d==null?void 0:d.satisFiyat)||0,Se=f.miktar??0;return{id:f.id,code:(d==null?void 0:d.urunKodu)||"Bilinmeyen Kod",barcode:(d==null?void 0:d.barkod)||"Bilinmeyen Barkod",brand:((V=d==null?void 0:d.urunMarka)==null?void 0:V.adi)||"Bilinmeyen Marka",name:(d==null?void 0:d.adi)||"Bilinmeyen Ürün",quantity:Se,alisFiyat:be,satisFiyat:Ce,urunId:f.urunId,depoId:f.depoId}}catch(d){return console.error(`Ürün ID ${f.urunId} için hata:`,d.message),null}}).filter(f=>f!==null);console.log("Fetched products:",_),W(_)}catch(l){console.error("Ürün yükleme hatası:",((r=l.response)==null?void 0:r.data)||l.message);const p=((n=l.response)==null?void 0:n.status)===404?"Stok verileri için endpoint bulunamadı.":((a=(o=l.response)==null?void 0:o.data)==null?void 0:a.message)||"Ürünler yüklenemedi.";i(p,"error")}finally{u(!1)}},me=async()=>{var r,n,o;const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}if(!x){i("Lütfen hedef depo seçin.","error");return}try{u(!0);const a=await b.post(`${C}/depo/depo-tumurunleri-aktar/${t.id}/${x}?kullaniciId=${s.id}`);console.log("Transfer all API response (depo/depo-tumurunleri-aktar):",a.data),i(a.data.mesaj||"Tüm ürünler başarıyla transfer edildi.","success"),W([]),L(!1),g("")}catch(a){console.error("Transfer hatası:",((r=a.response)==null?void 0:r.data)||a.message),i(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.mesaj)||"Transfer işlemi başarısız.","error")}finally{u(!1)}},pe=async()=>{var r,n,o;const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}if(!x){i("Lütfen hedef depo seçin.","error");return}if(!S||S<=0){i("Lütfen geçerli bir miktar girin.","error");return}if(S>(m==null?void 0:m.quantity)){i("Girilen miktar, mevcut stok miktarını aşıyor.","error");return}try{u(!0);const a={id:m.id,urunId:m.urunId,miktar:parseInt(S),kullaniciId:s.id};console.log("Transfer single payload:",a);const l=await b.post(`${C}/depo/secili-urun-aktar/${x}`,a);console.log("Transfer single API response (depo/secili-urun-aktar):",l.data),i(l.data.mesaj||"Ürün başarıyla transfer edildi.","success"),W(p=>p.map(T=>T.urunId===m.urunId?{...T,quantity:T.quantity-parseInt(S)}:T).filter(T=>T.quantity>0)),N(!1),E(null),g(""),P("")}catch(a){console.error("Transfer hatası:",((r=a.response)==null?void 0:r.data)||a.message),i(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.mesaj)||"Transfer işlemi başarısız.","error")}finally{u(!1)}},fe=async()=>{var r,n,o;const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}try{u(!0);const a=$.map(p=>({urunId:p.urunId,miktar:p.quantity,fiyat:p.alisFiyat,kullaniciId:s.id}));console.log("Stock count payload:",a);const l=await b.post(`${C}/depo/stok-sayim/${t.id}`,a);console.log("Stock count API response (depo/stok-sayim):",l.data),i(l.data.mesaj||"Stok sayımı başarıyla tamamlandı.","success"),I(`/app/warehouses/${t.id}/stock-count`,{state:{warehouse:t}})}catch(a){console.error("Stok sayım hatası:",((r=a.response)==null?void 0:r.data)||a.message),i(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.mesaj)||"Stok sayımı başarısız.","error")}finally{u(!1)}},ye=async s=>{var n,o,a;const r=JSON.parse(localStorage.getItem("user"))||{id:0};if(!r.id){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}try{u(!0);const l={id:t.id,adi:s.adi,durumu:1,kullaniciId:r.id};console.log("Update payload:",l);const p=await b.put(`${C}/depo/update`,l);console.log("Update API response (depo/update):",p.data),J(l),q(!1),i(p.data.message||"Depo güncellendi.","success")}catch(l){console.error("Depo güncelleme hatası:",((n=l.response)==null?void 0:n.data)||l.message),i(((a=(o=l.response)==null?void 0:o.data)==null?void 0:a.message)||"Depo güncellenemedi.","error")}finally{u(!1)}},xe=async()=>{var r,n,o;const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}try{u(!0);const a=await b.delete(`${C}/depo/delete/${t.id}?kullaniciId=${s.id}`);console.log("Delete API response (depo/delete):",a.data),i(a.data.message||"Depo başarıyla silindi.","success"),F(!1),I("/app/warehouses")}catch(a){console.error("Silme hatası:",((r=a.response)==null?void 0:r.data)||a.message),i(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.message)||"Depo silinemedi.","error")}finally{u(!1)}};c.useEffect(()=>{console.log("useEffect triggered with paramId:",w,"warehouse:",t);const s=(t==null?void 0:t.id)||w;if(!s){console.error("Depo ID'si bulunamadı:",{paramId:w,warehouse:t}),i("Depo ID'si bulunamadı.","error"),I("/app/warehouses");return}!t||t.id!==parseInt(s)?ue(s):K(t.id),he()},[w,t,I]);const ge=$.filter(s=>(s.code||"").toLowerCase().includes(D.toLowerCase())||(s.barcode||"").toLowerCase().includes(D.toLowerCase())||(s.brand||"").toLowerCase().includes(D.toLowerCase())||(s.name||"").toLowerCase().includes(D.toLowerCase())),je=$.reduce((s,r)=>s+(r.alisFiyat||0),0),ke=$.reduce((s,r)=>s+(r.satisFiyat||0),0);return h||!t?e.jsxs(v,{children:[e.jsx(A,{children:"Depo Bilgisi"}),e.jsxs(M,{children:[h?e.jsx("p",{children:"Yükleniyor..."}):e.jsx("p",{children:"Depo bulunamadı."}),e.jsx(y,{color:"primary",onClick:()=>I("/app/warehouses"),children:"Geri"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{ref:ce,placement:"top-end",className:"p-3",children:oe}),e.jsxs(X,{children:[e.jsx(B,{xs:12,children:e.jsxs(v,{children:[e.jsx(A,{style:{backgroundColor:"#2965A8",color:"#fff",fontSize:"24px"},children:((Q=t.adi)==null?void 0:Q.toUpperCase())||"DEPO ADI YOK"}),e.jsx(M,{children:e.jsxs(X,{children:[e.jsx(B,{md:6,children:e.jsxs(v,{children:[e.jsx(A,{className:"bg-info",style:{color:"white"},children:"Toplam Alış Değeri"}),e.jsx(M,{children:e.jsxs("p",{className:"fw-bold",children:[je.toLocaleString("tr-TR")," TRY"]})})]})}),e.jsx(B,{md:6,children:e.jsxs(v,{children:[e.jsx(A,{className:"bg-success",style:{color:"white"},children:"Toplam Satış Değeri"}),e.jsx(M,{children:e.jsxs("p",{className:"fw-bold",children:[ke.toLocaleString("tr-TR")," TRY"]})})]})})]})})]})}),e.jsx(B,{xs:12,className:"my-3 d-flex",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(y,{color:"primary",style:{color:"white"},onClick:()=>q(!0),children:[e.jsx(ve,{icon:Ae})," Güncelle"]}),e.jsx(y,{color:"success",style:{color:"white"},onClick:fe,children:"Stok Sayımı Yap"}),e.jsxs(Me,{children:[e.jsx(Be,{color:"info",style:{color:"white"},children:"Depolar Arası Transfer"}),e.jsx($e,{children:e.jsx(Le,{onClick:()=>L(!0),children:"Tamamını Başka Depoya Gönder"})})]}),e.jsx(y,{color:"danger",style:{color:"white"},onClick:()=>F(!0),children:"Sil"})]})}),e.jsx(B,{xs:12,children:e.jsxs(v,{children:[e.jsx(A,{style:{backgroundColor:"#2965A8",color:"white"},children:"Depodaki Ürünler"}),e.jsxs(M,{children:[e.jsx(Z,{type:"text",placeholder:"Ara...",value:D,onChange:s=>ae(s.target.value),className:"mb-3"}),e.jsxs(Ne,{responsive:!0,children:[e.jsx(Fe,{children:e.jsxs(ee,{children:[e.jsx(j,{children:"Kod"}),e.jsx(j,{children:"Barkod"}),e.jsx(j,{children:"Marka"}),e.jsx(j,{children:"Ürün"}),e.jsx(j,{children:"Miktar"}),e.jsx(j,{children:"Alış Fiyatı (TL)"}),e.jsx(j,{children:"Satış Fiyatı (TL)"}),e.jsx(j,{children:"Transfer"})]})}),e.jsx(Ee,{children:ge.map(s=>e.jsxs(ee,{children:[e.jsx(k,{children:s.code}),e.jsx(k,{children:s.barcode}),e.jsx(k,{children:s.brand}),e.jsx(k,{children:s.name}),e.jsx(k,{children:s.quantity}),e.jsxs(k,{children:[s.alisFiyat.toLocaleString("tr-TR")," TRY"]}),e.jsxs(k,{children:[s.satisFiyat.toLocaleString("tr-TR")," TRY"]}),e.jsx(k,{children:e.jsx(y,{color:"info",size:"sm",style:{color:"white"},onClick:()=>{E(s),N(!0)},disabled:h,children:"Transfer"})})]},s.id))})]})]})]})})]}),e.jsxs(U,{visible:te,onClose:()=>{L(!1),g("")},backdrop:"static",children:[e.jsx(z,{children:e.jsx(G,{children:"Tüm Ürünleri Transfer Et"})}),e.jsx(H,{children:e.jsxs(se,{label:"Hedef Depo",value:x,onChange:s=>g(s.target.value),disabled:h,children:[e.jsx("option",{value:"",children:"Depo Seçin"}),Y.map(s=>e.jsx("option",{value:s.id,children:s.adi||"Bilinmeyen Depo"},s.id))]})}),e.jsxs(O,{children:[e.jsx(y,{color:"primary",onClick:me,disabled:h||!x,children:"Transfer Et"}),e.jsx(y,{color:"secondary",onClick:()=>{L(!1),g("")},disabled:h,children:"İptal"})]})]}),e.jsxs(U,{visible:ie,onClose:()=>{N(!1),E(null),g(""),P("")},backdrop:"static",children:[e.jsx(z,{children:e.jsx(G,{children:m?`${m.name} Ürününü Transfer Et`:"Ürün Transferi"})}),e.jsxs(H,{children:[m&&e.jsxs("p",{children:["Mevcut Miktar: ",e.jsx("strong",{children:m.quantity})]}),e.jsxs(se,{label:"Hedef Depo",value:x,onChange:s=>g(s.target.value),disabled:h,className:"mb-3",children:[e.jsx("option",{value:"",children:"Depo Seçin"}),Y.map(s=>e.jsx("option",{value:s.id,children:s.adi||"Bilinmeyen Depo"},s.id))]}),e.jsx(Z,{type:"number",label:"Transfer Miktarı",value:S,onChange:s=>P(s.target.value),min:"1",max:m==null?void 0:m.quantity,disabled:h,required:!0})]}),e.jsxs(O,{children:[e.jsx(y,{color:"primary",onClick:pe,disabled:h||!x||!S,children:"Transfer Et"}),e.jsx(y,{color:"secondary",onClick:()=>{N(!1),E(null),g(""),P("")},disabled:h,children:"İptal"})]})]}),e.jsxs(U,{visible:de,onClose:()=>F(!1),backdrop:"static",children:[e.jsx(z,{children:e.jsx(G,{children:"Depo Sil"})}),e.jsx(H,{children:e.jsx("p",{children:"Bu depoyu silmek istediğinize emin misiniz? Bu işlem geri alınamaz."})}),e.jsxs(O,{children:[e.jsx(y,{color:"danger",onClick:xe,disabled:h,children:"Sil"}),e.jsx(y,{color:"secondary",onClick:()=>F(!1),disabled:h,children:"İptal"})]})]}),e.jsx(qe,{visible:le,onClose:()=>q(!1),onSubmit:ye,loading:h,warehouse:t})]})};export{Ge as default};
