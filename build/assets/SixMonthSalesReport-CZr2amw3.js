import{r as d,R as z,Z as x,j as a,g as K,s as P,h as V,e as Z,f as N,o as q,q as O,$ as G,a0 as J,a1 as L,a2 as k,a3 as Q,a4 as Y,am as X,aB as ee,az as F,aA as te}from"./index-DAwD_DDx.js";import{C as I,B as ae,a as re,L as se,b as ne,p as le,c as oe,d as ie}from"./chart-DDrJ3moh.js";const U="label";function $(e,n){typeof e=="function"?e(n):e&&(e.current=n)}function ce(e,n){const l=e.options;l&&n&&Object.assign(l,n)}function W(e,n){e.labels=n}function H(e,n){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U;const f=[];e.datasets=n.map(u=>{const p=e.datasets.find(A=>A[l]===u[l]);return!p||!u.data||f.includes(p)?{...u}:(f.push(p),Object.assign(p,u),p)})}function de(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U;const l={labels:[],datasets:[]};return W(l,e.labels),H(l,e.datasets,n),l}function ue(e,n){const{height:l=150,width:f=300,redraw:u=!1,datasetIdKey:p,type:A,data:y,options:g,plugins:v=[],fallbackContent:R,updateMode:C,..._}=e,j=d.useRef(null),i=d.useRef(null),T=()=>{j.current&&(i.current=new I(j.current,{type:A,data:de(y,p),options:g&&{...g},plugins:v}),$(n,i.current))},t=()=>{$(n,null),i.current&&(i.current.destroy(),i.current=null)};return d.useEffect(()=>{!u&&i.current&&g&&ce(i.current,g)},[u,g]),d.useEffect(()=>{!u&&i.current&&W(i.current.config.data,y.labels)},[u,y.labels]),d.useEffect(()=>{!u&&i.current&&y.datasets&&H(i.current.config.data,y.datasets,p)},[u,y.datasets]),d.useEffect(()=>{i.current&&(u?(t(),setTimeout(T)):i.current.update(C))},[u,g,y.labels,y.datasets,C]),d.useEffect(()=>{i.current&&(t(),setTimeout(T))},[A]),d.useEffect(()=>(T(),()=>t()),[]),z.createElement("canvas",{ref:j,role:"img",height:l,width:f,..._},R)}const he=d.forwardRef(ue);function me(e,n){return I.register(n),d.forwardRef((l,f)=>z.createElement(he,{...l,ref:f,type:e}))}const fe=me("bar",ae),ye="https://speedsofttest.com/api";I.register(re,se,ne,le,oe,ie);const pe={Ç:"C",ç:"c",Ğ:"G",ğ:"g",İ:"I",ı:"i",Ö:"O",ö:"o",Ş:"S",ş:"s",Ü:"U",ü:"u"},r=e=>e&&e.replace(/[ÇçĞğİıÖöŞşÜü]/g,n=>pe[n]||n),ge=e=>{try{e.setFont("times","normal"),console.log("Times fontu kullanılıyor (Türkçe karakter desteği ile)")}catch(n){console.error("Font ayarlama hatası:",n),e.setFont("helvetica","normal")}},xe=()=>{const[e,n]=d.useState([]),[l,f]=d.useState([]),[u,p]=d.useState(""),[A,y]=d.useState(!1),[g,v]=d.useState(null);d.useEffect(()=>{(async()=>{y(!0),v(null);try{const s=await X.get(`${ye}/musteriSatis/musteriSatis-last-six-months`);let h=[];Array.isArray(s.data)?h=s.data:s.data&&Array.isArray(s.data.data)?h=s.data.data:s.data&&s.data.items?h=s.data.items:console.warn("Beklenmeyen API yanıt formatı:",s.data),n(h),f(h)}catch(s){console.error("Satış verileri alınırken hata oluştu:",s),v("Veriler yüklenirken hata oluştu."),n([]),f([])}finally{y(!1)}})()},[]);const R=t=>{const s=t.target.value.toLowerCase();if(p(s),s==="")f(e);else{const h=e.filter(b=>Object.values(b).some(c=>c==null?!1:typeof c=="object"?Object.values(c).some(S=>S&&S.toString().toLowerCase().includes(s)):c.toString().toLowerCase().includes(s)));f(h)}},C=Array(6).fill(0).map((t,s)=>{const h=x().subtract(5-s,"month");let b=0;return Array.isArray(e)&&(b=e.filter(c=>c&&x(c.eklenmeTarihi).isSame(h,"month")).reduce((c,S)=>c+(S.toplamFiyat||0),0)),{month:h.format("MMM YYYY"),total:b}}),_={labels:C.map(t=>t.month),datasets:[{label:r("Toplam Satış (₺)"),data:C.map(t=>t.total),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(75, 192, 192, 1)","rgba(255, 206, 86, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},j={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:r("Son 6 Ayın Aylık Satışları")}},scales:{y:{beginAtZero:!0,title:{display:!0,text:r("Toplam Satış (₺)")}},x:{title:{display:!0,text:r("Ay")}}}},i=()=>{const t=new ee({orientation:"landscape"});ge(t),t.setFontSize(18);const s=r("6 Aylık Satış Raporu");t.text(s,148.5,15,{align:"center"});const h=x().format("DD/MM/YYYY HH:mm:ss");t.setFontSize(10),t.text(r(`Oluşturulma Tarihi: ${h}`),148.5,25,{align:"center"}),t.setFontSize(14),t.text(r("Satış Verileri"),14,35);const b=Array.isArray(e)?e.map(o=>{var M;return[o.id||"N/A",o.satisId||"N/A",o.eklenmeTarihi?x(o.eklenmeTarihi).format("DD/MM/YYYY"):"N/A",r(((M=o.musteri)==null?void 0:M.unvani)||o.musteriUnvani||"Bilinmeyen Müşteri"),o.toplamFiyat?`${o.toplamFiyat.toFixed(2).replace(".",",")} ₺`:"0,00 ₺"]}):[];t.autoTable({startY:40,head:[[r("ID"),r("Satış ID"),r("Tarih"),r("Müşteri"),r("Tutar")]],body:b,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255]},styles:{font:"times",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:20},1:{cellWidth:50},2:{cellWidth:40},3:{cellWidth:100},4:{cellWidth:50}}});const c=Array.isArray(e)?e.reduce((o,M)=>o+(M.toplamFiyat||0),0):0,S=Array.isArray(e)&&e.length?c/e.length:0,D=Array.isArray(e)?e.length:0,w=o=>o.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")+" ₺",B=[[r("Toplam Satış"),w(c)],[r("Ortalama Satış"),w(S)],[r("Belge Sayısı"),`${D} adet`]];t.setFontSize(14),t.text(r("Özet"),14,t.autoTable.previous.finalY+15),t.autoTable({startY:t.autoTable.previous.finalY+20,body:B,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255]},styles:{font:"times",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:70,fontStyle:"bold"},1:{cellWidth:70}}});const E=t.output("blob"),m=URL.createObjectURL(E);window.open(m,"_blank")},T=()=>{const t=Array.isArray(e)?e.map(m=>{var o;return{ID:m.id||"N/A","Satış ID":m.satisId||"N/A",Tarih:m.eklenmeTarihi?x(m.eklenmeTarihi).format("DD/MM/YYYY"):"N/A",Müşteri:r(((o=m.musteri)==null?void 0:o.unvani)||m.musteriUnvani||"Bilinmeyen Müşteri"),Tutar:m.toplamFiyat?`${m.toplamFiyat.toFixed(2).replace(".",",")} ₺`:"0,00 ₺"}}):[],s=Array.isArray(e)?e.reduce((m,o)=>m+(o.toplamFiyat||0),0):0,h=Array.isArray(e)&&e.length?s/e.length:0,b=Array.isArray(e)?e.length:0,c=m=>m.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")+" ₺",S=[{Kriter:"Toplam Satış",Değer:c(s)},{Kriter:"Ortalama Satış",Değer:c(h)},{Kriter:"Belge Sayısı",Değer:`${b} adet`}],D=F.book_new(),w=F.json_to_sheet(t);F.book_append_sheet(D,w,"Satış Verileri");const B=F.json_to_sheet(S);F.book_append_sheet(D,B,"Özet");const E=`6_Aylik_Satis_Raporu_${x().format("YYYYMMDD_HHmmss")}.xlsx`;te(D,E)};return a.jsxs(K,{children:[a.jsx(P,{style:{backgroundColor:"#2965A8",color:"#fff"},children:r("6 Aylık Satış Raporu")}),a.jsxs(V,{children:[a.jsxs(Z,{className:"mb-3",children:[a.jsx(N,{md:6,children:a.jsx(q,{placeholder:r("Tabloda Ara..."),value:u,onChange:R})}),a.jsxs(N,{md:6,className:"text-end",children:[a.jsx(O,{color:"primary",onClick:i,className:"me-2",children:r("PDF Oluştur")}),a.jsx(O,{color:"success",onClick:T,children:r("Excel Oluştur")})]})]}),a.jsx("h4",{className:"mt-4",children:r("Son 6 Ayın Satış Verileri")}),g&&a.jsx("div",{className:"alert alert-danger",children:g}),A?a.jsx("p",{children:r("Yükleniyor...")}):a.jsx(a.Fragment,{children:Array.isArray(l)&&l.length>0?a.jsxs(G,{striped:!0,hover:!0,children:[a.jsx(J,{children:a.jsxs(L,{children:[a.jsx(k,{children:r("ID")}),a.jsx(k,{children:r("Satış ID")}),a.jsx(k,{children:r("Tarih")}),a.jsx(k,{children:r("Müşteri")}),a.jsx(k,{children:r("Tutar")})]})}),a.jsx(Q,{children:l.map(t=>{var s;return a.jsxs(L,{children:[a.jsx(Y,{children:t.id||"N/A"}),a.jsx(Y,{children:t.satisId||"N/A"}),a.jsx(Y,{children:t.eklenmeTarihi?x(t.eklenmeTarihi).format("DD/MM/YYYY"):"N/A"}),a.jsx(Y,{children:r(((s=t.musteri)==null?void 0:s.unvani)||t.musteriUnvani||"Bilinmeyen Müşteri")}),a.jsx(Y,{children:t.toplamFiyat?`${t.toplamFiyat.toFixed(2).replace(".",",")} ₺`:"0,00 ₺"})]},t.id||Math.random())})})]}):a.jsx("p",{children:r("Satış verisi bulunamadı.")})}),a.jsx("h4",{className:"mt-4",children:r("Aylık Satış İstatistikleri")}),a.jsx("div",{style:{height:"400px",marginBottom:"20px"},children:a.jsx(fe,{data:_,options:j})})]})]})};export{xe as default};
