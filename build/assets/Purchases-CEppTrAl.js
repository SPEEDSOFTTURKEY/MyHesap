import{r as n,u as ke,j as e,N as le,C as Se,Q as ne,S as oe,T as ce,e as de,f as te,aq as ve,q as C,i as Ae,W as me,m as K,af as Te,av as Be,aw as Ue,ax as Ee,ay as Pe,am as Fe,a as Ce,b as De,c as be,M as ye,$ as Ne,a0 as Ie,a1 as fe,a2 as N,a3 as Ye,a4 as I,X as Le,a7 as ze,az as ie,aA as $e,aB as Me,B as Q,D as Z,E as ee,F as b,ak as Ge,ao as je,o as He,g as We,s as _e,h as Ke,J as Oe,an as Je,t as re}from"./index-DAwD_DDx.js";import{c as qe}from"./cil-reload-6LI_qKMh.js";import{c as Ve}from"./cil-file-CeQgYs_D.js";import{C as Xe,a as ae}from"./CPaginationItem-ConqRl1B.js";import{C as Qe}from"./CDropdownDivider-CxDfJebD.js";const q=n.createContext({}),Ze=Fe.create({baseURL:"https://speedsofttest.com/api",headers:{"Content-Type":"multipart/form-data"}}),et=({visible:m,onClose:p,onSupplierCreated:x})=>{const S=ke(),[s,c]=n.useState({unvan:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:"",durumu:1,aktif:0,fotograf:null}),[Y,f]=n.useState([]),[j,T]=n.useState("identity"),[F,P]=n.useState({}),D=(R,g="success")=>{const v=e.jsxs(Ce,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(De,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:g==="error"?"Hata":"Başarılı"})}),e.jsx(be,{children:R})]},Date.now());f(A=>[...A,v])},d=R=>{const{name:g,value:v,type:A,checked:B}=R.target;c(U=>({...U,[g]:A==="checkbox"?B:v})),P(U=>({...U,[g]:""}))},w=R=>{const g=R.target.files[0];if(g){if(!["image/jpeg","image/png","image/gif"].includes(g.type)){D("Lütfen yalnızca JPEG, PNG veya GIF formatında resim yükleyin.","error");return}c(A=>({...A,fotograf:g}))}},$=async R=>{var g,v,A,B,U,M,G,H,W,E,z,_,O;R.preventDefault();try{const y={unvan:((g=s.unvan)==null?void 0:g.trim())||"",fotograf:s.fotograf,vergiDairesi:s.vergiDairesi||"",vergiNo:s.vergiNo||"",vergiMuaf:s.vergiMuaf?1:0,bankaBilgileri:s.bankaBilgileri||"",paraBirimi:s.paraBirimi||"TRY",vadeGun:parseInt(s.vadeGun)||0,acilisBakiyesi:parseFloat(s.acilisBakiyesi)||0,yetkiliKisi:s.yetkiliKisi||"",email:((v=s.email)==null?void 0:v.trim())||"",adres:s.adres||"",telefon:s.telefon||"",diger:s.diger||"",tedarikciSiniflandirmaId:parseInt(s.tedarikciSiniflandirmaId)||0,kodu:s.kodu||"",aciklama:s.aciklama||"",durumu:1,aktif:0},l=new FormData;Object.entries(y).forEach(([t,i])=>{t==="fotograf"&&i?l.append("fotograf",i):l.append(t,i??"")});const u=await Ze.post("/tedarikci/tedarikci-create",l);console.log("API Cevabı:",JSON.stringify(u.data,null,2)),D("Tedarikçi başarıyla eklendi.","success"),x(u.data);const k=((B=(A=u.data)==null?void 0:A.Data)==null?void 0:B.id)||((M=(U=u.data)==null?void 0:U.data)==null?void 0:M.id);if(k&&k!==0){console.log("Yönlendirme yapılıyor, supplierId:",k);const t="/app/purchases/registered-supplier-purchase";setTimeout(()=>{try{S(t,{state:{supplierId:k}}),console.log("Yönlendirme tamamlandı, URL:",window.location.href),p()}catch(i){console.error("Yönlendirme hatası:",i),D("Yönlendirme başarısız oldu, lütfen tekrar deneyin.","error")}},100)}else console.error("Tedarikçi ID'si alınamadı veya sıfır, API cevabı:",u.data),D("Tedarikçi ID'si alınamadı veya geçersiz, lütfen tekrar deneyin.","error")}catch(y){console.error("Tedarikçi Ekleme Hatası:",{message:((H=(G=y==null?void 0:y.response)==null?void 0:G.data)==null?void 0:H.message)||y.message,status:(W=y==null?void 0:y.response)==null?void 0:W.status,data:(E=y==null?void 0:y.response)==null?void 0:E.data});let l=((_=(z=y==null?void 0:y.response)==null?void 0:z.data)==null?void 0:_.message)||"Tedarikçi eklenemedi.";((O=y.response)==null?void 0:O.status)===415&&(l="Sunucu dosya tipini desteklemiyor. Lütfen doğru formatta veri gönderin."),D(l,"error")}},L=()=>{switch(j){case"identity":return e.jsx(Pe,{formData:s,handleChange:d,handleImageUpload:w,errors:F,setErrors:P});case"financial":return e.jsx(Ee,{formData:s,handleChange:d});case"contact":return e.jsx(Ue,{formData:s,handleChange:d});case"other":return e.jsx(Be,{formData:s,handleChange:d});default:return null}};return e.jsxs(le,{visible:m,onClose:p,backdrop:"static",size:"lg",children:[e.jsx(Se,{placement:"top-end",className:"p-3",children:Y}),e.jsx(ne,{children:e.jsx(oe,{children:"Yeni Tedarikçi Ekle"})}),e.jsxs(ce,{children:[e.jsx(de,{className:"mb-3",children:e.jsx(te,{children:e.jsxs(ve,{role:"group",className:"mb-0",children:[e.jsx(C,{style:{backgroundColor:j==="identity"?"#FFFFFF":"#2965A8",color:j==="identity"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>T("identity"),children:"Kimlik Bilgileri"}),e.jsx(C,{style:{backgroundColor:j==="financial"?"#FFFFFF":"#2965A8",color:j==="financial"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>T("financial"),children:"Cari"}),e.jsx(C,{style:{backgroundColor:j==="contact"?"#FFFFFF":"#2965A8",color:j==="contact"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>T("contact"),children:"İletişim"}),e.jsx(C,{style:{backgroundColor:j==="other"?"#FFFFFF":"#2965A8",color:j==="other"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>T("other"),children:"Diğer"})]})})}),e.jsx(Ae,{id:"supplierForm",onSubmit:$,children:L()})]}),e.jsxs(me,{children:[e.jsxs(C,{type:"submit",form:"supplierForm",style:{width:"150px",color:"white",backgroundColor:"#1D9030"},children:[e.jsx(K,{icon:Te})," Kaydet"]}),e.jsx(C,{color:"secondary",onClick:p,children:"İptal"})]})]})},tt=()=>{const{setShowSupplierModal:m,navigate:p}=n.useContext(q),[x,S]=n.useState(!1),s=()=>{m(!0)},c=()=>{S(!0)},Y=f=>{p("/app/purchases/registered-supplier-purchase",{state:{supplier:f}}),S(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{color:"success",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:s,children:[e.jsx(K,{icon:ye})," Kayıtlı Tedarikçiden Ürün/Hizmet Gir"]}),e.jsxs(C,{color:"info",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:c,children:[e.jsx(K,{icon:ye})," Yeni Tedarikçiden Ürün/Hizmet Gir"]}),e.jsx(et,{visible:x,onClose:()=>S(!1),onSupplierCreated:Y})]})},we="https://speedsofttest.com/api",it=Fe.create({baseURL:we}),rt=()=>{const{filteredPurchases:m,navigate:p,addToast:x,suppliers:S,handleCancelPurchase:s,products:c}=n.useContext(q),[Y,f]=n.useState(!1),[j,T]=n.useState(null),[F,P]=n.useState(1),[D]=n.useState(10),[d,w]=n.useState({USD:32.5,EUR:35.2,lastUpdated:new Date,loading:!1,error:null}),$="doviz_kurlari_cache",L=async()=>{const t=localStorage.getItem($);if(t){const r=JSON.parse(t),a=new Date(r.lastUpdated).getTime();if(new Date().getTime()-a<5*60*1e3)return r}const i=[{url:"https://api.fastforex.io/fetch-multi?from=TRY&to=USD,EUR&api_key=demo",parser:r=>{var a,h;return{USD:(a=r.results)!=null&&a.USD?1/r.results.USD:32.5,EUR:(h=r.results)!=null&&h.EUR?1/r.results.EUR:35.2}}},{url:"https://api.exchangerate.host/latest?base=TRY&symbols=USD,EUR",parser:r=>{var a,h;return{USD:(a=r.rates)!=null&&a.USD?1/r.rates.USD:32.5,EUR:(h=r.rates)!=null&&h.EUR?1/r.rates.EUR:35.2}}},{url:"https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/try.json",parser:r=>{var a,h;return{USD:(a=r.try)!=null&&a.usd?1/r.try.usd:32.5,EUR:(h=r.try)!=null&&h.eur?1/r.try.eur:35.2}}}],o=new Promise((r,a)=>setTimeout(()=>a(new Error("Timeout")),3e3));for(const r of i)try{const a=fetch(r.url).then(X=>{if(!X.ok)throw new Error("API error");return X.json()}),h=await Promise.race([a,o]),J=r.parser(h),V={USD:J.USD,EUR:J.EUR,lastUpdated:new Date,loading:!1,error:null};return localStorage.setItem($,JSON.stringify(V)),V}catch(a){console.log(`API ${r.url} çalışmadı:`,a);continue}throw new Error("Tüm hızlı API'ler çalışmadı")},R=async()=>{try{w(i=>({...i,loading:!0,error:null}));const t=await L();w(t),x("Döviz kurları güncellendi.","success")}catch{console.log("Hızlı API'ler çalışmadı, fallback kullanılıyor");const i=localStorage.getItem($);if(i){const o=JSON.parse(i);w(o),x("Güncel kurlar alınamadı, önbellek kullanılıyor","warning");return}w({USD:32.5,EUR:35.2,lastUpdated:new Date,loading:!1,error:"Gerçek kurlar alınamadı, yaklaşık değerler kullanılıyor"}),x("Döviz kurları alınamadı, yaklaşık değerler kullanılıyor.","warning")}};n.useEffect(()=>{const t=localStorage.getItem($);if(t){const i=JSON.parse(t);w(i)}setTimeout(R,100)},[]);const g=F*D,v=g-D,A=m.slice(v,g),B=Math.ceil(m.length/D),U=m.reduce((t,i)=>i.paraBirimi==="TRY"?t+(i.toplam||0):t,0),M=m.reduce((t,i)=>i.paraBirimi==="EUR"?t+(i.toplam||0):t,0),G=m.reduce((t,i)=>i.paraBirimi==="USD"?t+(i.toplam||0):t,0),H=M*d.EUR,W=G*d.USD,E=U+H+W,z=t=>{const i=S.find(o=>o.id===t);return i?i.unvan:"Bilinmiyor"},_=t=>{if(t.urun&&t.urun.adi)return t.urun.adi;if(t.urunId&&c&&c.length>0){const i=c.find(o=>o.id===t.urunId);if(i&&i.adi)return i.adi}return t.urunId?`Ürün ID: ${t.urunId}`:"Bilinmiyor"},O=t=>new Date(t).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),y=()=>{const t=m.map((a,h)=>({No:h+1,Tarih:new Date(a.tarih).toLocaleDateString("tr-TR"),Tedarikçi:z(a.tedarikciId),"Ürün Adı":_(a),Miktar:a.miktar||0,"Belge No":a.belgeNo||"","Para Birimi":a.paraBirimi||"TRY",Tutar:a.toplam?`${a.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} ${a.paraBirimi||"TRY"}`:`0 ${a.paraBirimi||"TRY"}`,Durumu:a.durumu===1?"Faturalaşmış":"İptal"})),i=ie.json_to_sheet(t),o=ie.book_new();ie.book_append_sheet(o,i,"Alışlar");const r=[{wch:5},{wch:12},{wch:30},{wch:40},{wch:15},{wch:25},{wch:15},{wch:20},{wch:15}];i["!cols"]=r,$e(o,`Alışlar_${new Date().toLocaleDateString("tr-TR").replace(/\./g,"-")}.xlsx`),x("Excel dosyası başarıyla indirildi.","success")},l=()=>{const t=new Me("landscape");t.setFontSize(16),t.text("Alislar Raporu",14,20),t.setFontSize(10),t.text(`Olusturulma Tarihi: ${new Date().toLocaleDateString("tr-TR")}`,14,30),t.text(`Döviz Kurları: USD: ${d.USD.toFixed(2)} TRY, EUR: ${d.EUR.toFixed(2)} TRY`,14,37),t.text(`Kur Güncelleme: ${d.lastUpdated?O(d.lastUpdated):"Bilinmiyor"}`,14,44),d.error&&(t.setTextColor(220,53,69),t.text(`Uyarı: ${d.error}`,14,51),t.setTextColor(0,0,0));let i=d.error?58:51;t.text(`Toplam TRY: ${U.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY`,14,i),t.text(`Toplam EUR: ${M.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} EUR (${H.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY)`,14,i+7),t.text(`Toplam USD: ${G.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} USD (${W.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY)`,14,i+14),t.text(`Genel Toplam (TRY): ${E.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY`,14,i+21);const o=m.map((r,a)=>[a+1,new Date(r.tarih).toLocaleDateString("tr-TR"),z(r.tedarikciId),_(r),r.miktar||0,r.belgeNo||"",r.paraBirimi||"TRY",r.toplam?`${r.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} ${r.paraBirimi||"TRY"}`:`0 ${r.paraBirimi||"TRY"}`,r.durumu===1?"Faturalasmis":"Iptal"]);t.autoTable({startY:i+28,head:[["No","Tarih","Tedarikci","Urun Adi","Miktar","Belge No","Para Birimi","Tutar","Durumu"]],body:o,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,101,168],textColor:255,fontStyle:"bold"},columnStyles:{0:{cellWidth:15},1:{cellWidth:25},2:{cellWidth:55},3:{cellWidth:75},4:{cellWidth:20},5:{cellWidth:30},6:{cellWidth:20},7:{cellWidth:30},8:{cellWidth:25}}}),t.save(`Alışlar_${new Date().toLocaleDateString("tr-TR").replace(/\./g,"-")}.pdf`),x("PDF dosyası başarıyla indirildi.","success")},u=t=>{T(t),f(!0)},k=async()=>{var t,i,o,r,a;try{await it.delete(`${we}/alis/alis-delete/${j}`),x("Alış başarıyla silindi.","success"),s(j),f(!1),T(null)}catch(h){console.error("Alış silinirken hata:",h);const J=((t=h.response)==null?void 0:t.status)===404?`Alış ID ${j} bulunamadı.`:((o=(i=h.response)==null?void 0:i.data)==null?void 0:o.message)||((a=(r=h.response)==null?void 0:r.data)==null?void 0:a.error)||"Alış silinemedi. Lütfen tekrar deneyin.";x(J,"error"),f(!1),T(null)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",marginBottom:"20px",borderRadius:"5px",border:"1px solid #dee2e6"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h5",{style:{margin:0,color:"#2965A8",marginBottom:"10px"},children:["Genel Toplam (TRY):"," ",E.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"},children:[e.jsxs("span",{style:{color:"#2965A8",fontWeight:"bold"},children:["TRY:"," ",U.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("span",{style:{color:"#28a745",fontWeight:"bold"},children:["EUR:"," ",M.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","EUR ≈"," ",H.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("span",{style:{color:"#dc3545",fontWeight:"bold"},children:["USD:"," ",G.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","USD ≈"," ",W.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",minWidth:"250px"},children:[e.jsxs("div",{style:{backgroundColor:"#e9ecef",padding:"10px",borderRadius:"5px",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#495057"},children:"Döviz Kurları"}),e.jsxs("div",{style:{fontSize:"13px",color:"#6c757d"},children:[e.jsxs("div",{children:["USD: ",d.USD.toFixed(2)," TRY"]}),e.jsxs("div",{children:["EUR: ",d.EUR.toFixed(2)," TRY"]}),d.lastUpdated&&e.jsxs("div",{style:{fontSize:"12px",marginTop:"5px",color:"#868e96"},children:["Son güncelleme: ",O(d.lastUpdated)]}),d.error&&e.jsx("div",{style:{fontSize:"12px",color:"#dc3545",marginTop:"5px"},children:d.error})]}),e.jsxs(C,{color:"secondary",size:"sm",onClick:R,disabled:d.loading,style:{marginTop:"8px",fontSize:"12px"},children:[e.jsx(K,{icon:qe,style:{marginRight:"5px"}}),d.loading?"Güncelleniyor...":"Kurları Güncelle"]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs(C,{color:"success",size:"sm",onClick:y,style:{color:"white",flex:1},children:[e.jsx(K,{icon:Ve,style:{marginRight:"5px"}}),"Excel"]}),e.jsxs(C,{color:"danger",size:"sm",onClick:l,style:{color:"white",flex:"1"},children:[e.jsx(K,{icon:Te,style:{marginRight:"5px"}}),"PDF"]})]})]})]})}),e.jsxs(Ne,{hover:!0,responsive:!0,children:[e.jsx(Ie,{children:e.jsxs(fe,{children:[e.jsx(N,{children:"No"}),e.jsx(N,{children:"Tarih"}),e.jsx(N,{children:"Tedarikçi"}),e.jsx(N,{children:"Ürün Adı"}),e.jsx(N,{children:"Miktar"}),e.jsx(N,{children:"Belge No"}),e.jsx(N,{children:"Para Birimi"}),e.jsx(N,{children:"Tutar"}),e.jsx(N,{children:"Durumu"}),e.jsx(N,{children:"İşlemler"})]})}),e.jsx(Ye,{children:A.map((t,i)=>e.jsxs(fe,{children:[e.jsx(I,{children:v+i+1}),e.jsx(I,{children:new Date(t.tarih).toLocaleDateString("tr-TR")}),e.jsx(I,{children:z(t.tedarikciId)}),e.jsx(I,{children:_(t)}),e.jsx(I,{children:t.miktar}),e.jsx(I,{children:t.belgeNo||"-"}),e.jsx(I,{children:t.paraBirimi||"TRY"}),e.jsx(I,{children:t.toplam?t.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+` ${t.paraBirimi||"TRY"}`:`0 ${t.paraBirimi||"TRY"}`}),e.jsx(I,{children:t.durumu===1?"Faturalaşmış":"İptal"}),e.jsx(I,{children:e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(C,{color:"info",size:"sm",onClick:()=>p("/app/purchases/purchase-detail",{state:{purchaseId:t.id||null}}),style:{color:"white"},children:e.jsx(K,{icon:Le})}),e.jsx(C,{color:"danger",size:"sm",onClick:()=>u(t.id),style:{color:"white"},children:e.jsx(K,{icon:ze})})]})})]},t.id))})]}),B>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px",alignItems:"center",gap:"10px"},children:[e.jsxs("span",{style:{color:"#6c757d"},children:["Sayfa ",F," / ",B," (",m.length," ","kayıt)"]}),e.jsxs(Xe,{"aria-label":"Sayfalama",children:[e.jsx(ae,{"aria-label":"Önceki",disabled:F===1,onClick:()=>P(F-1),style:{cursor:F===1?"not-allowed":"pointer"},children:"Önceki"}),Array.from({length:B},(t,i)=>i+1).map(t=>e.jsx(ae,{active:t===F,onClick:()=>P(t),style:{cursor:"pointer"},children:t},t)),e.jsx(ae,{"aria-label":"Sonraki",disabled:F===B,onClick:()=>P(F+1),style:{cursor:F===B?"not-allowed":"pointer"},children:"Sonraki"})]})]}),e.jsxs(le,{visible:Y,onClose:()=>{f(!1),T(null)},children:[e.jsx(ne,{children:e.jsx(oe,{children:"Alışı Sil"})}),e.jsx(ce,{children:"Bu alışı silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."}),e.jsxs(me,{children:[e.jsx(C,{color:"secondary",onClick:()=>{f(!1),T(null)},children:"Hayır"}),e.jsx(C,{color:"danger",onClick:k,children:"Evet"})]})]})]})},at=()=>{const{showCancelled:m,setShowCancelled:p,docTypeFilter:x,setDocTypeFilter:S,timeFilter:s,setTimeFilter:c,searchType:Y,setSearchType:f,contentType:j,setContentType:T,searchTerm:F,setSearchTerm:P}=n.useContext(q);return e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"d-flex",children:e.jsxs(te,{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(Q,{children:[e.jsxs(Z,{color:"light",children:["Tüm Belge Tipleri: ",x]}),e.jsxs(ee,{children:[e.jsx(b,{onClick:()=>S("Tümünü seç"),children:"Tümünü seç"}),e.jsx(Qe,{}),e.jsx(b,{onClick:()=>S("Sipariş"),children:"Sipariş"}),e.jsx(b,{onClick:()=>S("İrsaliye"),children:"İrsaliye"}),e.jsx(b,{onClick:()=>S("Faturalaşmış"),children:"Faturalaşmış"})]})]}),e.jsxs(Q,{children:[e.jsx(Z,{color:"light",children:s}),e.jsxs(ee,{children:[e.jsx(b,{onClick:()=>c("Bu yılın Satışlarını Göster"),children:"Bu yılın Satışlarını Göster"}),e.jsx(b,{onClick:()=>c("Son 1 Ay"),children:"Son 1 Ay"}),e.jsx(b,{onClick:()=>c("Son 3 Ay"),children:"Son 3 Ay"}),e.jsx(b,{onClick:()=>c("Bugün"),children:"Bugün"}),e.jsx(b,{onClick:()=>c("Tamamını Göster"),children:"Tamamını Göster"})]})]})]}),e.jsx(Ge,{label:"İptalleri de göster",checked:m,onChange:()=>p(!m)})]})}),e.jsxs(te,{className:"d-flex flex-wrap align-items-center justify-content-between mt-2 gap-3",children:[e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(je,{type:"radio",button:{color:"light",variant:"outline"},name:"contentType",id:"products",label:"Ürünler",checked:j==="Ürünler",onChange:()=>T("Ürünler")}),e.jsx(je,{type:"radio",button:{color:"light",variant:"outline"},name:"contentType",id:"services",label:"Hizmetler",checked:j==="Hizmetler",onChange:()=>T("Hizmetler"),disabled:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",flexWrap:"wrap"},children:[e.jsx("span",{children:"Ara:"}),e.jsxs(Q,{children:[e.jsx(Z,{color:"light",children:Y}),e.jsxs(ee,{children:[e.jsx(b,{onClick:()=>f("Tedarikçi İsmi / Belge No"),children:"Tedarikçi İsmi / Belge No"}),e.jsx(b,{onClick:()=>f("Ürün Adı / Kodu / Barkodu"),children:"Ürün Adı / Kodu / Barkodu"}),e.jsx(b,{onClick:()=>f("Belge Açıklaması"),children:"Belge Açıklaması"}),e.jsx(b,{onClick:()=>f("Satır Açıklaması"),children:"Satır Açıklaması"})]})]})]}),e.jsx(He,{type:"text",placeholder:"Arama... (en az 3 karakter)",value:F,onChange:D=>P(D.target.value),style:{width:"240px"}})]})]})},st=()=>{const{loading:m,error:p,filteredPurchases:x}=n.useContext(q);return e.jsxs(We,{className:"my-3",children:[e.jsx(_e,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsx(at,{})}),e.jsxs(Ke,{children:[m&&e.jsx("p",{children:"Yükleniyor..."}),p&&e.jsx("p",{className:"text-danger",children:p}),!m&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Alış Sayısı: ",x.length]}),e.jsx(rt,{})]})]})]})},lt=()=>{const{showSupplierModal:m,setShowSupplierModal:p,suppliers:x,navigate:S}=n.useContext(q),s=c=>{p(!1),S("/app/purchases/registered-supplier-purchase",{state:{supplier:c}})};return e.jsxs(le,{visible:m,onClose:()=>p(!1),backdrop:"static",size:"lg",children:[e.jsx(ne,{children:e.jsx(oe,{children:"Tedarikçi Arama"})}),e.jsxs(ce,{children:[e.jsx("p",{style:{backgroundColor:"#FFC107",padding:"15px",borderRadius:"8px",marginBottom:"25px",fontWeight:"500"},children:"Alış yaptığınız tedarikçiyi bulun"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Tedarikçi Seçimi"}),e.jsxs(Q,{style:{width:"100%"},children:[e.jsx(Z,{color:"light",style:{width:"100%",textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"1px solid #ced4da",borderRadius:"6px",backgroundColor:"#fff",minHeight:"48px"},children:"Tedarikçi Seç"}),e.jsx(ee,{style:{width:"100%",maxHeight:"300px",overflowY:"auto",border:"1px solid #ced4da",borderRadius:"6px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:x.length===0?e.jsx(b,{disabled:!0,style:{padding:"12px 16px"},children:"Tedarikçi bulunamadı"}):x.map(c=>e.jsx(b,{onClick:()=>s(c),style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid #f8f9fa"},children:e.jsxs("div",{children:[e.jsx("strong",{children:c.unvan}),c.vergiNo&&e.jsxs("div",{style:{fontSize:"0.875rem",color:"#6c757d"},children:["Vergi No: ",c.vergiNo]})]})},c.id))})]})]})]}),e.jsx(me,{children:e.jsx(C,{color:"secondary",onClick:()=>p(!1),style:{color:"white"},children:"İptal"})})]})},se="https://speedsofttest.com/api",ut=()=>{const[m,p]=n.useState([]),[x,S]=n.useState([]),[s,c]=n.useState([]),[Y,f]=n.useState(!1),[j,T]=n.useState(null),[F,P]=n.useState(!1),[D,d]=n.useState(""),[w,$]=n.useState("Tümünü seç"),[L,R]=n.useState("Tamamını Göster"),[g,v]=n.useState("Tedarikçi İsmi / Belge No"),[A,B]=n.useState("Ürünler"),[U,M]=n.useState(!1),G=n.useRef(),H=ke(),W=Oe(),E=(l,u="success")=>{const k=e.jsxs(Ce,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(De,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:u==="error"?"Hata":"Başarılı"})}),e.jsx(be,{children:l})]},Date.now());p(t=>[...t,k])},z=async()=>{var l,u,k;f(!0);try{console.log("metod:fetchPurcahes");const{data:t}=await re.get(`${se}/alis/alis-get-all`);console.log("Fetched Purchases (Full Data):",JSON.stringify(t,null,2)),t.forEach((i,o)=>{var r;console.log(`Purchase ${o+1}:`,{id:i.id,toplam:i.toplam,urunAdi:((r=i.Urun)==null?void 0:r.Adi)||"Bilinmiyor",tedarikciId:i.tedarikciId,belgeNo:i.belgeNo,tarih:i.tarih,durumu:i.durumu,urun:i.Urun})}),S(t),T(null)}catch(t){console.error("Fetch Purchases Error:",((l=t.response)==null?void 0:l.data)||t),T(((k=(u=t.response)==null?void 0:u.data)==null?void 0:k.message)||"Alışlar yüklenemedi."),E("Alışlar yüklenemedi.","error")}finally{f(!1)}},_=async()=>{var l;try{const{data:u}=await re.get(`${se}/tedarikci/tedarikci-get-all`,{headers:{accept:"*/*"}});c(u.filter(k=>k.durumu===1))}catch(u){console.error("Fetch Suppliers Error:",((l=u.response)==null?void 0:l.data)||u),E("Tedarikçiler yüklenemedi.","error")}},O=async l=>{var u;try{await re.delete(`${se}/alis/alis-delete/${l}`),E("Alış başarıyla iptal edildi.","success"),z()}catch(k){console.error("Alış iptal edilirken hata:",((u=k.response)==null?void 0:u.data)||k),E("Alış iptal edilemedi.","error")}};n.useEffect(()=>{z(),_()},[W]);const y=x.filter(l=>{const u=w==="Tümünü seç"||l.docType===w||w==="Faturalaşmış"&&l.durumu===1,k=()=>{const o=new Date(l.tarih),r=new Date;return L==="Bu yılın Satışlarını Göster"?o.getFullYear()===r.getFullYear():L==="Son 1 Ay"?o>=new Date(r.setMonth(r.getMonth()-1)):L==="Son 3 Ay"?o>=new Date(r.setMonth(r.getMonth()-3)):L==="Bugün"?o.toDateString()===new Date().toDateString():!0},t=()=>{var r,a,h,J,V,X,ue,xe,he,pe,ge;if(D.length<3)return!0;const o=D.toLowerCase();return g==="Tedarikçi İsmi / Belge No"?l.tedarikciId&&((a=(r=s.find(Re=>Re.id===l.tedarikciId))==null?void 0:r.unvan)==null?void 0:a.toLowerCase().includes(o))||((h=l.belgeNo)==null?void 0:h.toLowerCase().includes(o)):g==="Ürün Adı / Kodu / Barkodu"?((V=(J=l.Urun)==null?void 0:J.Adi)==null?void 0:V.toLowerCase().includes(o))||((ue=(X=l.Urun)==null?void 0:X.UrunKodu)==null?void 0:ue.toLowerCase().includes(o))||((he=(xe=l.Urun)==null?void 0:xe.Barkod)==null?void 0:he.toLowerCase().includes(o)):g==="Belge Açıklaması"?(pe=l.aciklamaAlis)==null?void 0:pe.toLowerCase().includes(o):g==="Satır Açıklaması"?(ge=l.aciklamaUrun)==null?void 0:ge.toLowerCase().includes(o):!0},i=F?!0:l.durumu!==0;return u&&k()&&t()&&i});return e.jsx(Je,{children:e.jsxs(q.Provider,{value:{toasts:m,setToasts:p,purchases:x,setPurchases:S,suppliers:s,setSuppliers:c,loading:Y,setLoading:f,error:j,setError:T,showCancelled:F,setShowCancelled:P,searchTerm:D,setSearchTerm:d,docTypeFilter:w,setDocTypeFilter:$,timeFilter:L,setTimeFilter:R,searchType:g,setSearchType:v,contentType:A,setContentType:B,showSupplierModal:U,setShowSupplierModal:M,addToast:E,navigate:H,filteredPurchases:y,handleCancelPurchase:O},children:[e.jsx(Se,{ref:G,placement:"top-end",className:"p-3",children:m}),e.jsx(de,{className:"mb-3",children:e.jsx(te,{children:e.jsx(tt,{})})}),e.jsx(st,{}),e.jsx(lt,{})]})})};export{ut as default};
