import{j as e,$ as V,a0 as X,a1 as j,a2 as P,a3 as Z,a4 as b,r as o,u as ee,C as se,e as ae,f as B,q as te,m as ne,M as re,g as S,h as w,s as oe,ak as le,al as ce,am as T,a as ie,b as de,c as ue}from"./index-DtN76qeb.js";const me=({credits:m,onCreditClick:p})=>e.jsxs(V,{responsive:!0,hover:!0,children:[e.jsx(X,{children:e.jsxs(j,{children:[e.jsx(P,{children:"Kredi Adı"}),e.jsx(P,{children:"Kalan Tutar"})]})}),e.jsx(Z,{children:m.length>0?m.map(c=>e.jsxs(j,{onClick:()=>p(c),style:{cursor:"pointer"},children:[e.jsx(b,{children:c.name}),e.jsxs(b,{children:[c.remainingAmount.toLocaleString("tr-TR")," TRY"]})]},c.id)):e.jsx(j,{children:e.jsx(b,{colSpan:"2",children:"Kredi bulunamadı."})})})]}),fe=()=>{const[m,p]=o.useState([]),[c,M]=o.useState([]),[v,H]=o.useState([]),[A,h]=o.useState(!1),[y,I]=o.useState(null),[F,g]=o.useState(!1),[x,R]=o.useState(!1),[D,E]=o.useState(0),[Y,L]=o.useState(0),O=o.useRef(),$=ee(),k={1:"monthly",2:"bimonthly",3:"quarterly",4:"quadmonthly",6:"semiannually",12:"annually"},C="https://speedsofttest.com/api",q=()=>{try{return(JSON.parse(localStorage.getItem("user"))||{id:0}).id}catch(s){return console.error("Kullanıcı ID'si alınırken hata:",s),0}},i=(s,n="success")=>{const t=e.jsxs(ie,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(de,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:n==="error"?"Hata":"Başarılı"})}),e.jsx(ue,{children:s})]},Date.now());p(r=>[...r,t])},G=async()=>{var s,n;h(!0);try{const{data:t}=await T.get(`${C}/Hesap/hesap-get-allaktif`,{headers:{accept:"*/*"}});console.log("Hesaplar API response (Hesap/hesap-get-allaktif):",t),H(t),I(null)}catch(t){const r=((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Hesaplar yüklenemedi.";console.error("Hesaplar yüklenemedi:",t),i(r,"error")}finally{h(!1)}},K=async()=>{var s,n;h(!0);try{const{data:t}=await T.get(`${C}/kredi/get-all`,{headers:{accept:"*/*"}});console.log("Krediler API response (kredi/get-all):",t);const r=t.filter(a=>a.durumu===1).map(a=>({id:a.id,name:a.adi||`Kredi ${a.id}`,totalAmount:a.kalanBorc||0,remainingAmount:a.kalanBorc||0,installmentCount:a.kalanTaksit||0,nextPaymentDate:a.ilkTaksitTarih?new Date(a.ilkTaksitTarih).toISOString():new Date().toISOString(),paymentSchedule:k[a.odemeTakvim]||"monthly",accountId:a.hesapId||0,account:a.hesap||{tanim:"Bilinmeyen Hesap"},notes:a.notlar||"",durumu:a.durumu!==void 0?a.durumu:1}));M(r),z(r),I(null)}catch(t){const r=((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Krediler yüklenemedi.";console.error("Krediler yüklenemedi:",t),i(r,"error")}finally{h(!1)}},z=s=>{const n=s.filter(l=>l.durumu===1),t=n.reduce((l,u)=>l+(u.remainingAmount||0),0),r=new Date,a=r.getMonth(),d=r.getFullYear(),f=n.reduce((l,u)=>{if(!u.nextPaymentDate)return l;const N=new Date(u.nextPaymentDate);if(N.getMonth()===a&&N.getFullYear()===d){const Q=(u.totalAmount||0)/(u.installmentCount||1);return l+Q}return l},0);E(t),L(f)},J=s=>{try{if(!s||!s.id)throw new Error("Geçersiz kredi verisi");sessionStorage.setItem("selectedCredit",JSON.stringify(s)),console.log(`Kredi detayına yönlendiriliyor, ID: ${s.id}`),$("/app/credit-detail")}catch(n){console.error("Yönlendirme hatası:",n),i("Kredi detayı açılamadı","error")}},U=()=>{g(!0)},_=async s=>{var t,r;const n=q();if(!n){i("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}try{const a=Object.keys(k).find(l=>k[l]===s.paymentSchedule)||1,d={Adi:s.name,KalanBorc:parseFloat(s.remainingAmount),KalanTaksit:parseInt(s.installmentCount),IlkTaksitTarih:s.nextPaymentDate,OdemeTakvim:a,HesapId:parseInt(s.accountId),Notlar:s.notes,Durumu:1,kullaniciId:n};console.log("Kredi create payload:",d);const f=await T.post(`${C}/kredi/create`,d);console.log("Kredi create API response (kredi/create):",f.data),f.data&&(i("Kredi başarıyla eklendi.","success"),K(),g(!1))}catch(a){const d=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.Message)||"Kredi eklenemedi: Bilinmeyen hata";console.error("Kredi ekleme hatası:",a),i(d,"error")}};o.useEffect(()=>{G(),K()},[]);const W=x?c:c.filter(s=>(s.remainingAmount||0)>0&&s.durumu===1);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .custom-form-switch .form-check-input:checked {
            background-color: #34A149 !important;
            border-color: #2965A8 !important;
          }
          .custom-form-switch .form-check-input:checked::after {
            background-color: #ffffff !important;
          }
          .custom-form-switch .form-check-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(41, 101, 168, 0.25) !important;
          }
          .custom-form-switch .form-check-label {
            color: #fff;
          }
          .custom-form-switch .form-check-input {
            transition: background-color 0.3s ease;
          }
        `}),e.jsx(se,{ref:O,placement:"top-end",className:"p-3",children:m}),e.jsxs(ae,{className:"d-flex justify-content-between mb-3",children:[e.jsx(B,{children:e.jsxs(te,{color:"info",className:"text-light",onClick:U,children:[e.jsx(ne,{icon:re})," Yeni Kredi Ekle"]})}),e.jsxs(B,{className:"d-flex gap-3 justify-content-end",children:[e.jsx(S,{className:"p-3",children:e.jsxs(w,{children:[e.jsx("h5",{children:"Kalan Ödemeler"}),e.jsxs("p",{className:"fw-bold fs-5 text-success",children:[e.jsx("span",{className:"fs-4",children:"₺"})," ",D.toLocaleString("tr-TR")]})]})}),e.jsx(S,{className:"p-3",children:e.jsxs(w,{children:[e.jsx("h5",{children:"Bu Ayki Ödemeler"}),e.jsxs("p",{className:"fw-bold fs-5 text-warning",children:[e.jsx("span",{className:"fs-4",children:"₺"})," ",Y.toLocaleString("tr-TR")]})]})})]})]}),e.jsxs(S,{className:"my-3",children:[e.jsx(oe,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:"Kredi Listesi"}),e.jsx(le,{label:"Borcu Bitenleri Göster",className:"fs-6 custom-form-switch",checked:x,onChange:()=>R(!x),style:{backgroundColor:"#ccc",borderColor:"#ccc"}})]})}),e.jsxs(w,{children:[A&&e.jsx("p",{children:"Yükleniyor..."}),y&&e.jsx("p",{className:"text-danger",children:y}),!A&&!y&&e.jsx(me,{credits:W,onCreditClick:J})]})]}),e.jsx(ce,{visible:F,onClose:()=>g(!1),onSubmit:_,addToast:i,accounts:v})]})};export{fe as default};
