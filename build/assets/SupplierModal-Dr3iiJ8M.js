import{r as s,j as r,N as U,Q as Y,S as z,T as A,i as $,aq as q,q as b,W as H,t as B,av as P,aw as _,ax as Q,ay as W}from"./index-DAwD_DDx.js";const j="https://speedsofttest.com/api",V=({visible:F,onClose:M,onSubmit:D,addToast:f,supplier:i=null})=>{const[a,u]=s.useState({id:0,unvan:"",image:null,fotograf:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:""}),[x,I]=s.useState("identity"),[m,g]=s.useState(!1),[T,S]=s.useState(null),[k,d]=s.useState({}),[w,E]=s.useState([]);s.useEffect(()=>{i&&u({id:i.id||0,unvan:i.name||"",image:null,fotograf:i.fotograf||"",vergiDairesi:i.taxOffice||"",vergiNo:i.taxOrIdNumber||"",vergiMuaf:i.isTaxExempt||!1,bankaBilgileri:i.bankInfo||"",paraBirimi:i.currency||"TRY",vadeGun:i.dueDate||"",acilisBakiyesi:i.openBalance||"",yetkiliKisi:i.contactPerson||"",email:i.email||"",adres:i.address||"",telefon:i.phone||"",diger:i.otherContact||"",tedarikciSiniflandirmaId:i.classification||"",kodu:i.accountingCode||"",aciklama:i.note||""})},[i]);const G=async()=>{var e,t;try{g(!0);const{data:o}=await B.get(`${j}/tedarikciSiniflandirma/get-all`);E(o.filter(n=>n.durumu===1)),S(null)}catch(o){const n=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"Sınıflandırmalar yüklenemedi.";S(n),f(n,"error")}finally{g(!1)}};s.useEffect(()=>{G()},[]);const v=e=>{const{name:t,value:o,type:n,checked:y}=e.target;u(c=>({...c,[t]:n==="checkbox"?y:o})),d(c=>({...c,[t]:""}))},N=e=>{const t=e.target.files[0];t&&u(o=>({...o,image:t,fotograf:URL.createObjectURL(t)}))},R=()=>{var t,o;const e={};return(t=a.unvan)!=null&&t.trim()||(e.unvan="Tedarikçi unvanı zorunlu"),(o=a.email)!=null&&o.trim()?/\S+@\S+\.\S+/.test(a.email)||(e.email="Geçerli bir e-posta adresi giriniz"):e.email="E-posta adı zorunlu",d(e),Object.keys(e).length===0},K=async e=>{var t,o,n,y,c;if(e.preventDefault(),!R()){f("Lütfen zorunlu alanları doğru şekilde doldurun.","error");return}try{g(!0);const l={id:a.id||0,unvan:a.unvan||"",vergiDairesi:a.vergiDairesi||"",vergiNo:a.vergiNo||"",vergiMuaf:a.vergiMuaf?1:0,bankaBilgileri:a.bankaBilgileri||"",paraBirimi:a.paraBirimi||"TRY",vadeGun:parseInt(a.vadeGun)||0,acilisBakiyesi:parseFloat(a.acilisBakiyesi)||0,yetkiliKisi:a.yetkiliKisi||"",email:a.email||"",adres:a.adres||"",telefon:a.telefon||"",diger:a.diger||"",tedarikciSiniflandirmaId:parseInt(a.tedarikciSiniflandirmaId)||0,kodu:a.kodu||"",aciklama:a.aciklama||"",fotograf:a.image||a.fotograf||""},h=new FormData;for(const p in l)p==="fotograf"&&a.image?h.append("fotograf",a.image):h.append(p,l[p]===null?"":l[p]);const O=a.id?await B.put(`${j}/tedarikci/tedarikci-update`,h,{headers:{"Content-Type":"multipart/form-data"}}):await B.post(`${j}/tedarikci/tedarikci-create`,h,{headers:{"Content-Type":"multipart/form-data"}});D({...l,fotograf:((t=O.data.data)==null?void 0:t.fotograf)||a.fotograf}),f(a.id?"Tedarikçi başarıyla güncellendi.":"Tedarikçi başarıyla oluşturuldu.","success"),C()}catch(l){console.error("Tedarikçi Güncelleme/Oluşturma Hatası:",{message:l.message,status:(o=l.response)==null?void 0:o.status,data:(n=l.response)==null?void 0:n.data}),f(((c=(y=l.response)==null?void 0:y.data)==null?void 0:c.message)||"Tedarikçi güncellenemedi/oluşturulamadı. Lütfen veri formatını kontrol edin.","error")}finally{g(!1)}},C=()=>{u({id:0,unvan:"",image:null,fotograf:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:""}),d({}),S(null),M()},L=()=>{switch(x){case"identity":return r.jsx(W,{formData:a,handleChange:v,handleImageUpload:N,errors:k,setErrors:d,classifications:w});case"financial":return r.jsx(Q,{formData:a,handleChange:v,errors:k,setErrors:d});case"contact":return r.jsx(_,{formData:a,handleChange:v,errors:k});case"other":return r.jsx(P,{formData:a,handleChange:v,errors:k,setErrors:d});default:return null}};return r.jsxs(U,{visible:F,onClose:C,backdrop:"static",size:"lg",children:[r.jsx(Y,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},children:r.jsx(z,{children:a.id?"Tedarikçi Bilgilerini Güncelle":"Yeni Tedarikçi Ekle"})}),r.jsxs(A,{children:[m&&r.jsx("p",{children:"Yükleniyor..."}),T&&r.jsx("div",{className:"text-danger",children:T}),r.jsxs($,{id:"supplierUpdateForm",onSubmit:K,children:[r.jsx(q,{role:"group",className:"mb-3",children:["identity","financial","contact","other"].map(e=>r.jsx(b,{style:{backgroundColor:x===e?"#FFFFFF":"var(--primary-color)",color:x===e?"var(--primary-color)":"var(--white-color)",border:"1px solid var(--primary-color)"},onClick:()=>I(e),disabled:m,children:e==="identity"?"Kimlik Bilgileri":e==="financial"?"Cari":e==="contact"?"İletişim":"Diğer"},e))}),L()]})]}),r.jsxs(H,{children:[r.jsx(b,{type:"submit",form:"supplierUpdateForm",style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},disabled:m,children:"Kaydet"}),r.jsx(b,{style:{backgroundColor:"var(--secondary-color)",color:"var(--white-color)"},onClick:C,disabled:m,children:"İptal"})]})]})};export{V as S};
