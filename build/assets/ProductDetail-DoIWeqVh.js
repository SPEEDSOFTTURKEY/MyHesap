import{r as d,j as e,U as X,o as ye,q as f,N as de,Q as he,S as je,T as me,i as we,ap as De,W as fe,aD as Te,aE as Fe,aF as Re,t as M,Z as pe,g as E,h as Y,m as le,a8 as Me,a9 as Ae,aa as $e,V as be,ag as Ve,al as Be,ah as Ke,J as Ne,u as ze,s as H,C as Ee,e as oe,f as I,X as Ye,B as Se,D as Ie,E as Ce,F as ce,$ as ge,a0 as ue,a1 as ae,a2 as v,a3 as xe,a4 as D,a as Ue,b as Ge,c as Le}from"./index-DvA_wB1j.js";import{c as He}from"./cil-warning-C7g3f07Q.js";import{c as ke}from"./cil-list-CLA-Txc1.js";const qe=({formData:x,handleImageUpload:T,handleImageRemove:A})=>{const[n,a]=d.useState(null),s={padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"0.5rem",border:"1px solid #dee2e6",marginBottom:"1rem"},$={fontSize:"0.85rem",fontWeight:"600",marginBottom:"0.5rem",color:"#495057",display:"block"},V={fontSize:"0.9rem",padding:"0.4rem 0.75rem",borderRadius:"0.375rem",border:"1px solid #ced4da",backgroundColor:"#fff",marginBottom:"1rem"},Q={fontSize:"0.95rem",fontWeight:"bold",marginBottom:"1rem",color:"#2c3e50",borderBottom:"2px solid #3498db",paddingBottom:"0.5rem"},B={display:"flex",gap:"0.75rem",flexWrap:"wrap",marginTop:"1rem"},K={width:"100px",height:"100px",objectFit:"cover",borderRadius:"0.375rem",border:"1px solid #dee2e6",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"all 0.2s ease",cursor:"pointer"},U={...K,border:"2px solid #3498db",boxShadow:"0 0 0 3px rgba(52, 152, 219, 0.3)"},C={textAlign:"center",padding:"2rem",color:"#6c757d",fontStyle:"italic",backgroundColor:"#fff",borderRadius:"0.375rem",border:"1px dashed #dee2e6"},S={marginTop:"1.5rem",padding:"1rem",backgroundColor:"#fff",borderRadius:"0.5rem",border:"1px solid #dee2e6"},N={maxWidth:"100%",maxHeight:"300px",borderRadius:"0.375rem",border:"1px solid #dee2e6"},z={fontSize:"0.8rem",padding:"0.25rem 0.5rem",marginTop:"0.5rem"};return e.jsxs("div",{style:s,children:[e.jsx("div",{style:Q,children:"Ürün Resimleri"}),e.jsxs("div",{children:[e.jsx(X,{style:$,children:"Resim Ekle"}),e.jsx(ye,{type:"file",multiple:!0,accept:"image/*",onChange:T,style:{...V,color:"#000000"}})]}),x.images&&x.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:B,children:x.images.map((g,c)=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:g,alt:`Ürün resmi ${c+1}`,style:n===c?U:K,onMouseEnter:h=>{h.target.style.transform="scale(1.05)",h.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseLeave:h=>{h.target.style.transform="scale(1)",h.target.style.boxShadow=n===c?"0 0 0 3px rgba(52, 152, 219, 0.3)":"0 2px 4px rgba(0,0,0,0.1)"},onClick:()=>a(c)}),e.jsx(f,{color:"danger",size:"sm",style:{position:"absolute",top:"-8px",right:"-8px",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",padding:0},onClick:()=>A(c),children:"×"})]},c))}),n!==null&&e.jsxs("div",{style:S,children:[e.jsx("h6",{style:{marginBottom:"0.75rem",color:"#495057"},children:"Büyük Ön İzleme"}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("img",{src:x.images[n],alt:`Büyük ön izleme ${n+1}`,style:N})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[e.jsx(f,{color:"primary",size:"sm",style:z,onClick:()=>a(null),children:"Ön İzlemeyi Kapat"}),e.jsx(f,{color:"danger",size:"sm",style:z,onClick:()=>{A(n),a(null)},children:"Bu Resmi Sil"})]})]})]}):e.jsxs("div",{style:C,children:[e.jsx("p",{children:"Henüz hiç resim eklenmemiş"}),e.jsx("small",{children:"Yukarıdaki alandan resim yükleyebilirsiniz"})]})]})},se="https://speedsofttest.com/api",Oe=({visible:x,onClose:T,onSubmit:A,addToast:n,product:a=null})=>{const[s,$]=d.useState({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",unit:(a==null?void 0:a.unit)||"Adet",type:(a==null?void 0:a.type)||"Stoklu",categoryId:(a==null?void 0:a.categoryId)||"",brandId:(a==null?void 0:a.brandId)||"",shelfId:(a==null?void 0:a.shelfId)||"",depoId:(a==null?void 0:a.depoId)||"",salePrice:a!=null&&a.salePrice?String(a.salePrice):"",saleCurrency:(a==null?void 0:a.saleCurrency)||"TRY",purchaseCurrency:(a==null?void 0:a.purchaseCurrency)||"TRY",saleVatRate:a!=null&&a.saleVatRate?String(a.saleVatRate):"",saleVatIncluded:(a==null?void 0:a.saleVatIncluded)||!1,otvRate:a!=null&&a.otvRate?String(a.otvRate):"",otvType:(a==null?void 0:a.otvType)||"Yok",purchasePrice:a!=null&&a.purchasePrice?String(a.purchasePrice):"",purchaseVatRate:a!=null&&a.purchaseVatRate?String(a.purchaseVatRate):"",purchaseVatIncluded:(a==null?void 0:a.purchaseVatIncluded)||!1,purchaseDiscount:a!=null&&a.purchaseDiscount?String(a.purchaseDiscount):"",productCode:(a==null?void 0:a.productCode)||"",gtip:(a==null?void 0:a.gtip)||"",countryCode:(a==null?void 0:a.countryCode)||"TR",stockAmount:a!=null&&a.stockAmount?String(a.stockAmount):"",invoiceTitle:(a==null?void 0:a.invoiceTitle)||"",description:(a==null?void 0:a.description)||"",barcode:(a==null?void 0:a.barcode)||"",trackStock:(a==null?void 0:a.trackStock)||!1,criticalStock:a!=null&&a.criticalStock?String(a.criticalStock):"",tags:Array.isArray(a==null?void 0:a.tags)?a.tags.join(", "):"",images:Array.isArray(a==null?void 0:a.images)?a.images:[]}),[V,Q]=d.useState("productDefinition"),[B,K]=d.useState(!1),[U,C]=d.useState(!1),S=r=>{const{name:o,value:p,type:j,checked:t}=r.target;$(u=>({...u,[o]:j==="checkbox"?t:p}))},N=r=>{const o=Array.from(r.target.files);$(p=>({...p,images:[...p.images,...o]}))},z=r=>{if(r.preventDefault(),!s.name||!s.salePrice||!s.unit){n({message:"Ürün Adı, Satış Fiyatı ve Birim zorunlu alanlardır.",color:"danger"});return}C(!0)},g=async()=>{var r,o,p;try{K(!0);const j=JSON.parse(localStorage.getItem("user"))||{id:0},t=new FormData;t.append("Id",s.id||0),t.append("Adi",s.name||""),t.append("UrunTipi",s.type==="Stoklu"),t.append("BirimAdi",s.unit==="Adet"?"adet":s.unit||"adet");const u=parseFloat(s.salePrice.replace(",","."))||0,G=parseFloat(s.purchasePrice.replace(",","."))||0,y=parseFloat(s.saleVatRate.replace(",","."))||0,q=parseFloat(s.purchaseVatRate.replace(",","."))||0,J=parseFloat(s.otvRate.replace(",","."))||0,O=parseFloat(s.purchaseDiscount.replace(",","."))||0,P=parseInt(s.stockAmount)||0,Z=parseInt(s.criticalStock)||0;if(t.append("SatisFiyat",u),t.append("AlisFiyat",G),t.append("SatisKDV",y),t.append("AlisKDV",q),t.append("SatisKdvDahilmi",s.saleVatIncluded),t.append("AlisKdvDahilmi",s.purchaseVatIncluded),t.append("OIVOrani",J),t.append("AlisIskontosu",O),t.append("OTVTipi",s.otvType==="Yok"?null:s.otvType),t.append("UrunKategoriId",parseInt(s.categoryId)||0),t.append("UrunMarkaId",parseInt(s.brandId)||0),t.append("UrunRafId",parseInt(s.shelfId)||0),t.append("DepoId",parseInt(s.depoId)||0),t.append("UrunKodu",s.productCode||""),t.append("GTIPKodu",s.gtip||""),t.append("UlkeId",parseInt(s.countryCode)||0),t.append("StokMiktari",P),t.append("FaturaBasligi",s.invoiceTitle||""),t.append("Aciklama",s.description||""),t.append("Barkod",s.barcode||""),t.append("StokTakip",s.trackStock?"Evet":"Hayır"),t.append("KritikStok",Z),t.append("Etiketler",s.tags||""),t.append("Durumu",1),t.append("KullaniciId",j.id),s.images.length>0){for(const w of s.images)if(w instanceof File)t.append("Fotograf",w);else if(typeof w=="string"&&w.startsWith("data:image")){const ee=await(await fetch(w)).blob();t.append("Fotograf",ee,"image.png")}}else(r=a==null?void 0:a.images)!=null&&r[0]&&t.append("Fotograf",a.images[0]);const F=a!=null&&a.id?`${se}/urun/urun-update`:`${se}/urun/urun-create`,R=await M[a!=null&&a.id?"put":"post"](F,t,{headers:{"Content-Type":"multipart/form-data"}});if(R.data.message==="Güncelleme Başarılı."||R.data.message==="Ekleme Başarılı."){let w="",ee="",ne="";try{s.categoryId&&(w=(await M.get(`${se}/urunKategori/get-by-id/${s.categoryId}`)).data.adi||""),s.brandId&&(ee=(await M.get(`${se}/urunMarka/get-by-id/${s.brandId}`)).data.adi||""),s.shelfId&&(ne=(await M.get(`${se}/urunRaf/get-by-id/${s.shelfId}`)).data.adi||""),s.depoId&&(ne=(await M.get(`${se}/depo/depo-get-by-id/${s.depoId}`)).data.adi||"")}catch(L){console.error("Error fetching names:",L),n("Kategori, marka veya raf isimleri alınamadı.","error")}A({id:(a==null?void 0:a.id)||R.data.id,name:s.name,unit:s.unit,type:s.type,categoryId:parseInt(s.categoryId)||0,brandId:parseInt(s.brandId)||0,shelfId:parseInt(s.shelfId)||0,depoId:parseInt(s.depoId)||0,category:w,brand:ee,shelfLocation:ne,salePrice:u,saleCurrency:s.saleCurrency,purchaseCurrency:s.purchaseCurrency,saleVatRate:y,saleVatIncluded:s.saleVatIncluded,otvRate:J,otvType:s.otvType,purchasePrice:G,purchaseVatRate:q,purchaseVatIncluded:s.purchaseVatIncluded,purchaseDiscount:O,productCode:s.productCode,gtip:s.gtip,countryCode:s.countryCode,stockAmount:P,invoiceTitle:s.invoiceTitle,description:s.description,barcode:s.barcode,trackStock:s.trackStock,criticalStock:Z,tags:s.tags?s.tags.split(",").map(L=>L.trim()):[],images:s.images}),n(a!=null&&a.id?"Ürün başarıyla güncellendi.":"Ürün başarıyla eklendi.","success"),C(!1),T()}else throw new Error("Sunucu yanıtı beklenmedik: "+R.data.message)}catch(j){console.error("Submit Error:",j.message,j.stack),n(((p=(o=j.response)==null?void 0:o.data)==null?void 0:p.message)||"Ürün işlemi başarısız.","error")}finally{K(!1)}},c=()=>{C(!1),T()},h=()=>{switch(V){case"productDefinition":return e.jsx(Re,{formData:s,handleChange:S});case"pricing":return e.jsx(Fe,{formData:s,handleChange:S});case"otherInfo":return e.jsx(Te,{formData:s,handleChange:S});case"images":return e.jsx(qe,{formData:s,handleImageUpload:N});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsxs(de,{visible:x,onClose:c,backdrop:"static",size:"lg",children:[e.jsx(he,{style:{backgroundColor:"#2965A8",color:"#fff"},children:e.jsx(je,{children:a!=null&&a.id?"":"Yeni Ürün/Hizmet Ekle"})}),e.jsx(me,{children:e.jsxs(we,{onSubmit:z,children:[e.jsx(De,{role:"group",className:"mb-4 w-100",children:["productDefinition","pricing","otherInfo","images"].map(r=>e.jsx(f,{style:{backgroundColor:V===r?"#FFFFFF":"#2965A8",color:V===r?"#2965A8":"#FFFFFF",border:"1px solid #2965A8",flex:1,textAlign:"center"},onClick:()=>Q(r),disabled:B,children:r==="productDefinition"?"Ürün/Hizmet Tanımı":r==="pricing"?"Fiyatlandırma":r==="otherInfo"?"Diğer Bilgiler":"Resimler"},r))}),e.jsx("div",{style:{padding:"0 15px"},children:h()}),e.jsxs(fe,{children:[e.jsx(f,{color:"secondary",onClick:c,disabled:B,children:"Vazgeç"}),e.jsx(f,{color:"primary",type:"submit",disabled:B,children:B?"Kaydediliyor...":"Kaydet"})]})]})})]}),e.jsxs(de,{visible:U,onClose:()=>C(!1),className:"shadow-sm",backdrop:"static",children:[e.jsx(he,{style:{backgroundColor:"#2965A8",color:"#FFFFFF"},children:e.jsx(je,{children:"Güncelleme Onayı"})}),e.jsx(me,{children:e.jsxs("p",{children:['Ürün "',e.jsx("strong",{children:(s==null?void 0:s.name)||"Bilinmeyen Ürün"}),'"'," ",a!=null&&a.id?"güncellenecek":"eklenecek",", emin misiniz?"]})}),e.jsxs(fe,{children:[e.jsx(f,{color:"secondary",onClick:()=>C(!1),children:"İptal"}),e.jsx(f,{color:"primary",onClick:g,className:"text-white",children:"Onayla"})]})]})]})},ie="https://speedsofttest.com/api",re=Be.create({baseURL:ie}),We=({visible:x,onClose:T,onSubmit:A,product:n,addToast:a})=>{const[s,$]=d.useState({transactionDate:pe(),transactionType:"1",quantity:"",unitCost:(n==null?void 0:n.purchasePrice)||"",warehouseId:"",description:""}),[V,Q]=d.useState([]),[B,K]=d.useState(!1),U=async()=>{var g,c;try{K(!0);const{data:h}=await re.get(`${ie}/depo/get-all`);console.log("Raw depo data from API (depo/get-all):",h),Q(h.filter(r=>r.durumu===1))}catch(h){a(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Depolar yüklenemedi.","error")}finally{K(!1)}},C=async(g,c)=>{var h,r;try{const{data:o}=await re.get(`${ie}/urun/urun-depolardaki-stoklar/${g}`);console.log("Raw stock data from API (urun-depolardaki-stoklar):",o);const p=o.find(j=>j.depoId===parseInt(c));return p?p.miktar:0}catch(o){return a(((r=(h=o.response)==null?void 0:h.data)==null?void 0:r.message)||"Depo stoğu yüklenemedi.","error"),0}};d.useEffect(()=>{x&&(U(),$({transactionDate:pe(),transactionType:"1",quantity:"",unitCost:(n==null?void 0:n.purchasePrice)||"",warehouseId:"",description:""}))},[x,n]);const S=g=>{const{name:c,value:h}=g.target;$(r=>({...r,[c]:h}))},N=g=>{$(c=>({...c,transactionDate:g}))},z=async g=>{var c,h,r;g.preventDefault();try{if(!s.quantity||!s.warehouseId||!s.unitCost)throw new Error("Miktar, Birim Maliyet ve Depo alanları zorunludur.");if(parseFloat(s.quantity)<=0)throw new Error("Miktar sıfırdan büyük olmalıdır.");if(parseFloat(s.unitCost)<0)throw new Error("Birim Maliyet negatif olamaz.");if(!(n!=null&&n.id))throw new Error("Ürün ID'si bulunamadı.");const o=JSON.parse(localStorage.getItem("user"))||{id:0};if(!V.find(F=>F.id===parseInt(s.warehouseId)))throw new Error("Geçersiz depo seçimi.");const j=parseFloat(s.unitCost)!==parseFloat(n.purchasePrice);let t=n.id;if(j){const F={adi:`${n.name} (Yeni Maliyet)`,urunTipi:n.type==="Stoklu",birimAdi:n.unit==="Adet"?0:n.unit,satisFiyat:n.salePrice,alisFiyat:parseFloat(s.unitCost),satisKDV:n.saleVatRate,alisKDV:n.purchaseVatRate,satisKdvDahilmi:n.saleVatIncluded,alisKdvDahilmi:n.purchaseVatIncluded,alisIskontosu:n.purchaseDiscount,oivOrani:n.otvRate,otvTipi:n.otvType,urunKategoriId:n.categoryId||0,urunMarkaId:n.brandId||0,urunKodu:n.productCode,gtipKodu:n.gtip,ulkeId:parseInt(n.countryCode)||0,stokMiktari:s.transactionType==="1"?parseFloat(s.quantity):0,faturaBasligi:n.invoiceTitle,aciklama:n.description,barkod:n.barcode,urunRafId:n.shelfId||0,depoId:n.depoId||0,stokTakip:n.trackStock?"Evet":"Hayır",kritikStok:n.criticalStock,etiketler:n.tags.join(","),fotograf:n.images[0]||"",kullaniciId:o.id};console.log("Creating new product with payload:",F);const{data:R}=await re.post(`${ie}/urun/urun-create`,F);console.log("Response from API (urun-create):",R),t=R.id,a("Yeni ürün oluşturuldu.","success")}if(s.transactionType==="0"&&await C(t,s.warehouseId)<parseFloat(s.quantity))throw new Error("Çıkış miktarı mevcut stoktan fazla olamaz.");const u=new FormData;u.append("Id","0"),u.append("UrunId",t),u.append("IslemTipi",parseInt(s.transactionType)),u.append("Miktar",parseFloat(s.quantity)),u.append("Maliyet",parseFloat(s.unitCost)),u.append("DepoId",parseInt(s.warehouseId)),u.append("Aciklama",s.description||"Manuel Giriş"),u.append("IslemTarihi",s.transactionDate.format("YYYY-MM-DDTHH:mm:ss.SSSZ")),u.append("KullaniciId",o.id),console.log("Sending stock movement payload to /api/urun/urun-manuelstokgiris:");for(let[F,R]of u.entries())console.log(`${F}: ${R}`);const{data:G}=await re.post(`${ie}/urun/urun-manuelstokgiris`,u,{headers:{"Content-Type":"multipart/form-data"}});console.log("Response from API (urun-manuelstokgiris):",G);const y=await C(t,s.warehouseId),q=parseFloat(s.quantity)*(s.transactionType==="1"?1:-1),J=y+q;if(J<0)throw new Error("Stok miktarı negatif olamaz.");const O={urunId:t,kullaniciId:o.id,depoMiktarlari:[{depoId:parseInt(s.warehouseId),miktar:J}]};console.log("Sending depot stock update payload to /api/urun/urun-toplu-depostok-guncelle:",O);const{data:P}=await re.post(`${ie}/urun/urun-toplu-depostok-guncelle`,O);console.log("Response from API (urun-toplu-depostok-guncelle):",P);const Z={id:(G==null?void 0:G.id)||Date.now(),date:s.transactionDate.format("YYYY-MM-DD HH:mm:ss"),description:s.description||"Manuel Giriş",quantity:parseFloat(s.quantity),price:parseFloat(s.unitCost)};console.log("Adding new movement to table:",Z),a("Stok hareketi kaydedildi.","success"),A(Z)}catch(o){console.error("Error during submission:",((c=o.response)==null?void 0:c.data)||o.message),a(((r=(h=o.response)==null?void 0:h.data)==null?void 0:r.message)||o.message||"Stok hareketi kaydedilemedi.","error")}};return e.jsxs(de,{visible:x,onClose:T,backdrop:"static",size:"lg",children:[e.jsx(he,{children:e.jsx(je,{children:"Manuel Giriş-Çıkış İşlemleri"})}),e.jsx(me,{children:e.jsxs(we,{onSubmit:z,children:[e.jsx(E,{className:"mb-3",children:e.jsxs(Y,{className:"bg-danger text-white",children:[e.jsxs("h4",{children:["Dikkat ",e.jsx(le,{icon:He,size:"lg"})]}),e.jsx("p",{children:"Alış, satış, iade ya da üretim dışında bu ürünün stok giriş çıkış işlemi varsa buradan yapabilirsiniz. Buradan yapacağınız işlem, müşterileri ya da tedarikçi bakiyelerinizi etkilemeyecek, sadece depo stoklarınızı güncelleyecektir."})]})}),e.jsx(X,{children:"İşlem Tarihi"}),e.jsx(Me,{dateAdapter:Ae,children:e.jsx($e,{value:s.transactionDate,onChange:N,format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,className:"mb-3"}}})}),e.jsx(X,{children:"İşlem Tipi"}),e.jsxs(be,{name:"transactionType",value:s.transactionType,onChange:S,className:"mb-3",children:[e.jsx("option",{value:"1",children:"Stoklara Giriş Yap"}),e.jsx("option",{value:"0",children:"Stoklardan Çıkış Yap"})]}),e.jsx(X,{children:"Miktar (Adet)"}),e.jsx(ye,{type:"number",name:"quantity",value:s.quantity,onChange:S,required:!0,className:"mb-3",step:"0.01",min:"0.01"}),e.jsx(X,{children:"Birim Maliyet"}),e.jsx(ye,{type:"number",name:"unitCost",value:s.unitCost,onChange:S,required:!0,className:"mb-3",step:"0.01",min:"0"}),e.jsx(X,{children:"İlgili Depo"}),e.jsxs(be,{name:"warehouseId",value:s.warehouseId,onChange:S,className:"mb-3",disabled:B,required:!0,children:[e.jsx("option",{value:"",children:"Depo Seç"}),V.map(g=>e.jsx("option",{value:g.id,children:g.adi},g.id))]}),e.jsx(X,{children:"Açıklama"}),e.jsx(Ve,{name:"description",value:s.description,onChange:S,rows:3,className:"mb-3"})]})}),e.jsxs(fe,{children:[e.jsx(f,{color:"primary",type:"submit",onClick:z,children:"Kaydet"}),e.jsx(f,{color:"secondary",onClick:T,children:"Vazgeç"})]})]})},_="https://speedsofttest.com/api",Ze=()=>{const{id:x}=Ke(),{state:T}=Ne(),A=ze(),[n,a]=d.useState((T==null?void 0:T.product)||null),[s,$]=d.useState([]),[V,Q]=d.useState([]),[B,K]=d.useState([]),[U,C]=d.useState([]),[S,N]=d.useState(!1),[z,g]=d.useState(null),[c,h]=d.useState([]),[r,o]=d.useState(!1),[p,j]=d.useState(!1),[t,u]=d.useState(!1),G=d.useRef(),y=(i,k="success")=>{const b=e.jsxs(Ue,{autohide:k!=="confirm",visible:!0,delay:5e3,children:[e.jsx(Ge,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:k==="error"?"Hata":k==="confirm"?"Onay":"Başarılı"})}),e.jsx(Le,{children:i})]},Date.now());h(m=>[...m,b])},q=async(i,k)=>{var b,m,te;try{console.log(`Fetching data from: ${i}`);const{data:l}=await M.get(i);console.log(`API response from ${i}:`,l);const W=Array.isArray(l)?l.filter(ve=>ve.durumu===1):l.durumu===1?[l]:[];return k(W),W}catch(l){return console.error(`Error fetching ${i}:`,((b=l.response)==null?void 0:b.data)||l.message),y(((te=(m=l.response)==null?void 0:m.data)==null?void 0:te.message)||"Veriler yüklenemedi.","error"),[]}},J=async i=>{var te;let k="Bilinmeyen Kategori",b="Bilinmeyen Marka",m="Raf Yok";try{if(i.urunKategoriId&&i.urunKategoriId!==0){const l=s.find(W=>W.id===i.urunKategoriId)||(await M.get(`${_}/urunKategori/get-by-id/${i.urunKategoriId}`)).data;k=(l==null?void 0:l.adi)||k,l||console.warn(`Kategori bulunamadı: ID ${i.urunKategoriId}`)}if(i.urunMarkaId&&i.urunMarkaId!==0){const l=V.find(W=>W.id===i.urunMarkaId)||(await M.get(`${_}/urunMarka/get-by-id/${i.urunMarkaId}`)).data;b=(l==null?void 0:l.adi)||b,l||console.warn(`Marka bulunamadı: ID ${i.urunMarkaId}`)}if(i.urunRafId&&i.urunRafId!==0){const l=B.find(W=>W.id===i.urunRafId)||(await M.get(`${_}/urunRaf/get-by-id/${i.urunRafId}`)).data;m=(l==null?void 0:l.adi)||m,l||console.warn(`Raf bulunamadı: ID ${i.urunRafId}`)}}catch(l){console.error("Dönüşüm Hatası:",l.message,l.stack)}return{id:i.id,name:i.adi,salePrice:i.satisFiyat,stockQuantity:i.kritikStok||0,unit:i.birimAdi===0?"Adet":i.birimAdi,type:i.urunTipi?"Stoklu":"Stoksuz",category:k,brand:b,categoryId:i.urunKategoriId||0,brandId:i.urunMarkaId||0,shelfId:i.urunRafId||0,depoId:i.depoId||0,productCode:i.urunKodu,gtip:i.gtipKodu,countryCode:((te=i.ulkeId)==null?void 0:te.toString())||"",stockAmount:i.stokMiktari,invoiceTitle:i.faturaBasligi,description:i.aciklama,barcode:i.barkod,shelfLocation:m,trackStock:i.stokTakip==="Evet",criticalStock:i.kritikStok,tags:i.etiketler?i.etiketler.split(",").map(l=>l.trim()):[],purchasePrice:i.alisFiyat,saleVatRate:i.satisKDV,saleVatIncluded:i.satisKdvDahilmi,purchaseVatRate:i.alisKDV,purchaseVatIncluded:i.alisKdvDahilmi,purchaseDiscount:i.alisIskontosu,otvRate:i.oivOrani,otvType:i.otvTipi,images:i.fotograf?[i.fotograf]:[],saleCurrency:i.paraBirimi||"TRY"}},O=d.useCallback(async()=>{var i,k,b;N(!0);try{await q(`${_}/urunKategori/get-all`,$),await q(`${_}/urunMarka/get-all`,Q),await q(`${_}/urunRaf/get-all`,K),console.log("Fetching product with ID:",x);const{data:m}=await M.get(`${_}/urun/urun-get-by-id/${x}`);if(m.durumu!==1)throw new Error("Ürün bulunamadı veya aktif değil.");a(await J(m)),g(null)}catch(m){console.error("Ürün yükleme hatası:",((i=m.response)==null?void 0:i.data)||m.message),g(((b=(k=m.response)==null?void 0:k.data)==null?void 0:b.message)||"Ürün yüklenemedi."),y("Ürün yüklenemedi.","error")}finally{N(!1)}},[x]),P=()=>{u(!0)},Z=async()=>{var i,k,b;N(!0),u(!1);try{const m=JSON.parse(localStorage.getItem("user"))||{id:0};if(m.id===0){y("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}await M.delete(`${_}/urun/urun-delete/${x}?kullaniciId=${m.id}`),y("Ürün silindi.","success"),A("/app/products")}catch(m){console.error("Ürün silme hatası:",((i=m.response)==null?void 0:i.data)||m.message),y(((b=(k=m.response)==null?void 0:k.data)==null?void 0:b.message)||"Ürün silinemedi.","error")}finally{N(!1)}},F=()=>{u(!1)};d.useEffect(()=>{console.log("useEffect triggered with id:",x,"product:",n,"showUpdateModal:",r),x&&!n&&O()},[x,n,O]);const R=()=>{console.log("handleUpdate called, setting showUpdateModal to true"),o(!0)},w=i=>{console.log("handleStockEntry called with type:",i),i==="Manuel Giriş-Çıkış"?j(!0):i==="Stok Sayımı"?A(`/app/products/${x}/stock-count`,{state:{product:n}}):y(`${i} işlemi başlatıldı.`,"success")},ee=()=>{console.log("handleStockStatement called"),y("Stok ekstresi oluşturuldu.","success")},ne=i=>{console.log("handleOtherAction called with action:",i),P()};if(S)return e.jsx("div",{children:"Yükleniyor..."});if(z||!n)return e.jsxs(E,{children:[e.jsx(H,{children:"Ürün Bilgisi"}),e.jsxs(Y,{children:[e.jsx("p",{children:z||"Ürün bulunamadı."}),e.jsx(f,{color:"primary",onClick:()=>A("/app/products"),children:"Geri Dön"})]})]});const L=n.stockQuantity*n.salePrice;return e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{ref:G,placement:"top-end",className:"p-3",children:[c,t&&e.jsxs(de,{visible:!0,autohide:!1,children:[e.jsx(he,{style:{backgroundColor:"#DC3545",color:"white"},children:e.jsx("strong",{className:"me-auto",children:"Ürün Silme Onayı"})}),e.jsxs(me,{children:[e.jsx("p",{children:"Ürünü silmek istediğinize emin misiniz?"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(f,{color:"danger",style:{color:"white"},onClick:Z,children:"Evet"}),e.jsx(f,{color:"secondary",onClick:F,children:"Hayır"})]})]})]})]}),e.jsxs(oe,{children:[e.jsx(I,{xs:12,children:e.jsxs(E,{children:[e.jsx(H,{style:{backgroundColor:"#2965A8",color:"#fff",fontSize:"24px"},children:n.name}),e.jsx(Y,{children:e.jsxs(oe,{children:[e.jsxs(I,{xs:6,children:[e.jsxs("h5",{children:[e.jsx("strong",{children:"Barkod:"})," ",n.barcode]}),e.jsxs("div",{className:"mt-3",children:[console.log(n.images[0]),n.images&&n.images.length>0&&n.images[0]&&n.images[0].trim()!==""?e.jsx(e.Fragment,{children:e.jsx("img",{src:`https://speedsofttest.com/${n.images[0]}`,alt:n.name,style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain"},onLoad:()=>{console.log("Resim başarıyla yüklendi:",n.images[0])}})}):e.jsx("div",{style:{width:"200px",height:"200px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",border:"2px dashed #dee2e6",borderRadius:"8px",color:"#6c757d",fontSize:"14px",textAlign:"center"},children:e.jsxs("div",{children:[e.jsx("strong",{children:"Ürün Görseli Yok"}),e.jsx("br",{}),e.jsx("small",{children:"Görsel ekleyin"})]})})]})]}),e.jsxs(I,{xs:6,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ürün Kodu:"})," ",n.productCode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kategori:"})," ",n.category]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Marka:"})," ",n.brand]}),e.jsxs("p",{children:[e.jsx("strong",{children:"KDV Oranı:"})," %",n.saleVatRate]})]})]})})]})}),e.jsx(I,{xs:12,className:"my-3",children:e.jsxs(oe,{children:[e.jsx(I,{children:e.jsxs(E,{children:[e.jsx(H,{className:"bg-danger",style:{color:"white"},children:"Alış Fiyatı"}),e.jsx(Y,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",n.purchasePrice.toLocaleString("tr-TR")]})})]})}),e.jsx(I,{children:e.jsxs(E,{children:[e.jsx(H,{className:"bg-success",style:{color:"white"},children:"Satış Fiyatı"}),e.jsx(Y,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",n.salePrice.toLocaleString("tr-TR")]})})]})}),e.jsx(I,{children:e.jsxs(E,{children:[e.jsx(H,{className:"bg-warning",style:{color:"white"},children:"Toplam Stok"}),e.jsx(Y,{children:e.jsxs("p",{className:"fw-bold",children:[n.stockQuantity," Adet"]})})]})}),e.jsx(I,{children:e.jsxs(E,{children:[e.jsx(H,{className:"bg-info",style:{color:"white"},children:"Stok Değeri"}),e.jsx(Y,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",(L*n.stockQuantity).toLocaleString("tr-TR")]})})]})})]})}),e.jsx(I,{xs:12,className:"mb-3",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(f,{style:{color:"white"},color:"warning",onClick:R,children:[e.jsx(le,{icon:Ye,style:{color:"white"}})," Güncelle"]}),e.jsxs(Se,{children:[e.jsxs(Ie,{color:"primary",children:[e.jsx(le,{icon:ke})," Stoklara Giriş Yap"]}),e.jsxs(Ce,{children:[e.jsx(ce,{disabled:!0,onClick:()=>w("Tedarikçi Girişi"),children:"Tedarikçiden Ürün Girişi Yap"}),e.jsx(ce,{onClick:()=>w("Manuel Giriş-Çıkış"),children:"Manuel Giriş-Çıkış İşlemleri"}),e.jsx(ce,{onClick:()=>w("Stok Sayımı"),children:"Stok Sayımı Yap"})]})]}),e.jsxs(f,{style:{color:"white"},color:"info",onClick:ee,disabled:!0,children:[e.jsx(le,{icon:ke,style:{color:"white"}})," Stok Ekstresi"]}),e.jsxs(Se,{children:[e.jsxs(Ie,{color:"secondary",children:[e.jsx(le,{icon:ke})," Diğer İşlemler"]}),e.jsx(Ce,{children:e.jsx(ce,{onClick:()=>ne("Ürün Silme"),children:"Ürünü Sil"})})]})]})}),e.jsx(I,{xs:12,children:e.jsxs(oe,{children:[e.jsx(I,{className:"mt-3",children:e.jsxs(E,{children:[e.jsx(H,{style:{backgroundColor:"#2965A8",color:"white"},children:"Önceki Satışlar"}),e.jsx(Y,{children:e.jsxs(ge,{responsive:!0,children:[e.jsx(ue,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:U.filter(i=>i.description==="Satış").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})}),e.jsx(I,{className:"mt-3",children:e.jsxs(E,{children:[e.jsx(H,{style:{backgroundColor:"#2965A8",color:"white"},children:"Önceki Alışlar"}),e.jsx(Y,{children:e.jsxs(ge,{responsive:!0,children:[e.jsx(ue,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:U.filter(i=>i.description==="Tedarikçi Girişi").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})}),e.jsx(I,{className:"mt-3",children:e.jsxs(E,{children:[e.jsx(H,{style:{backgroundColor:"#2965A8",color:"white"},children:"Manuel Stok Hareketleri"}),e.jsx(Y,{children:e.jsxs(ge,{responsive:!0,children:[e.jsx(ue,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:U.filter(i=>i.description!=="Satış"&&i.description!=="Tedarikçi Girişi").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})})]})})]}),r!==void 0&&e.jsx(Oe,{visible:r,onClose:()=>{console.log("Closing ProductModal"),o(!1)},onSubmit:i=>{console.log("ProductModal submitted with data:",i),a({...n,...i}),y("Ürün güncellendi.","success"),o(!1)},product:n,addToast:y}),p!==void 0&&e.jsx(We,{visible:p,onClose:()=>{console.log("Closing StockMovementModal"),j(!1)},onSubmit:i=>{console.log("StockMovementModal submitted with data:",i),C(k=>[...k,i]),y("Stok hareketi kaydedildi.","success"),j(!1)},product:n,addToast:y})]})};export{Ze as default};
