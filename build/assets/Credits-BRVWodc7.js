import{j as e,$ as Q,a0 as V,a1 as k,a2 as K,a3 as X,a4 as b,r as o,u as Z,C as ee,e as se,f as M,q as ae,m as te,M as ne,g as w,h as S,s as re,ak as oe,al as le,am as T,a as ce,b as ie,c as de}from"./index-DAwD_DDx.js";const me=({credits:m,onCreditClick:h})=>e.jsxs(Q,{responsive:!0,hover:!0,children:[e.jsx(V,{children:e.jsxs(k,{children:[e.jsx(K,{children:"Kredi Adı"}),e.jsx(K,{children:"Kalan Tutar"})]})}),e.jsx(X,{children:m.length>0?m.map(l=>e.jsxs(k,{onClick:()=>h(l),style:{cursor:"pointer"},children:[e.jsx(b,{children:l.name}),e.jsxs(b,{children:[l.remainingAmount.toLocaleString("tr-TR")," TRY"]})]},l.id)):e.jsx(k,{children:e.jsx(b,{colSpan:"2",children:"Kredi bulunamadı."})})})]}),he=()=>{const[m,h]=o.useState([]),[l,v]=o.useState([]),[I,P]=o.useState([]),[N,u]=o.useState(!1),[f,p]=o.useState(null),[F,x]=o.useState(!1),[y,R]=o.useState(!1),[H,D]=o.useState(0),[E,Y]=o.useState(0),L=o.useRef(),$=Z(),g={1:"monthly",2:"bimonthly",3:"quarterly",4:"quadmonthly",6:"semiannually",12:"annually"},C="https://speedsofttest.com/api",i=(s,n="success")=>{const r=e.jsxs(ce,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(ie,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:n==="error"?"Hata":"Başarılı"})}),e.jsx(de,{children:s})]},Date.now());h(t=>[...t,r])},O=async()=>{var s,n;u(!0);try{const r=await T.get(`${C}/Hesap/hesap-get-allaktif`,{headers:{accept:"*/*"}});P(r.data),p(null)}catch(r){const t=((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"Hesaplar yüklenemedi.";console.error("Hesaplar yüklenemedi:",r),i(t,"error")}finally{u(!1)}},A=async()=>{var s,n;u(!0);try{const t=(await T.get(`${C}/kredi/get-all`,{headers:{accept:"*/*"}})).data.map(a=>({id:a.id,name:a.adi||`Kredi ${a.id}`,totalAmount:a.kalanBorc||0,remainingAmount:a.kalanBorc||0,installmentCount:a.kalanTaksit||0,nextPaymentDate:a.ilkTaksitTarih?new Date(a.ilkTaksitTarih).toISOString():new Date().toISOString(),paymentSchedule:g[a.odemeTakvim]||"monthly",accountId:a.hesapId||0,account:a.hesap||{tanim:"Bilinmeyen Hesap"},notes:a.notlar||"",durumu:a.durumu!==void 0?a.durumu:1}));v(t),q(t),p(null)}catch(r){const t=((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"Krediler yüklenemedi.";p(t),i(t,"error")}finally{u(!1)}},q=s=>{const n=s.filter(c=>c.durumu===1),r=n.reduce((c,d)=>c+(d.remainingAmount||0),0),t=new Date,a=t.getMonth(),j=t.getFullYear(),U=n.reduce((c,d)=>{if(!d.nextPaymentDate)return c;const B=new Date(d.nextPaymentDate);if(B.getMonth()===a&&B.getFullYear()===j){const W=(d.totalAmount||0)/(d.installmentCount||1);return c+W}return c},0);D(r),Y(U)},z=s=>{try{if(!s||!s.id)throw new Error("Geçersiz kredi verisi");sessionStorage.setItem("selectedCredit",JSON.stringify(s)),console.log(`Kredi detayına yönlendiriliyor, ID: ${s.id}`),$("/app/credit-detail")}catch(n){console.error("Yönlendirme hatası:",n),i("Kredi detayı açılamadı","error")}},G=()=>{x(!0)},_=async s=>{var n,r;try{const t=Object.keys(g).find(j=>g[j]===s.paymentSchedule)||1;(await T.post(`${C}/kredi/create`,{Adi:s.name,KalanBorc:parseFloat(s.remainingAmount),KalanTaksit:parseInt(s.installmentCount),IlkTaksitTarih:s.nextPaymentDate,OdemeTakvim:t,HesapId:parseInt(s.accountId),Notlar:s.notes,Durumu:1})).data&&(i("Kredi başarıyla eklendi.","success"),A(),x(!1))}catch(t){const a=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.Message)||"Kredi eklenemedi: Bilinmeyen hata";console.error("Kredi ekleme hatası:",t),i(a,"error")}};o.useEffect(()=>{O(),A()},[]);const J=y?l:l.filter(s=>(s.remainingAmount||0)>0&&s.durumu===1);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .custom-form-switch .form-check-input:checked {
            background-color: #34A149 !important;
            border-color: #2965A8 !important;
          }
          .custom-form-switch .form-check-input:checked::after {
            background-color: #ffffff !important;
          }
          .custom-form-switch .form-check-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(41, 101, 168, 0.25) !important;
          }
          .custom-form-switch .form-check-label {
            color: #fff;
          }
          .custom-form-switch .form-check-input {
            transition: background-color 0.3s ease;
          }
        `}),e.jsx(ee,{ref:L,placement:"top-end",className:"p-3",children:m}),e.jsxs(se,{className:"d-flex justify-content-between mb-3",children:[e.jsx(M,{children:e.jsxs(ae,{color:"info",className:"text-light",onClick:G,children:[e.jsx(te,{icon:ne})," Yeni Kredi Ekle"]})}),e.jsxs(M,{className:"d-flex gap-3 justify-content-end",children:[e.jsx(w,{className:"p-3",children:e.jsxs(S,{children:[e.jsx("h5",{children:"Kalan Ödemeler"}),e.jsxs("p",{className:"fw-bold fs-5 text-success",children:[e.jsx("span",{className:"fs-4",children:"₺"})," ",H.toLocaleString("tr-TR")]})]})}),e.jsx(w,{className:"p-3",children:e.jsxs(S,{children:[e.jsx("h5",{children:"Bu Ayki Ödemeler"}),e.jsxs("p",{className:"fw-bold fs-5 text-warning",children:[e.jsx("span",{className:"fs-4",children:"₺"})," ",E.toLocaleString("tr-TR")]})]})})]})]}),e.jsxs(w,{className:"my-3",children:[e.jsx(re,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:"Kredi Listesi"}),e.jsx(oe,{label:"Borcu Bitenleri Göster",className:"fs-6 custom-form-switch",checked:y,onChange:()=>R(!y),style:{backgroundColor:"#ccc",borderColor:"#ccc"}})]})}),e.jsxs(S,{children:[N&&e.jsx("p",{children:"Yükleniyor..."}),f&&e.jsx("p",{className:"text-danger",children:f}),!N&&!f&&e.jsx(me,{credits:J,onCreditClick:z})]})]}),e.jsx(le,{visible:F,onClose:()=>x(!1),onSubmit:_,addToast:i,accounts:I})]})};export{he as default};
