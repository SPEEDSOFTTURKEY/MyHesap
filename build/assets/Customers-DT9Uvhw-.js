import{r as l,j as e,$ as ue,a0 as me,a1 as W,a2 as p,a3 as xe,a4 as j,q as h,m as C,a5 as fe,a7 as pe,N as G,Q as K,S as Q,T as J,W as X,an as Z,t as k,u as je,C as ye,e as Ce,f as ge,M as be,g as ke,s as we,ao as q,V as Se,o as V,h as ve,ap as Te,a as Me,b as Be,c as Ee}from"./index-DAwD_DDx.js";import{C as ee}from"./CustomerModal-D4Wbjyc2.js";import{c as U}from"./cil-cloud-upload-Ca9_6_ej.js";const Fe="https://speedsofttest.com/api",Ne=({customers:F,onCustomerClick:N,fetchCustomers:w})=>{const[S,m]=l.useState(!1),[v,r]=l.useState(!1),[T,g]=l.useState(null),[M,x]=l.useState(null),[f,b]=l.useState(!1),B=(n,c="success")=>{alert(n)},E=async()=>{var n,c;try{b(!0),await k.delete(`${Fe}/musteri/musteri-delete/${T}`),w(),m(!1)}catch(u){console.error("Silme Hatası:",u),B(((c=(n=u.response)==null?void 0:n.data)==null?void 0:c.message)||"Müşteri silinemedi.","error")}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{responsive:!0,hover:!0,children:[e.jsx(me,{children:e.jsxs(W,{children:[e.jsx(p,{children:"Adı"}),e.jsx(p,{children:"Telefon"}),e.jsx(p,{children:"E-Posta"}),e.jsx(p,{children:"Açık Bakiye"}),e.jsx(p,{children:"Sınıflandırma"}),e.jsx(p,{children:"İşlem"})]})}),e.jsx(xe,{children:F.map(n=>e.jsxs(W,{onClick:()=>N(n),className:"customer-table-row",style:{cursor:"pointer"},children:[e.jsx(j,{children:n.name}),e.jsx(j,{children:n.phone||"Yok"}),e.jsx(j,{children:n.email||"Yok"}),e.jsxs(j,{children:[(n.openBalance||0).toLocaleString("tr-TR")," TRY"]}),e.jsx(j,{children:n.classification}),e.jsxs(j,{children:[e.jsx(h,{color:"info",size:"sm",style:{color:"white",marginRight:"5px"},onClick:c=>{c.stopPropagation(),x(n),r(!0)},children:e.jsx(C,{icon:fe})}),e.jsx(h,{color:"danger",size:"sm",style:{color:"white"},onClick:c=>{c.stopPropagation(),g(n.id),m(!0)},children:e.jsx(C,{icon:pe})})]})]},n.id))})]}),e.jsxs(G,{visible:S,onClose:()=>m(!1),children:[e.jsx(K,{style:{backgroundColor:"#DC3545",color:"white"},children:e.jsx(Q,{children:"Müşteriyi Sil"})}),e.jsx(J,{children:"Silinmesini istediğinizden emin misiniz?"}),e.jsxs(X,{children:[e.jsx(h,{color:"danger",style:{color:"white"},onClick:E,disabled:f,children:f?"Siliniyor...":"Sil"}),e.jsx(h,{color:"secondary",onClick:()=>m(!1),disabled:f,children:"İptal"})]})]}),e.jsx(Z,{children:e.jsx(ee,{visible:v,onClose:()=>r(!1),onSubmit:n=>{w(n.id),r(!1)},customer:M,addToast:B})})]})},y="https://speedsofttest.com/api",Re=()=>{const[F,N]=l.useState([]),[w,S]=l.useState([]),[m,v]=l.useState([]),[r,T]=l.useState(!1),[g,M]=l.useState(null),[x,f]=l.useState(!0),[b,B]=l.useState("all"),[E,n]=l.useState(""),[c,u]=l.useState(!1),[$,I]=l.useState(null),[A,z]=l.useState(!1),[se,L]=l.useState(!1),[ae,D]=l.useState(null),le=l.useRef(),H=je(),d=(s,t="success")=>{const a=e.jsxs(Me,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Be,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:t==="error"?"Hata":"Başarılı"})}),e.jsx(Ee,{children:s})]},Date.now());N(i=>[...i,a])},P=async(s,t)=>{var a,i;try{const{data:o}=await k.get(s);return t(Array.isArray(o)?o:[o]),o}catch(o){return d(((i=(a=o.response)==null?void 0:a.data)==null?void 0:i.message)||"Veriler yüklenemedi.","error"),null}},te=async s=>{let t="Bilinmiyor";try{if(s.musteriSiniflandirmaId){const a=m.find(i=>i.id===s.musteriSiniflandirmaId);if(a)t=a.adi;else{const i=await P(`${y}/musteriSiniflandirma/get-by-id/${s.musteriSiniflandirmaId}`,v);t=i&&i.length>0?i[0].adi:"Bilinmiyor"}}}catch(a){console.error("Dönüşüm Hatası:",a),t="Bilinmiyor"}return{id:s.id,name:s.unvani||"Bilinmiyor",openBalance:s.acilisBakiye||0,chequeBondBalance:0,phone:s.telefon||"",phone2:s.telefon2||"",classification:t,email:s.email||"",address:s.adres||"",taxOffice:s.vergiDairesi||"",taxOrIdNumber:s.vergiNumarasi||"",accountingCode:s.kodu||"",note:s.aciklama||"",currency:s.paraBirimi||"TRY",riskLimit:s.riskLimiti||0,dueDate:s.vade||"",isTaxExempt:s.vergiMuaf||!1,bankInfo:s.bankaBilgileri||"",contactPerson:s.yetkiliKisi||"",otherContact:s.diger||"",image:s.fotograf||"",branches:s.subeler||[]}},R=async(s=null)=>{var t,a;T(!0);try{await P(`${y}/musteriSiniflandirma/get-all`,v);const i=x?`${y}/musteri/musteri-get-all`:`${y}/musteri/musteri-get-allaktif`,{data:o}=await k.get(i),O=await Promise.all(o.map(te));if(S(O),M(null),s){const _=O.find(he=>he.id===s);_&&(D(_),L(!0))}}catch(i){M(((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"Müşteriler yüklenemedi."),d("Müşteriler yüklenemedi.","error")}finally{T(!1)}},ie=s=>{H(`/app/customer-detail/${s.id}`,{state:{customer:s}})},ne=()=>{H("/app/customer-new")},oe=()=>{u(!0)},re=async()=>{var s,t;try{const a=await k.get(`${y}/musteri/download-template`,{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([a.data])),o=document.createElement("a");o.href=i,o.setAttribute("download","musteri_sablonu.xlsx"),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i),d("Excel şablonu başarıyla indirildi.","success")}catch(a){d(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Excel şablonu indirilemedi.","error")}},ce=s=>{I(s.target.files[0])},de=async()=>{var s,t;if(!$){d("Lütfen bir Excel dosyası seçin.","error");return}z(!0);try{const a=new FormData;a.append("file",$);const i=await k.post(`${y}/musteri/upload-excel`,a,{headers:{"Content-Type":"multipart/form-data",accept:"*/*"}});await R(i.data.id),d("Excel dosyası başarıyla yüklendi.","success"),u(!1),I(null)}catch(a){d(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Excel dosyası yüklenemedi.","error")}finally{z(!1)}};l.useEffect(()=>{R()},[x]);const Y=w.filter(s=>s.name.toLowerCase().includes(E.toLowerCase())).filter(s=>b==="balance"?s.openBalance>0:!0);return e.jsxs(Z,{children:[e.jsx(ye,{ref:le,placement:"top-end",className:"p-3",children:F}),e.jsxs(Ce,{className:"mb-3",children:[e.jsxs(ge,{children:[e.jsxs(h,{color:"success",style:{color:"white"},onClick:ne,children:[e.jsx(C,{icon:be})," Yeni Müşteri Ekle"]}),e.jsxs(h,{color:"primary",style:{color:"white"},onClick:oe,className:"ms-2",children:[e.jsx(C,{icon:U})," Excel'den Müşteri Yükle"]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",color:"#2965A8",padding:"5px 8px",borderRadius:"4px",fontWeight:"bold",fontSize:"14px",maxWidth:"200px",textAlign:"center",margin:"10px 15px 0 0"},children:["Toplam Müşteri: ",Y.length]})]}),e.jsxs(ke,{className:"my-3",children:[e.jsx(we,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex flex-row justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-2",children:e.jsx(q,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterAll",autoComplete:"off",label:"Tüm Müşteriler",checked:x,onChange:()=>f(!0)})}),e.jsx("div",{children:e.jsx(q,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterActive",autoComplete:"off",label:"Aktif Müşteriler",checked:!x,onChange:()=>f(!1)})})]}),e.jsx("div",{className:"d-flex flex-row",children:e.jsxs(Se,{value:b,onChange:s=>B(s.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"all",children:"Hepsini Göster"}),e.jsx("option",{value:"balance",children:"Bakiyesi Olanlar"})]})}),e.jsx(V,{type:"text",placeholder:"Müşteri ara...",value:E,onChange:s=>n(s.target.value),style:{width:"200px"}})]})}),e.jsxs(ve,{children:[r&&e.jsx("p",{children:"Yükleniyor..."}),g&&e.jsx("p",{className:"text-danger",children:g}),!r&&!g&&e.jsx(Ne,{customers:Y,onCustomerClick:ie,fetchCustomers:R})]})]}),e.jsxs(G,{size:"lg",visible:c,backdrop:"static",keyboard:!1,onClose:()=>u(!1),children:[e.jsx(K,{children:e.jsx(Q,{children:"Excel ile Müşteri Yükleme"})}),e.jsxs(J,{children:[e.jsxs(h,{color:"primary",style:{color:"white"},onClick:re,disabled:r,children:[e.jsx(C,{icon:U})," Excel Şablonu İndir"]}),e.jsx("p",{className:"mt-3",children:"Müşterilerinizi tek tek tanımlamak yerine, Excel şablonunu indirin ve doldurun."}),e.jsx(V,{type:"file",accept:".xlsx,.xls",onChange:ce,className:"mb-3"}),e.jsx(h,{color:"success",style:{color:"white"},onClick:de,disabled:A||r,children:A?e.jsx(Te,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(C,{icon:U})," Excel Şablonu Yükle"]})})]}),e.jsx(X,{children:e.jsx(h,{color:"secondary",onClick:()=>u(!1),disabled:A||r,children:"İptal"})})]}),e.jsx(ee,{visible:se,onClose:()=>{L(!1),D(null)},onSubmit:s=>{S(t=>t.map(a=>a.id===s.id?{...a,...s}:a)),d("Müşteri güncellendi.","success"),L(!1),D(null)},customer:ae,addToast:d})]})};export{Re as default};
