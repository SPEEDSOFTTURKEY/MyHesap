import{u as $,J as z,K as M,r as h,j as e,e as W,f as g,g as D,s as q,h as G,q as T,L as V,A as _,t as J,B as Q,D as X,m as Z,M as ee,E as ae,F as se,N as te,Q as re,S as ne,i as oe,T as le,U as C,o as k,V as ie,W as ce}from"./index-DAwD_DDx.js";const de=()=>{const w=$(),b=z(),{users:o=[],loading:I,error:S,setUsers:c}=M(),f=[{categoryId:1,accountName:"Banka HesaplarÄ±",type:"bank"},{categoryId:2,accountName:"Kasa TanÄ±mlarÄ±",type:"cash"},{categoryId:3,accountName:"Kredi KartlarÄ±",type:"creditCard"},{categoryId:4,accountName:"Pos HesaplarÄ±",type:"pos"},{categoryId:5,accountName:"Åžirket OrtaklarÄ± HesaplarÄ±",type:"partner"},{categoryId:6,accountName:"Veresiye HesaplarÄ±",type:"debt"}],u=r=>{if(!r)return"#ffffff";const d=r.replace("#",""),t=parseInt(d.substr(0,2),16),B=parseInt(d.substr(2,2),16),L=parseInt(d.substr(4,2),16);return(t*299+B*587+L*114)/1e3>=128?"#000000":"#ffffff"},j=r=>{w(`/app/account-detail/${r.id}`,{state:{user:r}})};return h.useEffect(()=>{b.pathname==="/app/dashboard"&&o.length},[b,o.length,c]),I?e.jsx("p",{children:"Hesaplar yÃ¼kleniyor..."}):S?e.jsx("p",{children:S}):e.jsx(W,{className:"mb-4",xs:{gutter:3},children:f.map(r=>{const d=(o==null?void 0:o.filter(t=>t.type===r.type))||[];return e.jsx(g,{xs:12,sm:6,xl:6,xxl:6,children:e.jsxs(D,{className:"h-100 shadow-sm",children:[e.jsx(q,{className:"text-white",style:{backgroundColor:"#2965A8"},children:e.jsx("h5",{className:"mb-0",children:r.accountName.toUpperCase()})}),e.jsx(G,{style:{backgroundColor:"#FBF7DC"},className:"d-flex flex-wrap gap-2",children:d.length>0?d.map(t=>e.jsxs(T,{size:"sm",className:"text-start px-2 py-1 d-flex flex-column",style:{backgroundColor:t.labelColor||"#ccc",borderColor:t.labelColor||"#ccc",color:u(t.labelColor),height:"60px",minWidth:"120px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",justifyContent:"center",alignItems:"flex-start",lineHeight:"1.2"},onClick:()=>j(t),children:[e.jsx("strong",{style:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.userName||"Ä°sim Yok"}),e.jsxs("small",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(t.balance||0).toLocaleString("tr-TR",{minimumFractionDigits:2})," ",t.currency||"TRY"]})]},`${t.id}-${r.categoryId}`)):e.jsx("p",{className:"text-muted mb-0",children:"Bu kategoride hesap yok."})})]})},`row-${r.categoryId}`)})})},pe=()=>{const[w,b]=h.useState(!1),[o,I]=h.useState(""),[S,c]=h.useState(null),[f,u]=h.useState(!1),{users:j,setUsers:r,createAccount:d}=V(),{user:t,logout:B}=_(),L="https://speedsofttest.com/api",v={bank:1,cash:2,creditCard:3,pos:4,partner:5,debt:6};h.useEffect(()=>{j.length===0&&R()},[j.length]);const R=async()=>{try{const s=await J.get(`${L}/Hesap/hesap-get-all`),l=Array.isArray(s.data)?s.data:[s.data];console.log("ðŸ“¦ Gelen API verisi:",l);const n=l.filter(a=>(a==null?void 0:a.tanim)&&a.tanim.trim()!==""&&(Number(a.aktif)===1||Number(a.durumu)===1)).map(a=>({id:a.id,userName:a.tanim.trim(),accountNumber:a.hesapNo||"",balance:parseFloat(a.guncelBakiye)||0,currency:a.paraBirimi||"TRY",labelColor:a.etiketRengi||"#ccc",type:Object.keys(v).find(m=>v[m]===a.hesapKategoriId)||"cash",transactions:a.transactions||[],spendingLimit:parseFloat(a.harcamaLimiti)||0,hesapKategoriId:a.hesapKategoriId||1,aktif:a.aktif,durumu:a.durumu,tanim:a.tanim}));console.log("ðŸ› ï¸ FormatlanmÄ±ÅŸ hesaplar:",n),r(n)}catch(s){console.error("Hesaplar alÄ±namadÄ±:",s),c({message:`Hesaplar yÃ¼klenirken hata oluÅŸtu: ${s.message||"Bilinmeyen hata"}`,color:"danger"})}},E=async s=>{var l,x;if(u(!0),!s.description||!s.description.trim()){c({message:"TanÄ±m alanÄ± boÅŸ bÄ±rakÄ±lamaz.",color:"danger"}),u(!1);return}try{const n=typeof s.balance=="string"?parseFloat(s.balance.replace(/\./g,"").replace(",","."))||0:s.balance||0,a={userName:s.description.trim(),accountNumber:s.accountNumber,balance:n,currency:s.currency||"TRY",labelColor:s.tagColor||"#0d6efd",spendingLimit:s.spendingLimit?parseFloat(s.spendingLimit.replace(/\./g,"").replace(",",".")):0,type:o,description:s.description.trim(),hesapKategoriId:v[o]||2};if(!a.accountNumber){c({message:"Hesap No zorunlu alandÄ±r.",color:"danger"}),u(!1);return}if(j.some(m=>m.accountNumber===a.accountNumber)){c({message:"Bu hesap numarasÄ± zaten kullanÄ±mda.",color:"danger"}),u(!1);return}await d(a),await R(),b(!1),c({message:"Hesap baÅŸarÄ±yla oluÅŸturuldu.",color:"success"})}catch(n){console.error("Hesap oluÅŸturulamadÄ±:",n),c({message:"Hesap oluÅŸturulurken hata oluÅŸtu: "+(((x=(l=n.response)==null?void 0:l.data)==null?void 0:x.message)||n.message),color:"danger"})}finally{u(!1)}},O=({onSubmit:s,visible:l,onClose:x,type:n})=>{const[a,m]=h.useState({description:"",tagColor:"#0d6efd",currency:"TRY",accountNumber:"",balance:"",spendingLimit:""}),F=p=>{const{name:i,value:N}=p.target;m(y=>({...y,[i]:N}))},K=p=>{const{name:i,value:N}=p.target,y=N.replace(/[^\d]/g,"");if(!y){m(H=>({...H,[i]:""}));return}const U=P(y);m(H=>({...H,[i]:U}))},P=p=>{if(!p)return"";const i=p.replace(/[^\d]/g,"");let N=i.slice(0,-2)||"0",y=i.slice(-2).padStart(2,"0");return`${parseInt(N,10).toLocaleString("tr-TR")},${y}`},Y=p=>{p.preventDefault();const i={description:a.description,tagColor:a.tagColor,currency:a.currency,accountNumber:a.accountNumber,balance:a.balance?parseFloat(a.balance.replace(/\./g,"").replace(",",".")):0,spendingLimit:a.spendingLimit?parseFloat(a.spendingLimit.replace(/\./g,"").replace(",",".")):0};s(i),m({description:"",tagColor:"#0d6efd",currency:"TRY",accountNumber:"",balance:"",spendingLimit:""})};return e.jsxs(te,{visible:l,onClose:x,backdrop:"static",keyboard:!1,alignment:"center",children:[e.jsx(re,{children:e.jsx(ne,{children:n==="creditCard"?"Kredi KartÄ± Ekle":`Yeni ${A[n]} Ekle`})}),e.jsxs(oe,{onSubmit:Y,children:[e.jsxs(le,{children:[e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"description",children:"TanÄ±m"}),e.jsx(k,{type:"text",id:"description",name:"description",value:a.description,onChange:F,required:!0})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"currency",children:"Para Birimi"}),e.jsxs(ie,{id:"currency",name:"currency",value:a.currency,onChange:F,required:!0,children:[e.jsx("option",{value:"TRY",children:"â‚º TÃ¼rk LirasÄ± (TRY)"}),e.jsx("option",{value:"USD",children:"$ Amerikan DolarÄ± (USD)"}),e.jsx("option",{value:"EUR",children:"â‚¬ Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"Â£ Ä°ngiliz Sterlini (GBP)"})]})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"accountNumber",children:"Hesap numarasÄ±"}),e.jsx(k,{type:"text",id:"accountNumber",name:"accountNumber",value:a.accountNumber,onChange:F,required:!0})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"tagColor",children:"Etiket Rengi"}),e.jsx(k,{type:"color",id:"tagColor",name:"tagColor",value:a.tagColor,onChange:F})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"balance",children:"GÃ¼ncel Bakiye"}),e.jsx(k,{type:"text",id:"balance",name:"balance",value:a.balance,onChange:K,placeholder:"0,00"})]}),n==="creditCard"&&e.jsxs(g,{className:"mb-3",children:[e.jsx(C,{htmlFor:"spendingLimit",children:"Harcama Limiti"}),e.jsx(k,{type:"text",id:"spendingLimit",name:"spendingLimit",value:a.spendingLimit,onChange:K,placeholder:"0,00"}),e.jsx("div",{className:"form-text",children:"Bu limitin Ã¼zerinde borÃ§ varsa hata raporu gÃ¶nderilir."})]})]}),e.jsxs(ce,{children:[e.jsx(T,{color:"primary",type:"submit",disabled:f,children:f?"Kaydediliyor...":"Kaydet"}),e.jsx(T,{color:"secondary",onClick:x,disabled:f,children:"Ä°ptal"})]})]})]})},A={bank:"Banka HesabÄ±",cash:"Kasa HesabÄ±",creditCard:"Kredi KartÄ±",pos:"POS HesabÄ±",partner:"Ortaklar HesabÄ±",debt:"Veresiye HesabÄ±"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex flex-column align-items-start mb-4",children:[e.jsxs(Q,{variant:"btn-group",className:"me-2",children:[e.jsxs(X,{color:"success",size:"m",className:"text-light",children:[e.jsx(Z,{icon:ee,size:"m"})," Yeni Hesap Ekle"]}),e.jsx(ae,{children:Object.entries(A).map(([s,l])=>e.jsx(se,{onClick:()=>{I(s),b(!0)},children:l},s))})]}),e.jsx(O,{visible:w,onClose:()=>b(!1),onSubmit:E,type:o})]}),e.jsx(de,{})]})};export{pe as default};
