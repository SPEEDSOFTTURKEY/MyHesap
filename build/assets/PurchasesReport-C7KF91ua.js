import{r as c,Z as x,am as re,j as r,g as se,s as oe,h as ne,e as ie,f as d,U as f,V as g,q as le,aB as ce}from"./index-DtN76qeb.js";import{D as w}from"./DatePickerField-EZnQ-c41.js";const de={Ç:"C",ç:"c",Ğ:"G",ğ:"g",İ:"I",ı:"i",Ö:"O",ö:"o",Ş:"S",ş:"s",Ü:"U",ü:"u"},s=a=>a&&a.replace(/[ÇçĞğİıÖöŞşÜü]/g,u=>de[u]||u),ue=a=>{try{a.setFont("times","normal")}catch(u){console.error("Font ayarlama hatası:",u),a.setFont("helvetica","normal")}},p="https://speedsofttest.com/api",S=re.create({baseURL:p}),me=()=>{const[a,u]=c.useState({searchType:"",dateRangeStart:x().subtract(1,"month"),dateRangeEnd:x(),supplier:"",productService:"",category:"",brand:"",warehouse:""}),[M,z]=c.useState([]),[v,I]=c.useState([]),[j,F]=c.useState([]),[C,E]=c.useState([]),[k,P]=c.useState([]),[T,N]=c.useState([]),[A,R]=c.useState(!1),[B,$]=c.useState(!1);c.useEffect(()=>{L(),G(),U(),W(),H(),K()},[]);const L=async()=>{R(!0);try{const e=await S.get(`${p}/alis/alis-get-all`,{headers:{"Cache-Control":"no-cache"}});z(e.data)}catch(e){console.error("Alış verileri çekme hatası:",e)}finally{R(!1)}},G=async()=>{try{const e=await S.get(`${p}/tedarikci/tedarikci-get-all`);I(e.data)}catch(e){console.error("Tedarikçi verileri çekme hatası:",e)}},U=async()=>{try{const e=await S.get(`${p}/urunKategori/get-all`);F(e.data)}catch(e){console.error("Kategori verileri çekme hatası:",e)}},W=async()=>{try{const e=await S.get(`${p}/urunMarka/get-all`);E(e.data)}catch(e){console.error("Marka verileri çekme hatası:",e)}},H=async()=>{try{const e=await S.get(`${p}/depo/get-all`);P(e.data)}catch(e){console.error("Depo verileri çekme hatası:",e)}},K=async()=>{try{const e=await S.get(`${p}/urun/urun-get-all`);N(e.data)}catch(e){console.error("Ürün verileri çekme hatası:",e)}},m=e=>{const{name:i,value:n}=e.target;u(l=>({...l,[i]:n}))},Y=(e,i)=>{u(n=>({...n,[e]:i}))},O=e=>{const i={};return e.forEach(n=>{const l=n.belgeNo||"BELİRTİLMEMİŞ",h=`${l}_${n.tedarikciId}_${n.depoId}`;i[h]||(i[h]={belgeNo:l,tarih:n.tarih,tedarikci:n.tedarikci,depo:n.depo,paraBirimi:n.paraBirimi,toplamMiktar:0,toplamTutar:0,itemCount:0}),i[h].toplamMiktar+=parseFloat(n.miktar||0),i[h].toplamTutar+=parseFloat(n.toplam||0),i[h].itemCount+=1}),Object.values(i)},_=()=>{$(!0);const e=new ce("landscape");ue(e),e.setFontSize(18);const i=s("Alışlar Raporu (Belge Bazlı)");e.text(i,e.internal.pageSize.width/2,15,{align:"center"});const n=x().format("DD/MM/YYYY HH:mm:ss");e.setFontSize(10),e.text(s(`Oluşturulma Tarihi: ${n}`),e.internal.pageSize.width/2,25,{align:"center"}),e.setFontSize(12);let l=`Tarih Aralığı: ${a.dateRangeStart.format("DD/MM/YYYY")} - ${a.dateRangeEnd.format("DD/MM/YYYY")}`;if(a.supplier){const t=v.find(o=>o.id.toString()===a.supplier);l+=` | Tedarikçi: ${t?s(t.unvan):a.supplier}`}if(a.productService){const t=T.find(o=>o.id.toString()===a.productService);l+=` | Ürün: ${t?s(t.adi):a.productService}`}if(a.category){const t=j.find(o=>o.id.toString()===a.category);l+=` | Kategori: ${t?s(t.adi):a.category}`}if(a.brand){const t=C.find(o=>o.id.toString()===a.brand);l+=` | Marka: ${t?s(t.adi):a.brand}`}if(a.warehouse){const t=k.find(o=>o.id.toString()===a.warehouse);l+=` | Depo: ${t?s(t.adi):a.warehouse}`}e.text(s(l),14,35);const h=M.filter(t=>{const o=x(t.tarih);return!(!(o.isAfter(a.dateRangeStart.subtract(1,"day"))&&o.isBefore(a.dateRangeEnd.add(1,"day")))||a.supplier&&t.tedarikciId!==parseInt(a.supplier)||a.productService&&t.urunId!==parseInt(a.productService)||a.category&&t.urun&&t.urun.urunKategoriId!==parseInt(a.category)||a.brand&&t.urun&&t.urun.urunMarkaId!==parseInt(a.brand)||a.warehouse&&t.depoId!==parseInt(a.warehouse))}),y=O(h),Q=y.map(t=>{var o,b;return[s(t.belgeNo),x(t.tarih).format("DD/MM/YYYY"),s(((o=t.tedarikci)==null?void 0:o.unvan)||"-"),s(((b=t.depo)==null?void 0:b.adi)||"-"),t.itemCount,t.toplamMiktar.toFixed(2),`${t.toplamTutar.toFixed(2)} ${t.paraBirimi||"TRY"}`]}),D={};y.forEach(t=>{const o=t.paraBirimi||"TRY";D[o]||(D[o]=0),D[o]+=t.toplamTutar}),e.autoTable({startY:45,head:[[s("Belge No"),s("Tarih"),s("Tedarikçi"),s("Depo"),s("Ürün Sayısı"),s("Toplam Miktar"),s("Toplam Tutar")]],body:Q,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255]},styles:{font:"times",fontStyle:"normal",cellPadding:3,fontSize:9,overflow:"linebreak"},margin:{top:45}}),e.setFontSize(14),e.text(s("Özet"),14,e.autoTable.previous.finalY+15);const V=y.length,Z=y.reduce((t,o)=>t+o.itemCount,0),J=y.reduce((t,o)=>t+o.toplamMiktar,0),X=[[s("Toplam Belge Sayısı"),`${V} adet`],[s("Toplam Ürün Kalem Sayısı"),`${Z} adet`],[s("Toplam Miktar"),`${J.toFixed(2)}`]],ee=Object.entries(D).map(([t,o])=>[s(`${t} Toplam`),`${o.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,".")} ${t}`]);e.autoTable({startY:e.autoTable.previous.finalY+20,body:X,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255]},styles:{font:"times",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:60,fontStyle:"bold"},1:{cellWidth:50}}}),e.autoTable({startY:e.autoTable.previous.finalY+10,head:[[s("Para Birimi"),s("Toplam")]],body:ee,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255]},styles:{font:"times",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:50,fontStyle:"bold"},1:{cellWidth:50}}});const ae=e.output("blob"),te=URL.createObjectURL(ae);window.open(te,"_blank"),$(!1)},q=()=>{_()};return r.jsxs(se,{children:[r.jsx(oe,{style:{backgroundColor:"#2965A8",color:"#fff"},children:"Alışlar (Belge Bazlı Gruplama)"}),r.jsx(ne,{children:r.jsxs(ie,{children:[r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Arama"}),r.jsxs(g,{name:"searchType",value:a.searchType,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),r.jsx("option",{value:"document",children:"Belge Tarihine Göre"})]})]}),r.jsxs(d,{md:6,className:"d-flex gap-5 align-items-center",children:[r.jsx(w,{label:"Başlangıç Tarihi",value:a.dateRangeStart,onChange:e=>Y("dateRangeStart",e)}),r.jsx(w,{label:"Bitiş Tarihi",value:a.dateRangeEnd,onChange:e=>Y("dateRangeEnd",e)})]}),r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Tedarikçi"}),r.jsxs(g,{name:"supplier",value:a.supplier,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),v.map(e=>r.jsx("option",{value:e.id,children:s(e.unvan)},e.id))]})]}),r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Ürün/Hizmet"}),r.jsxs(g,{name:"productService",value:a.productService,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),T.map(e=>r.jsx("option",{value:e.id,children:s(e.adi)},e.id))]})]}),r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Kategori"}),r.jsxs(g,{name:"category",value:a.category,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),j.map(e=>r.jsx("option",{value:e.id,children:s(e.adi)},e.id))]})]}),r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Marka"}),r.jsxs(g,{name:"brand",value:a.brand,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),C.map(e=>r.jsx("option",{value:e.id,children:s(e.adi)},e.id))]})]}),r.jsxs(d,{md:6,children:[r.jsx(f,{children:"Depo"}),r.jsxs(g,{name:"warehouse",value:a.warehouse,onChange:m,className:"mb-3",children:[r.jsx("option",{value:"",children:"Seçiniz"}),k.map(e=>r.jsx("option",{value:e.id,children:s(e.adi)},e.id))]})]}),r.jsx(d,{md:12,className:"mt-3",children:r.jsx(le,{color:"primary",disabled:A||B,onClick:q,children:B?"Rapor Hazırlanıyor...":"Gruplu Rapor Hazırla"})})]})})]})};export{me as default};
