import{r as m,Z as P,j as t,g as ee,s as te,h as ae,i as oe,e as z,f as B,U as re,V as se,q as v,$ as ne,a0 as le,a1 as N,a2 as g,a3 as ie,a4 as x,al as _,aA as O,ay as A,az as de}from"./index-DvA_wB1j.js";import{D as U}from"./DatePickerField-BLTU0Ozl.js";const I="https://speedsofttest.com/api",$=async(a,b="normal")=>{try{let d,h,i;switch(b){case"bold":d="/fonts/Roboto-Bold.ttf",h="Roboto",i="bold";break;case"italic":d="/fonts/Roboto-Italic.ttf",h="Roboto",i="italic";break;default:d="/fonts/Roboto-Regular.ttf",h="Roboto",i="normal"}console.log(`Attempting to fetch ${d}...`);const S=await fetch(d);if(!S.ok)throw new Error(`Font file could not be loaded: ${S.statusText}`);const F=await S.arrayBuffer(),p=new Uint8Array(F);let j="";for(let R=0;R<p.byteLength;R++)j+=String.fromCharCode(p[R]);const f=btoa(j),T=d.split("/").pop();return console.log(`Registering ${h} ${i} font...`),a.addFileToVFS(T,f),a.addFont(T,h,i),console.log(`${h} ${i} font registered successfully`),!0}catch(d){return console.error("Font loading error:",d),console.warn("Falling back to Times font"),a.setFont("times",b==="bold"?"bold":"normal"),!1}},G=async a=>{try{return await $(a,"normal"),await $(a,"bold"),await $(a,"italic"),a.setFont("Roboto","normal"),!0}catch(b){return console.error("Error registering all fonts:",b),a.setFont("times","normal"),!1}},pe=()=>{var M;const[a,b]=m.useState({dateRangeStart:P().subtract(30,"day"),dateRangeEnd:P(),documentStatus:"",customer:""}),[d,h]=m.useState([]),[i,S]=m.useState([]),[F,p]=m.useState(!1),[j,f]=m.useState(null),[T,R]=m.useState(0),[k,H]=m.useState(0),[w,V]=m.useState(0);m.useEffect(()=>{(async()=>{p(!0);try{const o=await _.get(`${I}/musteri/musteri-get-allaktif`);h(o.data),await D(),f(null)}catch(o){console.error("API hatası:",o),f("Veriler yüklenemedi.")}finally{p(!1)}})()},[]);const D=async()=>{try{const e={startDate:a.dateRangeStart.format("YYYY-MM-DD"),endDate:a.dateRangeEnd.format("YYYY-MM-DD"),documentStatus:a.documentStatus||void 0,customerId:a.customer||void 0},o=await _.get(`${I}/musteriSatis/musteriSatis-get-filtered`,{params:e});S(o.data);const l=o.data.reduce((s,r)=>s+(r.toplamFiyat||0),0),u=o.data.length?l/o.data.length:0,c=o.data.length;R(l),H(u),V(c)}catch(e){console.error("Satış verileri yüklenemedi:",e),f("Satış verileri yüklenemedi.")}},q=e=>{const{name:o,value:l}=e.target;b(u=>({...u,[o]:l}))},L=(e,o)=>{b(l=>({...l,[e]:o}))},Z=()=>{var c;if(!i.length){f("Excel oluşturmak için veri yok.");return}const e=[["Tarih","Müşteri","Telefon","Adres","Ürün Adı","Birim","Miktar","Fiyat","Toplam Tutar"],...i.map(s=>{var r,y,n;return[s.eklenmeTarihi?new Date(s.eklenmeTarihi).toLocaleDateString("tr-TR"):"-",((r=s.musteris)==null?void 0:r.unvani)||"-",((y=s.musteris)==null?void 0:y.telefon)||"-",((n=s.musteris)==null?void 0:n.adres)||"-",s.urunAdi||"-",s.birim||"-",s.miktar||0,s.fiyat?`${s.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-",s.toplamFiyat?`${s.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"]}),[],["Özet"],["Toplam Satış",`${T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`],["Ortalama Satış",`${k.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`],["Belge Sayısı",w]],o=A.aoa_to_sheet(e),l=A.book_new();A.book_append_sheet(l,o,"Müşteri Ciroları");const u=a.customer&&((c=d.find(s=>s.id===a.customer))==null?void 0:c.unvani)||"Tümü";de(l,`MüşteriCirolarıRaporu_${u}.xlsx`)},J=async()=>{var y;if(!i.length){f("PDF oluşturmak için veri yok.");return}const e=new O({orientation:"landscape",unit:"mm",format:"a4"});await G(e),e.setFontSize(16),e.setFont("Roboto","bold");const o=a.customer?((y=d.find(n=>n.id===a.customer))==null?void 0:y.unvani)||"Seçili Müşteri":"Tüm Müşteriler";e.text(`Müşteri Ciroları Raporu - ${o}`,14,20),e.setFont("Roboto","normal");const l=["Tarih","Müşteri","Telefon","Adres","Ürün Adı","Birim","Miktar","Fiyat","Toplam Tutar"],u=i.map(n=>{var C,E,Y;return[n.eklenmeTarihi?new Date(n.eklenmeTarihi).toLocaleDateString("tr-TR"):"-",((C=n.musteris)==null?void 0:C.unvani)||"-",((E=n.musteris)==null?void 0:E.telefon)||"-",((Y=n.musteris)==null?void 0:Y.adres)||"-",n.urunAdi||"-",n.birim||"-",n.miktar||0,n.fiyat?`${n.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-",n.toplamFiyat?`${n.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"]});e.autoTable({head:[l],body:u,startY:30,theme:"grid",styles:{font:"Roboto",fontSize:8,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:n=>{e.getFontList().Roboto||e.setFont("times")}});const c=e.lastAutoTable.finalY+10;e.setFontSize(12),e.setFont("Roboto","bold"),e.text("Özet İstatistikler",14,c),e.setFont("Roboto","normal"),e.text(`Toplam Satış: ${T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,c+10),e.text(`Ortalama Satış: ${k.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,c+20),e.text(`Belge Sayısı: ${w}`,14,c+30);const s=e.output("blob"),r=URL.createObjectURL(s);window.open(r,"_blank")},K=async()=>{var s;if(!i.length){f("PDF indirmek için veri yok.");return}const e=new O({orientation:"landscape",unit:"mm",format:"a4"});await G(e),e.setFontSize(16),e.setFont("Roboto","bold");const o=a.customer?((s=d.find(r=>r.id===a.customer))==null?void 0:s.unvani)||"Seçili Müşteri":"Tüm Müşteriler";e.text(`Müşteri Ciroları Raporu - ${o}`,14,20),e.setFont("Roboto","normal");const l=["Tarih","Müşteri","Telefon","Adres","Ürün Adı","Birim","Miktar","Fiyat","Toplam Tutar"],u=i.map(r=>{var y,n,C;return[r.eklenmeTarihi?new Date(r.eklenmeTarihi).toLocaleDateString("tr-TR"):"-",((y=r.musteris)==null?void 0:y.unvani)||"-",((n=r.musteris)==null?void 0:n.telefon)||"-",((C=r.musteris)==null?void 0:C.adres)||"-",r.urunAdi||"-",r.birim||"-",r.miktar||0,r.fiyat?`${r.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-",r.toplamFiyat?`${r.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"]});e.autoTable({head:[l],body:u,startY:30,theme:"grid",styles:{font:"Roboto",fontSize:8,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:r=>{e.getFontList().Roboto||e.setFont("times")}});const c=e.lastAutoTable.finalY+10;e.setFontSize(12),e.setFont("Roboto","bold"),e.text("Özet İstatistikler",14,c),e.setFont("Roboto","normal"),e.text(`Toplam Satış: ${T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,c+10),e.text(`Ortalama Satış: ${k.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,c+20),e.text(`Belge Sayısı: ${w}`,14,c+30),e.save(`MüşteriCirolarıRaporu_${o}.pdf`)},Q=async e=>{e.preventDefault(),p(!0),await D(),p(!1)},W=async()=>{p(!0),await D(),Z(),p(!1)},X=async()=>{p(!0),await D(),J(),p(!1)};return t.jsxs(ee,{children:[t.jsx(te,{style:{backgroundColor:"#2965A8",color:"#fff"},children:"Müşteri Ciroları Raporu"}),t.jsxs(ae,{children:[t.jsxs(oe,{onSubmit:Q,children:[t.jsxs(z,{children:[t.jsxs(B,{md:6,className:"d-flex gap-5 align-items-center",children:[t.jsx(U,{label:"Başlangıç Tarihi",value:a.dateRangeStart,onChange:e=>L("dateRangeStart",e)}),t.jsx(U,{label:"Bitiş Tarihi",value:a.dateRangeEnd,onChange:e=>L("dateRangeEnd",e)})]}),t.jsxs(B,{md:3,children:[t.jsx(re,{children:"Müşteri"}),t.jsxs(se,{name:"customer",value:a.customer,onChange:q,className:"mb-3",children:[t.jsx("option",{value:"",children:"Seçiniz"}),d.map(e=>t.jsx("option",{value:e.id,children:e.unvani},e.id))]})]})]}),t.jsx(z,{className:"mt-3",children:t.jsxs(B,{className:"d-flex justify-content-start gap-3",children:[t.jsx(v,{color:"primary",type:"submit",disabled:F,children:"Getir"}),t.jsx(v,{color:"success",onClick:W,disabled:F,children:"Excel İndir"}),t.jsx(v,{color:"info",onClick:X,disabled:F,children:"Raporla"}),t.jsx(v,{color:"warning",onClick:K,disabled:F,children:"PDF İndir"})]})})]}),F?t.jsx("p",{children:"Yükleniyor..."}):j?t.jsx("p",{style:{color:"red"},children:j}):i.length===0?t.jsx("p",{children:"Seçilen kriterlere uygun satış verisi bulunamadı."}):t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"mt-4",children:a.customer?((M=d.find(e=>e.id===a.customer))==null?void 0:M.unvani)||"Seçili Müşteri":"Tüm Müşteriler"}),t.jsxs(ne,{striped:!0,hover:!0,className:"mt-2",style:{fontSize:"14px"},children:[t.jsx(le,{style:{backgroundColor:"#f8f9fa"},children:t.jsxs(N,{children:[t.jsx(g,{style:{padding:"13px"},children:"Tarih"}),t.jsx(g,{style:{padding:"13px"},children:"Müşteri"}),t.jsx(g,{style:{padding:"13px"},children:"Telefon"}),t.jsx(g,{style:{padding:"13px"},children:"Adres"}),t.jsx(g,{style:{padding:"13px"},children:"Ürün Adı"}),t.jsx(g,{style:{padding:"13px"},children:"Birim"}),t.jsx(g,{style:{padding:"13px"},children:"Miktar"}),t.jsx(g,{style:{padding:"13px"},children:"Fiyat"}),t.jsx(g,{style:{padding:"13px",textAlign:"right"},children:"Toplam Tutar"})]})}),t.jsx(ie,{children:i.map(e=>{var o,l,u;return t.jsxs(N,{children:[t.jsx(x,{style:{padding:"13px"},children:e.eklenmeTarihi?new Date(e.eklenmeTarihi).toLocaleDateString("tr-TR"):"-"}),t.jsx(x,{style:{padding:"13px"},children:((o=e.musteris)==null?void 0:o.unvani)||"-"}),t.jsx(x,{style:{padding:"13px"},children:((l=e.musteris)==null?void 0:l.telefon)||"-"}),t.jsx(x,{style:{padding:"13px"},children:((u=e.musteris)==null?void 0:u.adres)||"-"}),t.jsx(x,{style:{padding:"13px"},children:e.urunAdi||"-"}),t.jsx(x,{style:{padding:"13px"},children:e.birim||"-"}),t.jsx(x,{style:{padding:"13px"},children:e.miktar||0}),t.jsx(x,{style:{padding:"13px"},children:e.fiyat?`${e.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"}),t.jsx(x,{style:{padding:"13px",textAlign:"right"},children:e.toplamFiyat?`${e.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"})]},e.id)})})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("h5",{children:"Özet İstatistikler"}),t.jsxs("p",{children:["Toplam Satış:"," ",T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")," TL"]}),t.jsxs("p",{children:["Ortalama Satış:"," ",k.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")," TL"]}),t.jsxs("p",{children:["Belge Sayısı: ",w]})]})]})]})]})};export{pe as default};
