import{u as $,J as D,K as q,r as h,j as e,e as G,f as g,g as V,s as _,h as J,q as L,L as Q,A as X,t as Z,B as ee,D as ae,m as se,M as te,E as re,F as ne,N as oe,Q as le,S as ie,i as ce,T as de,U as f,o as k,V as me,W as pe}from"./index-DvA_wB1j.js";const ue=()=>{const F=$(),b=D(),{users:l=[],loading:w,error:S,setUsers:i}=q(),j=[{categoryId:1,accountName:"Banka Hesapları",type:"bank"},{categoryId:2,accountName:"Kasa Tanımları",type:"cash"},{categoryId:3,accountName:"Kredi Kartları",type:"creditCard"},{categoryId:4,accountName:"Pos Hesapları",type:"pos"},{categoryId:5,accountName:"Şirket Ortakları Hesapları",type:"partner"},{categoryId:6,accountName:"Veresiye Hesapları",type:"debt"}],u=r=>{if(!r)return"#ffffff";const d=r.replace("#",""),t=parseInt(d.substr(0,2),16),T=parseInt(d.substr(2,2),16),B=parseInt(d.substr(4,2),16);return(t*299+T*587+B*114)/1e3>=128?"#000000":"#ffffff"},x=r=>{F(`/app/account-detail/${r.id}`,{state:{user:r}})};return h.useEffect(()=>{b.pathname==="/app/dashboard"&&l.length},[b,l.length,i]),w?e.jsx("p",{children:"Hesaplar yükleniyor..."}):S?e.jsx("p",{children:S}):e.jsx(G,{className:"mb-4",xs:{gutter:3},children:j.map(r=>{const d=(l==null?void 0:l.filter(t=>t.type===r.type))||[];return e.jsx(g,{xs:12,sm:6,xl:6,xxl:6,children:e.jsxs(V,{className:"h-100 shadow-sm",children:[e.jsx(_,{className:"text-white",style:{backgroundColor:"#2965A8"},children:e.jsx("h5",{className:"mb-0",children:r.accountName.toUpperCase()})}),e.jsx(J,{style:{backgroundColor:"#FBF7DC"},className:"d-flex flex-wrap gap-2",children:d.length>0?d.map(t=>e.jsxs(L,{size:"sm",className:"text-start px-2 py-1 d-flex flex-column",style:{backgroundColor:t.labelColor||"#ccc",borderColor:t.labelColor||"#ccc",color:u(t.labelColor),height:"60px",minWidth:"120px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",justifyContent:"center",alignItems:"flex-start",lineHeight:"1.2"},onClick:()=>x(t),children:[e.jsx("strong",{style:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.userName||"İsim Yok"}),e.jsxs("small",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(t.balance||0).toLocaleString("tr-TR",{minimumFractionDigits:2})," ",t.currency||"TRY"]})]},`${t.id}-${r.categoryId}`)):e.jsx("p",{className:"text-muted mb-0",children:"Bu kategoride hesap yok."})})]})},`row-${r.categoryId}`)})})},ge=()=>{const[F,b]=h.useState(!1),[l,w]=h.useState(""),[S,i]=h.useState(null),[j,u]=h.useState(!1),{users:x,setUsers:r,createAccount:d,fetchAccount:t}=Q(),{user:T,logout:B}=X(),A=$(),O="https://speedsofttest.com/api",H={bank:1,cash:2,creditCard:3,pos:4,partner:5,debt:6};h.useEffect(()=>{x.length===0&&R()},[x.length]);const R=async()=>{try{const s=await Z.get(`${O}/Hesap/hesap-get-all`),n=Array.isArray(s.data)?s.data:[s.data];console.log("📦 Gelen API verisi:",n);const o=n.filter(a=>(a==null?void 0:a.tanim)&&a.tanim.trim()!==""&&(Number(a.aktif)===1||Number(a.durumu)===1)).map(a=>({id:a.id,userName:a.tanim.trim(),accountNumber:a.hesapNo||"",balance:parseFloat(a.guncelBakiye)||0,currency:a.paraBirimi||"TRY",labelColor:a.etiketRengi||"#ccc",type:Object.keys(H).find(m=>H[m]===a.hesapKategoriId)||"cash",transactions:a.transactions||[],spendingLimit:parseFloat(a.harcamaLimiti)||0,hesapKategoriId:a.hesapKategoriId||1,aktif:a.aktif,durumu:a.durumu,tanim:a.tanim}));console.log("🛠️ Formatlanmış hesaplar:",o),r(o)}catch(s){console.error("Hesaplar alınamadı:",s),i({message:`Hesaplar yüklenirken hata oluştu: ${s.message||"Bilinmeyen hata"}`,color:"danger"})}},P=async s=>{console.log("Tıklanan hesap ID:",s);try{await t(s),A(`/app/account/${s}`)}catch(n){console.error("Hesap detayları yüklenemedi:",n),i({message:`Hesap detayları yüklenirken hata: ${n.message}`,color:"danger"})}},Y=async s=>{var n,y;if(u(!0),!s.description||!s.description.trim()){i({message:"Tanım alanı boş bırakılamaz.",color:"danger"}),u(!1);return}try{const o=typeof s.balance=="string"?parseFloat(s.balance.replace(/\./g,"").replace(",","."))||0:s.balance||0,a={userName:s.description.trim(),accountNumber:s.accountNumber,balance:o,currency:s.currency||"TRY",labelColor:s.tagColor||"#0d6efd",spendingLimit:s.spendingLimit?parseFloat(s.spendingLimit.replace(/\./g,"").replace(",",".")):0,type:l,description:s.description.trim(),hesapKategoriId:H[l]||2};if(!a.accountNumber){i({message:"Hesap No zorunlu alandır.",color:"danger"}),u(!1);return}if(x.some(m=>m.accountNumber===a.accountNumber)){i({message:"Bu hesap numarası zaten kullanımda.",color:"danger"}),u(!1);return}await d(a),await R(),b(!1),i({message:"Hesap başarıyla oluşturuldu.",color:"success"})}catch(o){console.error("Hesap oluşturulamadı:",o),i({message:"Hesap oluşturulurken hata oluştu: "+(((y=(n=o.response)==null?void 0:n.data)==null?void 0:y.message)||o.message),color:"danger"})}finally{u(!1)}},z=({onSubmit:s,visible:n,onClose:y,type:o})=>{const[a,m]=h.useState({description:"",tagColor:"#0d6efd",currency:"TRY",accountNumber:"",balance:"",spendingLimit:""}),v=p=>{const{name:c,value:N}=p.target;m(C=>({...C,[c]:N}))},U=p=>{const{name:c,value:N}=p.target,C=N.replace(/[^\d]/g,"");if(!C){m(I=>({...I,[c]:""}));return}const E=M(C);m(I=>({...I,[c]:E}))},M=p=>{if(!p)return"";const c=p.replace(/[^\d]/g,"");let N=c.slice(0,-2)||"0",C=c.slice(-2).padStart(2,"0");return`${parseInt(N,10).toLocaleString("tr-TR")},${C}`},W=p=>{p.preventDefault();const c={description:a.description,tagColor:a.tagColor,currency:a.currency,accountNumber:a.accountNumber,balance:a.balance?parseFloat(a.balance.replace(/\./g,"").replace(",",".")):0,spendingLimit:a.spendingLimit?parseFloat(a.spendingLimit.replace(/\./g,"").replace(",",".")):0};s(c),m({description:"",tagColor:"#0d6efd",currency:"TRY",accountNumber:"",balance:"",spendingLimit:""})};return e.jsxs(oe,{visible:n,onClose:y,backdrop:"static",keyboard:!1,alignment:"center",children:[e.jsx(le,{children:e.jsx(ie,{children:o==="creditCard"?"Kredi Kartı Ekle":`Yeni ${K[o]} Ekle`})}),e.jsxs(ce,{onSubmit:W,children:[e.jsxs(de,{children:[e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"description",children:"Tanım"}),e.jsx(k,{type:"text",id:"description",name:"description",value:a.description,onChange:v,required:!0})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"currency",children:"Para Birimi"}),e.jsxs(me,{id:"currency",name:"currency",value:a.currency,onChange:v,required:!0,children:[e.jsx("option",{value:"TRY",children:"₺ Türk Lirası (TRY)"}),e.jsx("option",{value:"USD",children:"$ Amerikan Doları (USD)"}),e.jsx("option",{value:"EUR",children:"€ Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"£ İngiliz Sterlini (GBP)"})]})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"accountNumber",children:"Hesap numarası"}),e.jsx(k,{type:"text",id:"accountNumber",name:"accountNumber",value:a.accountNumber,onChange:v,required:!0})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"tagColor",children:"Etiket Rengi"}),e.jsx(k,{type:"color",id:"tagColor",name:"tagColor",value:a.tagColor,onChange:v})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"balance",children:"Güncel Bakiye"}),e.jsx(k,{type:"text",id:"balance",name:"balance",value:a.balance,onChange:U,placeholder:"0,00"})]}),o==="creditCard"&&e.jsxs(g,{className:"mb-3",children:[e.jsx(f,{htmlFor:"spendingLimit",children:"Harcama Limiti"}),e.jsx(k,{type:"text",id:"spendingLimit",name:"spendingLimit",value:a.spendingLimit,onChange:U,placeholder:"0,00"}),e.jsx("div",{className:"form-text",children:"Bu limitin üzerinde borç varsa hata raporu gönderilir."})]})]}),e.jsxs(pe,{children:[e.jsx(L,{color:"primary",type:"submit",disabled:j,children:j?"Kaydediliyor...":"Kaydet"}),e.jsx(L,{color:"secondary",onClick:y,disabled:j,children:"İptal"})]})]})]})},K={bank:"Banka Hesabı",cash:"Kasa Hesabı",creditCard:"Kredi Kartı",pos:"POS Hesabı",partner:"Ortaklar Hesabı",debt:"Veresiye Hesabı"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex flex-column align-items-start mb-4",children:[e.jsxs(ee,{variant:"btn-group",className:"me-2",children:[e.jsxs(ae,{color:"success",size:"m",className:"text-light",children:[e.jsx(se,{icon:te,size:"m"})," Yeni Hesap Ekle"]}),e.jsx(re,{children:Object.entries(K).map(([s,n])=>e.jsx(ne,{onClick:()=>{w(s),b(!0)},children:n},s))})]}),e.jsx(z,{visible:F,onClose:()=>b(!1),onSubmit:Y,type:l})]}),e.jsx(ue,{accounts:x,onAccountClick:P})]})};export{ge as default};
