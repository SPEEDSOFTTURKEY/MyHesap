import{r as d,Z as L,j as e,g as J,s as K,h as Q,i as W,e as M,f as C,U as X,V as ee,q as b,$ as ae,a0 as te,a1 as $,a2 as o,a3 as se,a4 as c,am as E,az as F,aA as re,aB as le}from"./index-DtN76qeb.js";import{D as Y}from"./DatePickerField-EZnQ-c41.js";const z="https://speedsofttest.com/api",de=()=>{var R;const[i,k]=d.useState({dateRangeStart:L().subtract(30,"day"),dateRangeEnd:L(),documentStatus:"",customer:""}),[g,_]=d.useState([]),[x,N]=d.useState([]),[y,u]=d.useState(!1),[D,m]=d.useState(null),[f,P]=d.useState(0),[T,O]=d.useState(0),[S,U]=d.useState(0);d.useEffect(()=>{(async()=>{u(!0);try{const t=await E.get(`${z}/musteri/musteri-get-allaktif`);_(t.data),await j(),m(null)}catch(t){console.error("API hatası:",t),m("Veriler yüklenemedi.")}finally{u(!1)}})()},[]);const j=async()=>{try{const a={startDate:i.dateRangeStart.format("YYYY-MM-DD"),endDate:i.dateRangeEnd.format("YYYY-MM-DD"),documentStatus:i.documentStatus||void 0,customerId:i.customer||void 0},t=await E.get(`${z}/musteriSatis/musteriSatis-get-filtered`,{params:a});N(t.data);const l=t.data.reduce((h,p)=>h+(p.toplamFiyat||0),0),n=t.data.length?l/t.data.length:0,s=t.data.length;P(l),O(n),U(s)}catch(a){console.error("Satış verileri yüklenemedi:",a),m("Satış verileri yüklenemedi.")}},G=a=>{const{name:t,value:l}=a.target;k(n=>({...n,[t]:l}))},v=(a,t)=>{k(l=>({...l,[a]:t}))},H=()=>{var n;if(!x.length){m("Excel oluşturmak için veri yok.");return}const a=[["Tarih","Müşteri","Telefon","Adres","Ürün Adı","Birim","Miktar","Fiyat","Toplam Tutar"],...x.map(s=>{var h,p,r;return[s.eklenmeTarihi?new Date(s.eklenmeTarihi).toLocaleDateString("tr-TR"):"-",((h=s.musteris)==null?void 0:h.unvani)||"-",((p=s.musteris)==null?void 0:p.telefon)||"-",((r=s.musteris)==null?void 0:r.adres)||"-",s.urunAdi||"-",s.birim||"-",s.miktar||0,s.fiyat?`${s.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-",s.toplamFiyat?`${s.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"]}),[],["Özet"],["Toplam Satış",`${f.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`],["Ortalama Satış",`${T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`],["Belge Sayısı",S]],t=F.aoa_to_sheet(a),l=F.book_new();F.book_append_sheet(l,t,"Müşteri Ciroları"),re(l,`MusteriCirolariRaporu_${i.customer&&((n=g.find(s=>s.id===i.customer))==null?void 0:n.unvani)||"Tumu"}.xlsx`)},I=()=>{var p;if(!x.length){m("PDF oluşturmak için veri yok.");return}const a=new le;a.setFontSize(16),i.customer&&((p=g.find(r=>r.id===i.customer))==null||p.unvani),a.text("Müşteri Ciroları Raporu ",14,20);const t=["Tarih","Müşteri","Telefon","Adres","Ürün Adı","Birim","Miktar","Fiyat","Toplam Tutar"],l=x.map(r=>{var B,A,w;return[r.eklenmeTarihi?new Date(r.eklenmeTarihi).toLocaleDateString("tr-TR"):"-",((B=r.musteris)==null?void 0:B.unvani)||"-",((A=r.musteris)==null?void 0:A.telefon)||"-",((w=r.musteris)==null?void 0:w.adres)||"-",r.urunAdi||"-",r.birim||"-",r.miktar||0,r.fiyat?`${r.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-",r.toplamFiyat?`${r.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"]});a.autoTable({head:[t],body:l,startY:30,theme:"grid",headStyles:{fillColor:[41,101,168],textColor:[255,255,255]},styles:{fontSize:8}});const n=a.lastAutoTable.finalY+10;a.setFontSize(12),a.text("Özet İstatistikler",14,n),a.text(`Toplam Satış: ${f.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,n+10),a.text(`Ortalama Satış: ${T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,14,n+20),a.text(`Belge Sayısı: ${S}`,14,n+30);const s=a.output("blob"),h=URL.createObjectURL(s);window.open(h,"_blank")},V=async a=>{a.preventDefault(),u(!0),await j(),u(!1)},q=async()=>{u(!0),await j(),H(),u(!1)},Z=async()=>{u(!0),await j(),I(),u(!1)};return e.jsxs(J,{children:[e.jsx(K,{style:{backgroundColor:"#2965A8",color:"#fff"},children:"Müşteri Ciroları Raporu"}),e.jsxs(Q,{children:[e.jsxs(W,{onSubmit:V,children:[e.jsxs(M,{children:[e.jsxs(C,{md:6,className:"d-flex gap-5 align-items-center",children:[e.jsx(Y,{label:"Başlangıç Tarihi",value:i.dateRangeStart,onChange:a=>v("dateRangeStart",a)}),e.jsx(Y,{label:"Bitiş Tarihi",value:i.dateRangeEnd,onChange:a=>v("dateRangeEnd",a)})]}),e.jsxs(C,{md:3,children:[e.jsx(X,{children:"Müşteri"}),e.jsxs(ee,{name:"customer",value:i.customer,onChange:G,className:"mb-3",children:[e.jsx("option",{value:"",children:"Seçiniz"}),g.map(a=>e.jsx("option",{value:a.id,children:a.unvani},a.id))]})]})]}),e.jsx(M,{className:"mt-3",children:e.jsxs(C,{className:"d-flex justify-content-start gap-3",children:[e.jsx(b,{color:"primary",type:"submit",disabled:y,children:"Getir"}),e.jsx(b,{color:"success",onClick:q,disabled:y,children:"Excel İndir"}),e.jsx(b,{color:"info",onClick:Z,disabled:y,children:"Raporla"})]})})]}),y?e.jsx("p",{children:"Yükleniyor..."}):D?e.jsx("p",{style:{color:"red"},children:D}):x.length===0?e.jsx("p",{children:"Seçilen kriterlere uygun satış verisi bulunamadı."}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"mt-4",children:i.customer?((R=g.find(a=>a.id===i.customer))==null?void 0:R.unvani)||"Seçili Müşteri":"Tüm Müşteriler"}),e.jsxs(ae,{striped:!0,hover:!0,className:"mt-2",style:{fontSize:"14px"},children:[e.jsx(te,{style:{backgroundColor:"#f8f9fa"},children:e.jsxs($,{children:[e.jsx(o,{style:{padding:"13px"},children:"Tarih"}),e.jsx(o,{style:{padding:"13px"},children:"Müşteri"}),e.jsx(o,{style:{padding:"13px"},children:"Telefon"}),e.jsx(o,{style:{padding:"13px"},children:"Adres"}),e.jsx(o,{style:{padding:"13px"},children:"Ürün Adı"}),e.jsx(o,{style:{padding:"13px"},children:"Birim"}),e.jsx(o,{style:{padding:"13px"},children:"Miktar"}),e.jsx(o,{style:{padding:"13px"},children:"Fiyat"}),e.jsx(o,{style:{padding:"13px",textAlign:"right"},children:"Toplam Tutar"})]})}),e.jsx(se,{children:x.map(a=>{var t,l,n;return e.jsxs($,{children:[e.jsx(c,{style:{padding:"13px"},children:a.eklenmeTarihi?new Date(a.eklenmeTarihi).toLocaleDateString("tr-TR"):"-"}),e.jsx(c,{style:{padding:"13px"},children:((t=a.musteris)==null?void 0:t.unvani)||"-"}),e.jsx(c,{style:{padding:"13px"},children:((l=a.musteris)==null?void 0:l.telefon)||"-"}),e.jsx(c,{style:{padding:"13px"},children:((n=a.musteris)==null?void 0:n.adres)||"-"}),e.jsx(c,{style:{padding:"13px"},children:a.urunAdi||"-"}),e.jsx(c,{style:{padding:"13px"},children:a.birim||"-"}),e.jsx(c,{style:{padding:"13px"},children:a.miktar||0}),e.jsx(c,{style:{padding:"13px"},children:a.fiyat?`${a.fiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"}),e.jsx(c,{style:{padding:"13px",textAlign:"right"},children:a.toplamFiyat?`${a.toplamFiyat.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`:"-"})]},a.id)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Özet İstatistikler"}),e.jsxs("p",{children:["Toplam Satış:"," ",f.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")," TL"]}),e.jsxs("p",{children:["Ortalama Satış:"," ",T.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")," TL"]}),e.jsxs("p",{children:["Belge Sayısı: ",S]})]})]})]})]})};export{de as default};
