import{L as oe,j as e,g as ke,h as be,s as Te,e as $e,f as ve,q as Y,m as de,X as Ge,B as Ae,D as De,E as Se,F as ce,Y as Ee,o as Z,Z as S,r as J,$ as Ue,a0 as Ve,a1 as Fe,a2 as ne,a3 as _e,a4 as ie,a5 as We,a6 as Qe,N as ue,Q as me,S as pe,T as he,W as ge,a7 as qe,i as Ie,t as A,u as Be,U as Q,a8 as Me,a9 as Re,aa as Pe,K as Xe,V as Ze,C as Je,a as ea,b as aa,c as sa,ab as ra}from"./index-DtN76qeb.js";import{c as ta}from"./cil-action-redo-BJFkhFcp.js";import{c as na}from"./cil-arrow-thick-top-BXOgyfTr.js";import{c as ia}from"./cil-transfer-BeKoe_Wl.js";import{C as Ye}from"./CCardText-DsGj6EwR.js";const la=()=>{const{selectedUser:w,getTextColor:N,getCurrencySymbol:n}=oe();return w?e.jsxs(ke,{className:"mb-3 shadow-sm w-50",children:[e.jsx(Te,{className:"p-3",style:{backgroundColor:w.labelColor||"var(--primary-color)",color:N(w.labelColor)},children:e.jsx("h4",{children:e.jsx("strong",{children:w.userName})})}),e.jsxs(be,{className:"d-flex",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center me-4",style:{fontSize:"2.5rem",fontWeight:"bold",width:"70px",height:"70px",borderRadius:"50%",backgroundColor:w.labelColor||"#eee",color:N(w.labelColor)},children:n(w.currency)}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Hesap No:"})," ",w.accountNumber||"Bilinmiyor"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Bakiye:"})," ",(w.balance||0).toLocaleString("tr-TR",{minimumFractionDigits:2})," ",w.currency||"TRY"]})]})]})]}):e.jsx(ke,{className:"mb-3 shadow-sm",children:e.jsx(be,{children:e.jsx("p",{children:"Lütfen bir hesap seçin."})})})},oa=()=>{const{setModalVisible:w,setTransactionModalVisible:N,setTransactionType:n,setTransactionForm:s,setVisibleTransferModal:t,setTransferDirection:L,setFilterPeriod:$,searchQuery:j,setSearchQuery:u,setEditingTransaction:l}=oe(),c={"--cui-dropdown-link-hover-color":"#ffffff","--cui-dropdown-link-hover-bg":"#f0b942","--cui-dropdown-link-active-color":"#ffffff","--cui-dropdown-link-active-bg":"#eead20"},k={"--cui-dropdown-link-hover-color":"#ffffff","--cui-dropdown-link-hover-bg":"#504fb0","--cui-dropdown-link-active-color":"#ffffff","--cui-dropdown-link-active-bg":"#5e5cd0"},d=()=>w(!0),b=M=>{l(null),n(M),s({rawAmount:"",formattedAmount:"",description:"",date:S().format("YYYY-MM-DD"),recipientAccount:"",submissionTimestamp:null}),N(!0)},O=M=>{l(null),L(M),s({rawAmount:"",formattedAmount:"",description:"",date:S().format("YYYY-MM-DD"),recipientAccount:"",submissionTimestamp:null}),t(!0)},E=M=>{const g=M.target.value||"";try{u(g),console.log("Arama terimi:",g)}catch(ee){console.error("Arama güncelleme hatası:",ee)}};return e.jsx($e,{className:"d-flex gap-2 flex-wrap mb-2",children:e.jsxs(ve,{children:[e.jsxs(Y,{className:"mx-1 text-white",color:"info",size:"sm",onClick:d,children:[e.jsx(de,{icon:Ge})," Hesabı Güncelle"]}),e.jsxs(Y,{className:"mx-1 text-white",color:"success",size:"sm",onClick:()=>b("in"),children:[e.jsx(de,{icon:ta})," Para Girişi"]}),e.jsxs(Y,{className:"mx-1 text-white",color:"danger",size:"sm",onClick:()=>b("out"),children:[e.jsx(de,{icon:na})," Para Çıkışı"]}),e.jsxs(Ae,{children:[e.jsxs(De,{className:"mx-1 text-white",size:"sm",color:"warning",children:[e.jsx(de,{icon:ia})," Hesaplar Arası Transfer"]}),e.jsxs(Se,{children:[e.jsx(ce,{style:c,onClick:()=>O("outgoing"),children:"Bu hesaptan başka hesaba para aktar"}),e.jsx(ce,{style:c,onClick:()=>O("incoming"),children:"Başka hesaptan bu hesaba para aktar"})]})]}),e.jsxs(Ae,{children:[e.jsxs(De,{className:"mx-1 text-white",size:"sm",color:"primary",children:[e.jsx(de,{icon:Ee})," Listele"]}),e.jsxs(Se,{children:[e.jsx(ce,{style:k,onClick:()=>$("all"),children:"Tümünü Göster"}),e.jsx(ce,{style:k,onClick:()=>$("today"),children:"Bugün"}),e.jsx(ce,{style:k,onClick:()=>$("last7days"),children:"Son 7 gün"}),e.jsx(ce,{style:k,onClick:()=>$("last30days"),children:"Son 30 gün"}),e.jsx(ce,{style:k,onClick:()=>$("last1year"),children:"Son 1 yıl"})]})]}),e.jsx(Z,{type:"text",style:{margin:"5px",width:"200px",display:"inline-block"},size:"sm",placeholder:"Hesaplarda ara...",value:j||"",onChange:E,className:"my-2"})]})})},le="https://speedsofttest.com/api",ca=()=>{const{transactions:w,showDeleteTransactionModal:N,setShowDeleteTransactionModal:n,transactionToDelete:s,setTransactionToDelete:t,rawTransactions:L,setRawTransactions:$,setTransactions:j,selectedUser:u,setSelectedUser:l,users:c,setUsers:k,userId:d,setToast:b,fetchTransactions:O}=oe(),[E,M]=J.useState(!1),[g,ee]=J.useState(null),[K,te]=J.useState({Tutar:""}),[T,p]=J.useState(!1),[m,D]=J.useState(""),I=async(a,r,i,h,f)=>{var B,G;try{const R=await A.get(`${le}/hesapHareket/hesapHareket-get-by-Id/${r}`),o=(Array.isArray(R.data)?R.data:[]).find(P=>P.etkilenenHesapId===a&&parseFloat(P.tutar)===parseFloat(i)&&P.islemTarihi===h&&P.islemTuruId===(f?4:3));return o||console.warn("fetchRelatedTransaction: Karşı işlem bulunamadı",{hesapId:a,etkilenenHesapId:r,amount:i,islemTarihi:h}),o||null}catch(R){return console.error("fetchRelatedTransaction error:",{message:R.message,response:(B=R.response)==null?void 0:B.data,status:(G=R.response)==null?void 0:G.status}),null}},x=a=>{ee(a),te({Tutar:a.tutar||""}),M(!0),D("")},H=async()=>{var a,r;if(g){p(!0),D("");try{const i={Id:g.id,KullanicilarId:d,HesapId:g.hesapId,HesapKategoriId:g.hesapKategoriId,EtkilenenHesapId:g.etkilenenHesapId,IslemTarihi:g.islemTarihi,IslemTuruId:g.islemTuruId,Bilgi:g.bilgi,Aciklama:g.aciklama,Borc:g.borc,Alacak:g.alacak,Tutar:parseFloat(K.Tutar),Bakiye:g.bakiye,GuncelleyenKullaniciId:d};if((await A.put(`${le}/hesapHareket/hesapHareket-update`,i)).status===200){if(b({message:"İşlem başarıyla güncellendi.",color:"success"}),g.islemTuruId===3||g.islemTuruId===4){const f=await I(g.hesapId,g.etkilenenHesapId,g.tutar,g.islemTarihi,g.islemTuruId===3);if(f){const B={Id:f.id,KullanicilarId:d,HesapId:f.hesapId,HesapKategoriId:f.hesapKategoriId,EtkilenenHesapId:f.etkilenenHesapId,IslemTarihi:f.islemTarihi,IslemTuruId:f.islemTuruId,Bilgi:f.bilgi,Aciklama:f.aciklama,Borc:f.borc,Alacak:f.alacak,Tutar:parseFloat(K.Tutar),Bakiye:f.bakiye,GuncelleyenKullaniciId:d};await A.put(`${le}/hesapHareket/hesapHareket-update`,B)}}await O(d,u.id,u.hesapKategoriId),M(!1)}}catch(i){console.error("Güncelleme hatası:",i),D("Güncelleme sırasında bir hata oluştu: "+(((r=(a=i.response)==null?void 0:a.data)==null?void 0:r.Message)||i.message))}finally{p(!1)}}},F=async()=>{var a,r,i;if(!(s!=null&&s.id)||!(s!=null&&s.hesapId)){console.error("Invalid transaction or account ID:",s),b({message:"Geçersiz işlem veya hesap ID'si.",color:"danger"}),n(!1),t(null);return}try{const h=parseFloat(s.tutar)||0,f=s.islemTuruId===3,B=s.islemTuruId===4,G=f||B,re=(await A.get(`${le}/Hesap/Hesap-get-by-Id/${s.hesapId}`)).data;let P=parseFloat(re.guncelBakiye)||0,q=null,U=null,_=null;if(G){if(!s.etkilenenHesapId){b({message:"Transfer işlemi için karşı hesap ID'si eksik.",color:"danger"}),console.warn("confirmDeleteTransaction: etkilenenHesapId eksik",s),n(!1),t(null);return}U=(await A.get(`${le}/Hesap/Hesap-get-by-Id/${s.etkilenenHesapId}`)).data;let C=parseFloat(U.guncelBakiye)||0;if(_=await I(s.hesapId,s.etkilenenHesapId,h,s.islemTarihi,f),!_){b({message:"İlgili transfer işlemi bulunamadı.",color:"danger"}),console.warn("confirmDeleteTransaction: Karşı işlem bulunamadı",s.etkilenenHesapId),n(!1),t(null);return}f?(P+=h,q=C-h):(P-=h,q=C+h),await A.delete(`${le}/hesapHareket/hesapHareket-delete/${s.id}?kullaniciId=${d}`),await A.delete(`${le}/hesapHareket/hesapHareket-delete/${_.id}?kullaniciId=${d}`)}else{if(s.islemTuruId===1)P-=h;else if(s.islemTuruId===2)P+=h;else{b({message:"Yalnızca para girişi, çıkışı veya transfer işlemleri silinebilir.",color:"warning"}),n(!1),t(null);return}await A.delete(`${le}/hesapHareket/hesapHareket-delete/${s.id}?kullaniciId=${d}`)}const v=L.filter(y=>y.id!==s.id&&y.id!==((_==null?void 0:_.id)||null)).sort((y,C)=>S(C.islemTarihi).isAfter(S(y.islemTarihi))?1:-1);$(v),j(v.filter(y=>y.hesapId===(u==null?void 0:u.id)));const fe=c.map(y=>y.id===s.hesapId?{...y,balance:P}:y.id===s.etkilenenHesapId&&q!==null?{...y,balance:q}:y);k(fe),(u==null?void 0:u.id)===s.hesapId?l(y=>({...y,balance:P})):G&&(u==null?void 0:u.id)===s.etkilenenHesapId&&l(y=>({...y,balance:q})),await O(d,u.id,u.hesapKategoriId),b({message:"İşlem silindi.",color:"success"})}catch(h){console.error("Silme hatası:",{message:h.message,response:(a=h.response)==null?void 0:a.data}),b({message:"İşlem silme sırasında hata oluştu: "+(((i=(r=h.response)==null?void 0:r.data)==null?void 0:i.message)||h.message),color:"danger"})}finally{n(!1),t(null)}};return e.jsx(e.Fragment,{children:e.jsxs(ke,{className:"mb-4",children:[e.jsx(Te,{className:"p-3",style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},children:e.jsx("h5",{children:"İşlem Geçmişi"})}),e.jsx(be,{children:w.length>0?e.jsxs(Ue,{responsive:!0,children:[e.jsx(Ve,{children:e.jsxs(Fe,{children:[e.jsx(ne,{children:"Tarih"}),e.jsx(ne,{children:"İşlem"}),e.jsx(ne,{children:"Kullanıcı"}),e.jsx(ne,{children:"Hesap No"}),e.jsx(ne,{children:"Açıklama"}),e.jsx(ne,{children:"Borç"}),e.jsx(ne,{children:"Alacak"}),e.jsx(ne,{children:"İşlemler"})]})}),e.jsx(_e,{className:"my-2",children:w.map((a,r)=>e.jsxs(Fe,{children:[e.jsx(ie,{children:a.date||"-"}),e.jsx(ie,{children:a.type||"-"}),e.jsx(ie,{children:a.userName||"Bilinmiyor"}),e.jsx(ie,{children:a.accountNumber||"-"}),e.jsx(ie,{children:a.bilgi||a.description||"-"}),e.jsx(ie,{children:a.debit||"-"}),e.jsx(ie,{children:a.credit||"-"}),e.jsxs(ie,{children:[e.jsx(Y,{color:"info",size:"sm",className:"me-2",style:{color:"white",marginBottom:"3px"},onClick:()=>x(a),children:e.jsx(de,{icon:We})}),(a.islemTuruId===1||a.islemTuruId===2||a.islemTuruId===3||a.islemTuruId===4)&&e.jsx(Y,{color:"danger",size:"sm",style:{color:"white"},onClick:()=>{t(a),n(!0)},children:e.jsx(de,{icon:Qe})})]})]},a.id||r))})]}):e.jsx("p",{children:"Henüz işlem bulunmamaktadır."})}),e.jsxs(ue,{visible:N,onClose:()=>{n(!1),t(null)},className:"shadow-sm",backdrop:"static",children:[e.jsx(me,{style:{backgroundColor:"var(--danger-color)",color:"var(--white-color)"},children:e.jsx(pe,{children:"Silme Onayı"})}),e.jsx(he,{children:e.jsxs("p",{children:['"',e.jsx("strong",{children:(s==null?void 0:s.description)||"Bu işlem"}),'" tablodan kaldırılacak, emin misiniz? Bu işlem geri alınamaz.']})}),e.jsxs(ge,{children:[e.jsx(Y,{color:"secondary",onClick:()=>{n(!1),t(null)},children:"İptal"}),e.jsx(Y,{color:"danger",onClick:F,className:"text-white",children:"Sil"})]})]}),e.jsxs(ue,{visible:E,onClose:()=>M(!1),className:"shadow-sm",backdrop:"static",size:"lg",children:[e.jsx(me,{style:{backgroundColor:"var(--info-color)",color:"var(--white-color)"},children:e.jsx(pe,{children:"İşlem Güncelle"})}),e.jsxs(he,{children:[m&&e.jsx(qe,{color:"danger",children:m}),e.jsx(Ie,{children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Tutar"}),e.jsx(Z,{type:"number",value:K.Tutar,onChange:a=>te({...K,Tutar:a.target.value}),placeholder:"Tutar",step:"0.01"})]})})]}),e.jsxs(ge,{children:[e.jsx(Y,{color:"secondary",onClick:()=>M(!1),disabled:T,children:"İptal"}),e.jsx(Y,{color:"primary",onClick:H,disabled:T,className:"text-white",children:T?"Güncelleniyor...":"Güncelle"})]})]})]})})},He="https://speedsofttest.com/api",da=()=>{const{modalVisible:w,setModalVisible:N,formData:n,setFormData:s,selectedUser:t,setSelectedUser:L,users:$,setUsers:j,setToast:u,userId:l}=oe(),c=Be(),[k,d]=J.useState(!1),[b,O]=J.useState(!1),E=T=>{const{name:p,value:m}=T.target;s(D=>({...D,[p]:m}))},M=async()=>{var p,m,D,I;if(!((p=n.userName)!=null&&p.trim())||!((m=n.accountNumber)!=null&&m.trim())){u({message:"Hesap Adı ve Hesap No zorunlu alanlardır.",color:"danger"});return}if($.some(x=>x.accountNumber===n.accountNumber&&x.id!==t.id)){u({message:"Bu hesap numarası zaten kullanımda.",color:"danger"});return}const T={...t,userName:n.userName.trim(),accountNumber:n.accountNumber.trim(),labelColor:n.labelColor||"#cccccc",description:n.description||"",spendingLimit:parseFloat(n.spendingLimit)||0,balance:parseFloat(n.balance)||0,currency:t.currency||"TRY",transactions:t.transactions,type:t.type,hesapKategoriId:t.hesapKategoriId,kullaniciId:l};try{await A.put(`${He}/Hesap/hesap-update`,{id:T.id,tanim:T.userName,hesapNo:T.accountNumber,guncelBakiye:T.balance,paraBirimi:T.currency,etiketRengi:T.labelColor,harcamaLimiti:T.spendingLimit,guncellenmeTarihi:new Date().toISOString(),hesapKategoriId:T.hesapKategoriId,durumu:t.durumu||1,aktif:t.aktif||1,eklenmeTarihi:t.eklenmeTarihi||new Date().toISOString(),kullaniciId:l}),L(T),j(x=>x.map(H=>H.id===T.id?T:H)),u({message:"Hesap başarıyla güncellendi.",color:"success"}),N(!1)}catch(x){u({message:"Hesap güncellenirken hata oluştu: "+(((I=(D=x.response)==null?void 0:D.data)==null?void 0:I.message)||x.message),color:"danger"})}},g=()=>{O(!0)},ee=async()=>{var T,p;if(!(t!=null&&t.id)||!l){u({message:"Hesap ID'si veya kullanıcı ID'si eksik.",color:"danger"}),O(!1);return}try{await A.put(`${He}/Hesap/hesap-aktif/${t.id}`);const m={...t,aktif:t.aktif===1?0:1};L(m),j(D=>D.map(I=>I.id===t.id?m:I)),u({message:m.aktif===1?`Hesap "${n.userName}" aktifleştirildi.`:`Hesap "${n.userName}" pasif yapıldı.`,color:m.aktif===1?"success":"warning"}),N(!1),O(!1),c("/app/dashboard")}catch(m){u({message:"Hesap pasif yapılırken hata oluştu: "+(((p=(T=m.response)==null?void 0:T.data)==null?void 0:p.message)||m.message),color:"danger"}),O(!1)}},K=()=>{d(!0)},te=async()=>{var T,p;if(!(t!=null&&t.id)||!l){u({message:"Hesap ID'si veya kullanıcı ID'si eksik.",color:"danger"}),d(!1);return}try{await A.delete(`${He}/Hesap/hesap-delete/${t.id}?kullaniciId=${l}`),j(m=>m.filter(D=>D.id!==t.id)),L(null),u({message:"Hesap silindi.",color:"success"}),N(!1),d(!1),c("/app/dashboard")}catch(m){u({message:"Hesap silinirken hata oluştu: "+(((p=(T=m.response)==null?void 0:T.data)==null?void 0:p.message)||m.message),color:"danger"}),d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{visible:w,backdrop:"static",keyboard:!1,onClose:()=>N(!1),className:"shadow-sm",children:[e.jsx(me,{style:{backgroundColor:"#2965A8",color:"#FFFFFF"},children:e.jsx(pe,{children:"Hesap Güncelle"})}),e.jsx(he,{children:e.jsxs(Ie,{children:[e.jsx(Q,{htmlFor:"userName",children:"Hesap Adı"}),e.jsx(Z,{name:"userName",value:n.userName,onChange:E}),e.jsx(Q,{htmlFor:"accountNumber",className:"mt-3",children:"Hesap No"}),e.jsx(Z,{name:"accountNumber",value:n.accountNumber,onChange:E}),e.jsx(Q,{htmlFor:"balance",className:"mt-3",children:"Güncel Bakiye"}),e.jsx(Z,{type:"number",name:"balance",value:n.balance,onChange:E}),e.jsx(Q,{htmlFor:"labelColor",className:"mt-3",children:"Etiket Rengi"}),e.jsx(Z,{type:"color",name:"labelColor",value:n.labelColor,onChange:E}),e.jsx(Q,{htmlFor:"spendingLimit",className:"mt-3",children:"Harcama Limiti"}),e.jsx(Z,{type:"number",name:"spendingLimit",value:n.spendingLimit,onChange:E})]})}),e.jsxs(ge,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx(Y,{color:"warning",className:"me-2",style:{color:"white"},onClick:g,children:"Pasif/Aktif Yap"}),e.jsx(Y,{color:"danger",style:{color:"white"},onClick:K,children:"Sil"})]}),e.jsx(Y,{color:"primary",onClick:M,children:"Kaydet"})]})]}),e.jsxs(ue,{visible:k,onClose:()=>d(!1),className:"shadow-sm",backdrop:"static",children:[e.jsx(me,{style:{backgroundColor:"#dc3545",color:"#FFFFFF"},children:e.jsx(pe,{children:"Silme Onayı"})}),e.jsx(he,{children:e.jsxs("p",{children:['Hesap "',e.jsx("strong",{children:(n==null?void 0:n.userName)||"Bilinmeyen Hesap"}),'" silinecek, emin misiniz? Bu işlem geri alınamaz.']})}),e.jsxs(ge,{children:[e.jsx(Y,{color:"secondary",onClick:()=>d(!1),children:"İptal"}),e.jsx(Y,{color:"danger",onClick:te,className:"text-white",children:"Sil"})]})]}),e.jsxs(ue,{visible:b,onClose:()=>O(!1),className:"shadow-sm",backdrop:"static",children:[e.jsx(me,{style:{backgroundColor:"#F6A213",color:"#FFFFFF"},children:e.jsx(pe,{children:"Pasif/Aktif Yapma Onayı"})}),e.jsx(he,{children:e.jsxs("p",{children:['Hesap "',e.jsx("strong",{children:(n==null?void 0:n.userName)||"Bilinmeyen Hesap"}),'"',(t==null?void 0:t.aktif)===1?" pasif ":" aktif ","yapılacak, emin misiniz?"]})}),e.jsxs(ge,{children:[e.jsx(Y,{color:"secondary",onClick:()=>O(!1),children:"İptal"}),e.jsx(Y,{color:"warning",onClick:ee,className:"text-white",children:"Onayla"})]})]})]})},je="https://speedsofttest.com/api",ua=`
  .custom-modal .close {
    color: #FFFFFF !important;
    opacity: 1 !important;
  }
  .custom-modal .close:hover {
    color: #FFFFFF !important;
    opacity: 0.8 !important;
  }
`,ma=()=>{const{transactionModalVisible:w,setTransactionModalVisible:N,transactionType:n,transactionForm:s,setTransactionForm:t,value:L,setValue:$,selectedUser:j,setSelectedUser:u,setToast:l,editingTransaction:c,setEditingTransaction:k,isSubmitting:d,setIsSubmitting:b,rawTransactions:O,setRawTransactions:E,processedSubmissions:M,userId:g,setUsers:ee,setTransactions:K}=oe(),te=m=>{const{name:D,value:I}=m.target;t(x=>({...x,[D]:I}))},T=m=>{const I=m.target.value.replace(/[^\d,]/g,"").replace(/,/g,"");if(!I){t(r=>({...r,rawAmount:"",formattedAmount:""}));return}let x=I.slice(0,-2)||"0",H=I.slice(-2).padStart(2,"0");const F=parseFloat(`${x}.${H}`),a=`${parseInt(x,10).toLocaleString("tr-TR")},${H}`;t(r=>({...r,rawAmount:F.toString(),formattedAmount:a}))},p=async m=>{var f,B,G,R,re;if(m.preventDefault(),d)return;if(!j){l({message:"Lütfen bir kullanıcı seçin.",color:"danger"});return}const D=Date.now();if(M.current.has(D))return;b(!0),t(o=>({...o,submissionTimestamp:D}));const I=parseFloat(s.rawAmount);if(isNaN(I)||I<=0){l({message:"Lütfen geçerli bir tutar girin.",color:"danger"}),b(!1);return}const x=n==="in";if(!x&&!(n==="out")){l({message:"Geçersiz işlem türü.",color:"danger"}),b(!1);return}let F;if(!j||!j.id){l({message:"Hesap seçilmedi veya geçersiz.",color:"danger"}),b(!1);return}try{const o=await A.get(`${je}/Hesap/Hesap-get-by-Id/${j.id}`);if(console.log("TransactionModal;",j.id),console.log("API'den gelen yanıt:",o.data),!o.data||!Array.isArray(o.data)||o.data.length===0){l({message:"Hesap bilgisi alınamadı.",color:"danger"}),b(!1);return}F=parseFloat(o.data[0].guncelBakiye)||0}catch(o){console.error("Bakiye alma hatası:",o.response||o),l({message:"Bakiye kontrolü başarısız.",color:"danger"}),b(!1);return}let a=0,r=null;if(c){if(!c.id){l({message:"Geçersiz işlem ID'si.",color:"danger"}),b(!1);return}try{if(r=(await A.get(`${je}/hesapHareket/hesapHareket-get-by-Id/${j.id}`)).data.find(P=>P.id===c.id),r)if(a=parseFloat(r.tutar)||0,r.islemTuruId===1)F-=a;else if(r.islemTuruId===2)F+=a;else{l({message:"Yalnızca Para Girişi veya Çıkışı işlemleri düzenlenebilir.",color:"danger"}),b(!1);return}else{console.warn(`İşlem ID ${c.id} bulunamadı`),l({message:"Düzenlenecek işlem bulunamadı.",color:"danger"}),b(!1);return}}catch(o){console.error("İşlem alma hatası:",o.response||o),l({message:"İşlem detayları alınamadı.",color:"danger"}),b(!1);return}}const i=s.date?S(s.date,"DD.MM.YYYY").isValid()?S(s.date,"DD.MM.YYYY").toISOString():new Date().toISOString():new Date().toISOString(),h={id:c?c.id:0,kullanicilarId:g,hesapId:j.id,etkilenenHesapId:j.etkilenenHesapId??j.id,hesapKategoriId:j.hesapKategoriId||1,islemTarihi:i,islemTuruId:x?1:2,bilgi:s.description||"",aciklama:s.description||(x?"Para Girişi":"Para Çıkışı"),tutar:I,borc:x?0:I,alacak:x?I:0,bakiye:0,eklenmeTarihi:c?(r==null?void 0:r.eklenmeTarihi)||new Date().toISOString():new Date().toISOString(),guncellenmeTarihi:new Date().toISOString(),durumu:1};console.log("API'ye gönderilen işlem objesi:",h),b(!0);try{let o;c?o=await A.put(`${je}/hesapHareket/hesapHareket-update`,h):o=await A.post(`${je}/hesapHareket/hesapHareket-create`,h);const q={id:c?c.id:o.data.id||Date.now(),date:s.date||S().format("DD.MM.YYYY"),type:x?"Para Girişi":"Para Çıkışı",description:s.description||(x?"Para Girişi":"Para Çıkışı"),debit:x?"-":`${I.toLocaleString("tr-TR",{minimumFractionDigits:2})}`,credit:x?`${I.toLocaleString("tr-TR",{minimumFractionDigits:2})}`:"-",islemTarihi:i,islemTuruId:x?1:2,tutar:I,etkilenenHesapId:j.etkilenenHesapId||j.id,hesapId:j.id,borc:x?0:I,alacak:x?I:0,durumu:1};console.log("Yeni işlem:",q);let U=[...O];c&&r&&(U=U.filter(C=>C.id!==c.id)),(!c||c&&r)&&U.push(q);const _=U.filter(C=>C.durumu===1),v=_.reduce((C,z)=>C+(z.alacak||0),0),fe=_.reduce((C,z)=>C+(z.borc||0),0),y=v-fe;console.log("Yeni bakiye:",y),U.sort((C,z)=>S(z.islemTarihi).isAfter(S(C.islemTarihi))?1:-1),E(U),K(U.filter(C=>C.durumu===1)),ee(C=>C.map(z=>z.id===j.id?{...z,balance:y}:z)),u(C=>({...C,balance:y})),M.current.add(D),l({message:c?`İşlem güncellendi: ${a.toLocaleString("tr-TR",{minimumFractionDigits:2})} ${j.currency} -> ${I.toLocaleString("tr-TR",{minimumFractionDigits:2})} ${j.currency}`:"İşlem başarıyla eklendi!",color:"success"}),N(!1),k(null),t({rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})}catch(o){console.error("Transaction error:",{message:o.message,response:(f=o.response)==null?void 0:f.data,status:(B=o.response)==null?void 0:B.status,url:(G=o.config)==null?void 0:G.url,payload:h}),l({message:"İşlem sırasında hata oluştu: "+(((re=(R=o.response)==null?void 0:R.data)==null?void 0:re.message)||o.message),color:"danger"})}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:ua}),e.jsxs(ue,{visible:w,backdrop:"static",keyboard:!1,onClose:()=>{N(!1),k(null),t({rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})},className:"custom-modal",children:[e.jsx(me,{style:{backgroundColor:n==="in"?"var(--income-color)":"var(--outcome-color)",color:"white"},children:e.jsx(pe,{children:n==="in"?"Para Girişi Ekle":"Para Çıkışı Ekle"})}),e.jsx(he,{children:e.jsxs(Ie,{onSubmit:p,children:[e.jsx(Q,{htmlFor:"date",className:"block text-sm font-semibold mb-3",children:"İşlem Tarihi"}),e.jsx(Me,{dateAdapter:Re,children:e.jsx(Pe,{value:L,onChange:m=>{$(m),t(D=>({...D,date:m?m.format("DD.MM.YYYY"):""}))},format:"DD.MM.YYYY",slotProps:{textField:{fullWidth:!0,variant:"outlined",size:"small"}}})}),e.jsx(Q,{htmlFor:"amount",className:"mt-3",children:"Tutar"}),e.jsx(Z,{type:"text",id:"amount",name:"amount",value:s.formattedAmount,onChange:T,placeholder:"0,00"}),e.jsx(Q,{htmlFor:"description",className:"mt-3",children:"Açıklama"}),e.jsx(Z,{type:"text",name:"description",value:s.description,onChange:te}),e.jsxs(ge,{children:[e.jsx(Y,{color:"primary",type:"submit",disabled:d,children:d?"İşleniyor...":c?"Güncelle":"Ekle"}),e.jsx(Y,{color:"secondary",onClick:()=>{N(!1),k(null),t({rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})},children:"İptal"})]})]})})]})]})},se="https://speedsofttest.com/api",pa=[{categoryId:1,accountName:"Banka Hesapları",type:"bank"},{categoryId:2,accountName:"Kasa Tanımları",type:"cash"},{categoryId:3,accountName:"Kredi Kartları",type:"creditCard"},{categoryId:4,accountName:"Pos Hesapları",type:"pos"},{categoryId:5,accountName:"Şirket Ortakları Hesapları",type:"partner"},{categoryId:6,accountName:"Veresiye Hesapları",type:"debt"}],ha=()=>{const{visibleTransferModal:w,setVisibleTransferModal:N,transferDirection:n,transactionForm:s,setTransactionForm:t,setTransactions:L,value:$,setValue:j,isSubmitting:u,setIsSubmitting:l,selectedUser:c,setToast:k,editingTransaction:d,setEditingTransaction:b,rawTransactions:O,setRawTransactions:E,processedSubmissions:M,userId:g,setSelectedUser:ee}=oe(),{users:K,setUsers:te,fetchUsers:T}=Xe(),p=J.useRef(!1);J.useEffect(()=>{K.length||(console.log("Fetching users..."),T().catch(H=>{console.error("Fetch users error:",H),k({message:"Hesaplar yüklenirken hata oluştu.",color:"danger"})}))},[K,T]);const m=H=>{const{name:F,value:a}=H.target;t(r=>({...r,[F]:a}))},D=H=>{const a=H.target.value.replace(/[^\d]/g,"");if(!a){t(B=>({...B,rawAmount:"",formattedAmount:""}));return}let r=a.slice(0,-2)||"0",i=a.slice(-2).padStart(2,"0");const h=parseFloat(`${r}.${i}`);if(isNaN(h)||h<=0){k({message:"Geçerli bir tutar girin.",color:"danger"});return}const f=`${parseInt(r,10).toLocaleString("tr-TR")},${i}`;t(B=>({...B,rawAmount:h.toString(),formattedAmount:f}))},I=async(H,F,a,r,i,h,f)=>{var B,G;try{return(await A.get(`${se}/hesapHareket/hesapHareket-get-by-Id/${h}/${F}/${f}`)).data.find(o=>o.hesapId===F&&o.etkilenenHesapId===H&&parseFloat(o.tutar)===parseFloat(a)&&S(o.islemTarihi).isSame(S(r),"second")&&o.islemTuruId===(i?4:3))||null}catch(R){return console.error("Related transaction fetch error:",{error:R.message,response:(B=R.response)==null?void 0:B.data,status:(G=R.response)==null?void 0:G.status}),null}},x=async H=>{var B,G,R,re,o,P,q,U,_;if(H.preventDefault(),u||p.current)return;if(p.current=!0,l(!0),!c){k({message:"Lütfen önce bir kullanıcı seçin.",color:"danger"}),l(!1),p.current=!1;return}const F=Date.now();if(M.current.has(F)){l(!1),p.current=!1;return}t(v=>({...v,submissionTimestamp:F}));const a=parseFloat(s.rawAmount);if(isNaN(a)||a<=0){k({message:"Lütfen geçerli bir tutar girin.",color:"danger"}),l(!1),p.current=!1;return}let r,i;if(n==="outgoing"?(r=c,i=K.find(v=>v.accountNumber===s.recipientAccount)):(r=K.find(v=>v.accountNumber===s.recipientAccount),i=c),console.log("Sender:",r),console.log("Recipient:",i),console.log("Amount:",a),!r||!i){k({message:"Gönderen veya alıcı hesap bulunamadı.",color:"danger"}),l(!1),p.current=!1;return}if(r.accountNumber===i.accountNumber){k({message:"Aynı hesaba transfer yapılamaz.",color:"danger"}),l(!1),p.current=!1;return}if(console.log("Sender Currency:",r.currency),console.log("Recipient Currency:",i.currency),r.currency!==i.currency){k({message:"Hesaplar farklı para birimlerinde, transfer yapılamaz.",color:"danger"}),l(!1),p.current=!1;return}let h=null,f=null;try{const[v,fe]=await Promise.all([A.get(`${se}/Hesap/Hesap-get-by-Id/${r.id}`),A.get(`${se}/Hesap/Hesap-get-by-Id/${i.id}`)]);console.log("Sender API Response:",v.data),console.log("Recipient API Response:",fe.data);let y=parseFloat((B=v.data[0])==null?void 0:B.guncelBakiye)||r.balance||0,C=parseFloat((G=fe.data[0])==null?void 0:G.guncelBakiye)||i.balance||0;console.log("Initial Sender Balance:",y),console.log("Initial Recipient Balance:",C);let z=0,W=null,X=null;if(d){if(!d.id){k({message:"Geçersiz işlem ID'si.",color:"danger"}),l(!1),p.current=!1;return}try{if(W=(await A.get(`${se}/hesapHareket/hesapHareket-get-by-Id/${g}/${r.id}/${r.hesapKategoriId}`)).data.find(Ne=>Ne.id===d.id),!W){k({message:"Düzenlenecek gönderici işlemi bulunamadı.",color:"danger"}),l(!1),p.current=!1;return}z=parseFloat(W.tutar)||0;const ae=W.islemTuruId===3;if(ae?(y+=z,C-=z):(y-=z,C+=z),console.log("Old Amount:",z),console.log("Adjusted Sender Balance:",y),console.log("Adjusted Recipient Balance:",C),X=await I(r.id,i.id,z,W.islemTarihi,ae,g,i.hesapKategoriId),!X){k({message:"İlgili alıcı işlemi bulunamadı.",color:"danger"}),l(!1),p.current=!1;return}try{await Promise.all([A.delete(`${se}/hesapHareket/${W.id}`),A.delete(`${se}/hesapHareket/hesapHareket-deletee/${X.id}`)]),console.log("Old transactions deleted successfully")}catch(Ne){console.error("Delete Transaction Error:",Ne),k({message:"Eski işlemler silinirken hata oluştu.",color:"danger"}),l(!1),p.current=!1;return}}catch(V){console.error("Eski işlem silme hatası:",{error:V.message,response:(R=V.response)==null?void 0:R.data,status:(re=V.response)==null?void 0:re.status}),k({message:"Eski işlemler silinirken hata oluştu.",color:"danger"}),l(!1),p.current=!1;return}}if(console.log("Final Sender Balance:",y),console.log("Final Recipient Balance:",C),a>y){k({message:"Yetersiz bakiye.",color:"danger"}),l(!1),p.current=!1;return}const we=y-a,Ce=C+a,xe=s.date?S(s.date,"DD.MM.YYYY").isValid()?S(s.date,"DD.MM.YYYY").toISOString():new Date().toISOString():new Date().toISOString();h={id:d?d.id:0,kullanicilarId:g,hesapId:r.id,etkilenenHesapId:i.id,hesapKategoriId:r.hesapKategoriId,islemTarihi:xe,islemTuruId:3,bilgi:s.description||`Transfer - ${i.userName} (${i.accountNumber})`,aciklama:`${i.userName} hesabına transfer`,tutar:a,borc:a,alacak:0,bakiye:we,eklenmeTarihi:d?(W==null?void 0:W.eklenmeTarihi)||new Date().toISOString():new Date().toISOString(),guncellenmeTarihi:new Date().toISOString(),durumu:1},f={id:d&&X?X.id:0,kullanicilarId:g,hesapId:i.id,etkilenenHesapId:r.id,hesapKategoriId:i.hesapKategoriId,islemTarihi:xe,islemTuruId:4,bilgi:s.description||`Transfer - ${r.userName} (${r.accountNumber})`,aciklama:`${r.userName} hesabından transfer`,tutar:a,borc:0,alacak:a,bakiye:Ce,eklenmeTarihi:d?(X==null?void 0:X.eklenmeTarihi)||new Date().toISOString():new Date().toISOString(),guncellenmeTarihi:new Date().toISOString(),durumu:1};const[ze,Le]=await Promise.all([d?A.put(`${se}/hesapHareket/hesapHareket-updatee`,h):A.post(`${se}/hesapHareket/hesapHareket-create`,h),d?A.put(`${se}/hesapHareket/hesapHareket-updatee`,f):A.post(`${se}/hesapHareket/hesapHareket-create`,f)]),Oe={id:ze.data.id||Date.now(),date:s.date||S().format("DD.MM.YYYY"),type:"Transfer Çıkış",userName:r.userName,accountNumber:i.accountNumber,description:`${i.userName} hesabına transfer`,debit:`${a.toLocaleString("tr-TR",{minimumFractionDigits:2})}`,credit:"-",islemTarihi:xe,islemTuruId:3,tutar:a,etkilenenHesapId:i.id,hesapId:r.id},Ke={id:Le.data.id||Date.now()+1,date:s.date||S().format("DD.MM.YYYY"),type:"Transfer Giriş",userName:i.userName,accountNumber:r.accountNumber,description:`${r.userName} hesabından transfer`,debit:"-",credit:`${a.toLocaleString("tr-TR",{minimumFractionDigits:2})}`,islemTarihi:xe,islemTuruId:4,tutar:a,etkilenenHesapId:r.id,hesapId:i.id};let ye=O.filter(V=>V.id!==(W==null?void 0:W.id)&&V.id!==(X==null?void 0:X.id));ye.push(Oe,Ke),ye.sort((V,ae)=>S(ae.islemTarihi).isAfter(S(V.islemTarihi))?1:-1),E(ye),L(ye.filter(V=>V.hesapId===(c==null?void 0:c.id))),te(V=>V.map(ae=>ae.id===r.id?{...ae,balance:we}:ae.id===i.id?{...ae,balance:Ce}:ae)),r.id===c.id?ee({...r,balance:we}):i.id===c.id&&ee({...i,balance:Ce}),M.current.add(F),k({message:d?"Transfer başarıyla güncellendi.":"Transfer başarıyla gerçekleştirildi.",color:"success"}),N(!1),b(null),t({rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})}catch(v){console.error("Transfer error:",{message:v.message,response:(o=v.response)==null?void 0:o.data,status:(P=v.response)==null?void 0:P.status,url:(q=v.config)==null?void 0:q.url,senderPayload:h||"Not defined",recipientPayload:f||"Not defined"}),k({message:`Transfer sırasında hata oluştu: ${((_=(U=v.response)==null?void 0:U.data)==null?void 0:_.message)||v.message}`,color:"danger"})}finally{l(!1),p.current=!1}};return e.jsxs(ue,{visible:w,backdrop:"static",keyboard:!1,onClose:()=>{N(!1),b(null),t({id:"",rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})},children:[e.jsx(me,{style:{backgroundColor:"var(--warning-color)",color:"var(--white-color)"},children:e.jsx(pe,{children:n==="outgoing"?"Bu hesaptan başka hesaba para aktar":"Başka hesaptan bu hesaba para aktar"})}),e.jsxs(he,{children:[K.length===0&&e.jsx("p",{children:"Hesaplar yükleniyor..."}),e.jsxs(Ie,{onSubmit:x,children:[e.jsx(Q,{htmlFor:"date",className:"block text-sm font-semibold mb-3",children:"İşlem Tarihi"}),e.jsx(Me,{dateAdapter:Re,children:e.jsx(Pe,{value:$,onChange:H=>{j(H),t(F=>({...F,date:H?H.format("DD.MM.YYYY"):""}))},format:"DD.MM.YYYY",slotProps:{textField:{fullWidth:!0,variant:"outlined",size:"small"}}})}),e.jsx(Q,{htmlFor:"amount",className:"mt-3",children:"Tutar"}),e.jsx(Z,{type:"text",id:"amount",name:"amount",value:s.formattedAmount,onChange:D,placeholder:"0,00"}),e.jsx(Q,{htmlFor:"description",className:"mt-3",children:"Açıklama"}),e.jsx(Z,{type:"text",name:"description",value:s.description,onChange:m}),e.jsx(Q,{htmlFor:"recipientAccount",className:"mt-3",children:n==="outgoing"?"Alıcı Hesap":"Gönderen Hesap"}),e.jsxs(Ze,{id:"recipientAccount",name:"recipientAccount",value:s.recipientAccount,onChange:m,children:[e.jsx("option",{value:"",children:"Hesap Seç"}),pa.map(H=>{const F=K.filter(a=>a.hesapKategoriId===H.categoryId&&a.id!==(c==null?void 0:c.id));return F.length>0?e.jsx("optgroup",{label:H.accountName,children:F.map(a=>e.jsxs("option",{value:a.accountNumber,children:[a.userName||"İsim Yok"," -"," ",a.accountNumber||"-"," (",a.currency,")"]},a.id))},H.categoryId):null})]}),e.jsxs(ge,{children:[e.jsx(Y,{color:"primary",type:"submit",disabled:u||K.length===0||p.current,children:u?"İşleniyor...":d?"Güncelle":"Transferi Gerçekleştir"}),e.jsx(Y,{color:"secondary",onClick:()=>{N(!1),b(null),t({id:"",rawAmount:"",formattedAmount:"",description:"",date:S().format("DD.MM.YYYY"),recipientAccount:"",submissionTimestamp:null})},children:"İptal"})]})]})]})]})},ga=()=>{const{toast:w,setToast:N,toaster:n}=oe(),[s,t]=J.useState([]);return J.useEffect(()=>{if(w){t($=>[...$,w]);const L=setTimeout(()=>{t($=>$.slice(1)),N(null)},5e3);return()=>clearTimeout(L)}},[w,N]),e.jsx(Je,{ref:n,placement:"top-end",className:"p-3",children:s.map((L,$)=>e.jsxs(ea,{autohide:5e3,visible:!0,color:L.color,className:"text-white shadow-lg",onClose:()=>{t(j=>j.filter((u,l)=>l!==$)),$===0&&N(null)},children:[e.jsx(aa,{closeButton:{label:"Kapat"},style:{color:"var(--jetBlack-color)"},children:e.jsx("strong",{className:"me-auto",children:"Bildirim"})}),e.jsx(sa,{children:L.message})]},$))})},fa=()=>{const{loading:w,error:N,selectedUser:n}=oe(),s=Be();return w?e.jsx(ke,{children:e.jsx(be,{children:"Yükleniyor..."})}):N?e.jsxs(ke,{className:"mt-4",children:[e.jsx(Te,{children:"Hesap Bilgisi"}),e.jsxs(be,{children:[e.jsx(Ye,{children:N}),e.jsx(Y,{color:"primary",onClick:()=>s("/app/dashboard"),children:"Geri Dön"})]})]}):n?e.jsxs(e.Fragment,{children:[e.jsx(ga,{}),e.jsx(la,{}),e.jsx(oa,{}),e.jsx($e,{children:e.jsx(ve,{xs:12,children:e.jsx(ca,{})})}),e.jsx(da,{}),e.jsx(ma,{}),e.jsx(ha,{})]}):e.jsxs(ke,{className:"mt-4",children:[e.jsx(Te,{children:"Hesap Bilgisi"}),e.jsxs(be,{children:[e.jsx(Ye,{children:"Lütfen bir kullanıcı seçin."}),e.jsx(Y,{color:"primary",onClick:()=>s("/app/dashboard"),children:"Geri Dön"})]})]})},Ta=()=>e.jsx(ra,{children:e.jsx(fa,{})});export{Ta as default};
