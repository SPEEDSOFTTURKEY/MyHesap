import{j as e,ap as z,$ as ve,a0 as Be,a1 as X,a2 as f,a3 as De,a4 as g,q as m,m as j,X as Ne,a6 as Ie,r as l,u as Ee,t as b,an as Fe,C as Ae,e as Re,f as Le,M as Me,g as Ue,s as $e,ao as Z,V as ee,o as ae,h as ze,N as se,Q as le,S as te,T as ne,W as re,a as He,b as Pe,c as Oe}from"./index-DtN76qeb.js";import{S as Ye}from"./SupplierModal-Df4Vr4WA.js";import{c as $}from"./cil-cloud-upload-Ca9_6_ej.js";const qe=({suppliers:y,onSupplierClick:D,onUpdate:N,onDelete:I,loading:w})=>{const E=(n,u)=>{n.stopPropagation(),I(u)},p=(n,u)=>{n.stopPropagation(),N(u)};return w?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(z,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Yükleniyor..."})]}):!y||y.length===0?e.jsx("div",{className:"text-center p-5",children:e.jsx("p",{className:"text-muted",children:"Tedarikçi bulunamadı."})}):e.jsxs(ve,{hover:!0,responsive:!0,children:[e.jsx(Be,{children:e.jsxs(X,{children:[e.jsx(f,{children:"Tedarikçi Adı/Unvanı"}),e.jsx(f,{children:"Telefon"}),e.jsx(f,{children:"Sınıflandırma"}),e.jsx(f,{children:"Açık Bakiye"}),e.jsx(f,{children:"Çek/Senet Bakiyesi"}),e.jsx(f,{width:"120",className:"text-center",children:"İşlemler"})]})}),e.jsx(De,{children:y.map(n=>e.jsxs(X,{onClick:()=>D(n),style:{cursor:"pointer"},children:[e.jsxs(g,{children:[e.jsx("strong",{children:n.name}),n.email&&e.jsx("div",{className:"small text-muted",children:n.email})]}),e.jsx(g,{children:n.phone||"-"}),e.jsx(g,{children:e.jsx("span",{className:"badge bg-info text-white",children:n.classification||"Sınıflandırılmamış"})}),e.jsx(g,{children:e.jsxs("span",{className:n.openBalance>0?"text-danger fw-bold":"",children:[n.openBalance.toLocaleString("tr-TR")," TRY"]})}),e.jsx(g,{children:e.jsxs("span",{className:n.chequeBondBalance>0?"text-warning fw-bold":"",children:[n.chequeBondBalance.toLocaleString("tr-TR")," TRY"]})}),e.jsxs(g,{className:"text-center",children:[e.jsx(m,{size:"sm",className:"me-1",style:{backgroundColor:"#FFC107",border:"none",color:"white",padding:"4px 8px"},title:"Düzenle",onClick:u=>p(u,n),children:e.jsx(j,{icon:Ne,size:"sm"})}),e.jsx(m,{size:"sm",style:{backgroundColor:"#DC3545",border:"none",color:"white",padding:"4px 8px"},title:"Sil",onClick:u=>E(u,n.id),children:e.jsx(j,{icon:Ie,size:"sm"})})]})]},n.id))})]})},k="https://speedsofttest.com/api",_e=()=>{const[y,D]=l.useState([]),[N,I]=l.useState([]),[w,E]=l.useState([]),[p,n]=l.useState(!1),[u,H]=l.useState(null),[S,P]=l.useState(!0),[F,oe]=l.useState(""),[O,ie]=l.useState("all"),[Y,ce]=l.useState(""),[de,T]=l.useState(!1),[q,G]=l.useState(null),[A,W]=l.useState(!1),[ue,R]=l.useState(!1),[J,L]=l.useState(null),[me,v]=l.useState(!1),[M,B]=l.useState(null),[U,_]=l.useState(!1),he=l.useRef(),K=Ee(),d=l.useCallback((a,o="success")=>{const t=e.jsxs(He,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Pe,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:o==="error"?"Hata":"Başarılı"})}),e.jsx(Oe,{children:a})]},Date.now());D(r=>[...r,t])},[]),V=l.useCallback(async(a,o)=>{var t,r,s,i;try{const{data:c}=await b.get(a);console.log(`API Response for ${a}:`,c);const x=(Array.isArray(c)?c:[c]).filter(Te=>Te.durumu===1);return o(x),console.log(`fetchData (${a}) filtered result:`,x),x}catch(c){return console.error(`fetchData Hatası (${a}):`,{message:c.message,status:(t=c.response)==null?void 0:t.status,data:(r=c.response)==null?void 0:r.data}),d(((i=(s=c.response)==null?void 0:s.data)==null?void 0:i.message)||"Veriler yüklenemedi.","error"),[]}},[d]),xe=(a,o)=>{console.log("Mapping supplier data:",a);const t=a.tedarikciSiniflandirmaId?o.find(i=>i.id===a.tedarikciSiniflandirmaId):null,r=(t==null?void 0:t.adi)||"Bilinmiyor";a.tedarikciSiniflandirmaId&&!t&&console.warn(`Sınıflandırma bulunamadı (Tedarikçi ID: ${a.id}, Sınıflandırma ID: ${a.tedarikciSiniflandirmaId})`);const s={id:a.id,name:a.unvan||"Bilinmiyor",openBalance:a.acilisBakiyesi||0,chequeBondBalance:0,phone:a.telefon||"",classification:r,email:a.email||"",address:a.adres||"",taxOffice:a.vergiDairesi||"",taxOrIdNumber:a.vergiNo||"",accountingCode:a.kodu||"",note:a.aciklama||"",currency:a.paraBirimi||"TRY",dueDate:a.vadeGun||"",isTaxExempt:a.vergiMuaf||!1,bankInfo:a.bankaBilgileri||"",contactPerson:a.yetkiliKisi||"",otherContact:a.diger||"",tedarikciSiniflandirmaId:a.tedarikciSiniflandirmaId};return console.log("Mapped supplier:",s),s},C=l.useCallback(async()=>{var a,o,t,r;n(!0);try{const s=await V(`${k}/tedarikciSiniflandirma/get-all`,E);s.length||console.warn("Sınıflandırmalar boş, veri tutarsızlığı olabilir.");const i=S?`${k}/tedarikci/tedarikci-get-all`:`${k}/tedarikci/tedarikci-get-allaktif`,{data:c}=await b.get(i);console.log("Suppliers API response:",c);const h=c.filter(x=>x.durumu===1).map(x=>xe(x,s));I(h),H(null),d("Tedarikçiler başarıyla yüklendi.","success")}catch(s){console.error("Tedarikçi Yükleme Hatası:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(o=s.response)==null?void 0:o.data}),H(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Tedarikçiler yüklenemedi."),d("Tedarikçiler yüklenemedi.","error")}finally{n(!1)}},[S,V,d]),pe=a=>{L(a),R(!0)},fe=a=>{B(a),v(!0)},ge=async()=>{var a,o,t,r;if(M){_(!0);try{const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){d("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}console.log("Silme isteği gönderiliyor: ID =",M,"Kullanıcı ID =",s.id);const i=await b.delete(`${k}/tedarikci/tedarikci-delete/${M}?kullaniciId=${s.id}`,{headers:{accept:"*/*"}});if(console.log("Delete API response (tedarikci/tedarikci-delete):",i.data),i.status===200||i.status===204)d("Tedarikçi başarıyla silindi.","success"),await C();else throw new Error("Silme işlemi başarısız")}catch(s){console.error("Silme Hatası:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(o=s.response)==null?void 0:o.data}),d(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Tedarikçi silinemedi. Lütfen tekrar deneyin.","error")}finally{_(!1),v(!1),B(null)}}},ke=a=>{J&&(R(!1),L(null),C())},je=a=>{K(`/app/supplier-detail/${a.id}`,{state:{supplier:a}})},ye=()=>{K("/app/supplier-new")},Ce=()=>{T(!0)},be=async()=>{var a,o,t,r;try{const s=JSON.parse(localStorage.getItem("user"))||{id:0};console.log("Download template request with user ID:",s.id);const i=await b.get(`${k}/tedarikci/download-template?kullaniciId=${s.id}`,{responseType:"blob"});console.log("Download template API response status:",i.status);const c=window.URL.createObjectURL(new Blob([i.data])),h=document.createElement("a");h.href=c,h.setAttribute("download","tedarikci_sablonu.xlsx"),document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(c),d("Excel şablonu başarıyla indirildi.","success")}catch(s){console.error("Download template error:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(o=s.response)==null?void 0:o.data}),d(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Excel şablonu indirilemedi.","error")}},we=a=>{G(a.target.files[0])},Se=async()=>{var a,o,t,r;if(!q){d("Lütfen bir Excel dosyası seçin.","error");return}W(!0);try{const s=JSON.parse(localStorage.getItem("user"))||{id:0};if(!s.id){d("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}const i=new FormData;i.append("file",q),i.append("kullaniciId",s.id),console.log("Excel upload payload with user ID:",s.id);const c=await b.post(`${k}/tedarikci/upload-excel`,i,{headers:{"Content-Type":"multipart/form-data",accept:"*/*"}});console.log("Excel upload API response:",c.data),await C(),d("Excel dosyası başarıyla yüklendi.","success"),T(!1),G(null)}catch(s){console.error("Excel upload error:",{message:s.message,status:(a=s.response)==null?void 0:a.status,data:(o=s.response)==null?void 0:o.data}),d(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Excel dosyası yüklenemedi.","error")}finally{W(!1)}};l.useEffect(()=>{C()},[C]);const Q=N.filter(a=>a.name.toLowerCase().includes(Y.toLowerCase())).filter(a=>F?a.classification===F:!0).filter(a=>O==="balance"?a.openBalance>0||a.chequeBondBalance>0:!0);return e.jsxs(Fe,{children:[e.jsx(Ae,{ref:he,placement:"top-end",className:"p-3",children:y}),e.jsxs(Re,{className:"mb-3",children:[e.jsxs(Le,{children:[e.jsxs(m,{color:"success",style:{color:"white",marginRight:"10px",marginBottom:"15px"},onClick:ye,children:[e.jsx(j,{icon:Me})," Yeni Tedarikçi Ekle"]}),e.jsxs(m,{color:"primary",style:{color:"white",marginRight:"10px",marginBottom:"15px"},onClick:Ce,children:[e.jsx(j,{icon:$})," Excel'den Tedarikçi Yükle"]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",color:"#2965A8",padding:"5px 10px",borderRadius:"4px",fontWeight:"bold",fontSize:"14px",maxHeight:"35px",maxWidth:"200px",textAlign:"center",margin:"10px 15px 0 0"},children:["Toplam Tedarikçi: ",Q.length]})]}),e.jsxs(Ue,{className:"my-3",children:[e.jsx($e,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex flex-row justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(Z,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterAll",autoComplete:"off",label:"Tüm Tedarikçiler",checked:S,onChange:()=>P(!0)}),e.jsx(Z,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterActive",autoComplete:"off",label:"Aktif Tedarikçiler",checked:!S,onChange:()=>P(!1)})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(ee,{value:F,onChange:a=>oe(a.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"",children:"Tüm Sınıflandırmalar"}),w.map(a=>e.jsx("option",{value:a.adi,children:a.adi},a.id))]}),e.jsxs(ee,{value:O,onChange:a=>ie(a.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"all",children:"Hepsini Göster"}),e.jsx("option",{value:"balance",children:"Bakiyesi Olanları Göster"})]})]}),e.jsx(ae,{type:"text",placeholder:"Tedarikçi ara...",value:Y,onChange:a=>ce(a.target.value),style:{width:"200px"},className:"ms-2"})]})}),e.jsxs(ze,{children:[u&&e.jsx("p",{className:"text-danger",children:u}),e.jsx(qe,{suppliers:Q,onSupplierClick:je,onUpdate:pe,onDelete:fe,loading:p})]})]}),e.jsxs(se,{size:"lg",visible:de,backdrop:"static",keyboard:!1,onClose:()=>T(!1),children:[e.jsx(le,{children:e.jsx(te,{children:"Excel ile Tedarikçi Yükleme"})}),e.jsxs(ne,{children:[e.jsxs(m,{color:"primary",style:{color:"white"},onClick:be,disabled:p,children:[e.jsx(j,{icon:$})," Excel Şablonu İndir"]}),e.jsx("p",{className:"mt-3",children:"Tedarikçilerinizi tek tek tanımlamak yerine, Excel şablonunu indirin ve doldurun."}),e.jsx(ae,{type:"file",accept:".xlsx,.xls",onChange:we,className:"mb-3"}),e.jsx(m,{color:"success",style:{color:"white"},onClick:Se,disabled:A||p,children:A?e.jsx(z,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:$})," Excel Şablonu Yükle"]})})]}),e.jsx(re,{children:e.jsx(m,{color:"secondary",onClick:()=>T(!1),disabled:A||p,children:"İptal"})})]}),e.jsx(Ye,{visible:ue,onClose:()=>{R(!1),L(null)},onSubmit:ke,supplier:J,addToast:d,classifications:w}),e.jsxs(se,{visible:me,onClose:()=>{v(!1),B(null)},backdrop:"static",children:[e.jsx(le,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},children:e.jsx(te,{children:"Silme Onayı"})}),e.jsx(ne,{children:e.jsx("p",{children:"Bu tedarikçiyi silmek istediğinizden emin misiniz?"})}),e.jsxs(re,{children:[e.jsx(m,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},onClick:ge,disabled:U,children:U?e.jsx(z,{size:"sm"}):"Tamam"}),e.jsx(m,{style:{backgroundColor:"var(--secondary-color)",color:"var(--white-color)"},onClick:()=>{v(!1),B(null)},disabled:U,children:"İptal"})]})]})]})};export{_e as default};
