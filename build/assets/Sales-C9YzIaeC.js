import{r as l,j as e,t as D,am as ze,C as Ke,e as y,f as j,q as p,m as je,M as pe,g as Ye,s as qe,B as ge,D as Ce,E as ye,F as S,aj as Ue,h as Ve,$ as J,a0 as O,a1 as M,a2 as u,a3 as X,a4 as h,N as Se,Q as ke,S as fe,T as ve,i as be,U as C,o as k,V as E,W as De,a as _e,b as Qe,c as We}from"./index-DvA_wB1j.js";import{C as Je}from"./CDropdownDivider-Cs8l3po-.js";const f="https://speedsofttest.com/api",sr=()=>{var xe;const[we,Fe]=l.useState([]),[Te,Ie]=l.useState([]),[Z,ee]=l.useState(!1),[q,re]=l.useState(null),[U,Me]=l.useState(!1),[se,Oe]=l.useState(""),[G,Xe]=l.useState("Tümünü seç"),[w,F]=l.useState("Tamamını Göster"),[L,Ze]=l.useState("Müşteri İsmi / Belge No"),[Be,H]=l.useState(!1),[Ne,R]=l.useState(!1),[V,Ae]=l.useState([]),[B,Ee]=l.useState([]),[$,ae]=l.useState(""),[N,ie]=l.useState(""),[m,te]=l.useState({unvani:"",email:"",telefon:"",vergiDairesi:"",vergiNumarasi:"",adres:""}),[x,T]=l.useState([]),[P,_]=l.useState(""),[ne,le]=l.useState({}),[v]=l.useState({id:1002,aktiflikDurumu:1,durumu:1,yetkiId:1,kullaniciAdi:"gizem"}),Ge=l.useRef(),d=l.useCallback((r,s="success")=>{const i=e.jsxs(_e,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Qe,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:s==="error"?"Hata":"Başarılı"})}),e.jsx(We,{children:r})]},Date.now());Fe(n=>[...n,i])},[]),z=l.useCallback(async()=>{var r,s;ee(!0);try{let i=`${f}/musteriSatis/musteriSatis-get-all`;N&&(i=`${f}/musteriSatis/musteriSatis-get-by-musteri/${N}`);const{data:n}=await D.get(i);Ie(n),re(null)}catch(i){console.error("Satışları Getirme Hatası:",i),re(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"Satışlar yüklenemedi."),d("Satışlar yüklenemedi.","error")}finally{ee(!1)}},[d,N]),Q=l.useCallback(async()=>{try{const{data:r}=await D.get(`${f}/musteri/musteri-get-allaktif`);Ae(r)}catch(r){console.error("Müşterileri Getirme Hatası:",r),d("Müşteriler yüklenemedi.","error")}},[d]),oe=l.useCallback(async()=>{try{const{data:r}=await D.get(`${f}/urun/urun-get-all`);Ee(r)}catch(r){console.error("Ürünleri Getirme Hatası:",r),d("Ürünler yüklenemedi.","error")}},[d]),Le=l.useCallback(async r=>{try{const{data:s}=await D.get(`${f}/urun/urun-depolardaki-stoklar/${r}`);if(Array.isArray(s)){const i=s.filter(n=>n.durumu===1);le(n=>({...n,[r]:i}))}else throw new Error("Depo verisi dizi formatında değil.")}catch(s){console.error("Depoları Getirme Hatası:",s),d(`Ürün ID ${r} için depolar yüklenemedi.`,"error"),le(i=>({...i,[r]:[]}))}},[d]);l.useEffect(()=>{console.log("Giriş yapan kullanıcı bilgileri:",v),z(),Q()},[z,Q,v]);const He=()=>{H(!0),te({unvani:"",email:"",telefon:"",vergiDairesi:"",vergiNumarasi:"",adres:""}),T([]),oe()},Re=()=>{R(!0),ae(""),T([]),Q(),oe()},I=r=>{const{name:s,value:i}=r.target;te(n=>({...n,[s]:i}))},de=()=>{if(!P){d("Lütfen bir ürün seçin.","error");return}const r=B.find(s=>s.id===parseInt(P));if(!r){d("Ürün bulunamadı.","error");return}if(x.some(s=>s.barkod===r.barkod)){d("Bu ürün zaten eklenmiş.","error");return}Le(r.id),T(s=>[...s,{barkod:r.barkod,urunAdi:r.adi,fiyat:r.satisFiyat,birim:r.birimAdi,miktar:1,toplamFiyat:r.satisFiyat,depoId:""}]),_("")},ce=(r,s)=>{const i=parseInt(s)||1;T(n=>n.map((a,o)=>o===r?{...a,miktar:i,toplamFiyat:i*a.fiyat}:a))},ue=(r,s)=>{T(i=>i.map((n,a)=>a===r?{...n,depoId:s}:n))},he=r=>{T(s=>s.filter((i,n)=>n!==r))},$e=async()=>{var r,s,i,n,a,o,t,b;try{if(!((r=m.unvani)!=null&&r.trim())){d("Unvan zorunlu.","error");return}if(!((s=m.email)!=null&&s.trim())){d("E-posta zorunlu.","error");return}if(x.length===0){d("En az bir ürün eklenmeli.","error");return}if(x.some(g=>!g.depoId)){d("Tüm ürünler için bir depo seçilmelidir.","error");return}if(!v.id){d("Kullanıcı ID'si eksik.","error");return}const c={unvani:m.unvani.trim(),email:m.email.trim(),telefon:m.telefon||"",vergiDairesi:m.vergiDairesi||"",vergiNumarasi:m.vergiNumarasi||"",adres:m.adres||"",durumu:1,aktif:1,kullaniciId:v.id},K=(await D.post(`${f}/musteri/musteri-create`,c)).data.Data.id,A=x.map(g=>({musteriId:K,barkod:g.barkod,urunAdi:g.urunAdi,fiyat:g.fiyat,birim:g.birim,miktar:g.miktar,toplamFiyat:g.toplamFiyat,kullaniciId:v.id,depoId:parseInt(g.depoId)}));console.log("Gönderilen satış verisi:",A);const Y=await D.post(`${f}/musteriSatis/musteriSatis-create`,A);d(Y.data.Message||"Satış başarıyla kaydedildi."),H(!1),z()}catch(c){console.error("Yeni Müşteri Satış Hatası:",{message:((n=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:n.message)||c.message,status:(a=c==null?void 0:c.response)==null?void 0:a.status,data:(o=c==null?void 0:c.response)==null?void 0:o.data}),d(((b=(t=c.response)==null?void 0:t.data)==null?void 0:b.Message)||"Satış kaydedilemedi.","error")}},Pe=async()=>{var r,s,i,n,a,o;if(!$){d("Lütfen bir müşteri seçin.","error");return}if(x.length===0){d("En az bir ürün eklenmeli.","error");return}if(x.some(t=>!t.depoId)){d("Tüm ürünler için bir depo seçilmelidir.","error");return}if(!v.id){d("Kullanıcı ID'si eksik.","error");return}try{const t=x.map(c=>({musteriId:parseInt($),barkod:c.barkod,urunAdi:c.urunAdi,fiyat:c.fiyat,birim:c.birim,miktar:c.miktar,toplamFiyat:c.toplamFiyat,kullaniciId:v.id,depoId:parseInt(c.depoId)}));console.log("Gönderilen satış verisi:",t);const b=await D.post(`${f}/musteriSatis/musteriSatis-create`,t);d(b.data.Message||"Satış başarıyla kaydedildi."),R(!1),z()}catch(t){console.error("Kayıtlı Müşteri Satış Hatası:",{message:((s=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:s.message)||t.message,status:(i=t==null?void 0:t.response)==null?void 0:i.status,data:(n=t==null?void 0:t.response)==null?void 0:n.data}),d(((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.Message)||"Satış kaydedilemedi.","error")}},me=Te.filter(r=>{const s=G==="Tümünü seç"||r.docType===G||G==="E-Faturalaşmış"&&r.durumu===1||G==="E-Faturalaşmamış"&&r.durumu===0,i=()=>{const o=new Date(r.eklenmeTarihi),t=new Date;return w==="Bu yılın Satışlarını Göster"?o.getFullYear()===t.getFullYear():w==="Son 1 Ay"?o>=new Date(t.setMonth(t.getMonth()-1)):w==="Son 3 Ay"?o>=new Date(t.setMonth(t.getMonth()-3)):w==="Bugün"?o.toDateString()===new Date().toDateString():w==="İleri Tarihli Planlı Satışlar"?o>t:!0},n=()=>{var t,b,c,W,K,A,Y;if(se.length<3)return!0;const o=se.toLowerCase();return L==="Müşteri İsmi / Belge No"?((b=(t=r.musteri)==null?void 0:t.unvani)==null?void 0:b.toLowerCase().includes(o))||((c=r.satisId)==null?void 0:c.toLowerCase().includes(o)):L==="Ürün Adı / Kodu / Barkodu"?((W=r.urunAdi)==null?void 0:W.toLowerCase().includes(o))||((K=r.barkod)==null?void 0:K.toLowerCase().includes(o)):L==="Belge Açıklaması"?(A=r.aciklama)==null?void 0:A.toLowerCase().includes(o):L==="Satır Açıklaması"?(Y=r.aciklama)==null?void 0:Y.toLowerCase().includes(o):!0},a=U?!0:r.durumu!==0;return s&&i()&&n()&&a});return e.jsxs(ze,{children:[e.jsx(Ke,{ref:Ge,placement:"top-end",className:"p-3",children:we}),e.jsx(y,{className:"mb-3",children:e.jsxs(j,{children:[e.jsxs(p,{color:"primary",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:He,children:[e.jsx(je,{icon:pe})," Yeni Müşteriye Satış Gir"]}),e.jsxs(p,{color:"info",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:Re,children:[e.jsx(je,{icon:pe})," Kayıtlı Müşteriye Satış Gir"]})]})}),e.jsxs(Ye,{className:"mb-3",children:[e.jsx(qe,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsx(y,{className:"d-flex justify-content-between align-items-center",children:e.jsxs(j,{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(ge,{children:[e.jsx(Ce,{color:"light",children:w}),e.jsxs(ye,{children:[e.jsx(S,{onClick:()=>F("Bu yılın Satışlarını Göster"),children:"Bu yılın Satışlarını Göster"}),e.jsx(S,{onClick:()=>F("Son 1 Ay"),children:"Son 1 Ay"}),e.jsx(S,{onClick:()=>F("Son 3 Ay"),children:"Son 3 Ay"}),e.jsx(S,{onClick:()=>F("Bugün"),children:"Bugün"}),e.jsx(S,{onClick:()=>F("Tamamını Göster"),children:"Tamamını Göster"}),e.jsx(S,{onClick:()=>F("İleri Tarihli Planlı Satışlar"),children:"İleri Tarihli Planlı Satışlar"})]})]}),e.jsxs(ge,{children:[e.jsx(Ce,{color:"light",children:N&&((xe=V.find(r=>r.id===parseInt(N)))==null?void 0:xe.unvani)||"Müşteri Seç"}),e.jsxs(ye,{children:[e.jsx(S,{onClick:()=>ie(""),children:"Tüm Müşteriler"}),e.jsx(Je,{}),V.map(r=>e.jsx(S,{onClick:()=>ie(r.id.toString()),children:r.unvani},r.id))]})]})]}),e.jsx(Ue,{label:"İptalleri de göster",checked:U,onChange:()=>Me(!U)})]})})}),e.jsxs(Ve,{children:[Z&&e.jsx("p",{children:"Yükleniyor..."}),q&&e.jsx("p",{className:"text-danger",children:q}),!Z&&!q&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Satış Sayısı: ",me.length]}),e.jsxs(J,{hover:!0,responsive:!0,children:[e.jsx(O,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Tarih"}),e.jsx(u,{children:"Müşteri"}),e.jsx(u,{children:"Belge No"}),e.jsx(u,{children:"Ürün Adı"}),e.jsx(u,{children:"Adet"}),e.jsx(u,{children:"Tutar"}),e.jsx(u,{children:"Durumu"})]})}),e.jsx(X,{children:me.map(r=>{var s;return e.jsxs(M,{children:[e.jsx(h,{children:new Date(r.eklenmeTarihi).toLocaleDateString()}),e.jsx(h,{children:(s=r.musteris)==null?void 0:s.unvani}),e.jsx(h,{children:r.satisId}),e.jsx(h,{children:r.urunAdi}),e.jsx(h,{children:r.miktar}),e.jsx(h,{children:r.toplamFiyat}),e.jsx(h,{children:r.durumu===1?"Aktif":"İptal"})]},r.id)})})]})]})]})]}),e.jsxs(Se,{visible:Be,onClose:()=>H(!1),size:"lg",children:[e.jsx(ke,{children:e.jsx(fe,{children:"Yeni Müşteriye Satış"})}),e.jsx(ve,{children:e.jsxs(be,{children:[e.jsxs(y,{className:"mb-3",children:[e.jsxs(j,{md:6,children:[e.jsx(C,{children:"Unvan"}),e.jsx(k,{name:"unvani",value:m.unvani,onChange:I,required:!0})]}),e.jsxs(j,{md:6,children:[e.jsx(C,{children:"E-posta"}),e.jsx(k,{name:"email",type:"email",value:m.email,onChange:I,required:!0})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(j,{md:6,children:[e.jsx(C,{children:"Telefon"}),e.jsx(k,{name:"telefon",value:m.telefon,onChange:I})]}),e.jsxs(j,{md:6,children:[e.jsx(C,{children:"Adres"}),e.jsx(k,{name:"adres",value:m.adres,onChange:I})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(j,{md:6,children:[e.jsx(C,{children:"Vergi Dairesi"}),e.jsx(k,{name:"vergiDairesi",value:m.vergiDairesi,onChange:I})]}),e.jsxs(j,{md:6,children:[e.jsx(C,{children:"Vergi Numarası"}),e.jsx(k,{name:"vergiNumarasi",value:m.vergiNumarasi,onChange:I})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(j,{md:8,children:[e.jsx(C,{children:"Ürün Seç"}),e.jsxs(E,{value:P,onChange:r=>_(r.target.value),children:[e.jsx("option",{value:"",children:"Ürün Seçin"}),B.map(r=>e.jsxs("option",{value:r.id,children:[r.adi," (Barkod: ",r.barkod,", Fiyat: ",r.satisFiyat,")"]},r.id))]})]}),e.jsx(j,{md:4,className:"d-flex align-items-end",children:e.jsx(p,{color:"primary",onClick:de,children:"Ürün Ekle"})})]}),e.jsxs(J,{hover:!0,responsive:!0,children:[e.jsx(O,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Ürün Adı"}),e.jsx(u,{children:"Barkod"}),e.jsx(u,{children:"Fiyat"}),e.jsx(u,{children:"Birim"}),e.jsx(u,{children:"Depo"}),e.jsx(u,{children:"Miktar"}),e.jsx(u,{children:"Toplam Fiyat"}),e.jsx(u,{children:"İşlem"})]})}),e.jsx(X,{children:x.map((r,s)=>{const i=B.find(a=>a.barkod===r.barkod),n=i?ne[i.id]||[]:[];return e.jsxs(M,{children:[e.jsx(h,{children:r.urunAdi}),e.jsx(h,{children:r.barkod}),e.jsx(h,{children:r.fiyat}),e.jsx(h,{children:r.birim}),e.jsx(h,{children:e.jsxs(E,{value:r.depoId,onChange:a=>ue(s,a.target.value),children:[e.jsx("option",{value:"",children:"Depo Seçin"}),n.map(a=>{var o;return e.jsxs("option",{value:a.depoId,children:[((o=a.depo)==null?void 0:o.adi)||"Bilinmeyen Depo"," (Stok: ",a.miktar,")"]},a.depoId)})]})}),e.jsx(h,{children:e.jsx(k,{type:"number",min:"1",value:r.miktar,onChange:a=>ce(s,a.target.value),style:{width:"100px"}})}),e.jsx(h,{children:r.toplamFiyat}),e.jsx(h,{children:e.jsx(p,{color:"danger",onClick:()=>he(s),children:"Sil"})})]},s)})})]})]})}),e.jsxs(De,{children:[e.jsx(p,{color:"secondary",onClick:()=>H(!1),children:"İptal"}),e.jsx(p,{color:"primary",onClick:$e,disabled:x.length===0||!m.unvani||!m.email||x.some(r=>!r.depoId),children:"Satışı Kaydet"})]})]}),e.jsxs(Se,{visible:Ne,onClose:()=>R(!1),size:"lg",children:[e.jsx(ke,{children:e.jsx(fe,{children:"Kayıtlı Müşteriye Satış"})}),e.jsx(ve,{children:e.jsxs(be,{children:[e.jsx(y,{className:"mb-3",children:e.jsxs(j,{children:[e.jsx(C,{children:"Müşteri Seç"}),e.jsxs(E,{value:$,onChange:r=>ae(r.target.value),children:[e.jsx("option",{value:"",children:"Müşteri Seçin"}),V.map(r=>e.jsx("option",{value:r.id,children:r.unvani},r.id))]})]})}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(j,{md:8,children:[e.jsx(C,{children:"Ürün Seç"}),e.jsxs(E,{value:P,onChange:r=>_(r.target.value),children:[e.jsx("option",{value:"",children:"Ürün Seçin"}),B.map(r=>e.jsxs("option",{value:r.id,children:[r.adi," (Barkod: ",r.barkod,", Fiyat: ",r.satisFiyat,")"]},r.id))]})]}),e.jsx(j,{md:4,className:"d-flex align-items-end",children:e.jsx(p,{color:"primary",onClick:de,children:"Ürün Ekle"})})]}),e.jsxs(J,{hover:!0,responsive:!0,children:[e.jsx(O,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Ürün Adı"}),e.jsx(u,{children:"Barkod"}),e.jsx(u,{children:"Fiyat"}),e.jsx(u,{children:"Birim"}),e.jsx(u,{children:"Depo"}),e.jsx(u,{children:"Miktar"}),e.jsx(u,{children:"Toplam Fiyat"}),e.jsx(u,{children:"İşlem"})]})}),e.jsx(X,{children:x.map((r,s)=>{const i=B.find(a=>a.barkod===r.barkod),n=i?ne[i.id]||[]:[];return e.jsxs(M,{children:[e.jsx(h,{children:r.urunAdi}),e.jsx(h,{children:r.barkod}),e.jsx(h,{children:r.fiyat}),e.jsx(h,{children:r.birim}),e.jsx(h,{children:e.jsxs(E,{value:r.depoId,onChange:a=>ue(s,a.target.value),children:[e.jsx("option",{value:"",children:"Depo Seçin"}),n.map(a=>{var o;return e.jsxs("option",{value:a.depoId,children:[((o=a.depo)==null?void 0:o.adi)||"Bilinmeyen Depo"," (Stok: ",a.miktar,")"]},a.depoId)})]})}),e.jsx(h,{children:e.jsx(k,{type:"number",min:"1",value:r.miktar,onChange:a=>ce(s,a.target.value),style:{width:"100px"}})}),e.jsx(h,{children:r.toplamFiyat}),e.jsx(h,{children:e.jsx(p,{color:"danger",onClick:()=>he(s),children:"Sil"})})]},s)})})]})]})}),e.jsxs(De,{children:[e.jsx(p,{color:"secondary",onClick:()=>R(!1),children:"İptal"}),e.jsx(p,{color:"primary",onClick:Pe,disabled:x.length===0||!$||x.some(r=>!r.depoId),children:"Satışı Kaydet"})]})]})]})};export{sr as default};
