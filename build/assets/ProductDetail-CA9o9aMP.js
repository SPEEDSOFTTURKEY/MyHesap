import{r as c,j as e,U as X,o as ye,q as f,N as ce,Q as de,S as ue,T as he,i as Ie,aq as De,W as je,aE as Te,aF as Fe,aG as Me,t as Y,Z as fe,g as N,h as E,m as re,a9 as Re,aa as Ae,ab as $e,V as pe,a8 as Ve,am as ze,ai as Be,J as Ke,u as Ne,s as L,C as Ee,e as oe,f as S,X as Ye,B as be,D as Se,E as Ce,F as J,$ as me,a0 as ge,a1 as ae,a2 as v,a3 as xe,a4 as D,a as Ge,b as Ue,c as Le}from"./index-DAwD_DDx.js";import{c as He}from"./cil-warning-C7g3f07Q.js";import{c as ke}from"./cil-list-CLA-Txc1.js";const qe=({formData:g,handleImageUpload:T,handleImageRemove:M})=>{const[n,a]=c.useState(null),s={padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"0.5rem",border:"1px solid #dee2e6",marginBottom:"1rem"},R={fontSize:"0.85rem",fontWeight:"600",marginBottom:"0.5rem",color:"#495057",display:"block"},A={fontSize:"0.9rem",padding:"0.4rem 0.75rem",borderRadius:"0.375rem",border:"1px solid #ced4da",backgroundColor:"#fff",marginBottom:"1rem"},_={fontSize:"0.95rem",fontWeight:"bold",marginBottom:"1rem",color:"#2c3e50",borderBottom:"2px solid #3498db",paddingBottom:"0.5rem"},$={display:"flex",gap:"0.75rem",flexWrap:"wrap",marginTop:"1rem"},V={width:"100px",height:"100px",objectFit:"cover",borderRadius:"0.375rem",border:"1px solid #dee2e6",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"all 0.2s ease",cursor:"pointer"},G={...V,border:"2px solid #3498db",boxShadow:"0 0 0 3px rgba(52, 152, 219, 0.3)"},C={textAlign:"center",padding:"2rem",color:"#6c757d",fontStyle:"italic",backgroundColor:"#fff",borderRadius:"0.375rem",border:"1px dashed #dee2e6"},b={marginTop:"1.5rem",padding:"1rem",backgroundColor:"#fff",borderRadius:"0.5rem",border:"1px solid #dee2e6"},z={maxWidth:"100%",maxHeight:"300px",borderRadius:"0.375rem",border:"1px solid #dee2e6"},B={fontSize:"0.8rem",padding:"0.25rem 0.5rem",marginTop:"0.5rem"};return e.jsxs("div",{style:s,children:[e.jsx("div",{style:_,children:"Ürün Resimleri"}),e.jsxs("div",{children:[e.jsx(X,{style:R,children:"Resim Ekle"}),e.jsx(ye,{type:"file",multiple:!0,accept:"image/*",onChange:T,style:{...A,color:"#000000"}})]}),g.images&&g.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:$,children:g.images.map((d,o)=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:d,alt:`Ürün resmi ${o+1}`,style:n===o?G:V,onMouseEnter:h=>{h.target.style.transform="scale(1.05)",h.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseLeave:h=>{h.target.style.transform="scale(1)",h.target.style.boxShadow=n===o?"0 0 0 3px rgba(52, 152, 219, 0.3)":"0 2px 4px rgba(0,0,0,0.1)"},onClick:()=>a(o)}),e.jsx(f,{color:"danger",size:"sm",style:{position:"absolute",top:"-8px",right:"-8px",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",padding:0},onClick:()=>M(o),children:"×"})]},o))}),n!==null&&e.jsxs("div",{style:b,children:[e.jsx("h6",{style:{marginBottom:"0.75rem",color:"#495057"},children:"Büyük Ön İzleme"}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("img",{src:g.images[n],alt:`Büyük ön izleme ${n+1}`,style:z})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[e.jsx(f,{color:"primary",size:"sm",style:B,onClick:()=>a(null),children:"Ön İzlemeyi Kapat"}),e.jsx(f,{color:"danger",size:"sm",style:B,onClick:()=>{M(n),a(null)},children:"Bu Resmi Sil"})]})]})]}):e.jsxs("div",{style:C,children:[e.jsx("p",{children:"Henüz hiç resim eklenmemiş"}),e.jsx("small",{children:"Yukarıdaki alandan resim yükleyebilirsiniz"})]})]})},ne="https://speedsofttest.com/api",Oe=({visible:g,onClose:T,onSubmit:M,addToast:n,product:a=null})=>{const[s,R]=c.useState({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",unit:(a==null?void 0:a.unit)||"Adet",type:(a==null?void 0:a.type)||"Stoklu",categoryId:(a==null?void 0:a.categoryId)||"",brandId:(a==null?void 0:a.brandId)||"",shelfId:(a==null?void 0:a.shelfId)||"",salePrice:a!=null&&a.salePrice?String(a.salePrice):"",saleCurrency:(a==null?void 0:a.saleCurrency)||"TRY",purchaseCurrency:(a==null?void 0:a.purchaseCurrency)||"TRY",saleVatRate:a!=null&&a.saleVatRate?String(a.saleVatRate):"",saleVatIncluded:(a==null?void 0:a.saleVatIncluded)||!1,otvRate:a!=null&&a.otvRate?String(a.otvRate):"",otvType:(a==null?void 0:a.otvType)||"Yok",purchasePrice:a!=null&&a.purchasePrice?String(a.purchasePrice):"",purchaseVatRate:a!=null&&a.purchaseVatRate?String(a.purchaseVatRate):"",purchaseVatIncluded:(a==null?void 0:a.purchaseVatIncluded)||!1,purchaseDiscount:a!=null&&a.purchaseDiscount?String(a.purchaseDiscount):"",productCode:(a==null?void 0:a.productCode)||"",gtip:(a==null?void 0:a.gtip)||"",countryCode:(a==null?void 0:a.countryCode)||"TR",stockAmount:a!=null&&a.stockAmount?String(a.stockAmount):"",invoiceTitle:(a==null?void 0:a.invoiceTitle)||"",description:(a==null?void 0:a.description)||"",barcode:(a==null?void 0:a.barcode)||"",trackStock:(a==null?void 0:a.trackStock)||!1,criticalStock:a!=null&&a.criticalStock?String(a.criticalStock):"",tags:Array.isArray(a==null?void 0:a.tags)?a.tags.join(", "):"",images:Array.isArray(a==null?void 0:a.images)?a.images:[]}),[A,_]=c.useState("productDefinition"),[$,V]=c.useState(!1),[G,C]=c.useState(!1),b=r=>{const{name:m,value:j,type:t,checked:k}=r.target;R(I=>({...I,[m]:t==="checkbox"?k:j}))},z=r=>{const m=Array.from(r.target.files);R(j=>({...j,images:[...j.images,...m]}))},B=r=>{if(r.preventDefault(),!s.name||!s.salePrice||!s.unit){n({message:"Ürün Adı, Satış Fiyatı ve Birim zorunlu alanlardır.",color:"danger"});return}C(!0)},d=async()=>{var r,m,j;try{V(!0);const t=new FormData;t.append("Id",s.id||0),t.append("Adi",s.name||""),t.append("UrunTipi",s.type==="Stoklu"),t.append("BirimAdi",s.unit==="Adet"?"adet":s.unit||"adet");const k=parseFloat(s.salePrice.replace(",","."))||0,I=parseFloat(s.purchasePrice.replace(",","."))||0,P=parseFloat(s.saleVatRate.replace(",","."))||0,u=parseFloat(s.purchaseVatRate.replace(",","."))||0,U=parseFloat(s.otvRate.replace(",","."))||0,Q=parseFloat(s.purchaseDiscount.replace(",","."))||0,H=parseInt(s.stockAmount)||0,w=parseInt(s.criticalStock)||0;if(t.append("SatisFiyat",k),t.append("AlisFiyat",I),t.append("SatisKDV",P),t.append("AlisKDV",u),t.append("SatisKdvDahilmi",s.saleVatIncluded),t.append("AlisKdvDahilmi",s.purchaseVatIncluded),t.append("OIVOrani",U),t.append("AlisIskontosu",Q),t.append("OTVTipi",s.otvType==="Yok"?null:s.otvType),t.append("UrunKategoriId",parseInt(s.categoryId)||0),t.append("UrunMarkaId",parseInt(s.brandId)||0),t.append("UrunRafId",parseInt(s.shelfId)||0),t.append("UrunKodu",s.productCode||""),t.append("GTIPKodu",s.gtip||""),t.append("UlkeId",parseInt(s.countryCode)||0),t.append("StokMiktari",H),t.append("FaturaBasligi",s.invoiceTitle||""),t.append("Aciklama",s.description||""),t.append("Barkod",s.barcode||""),t.append("StokTakip",s.trackStock?"Evet":"Hayır"),t.append("KritikStok",w),t.append("Etiketler",s.tags||""),t.append("Durumu",1),s.images.length>0){for(const K of s.images)if(K instanceof File)t.append("Fotograf",K);else if(typeof K=="string"&&K.startsWith("data:image")){const q=await(await fetch(K)).blob();t.append("Fotograf",q,"image.png")}}else(r=a==null?void 0:a.images)!=null&&r[0]&&t.append("Fotograf",a.images[0]);const Z=a!=null&&a.id?`${ne}/urun/urun-update`:`${ne}/urun/urun-create`,ee=await Y[a!=null&&a.id?"put":"post"](Z,t,{headers:{"Content-Type":"multipart/form-data"}});if(ee.data.message==="Güncelleme Başarılı."||ee.data.message==="Ekleme Başarılı."){let K="",q="",le="";try{s.categoryId&&(K=(await Y.get(`${ne}/urunKategori/get-by-id/${s.categoryId}`)).data.adi||""),s.brandId&&(q=(await Y.get(`${ne}/urunMarka/get-by-id/${s.brandId}`)).data.adi||""),s.shelfId&&(le=(await Y.get(`${ne}/urunRaf/get-by-id/${s.shelfId}`)).data.adi||"")}catch(F){console.error("Error fetching names:",F),n("Kategori, marka veya raf isimleri alınamadı.","error")}M({id:(a==null?void 0:a.id)||ee.data.id,name:s.name,unit:s.unit,type:s.type,categoryId:parseInt(s.categoryId)||0,brandId:parseInt(s.brandId)||0,shelfId:parseInt(s.shelfId)||0,category:K,brand:q,shelfLocation:le,salePrice:k,saleCurrency:s.saleCurrency,purchaseCurrency:s.purchaseCurrency,saleVatRate:P,saleVatIncluded:s.saleVatIncluded,otvRate:U,otvType:s.otvType,purchasePrice:I,purchaseVatRate:u,purchaseVatIncluded:s.purchaseVatIncluded,purchaseDiscount:Q,productCode:s.productCode,gtip:s.gtip,countryCode:s.countryCode,stockAmount:H,invoiceTitle:s.invoiceTitle,description:s.description,barcode:s.barcode,trackStock:s.trackStock,criticalStock:w,tags:s.tags?s.tags.split(",").map(F=>F.trim()):[],images:s.images}),n(a!=null&&a.id?"Ürün başarıyla güncellendi.":"Ürün başarıyla eklendi.","success"),C(!1),T()}else throw new Error("Sunucu yanıtı beklenmedik: "+ee.data.message)}catch(t){console.error("Submit Error:",t.message,t.stack),n(((j=(m=t.response)==null?void 0:m.data)==null?void 0:j.message)||"Ürün işlemi başarısız.","error")}finally{V(!1)}},o=()=>{C(!1),T()},h=()=>{switch(A){case"productDefinition":return e.jsx(Me,{formData:s,handleChange:b});case"pricing":return e.jsx(Fe,{formData:s,handleChange:b});case"otherInfo":return e.jsx(Te,{formData:s,handleChange:b});case"images":return e.jsx(qe,{formData:s,handleImageUpload:z});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{visible:g,onClose:o,backdrop:"static",size:"lg",children:[e.jsx(de,{style:{backgroundColor:"#2965A8",color:"#fff"},children:e.jsx(ue,{children:a!=null&&a.id?"Ürün/Hizmet Güncelle":"Yeni Ürün/Hizmet Ekle"})}),e.jsx(he,{children:e.jsxs(Ie,{onSubmit:B,children:[e.jsx(De,{role:"group",className:"mb-4 w-100",children:["productDefinition","pricing","otherInfo","images"].map(r=>e.jsx(f,{style:{backgroundColor:A===r?"#FFFFFF":"#2965A8",color:A===r?"#2965A8":"#FFFFFF",border:"1px solid #2965A8",flex:1,textAlign:"center"},onClick:()=>_(r),disabled:$,children:r==="productDefinition"?"Ürün/Hizmet Tanımı":r==="pricing"?"Fiyatlandırma":r==="otherInfo"?"Diğer Bilgiler":"Resimler"},r))}),e.jsx("div",{style:{padding:"0 15px"},children:h()}),e.jsxs(je,{children:[e.jsx(f,{color:"secondary",onClick:o,disabled:$,children:"Vazgeç"}),e.jsx(f,{color:"primary",type:"submit",disabled:$,children:$?"Kaydediliyor...":"Kaydet"})]})]})})]}),e.jsxs(ce,{visible:G,onClose:()=>C(!1),className:"shadow-sm",backdrop:"static",children:[e.jsx(de,{style:{backgroundColor:"#2965A8",color:"#FFFFFF"},children:e.jsx(ue,{children:"Güncelleme Onayı"})}),e.jsx(he,{children:e.jsxs("p",{children:['Ürün "',e.jsx("strong",{children:(s==null?void 0:s.name)||"Bilinmeyen Ürün"}),'"'," ",a!=null&&a.id?"güncellenecek":"eklenecek",", emin misiniz?"]})}),e.jsxs(je,{children:[e.jsx(f,{color:"secondary",onClick:()=>C(!1),children:"İptal"}),e.jsx(f,{color:"primary",onClick:d,className:"text-white",children:"Onayla"})]})]})]})},se="https://speedsofttest.com/api",te=ze.create({baseURL:se}),We=({visible:g,onClose:T,onSubmit:M,product:n,addToast:a})=>{const[s,R]=c.useState({transactionDate:fe(),transactionType:"1",quantity:"",unitCost:(n==null?void 0:n.purchasePrice)||"",warehouseId:"",description:""}),[A,_]=c.useState([]),[$,V]=c.useState(!1),G=async()=>{var d,o;try{V(!0);const{data:h}=await te.get(`${se}/depo/get-all`);_(h.filter(r=>r.durumu===1))}catch(h){a(((o=(d=h.response)==null?void 0:d.data)==null?void 0:o.message)||"Depolar yüklenemedi.","error")}finally{V(!1)}},C=async(d,o)=>{var h,r;try{const{data:m}=await te.get(`${se}/urun/urun-depolardaki-stoklar/${d}`),j=m.find(t=>t.depoId===parseInt(o));return j?j.miktar:0}catch(m){return a(((r=(h=m.response)==null?void 0:h.data)==null?void 0:r.message)||"Depo stoğu yüklenemedi.","error"),0}};c.useEffect(()=>{g&&(G(),R({transactionDate:fe(),transactionType:"1",quantity:"",unitCost:(n==null?void 0:n.purchasePrice)||"",warehouseId:"",description:""}))},[g,n]);const b=d=>{const{name:o,value:h}=d.target;R(r=>({...r,[o]:h}))},z=d=>{R(o=>({...o,transactionDate:d}))},B=async d=>{var o,h,r;d.preventDefault();try{if(!s.quantity||!s.warehouseId||!s.unitCost)throw new Error("Miktar, Birim Maliyet ve Depo alanları zorunludur.");if(parseFloat(s.quantity)<=0)throw new Error("Miktar sıfırdan büyük olmalıdır.");if(parseFloat(s.unitCost)<0)throw new Error("Birim Maliyet negatif olamaz.");if(!(n!=null&&n.id))throw new Error("Ürün ID'si bulunamadı.");if(!A.find(w=>w.id===parseInt(s.warehouseId)))throw new Error("Geçersiz depo seçimi.");const j=parseFloat(s.unitCost)!==parseFloat(n.purchasePrice);let t=n.id;if(j){const w={adi:`${n.name} (Yeni Maliyet)`,urunTipi:n.type==="Stoklu",birimAdi:n.unit==="Adet"?0:n.unit,satisFiyat:n.salePrice,alisFiyat:parseFloat(s.unitCost),satisKDV:n.saleVatRate,alisKDV:n.purchaseVatRate,satisKdvDahilmi:n.saleVatIncluded,alisKdvDahilmi:n.purchaseVatIncluded,alisIskontosu:n.purchaseDiscount,oivOrani:n.otvRate,otvTipi:n.otvType,urunKategoriId:n.categoryId||0,urunMarkaId:n.brandId||0,urunKodu:n.productCode,gtipKodu:n.gtip,ulkeId:parseInt(n.countryCode)||0,stokMiktari:s.transactionType==="1"?parseFloat(s.quantity):0,faturaBasligi:n.invoiceTitle,aciklama:n.description,barkod:n.barcode,urunRafId:n.shelfId||0,stokTakip:n.trackStock?"Evet":"Hayır",kritikStok:n.criticalStock,etiketler:n.tags.join(","),fotograf:n.images[0]||""};console.log("Creating new product with payload:",w);const{data:Z}=await te.post(`${se}/urun/urun-create`,w);t=Z.id,a("Yeni ürün oluşturuldu.","success")}if(s.transactionType==="0"&&await C(t,s.warehouseId)<parseFloat(s.quantity))throw new Error("Çıkış miktarı mevcut stoktan fazla olamaz.");const k=new FormData;k.append("Id","0"),k.append("UrunId",t),k.append("IslemTipi",parseInt(s.transactionType)),k.append("Miktar",parseFloat(s.quantity)),k.append("Maliyet",parseFloat(s.unitCost)),k.append("DepoId",parseInt(s.warehouseId)),k.append("Aciklama",s.description||"Manuel Giriş"),k.append("IslemTarihi",s.transactionDate.format("YYYY-MM-DDTHH:mm:ss.SSSZ")),console.log("Sending stock movement payload to /api/urun/urun-manuelstokgiris:");for(let[w,Z]of k.entries())console.log(`${w}: ${Z}`);const{data:I}=await te.post(`${se}/urun/urun-manuelstokgiris`,k,{headers:{"Content-Type":"multipart/form-data"}}),P=await C(t,s.warehouseId),u=parseFloat(s.quantity)*(s.transactionType==="1"?1:-1),U=P+u;if(U<0)throw new Error("Stok miktarı negatif olamaz.");const Q={UrunId:t,DepoMiktarlari:[{DepoId:parseInt(s.warehouseId),Miktar:U}]};console.log("Sending depot stock update payload to /api/urun/urun-toplu-depostok-guncelle:",Q),await te.post(`${se}/urun/urun-toplu-depostok-guncelle`,Q);const H={id:(I==null?void 0:I.id)||Date.now(),date:s.transactionDate.format("YYYY-MM-DD HH:mm:ss"),description:s.description||"Manuel Giriş",quantity:parseFloat(s.quantity),price:parseFloat(s.unitCost)};console.log("Adding new movement to table:",H),a("Stok hareketi kaydedildi.","success"),M(H)}catch(m){console.error("Error during submission:",((o=m.response)==null?void 0:o.data)||m.message),a(((r=(h=m.response)==null?void 0:h.data)==null?void 0:r.message)||m.message||"Stok hareketi kaydedilemedi.","error")}};return e.jsxs(ce,{visible:g,onClose:T,backdrop:"static",size:"lg",children:[e.jsx(de,{children:e.jsx(ue,{children:"Manuel Giriş-Çıkış İşlemleri"})}),e.jsx(he,{children:e.jsxs(Ie,{onSubmit:B,children:[e.jsx(N,{className:"mb-3",children:e.jsxs(E,{className:"bg-danger text-white",children:[e.jsxs("h4",{children:["Dikkat ",e.jsx(re,{icon:He,size:"lg"})]}),e.jsx("p",{children:"Alış, satış, iade ya da üretim dışında bu ürünün stok giriş çıkış işlemi varsa buradan yapabilirsiniz. Buradan yapacağınız işlem, müşterileri ya da tedarikçi bakiyelerinizi etkilemeyecek, sadece depo stoklarınızı güncelleyecektir."})]})}),e.jsx(X,{children:"İşlem Tarihi"}),e.jsx(Re,{dateAdapter:Ae,children:e.jsx($e,{value:s.transactionDate,onChange:z,format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,className:"mb-3"}}})}),e.jsx(X,{children:"İşlem Tipi"}),e.jsxs(pe,{name:"transactionType",value:s.transactionType,onChange:b,className:"mb-3",children:[e.jsx("option",{value:"1",children:"Stoklara Giriş Yap"}),e.jsx("option",{value:"0",children:"Stoklardan Çıkış Yap"})]}),e.jsx(X,{children:"Miktar (Adet)"}),e.jsx(ye,{type:"number",name:"quantity",value:s.quantity,onChange:b,required:!0,className:"mb-3",step:"0.01",min:"0.01"}),e.jsx(X,{children:"Birim Maliyet"}),e.jsx(ye,{type:"number",name:"unitCost",value:s.unitCost,onChange:b,required:!0,className:"mb-3",step:"0.01",min:"0"}),e.jsx(X,{children:"İlgili Depo"}),e.jsxs(pe,{name:"warehouseId",value:s.warehouseId,onChange:b,className:"mb-3",disabled:$,required:!0,children:[e.jsx("option",{value:"",children:"Depo Seç"}),A.map(d=>e.jsx("option",{value:d.id,children:d.adi},d.id))]}),e.jsx(X,{children:"Açıklama"}),e.jsx(Ve,{name:"description",value:s.description,onChange:b,rows:3,className:"mb-3"})]})}),e.jsxs(je,{children:[e.jsx(f,{color:"primary",type:"submit",onClick:B,children:"Kaydet"}),e.jsx(f,{color:"secondary",onClick:T,children:"Vazgeç"})]})]})},W="https://speedsofttest.com/api",Je=()=>{const{id:g}=Be(),{state:T}=Ke(),M=Ne(),[n,a]=c.useState((T==null?void 0:T.product)||null),[s,R]=c.useState([]),[A,_]=c.useState([]),[$,V]=c.useState([]),[G,C]=c.useState([]),[b,z]=c.useState(!1),[B,d]=c.useState(null),[o,h]=c.useState([]),[r,m]=c.useState(!1),[j,t]=c.useState(!1),[k,I]=c.useState(!1),P=c.useRef(),u=(i,y="success")=>{const p=e.jsxs(Ge,{autohide:y!=="confirm",visible:!0,delay:5e3,children:[e.jsx(Ue,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:y==="error"?"Hata":y==="confirm"?"Onay":"Başarılı"})}),e.jsx(Le,{children:i})]},Date.now());h(x=>[...x,p])},U=async(i,y)=>{var p,x,ie;try{console.log(`Fetching data from: ${i}`);const{data:l}=await Y.get(i);console.log(`API response from ${i}:`,l);const O=Array.isArray(l)?l.filter(ve=>ve.durumu===1):l.durumu===1?[l]:[];return y(O),O}catch(l){return console.error(`Error fetching ${i}:`,((p=l.response)==null?void 0:p.data)||l.message),u(((ie=(x=l.response)==null?void 0:x.data)==null?void 0:ie.message)||"Veriler yüklenemedi.","error"),[]}},Q=async i=>{var ie;let y="Bilinmeyen Kategori",p="Bilinmeyen Marka",x="Raf Yok";try{if(i.urunKategoriId&&i.urunKategoriId!==0){const l=s.find(O=>O.id===i.urunKategoriId)||(await Y.get(`${W}/urunKategori/get-by-id/${i.urunKategoriId}`)).data;y=(l==null?void 0:l.adi)||y,l||console.warn(`Kategori bulunamadı: ID ${i.urunKategoriId}`)}if(i.urunMarkaId&&i.urunMarkaId!==0){const l=A.find(O=>O.id===i.urunMarkaId)||(await Y.get(`${W}/urunMarka/get-by-id/${i.urunMarkaId}`)).data;p=(l==null?void 0:l.adi)||p,l||console.warn(`Marka bulunamadı: ID ${i.urunMarkaId}`)}if(i.urunRafId&&i.urunRafId!==0){const l=$.find(O=>O.id===i.urunRafId)||(await Y.get(`${W}/urunRaf/get-by-id/${i.urunRafId}`)).data;x=(l==null?void 0:l.adi)||x,l||console.warn(`Raf bulunamadı: ID ${i.urunRafId}`)}}catch(l){console.error("Dönüşüm Hatası:",l.message,l.stack)}return{id:i.id,name:i.adi,salePrice:i.satisFiyat,stockQuantity:i.kritikStok||0,unit:i.birimAdi===0?"Adet":i.birimAdi,type:i.urunTipi?"Stoklu":"Stoksuz",category:y,brand:p,categoryId:i.urunKategoriId||0,brandId:i.urunMarkaId||0,shelfId:i.urunRafId||0,productCode:i.urunKodu,gtip:i.gtipKodu,countryCode:((ie=i.ulkeId)==null?void 0:ie.toString())||"",stockAmount:i.stokMiktari,invoiceTitle:i.faturaBasligi,description:i.aciklama,barcode:i.barkod,shelfLocation:x,trackStock:i.stokTakip==="Evet",criticalStock:i.kritikStok,tags:i.etiketler?i.etiketler.split(",").map(l=>l.trim()):[],purchasePrice:i.alisFiyat,saleVatRate:i.satisKDV,saleVatIncluded:i.satisKdvDahilmi,purchaseVatRate:i.alisKDV,purchaseVatIncluded:i.alisKdvDahilmi,purchaseDiscount:i.alisIskontosu,otvRate:i.oivOrani,otvType:i.otvTipi,images:i.fotograf?[i.fotograf]:[],saleCurrency:i.paraBirimi||"TRY"}},H=c.useCallback(async()=>{var i,y,p;z(!0);try{await U(`${W}/urunKategori/get-all`,R),await U(`${W}/urunMarka/get-all`,_),await U(`${W}/urunRaf/get-all`,V),console.log("Fetching product with ID:",g);const{data:x}=await Y.get(`${W}/urun/urun-get-by-id/${g}`);if(x.durumu!==1)throw new Error("Ürün bulunamadı veya aktif değil.");a(await Q(x)),d(null)}catch(x){console.error("Ürün yükleme hatası:",((i=x.response)==null?void 0:i.data)||x.message),d(((p=(y=x.response)==null?void 0:y.data)==null?void 0:p.message)||"Ürün yüklenemedi."),u("Ürün yüklenemedi.","error")}finally{z(!1)}},[g]),w=()=>{I(!0)},Z=async()=>{var i,y,p;z(!0),I(!1);try{await Y.delete(`${W}/urun/urun-delete/${g}`),u("Ürün silindi.","success"),M("/app/products")}catch(x){console.error("Ürün silme hatası:",((i=x.response)==null?void 0:i.data)||x.message),u(((p=(y=x.response)==null?void 0:y.data)==null?void 0:p.message)||"Ürün silinemedi.","error")}finally{z(!1)}},ee=()=>{I(!1)};c.useEffect(()=>{console.log("useEffect triggered with id:",g,"product:",n,"showUpdateModal:",r),g&&!n&&H()},[g,n,H]);const K=()=>{console.log("handleUpdate called, setting showUpdateModal to true"),m(!0)},q=i=>{console.log("handleStockEntry called with type:",i),i==="Manuel Giriş-Çıkış"?t(!0):i==="Stok Sayımı"?M(`/app/products/${g}/stock-count`,{state:{product:n}}):u(`${i} işlemi başlatıldı.`,"success")},le=()=>{console.log("handleStockStatement called"),u("Stok ekstresi oluşturuldu.","success")},F=i=>{console.log("handleOtherAction called with action:",i),i==="Ürün Silme"?w():u(`${i} işlemi başlatıldı.`,"success")};if(b)return e.jsx("div",{children:"Yükleniyor..."});if(B||!n)return e.jsxs(N,{children:[e.jsx(L,{children:"Ürün Bilgisi"}),e.jsxs(E,{children:[e.jsx("p",{children:B||"Ürün bulunamadı."}),e.jsx(f,{color:"primary",onClick:()=>M("/app/products"),children:"Geri Dön"})]})]});const we=n.stockQuantity*n.salePrice;return e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{ref:P,placement:"top-end",className:"p-3",children:[o,k&&e.jsxs(ce,{visible:!0,autohide:!1,children:[e.jsx(de,{style:{backgroundColor:"#DC3545",color:"white"},children:e.jsx("strong",{className:"me-auto",children:"Ürün Silme Onayı"})}),e.jsxs(he,{children:[e.jsx("p",{children:"Ürünü silmek istediğinize emin misiniz?"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(f,{color:"danger",style:{color:"white"},onClick:Z,children:"Evet"}),e.jsx(f,{color:"secondary",onClick:ee,children:"Hayır"})]})]})]})]}),e.jsxs(oe,{children:[e.jsx(S,{xs:12,children:e.jsxs(N,{children:[e.jsx(L,{style:{backgroundColor:"#2965A8",color:"#fff",fontSize:"24px"},children:n.name}),e.jsx(E,{children:e.jsxs(oe,{children:[e.jsxs(S,{xs:6,children:[e.jsxs("h5",{children:[e.jsx("strong",{children:"Barkod:"})," ",n.barcode]}),e.jsxs("div",{className:"mt-3",children:[console.log(n.images[0]),n.images&&n.images.length>0&&n.images[0]&&n.images[0].trim()!==""?e.jsx(e.Fragment,{children:e.jsx("img",{src:`https://speedsofttest.com/${n.images[0]}`,alt:n.name,style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain"},onLoad:()=>{console.log("Resim başarıyla yüklendi:",n.images[0])}})}):e.jsx("div",{style:{width:"200px",height:"200px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",border:"2px dashed #dee2e6",borderRadius:"8px",color:"#6c757d",fontSize:"14px",textAlign:"center"},children:e.jsxs("div",{children:[e.jsx("strong",{children:"Ürün Görseli Yok"}),e.jsx("br",{}),e.jsx("small",{children:"Görsel ekleyin"})]})})]})]}),e.jsxs(S,{xs:6,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ürün Kodu:"})," ",n.productCode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kategori:"})," ",n.category]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Marka:"})," ",n.brand]}),e.jsxs("p",{children:[e.jsx("strong",{children:"KDV Oranı:"})," %",n.saleVatRate]})]})]})})]})}),e.jsx(S,{xs:12,className:"my-3",children:e.jsxs(oe,{children:[e.jsx(S,{children:e.jsxs(N,{children:[e.jsx(L,{className:"bg-danger",style:{color:"white"},children:"Alış Fiyatı"}),e.jsx(E,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",n.purchasePrice.toLocaleString("tr-TR")]})})]})}),e.jsx(S,{children:e.jsxs(N,{children:[e.jsx(L,{className:"bg-success",style:{color:"white"},children:"Satış Fiyatı"}),e.jsx(E,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",n.salePrice.toLocaleString("tr-TR")]})})]})}),e.jsx(S,{children:e.jsxs(N,{children:[e.jsx(L,{className:"bg-warning",style:{color:"white"},children:"Toplam Stok"}),e.jsx(E,{children:e.jsxs("p",{className:"fw-bold",children:[n.stockQuantity," Adet"]})})]})}),e.jsx(S,{children:e.jsxs(N,{children:[e.jsx(L,{className:"bg-info",style:{color:"white"},children:"Stok Değeri"}),e.jsx(E,{children:e.jsxs("p",{className:"fw-bold",children:[n.saleCurrency||"TRY"," ",(we*n.stockQuantity).toLocaleString("tr-TR")]})})]})})]})}),e.jsx(S,{xs:12,className:"mb-3",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(f,{style:{color:"white"},color:"warning",onClick:K,children:[e.jsx(re,{icon:Ye,style:{color:"white"}})," Güncelle"]}),e.jsxs(be,{children:[e.jsxs(Se,{color:"primary",children:[e.jsx(re,{icon:ke})," Stoklara Giriş Yap"]}),e.jsxs(Ce,{children:[e.jsx(J,{disabled:!0,onClick:()=>q("Tedarikçi Girişi"),children:"Tedarikçiden Ürün Girişi Yap"}),e.jsx(J,{onClick:()=>q("Manuel Giriş-Çıkış"),children:"Manuel Giriş-Çıkış İşlemleri"}),e.jsx(J,{onClick:()=>q("Stok Sayımı"),children:"Stok Sayımı Yap"})]})]}),e.jsxs(f,{style:{color:"white"},color:"info",onClick:le,disabled:!0,children:[e.jsx(re,{icon:ke,style:{color:"white"}})," Stok Ekstresi"]}),e.jsxs(be,{children:[e.jsxs(Se,{color:"secondary",children:[e.jsx(re,{icon:ke})," Diğer İşlemler"]}),e.jsxs(Ce,{children:[e.jsx(J,{disabled:!0,onClick:()=>F("Döküman Yükle"),children:"Döküman Yükle"}),e.jsx(J,{disabled:!0,onClick:()=>F("Etiket Yazdır"),children:"Etiket Yazdır"}),e.jsx(J,{disabled:!0,onClick:()=>F("Müşteri Kodları"),children:"Müşteri Kodları"}),e.jsx(J,{onClick:()=>F("Ürün Silme"),children:"Ürün Silme"})]})]})]})}),e.jsx(S,{xs:12,children:e.jsxs(oe,{children:[e.jsx(S,{className:"mt-3",children:e.jsxs(N,{children:[e.jsx(L,{style:{backgroundColor:"#2965A8",color:"white"},children:"Önceki Satışlar"}),e.jsx(E,{children:e.jsxs(me,{responsive:!0,children:[e.jsx(ge,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:G.filter(i=>i.description==="Satış").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})}),e.jsx(S,{className:"mt-3",children:e.jsxs(N,{children:[e.jsx(L,{style:{backgroundColor:"#2965A8",color:"white"},children:"Önceki Alışlar"}),e.jsx(E,{children:e.jsxs(me,{responsive:!0,children:[e.jsx(ge,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:G.filter(i=>i.description==="Tedarikçi Girişi").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})}),e.jsx(S,{className:"mt-3",children:e.jsxs(N,{children:[e.jsx(L,{style:{backgroundColor:"#2965A8",color:"white"},children:"Manuel Stok Hareketleri"}),e.jsx(E,{children:e.jsxs(me,{responsive:!0,children:[e.jsx(ge,{children:e.jsxs(ae,{children:[e.jsx(v,{children:"Tarih"}),e.jsx(v,{children:"Açıklama"}),e.jsx(v,{children:"Miktar"}),e.jsx(v,{children:"Fiyat"})]})}),e.jsx(xe,{children:G.filter(i=>i.description!=="Satış"&&i.description!=="Tedarikçi Girişi").map(i=>e.jsxs(ae,{children:[e.jsx(D,{children:i.date}),e.jsx(D,{children:i.description}),e.jsx(D,{children:i.quantity}),e.jsx(D,{children:i.price.toLocaleString("tr-TR")})]},i.id))})]})})]})})]})})]}),r!==void 0&&e.jsx(Oe,{visible:r,onClose:()=>{console.log("Closing ProductModal"),m(!1)},onSubmit:i=>{console.log("ProductModal submitted with data:",i),a({...n,...i}),u("Ürün güncellendi.","success"),m(!1)},product:n,addToast:u}),j!==void 0&&e.jsx(We,{visible:j,onClose:()=>{console.log("Closing StockMovementModal"),t(!1)},onSubmit:i=>{console.log("StockMovementModal submitted with data:",i),C(y=>[...y,i]),u("Stok hareketi kaydedildi.","success"),t(!1)},product:n,addToast:u})]})};export{Je as default};
