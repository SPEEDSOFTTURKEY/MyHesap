import{r as h,R as O,Z as F,j as a,g as Z,s as q,h as G,e as J,f as z,o as Q,q as B,$ as X,a0 as tt,a1 as $,a2 as v,a3 as et,a4 as M,al as at,aA as L,ay as _,az as ot}from"./index-DvA_wB1j.js";import{C as I,B as rt,a as nt,L as st,b as lt,p as it,c as ct,d as dt}from"./chart-DDrJ3moh.js";const U="label";function W(e,n){typeof e=="function"?e(n):e&&(e.current=n)}function ut(e,n){const o=e.options;o&&n&&Object.assign(o,n)}function K(e,n){e.labels=n}function V(e,n){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U;const l=[];e.datasets=n.map(s=>{const y=e.datasets.find(S=>S[o]===s[o]);return!y||!s.data||l.includes(y)?{...s}:(l.push(y),Object.assign(y,s),y)})}function mt(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U;const o={labels:[],datasets:[]};return K(o,e.labels),V(o,e.datasets,n),o}function ft(e,n){const{height:o=150,width:l=300,redraw:s=!1,datasetIdKey:y,type:S,data:i,options:g,plugins:x=[],fallbackContent:A,updateMode:C,...P}=e,T=h.useRef(null),d=h.useRef(null),k=()=>{T.current&&(d.current=new I(T.current,{type:S,data:mt(i,y),options:g&&{...g},plugins:x}),W(n,d.current))},w=()=>{W(n,null),d.current&&(d.current.destroy(),d.current=null)};return h.useEffect(()=>{!s&&d.current&&g&&ut(d.current,g)},[s,g]),h.useEffect(()=>{!s&&d.current&&K(d.current.config.data,i.labels)},[s,i.labels]),h.useEffect(()=>{!s&&d.current&&i.datasets&&V(d.current.config.data,i.datasets,y)},[s,i.datasets]),h.useEffect(()=>{d.current&&(s?(w(),setTimeout(k)):d.current.update(C))},[s,g,i.labels,i.datasets,C]),h.useEffect(()=>{d.current&&(w(),setTimeout(k))},[S]),h.useEffect(()=>(k(),()=>w()),[]),O.createElement("canvas",{ref:T,role:"img",height:o,width:l,...P},A)}const ht=h.forwardRef(ft);function bt(e,n){return I.register(n),h.forwardRef((o,l)=>O.createElement(ht,{...o,ref:l,type:e}))}const yt=bt("bar",rt),gt="https://speedsofttest.com/api";I.register(nt,st,lt,it,ct,dt);const E=async(e,n="normal")=>{try{let o,l,s;switch(n){case"bold":o="/fonts/Roboto-Bold.ttf",l="Roboto",s="bold";break;case"italic":o="/fonts/Roboto-Italic.ttf",l="Roboto",s="italic";break;default:o="/fonts/Roboto-Regular.ttf",l="Roboto",s="normal"}console.log(`Attempting to fetch ${o}...`);const y=await fetch(o);if(!y.ok)throw new Error(`Font file could not be loaded: ${y.statusText}`);const S=await y.arrayBuffer(),i=new Uint8Array(S);let g="";for(let C=0;C<i.byteLength;C++)g+=String.fromCharCode(i[C]);const x=btoa(g),A=o.split("/").pop();return console.log(`Registering ${l} ${s} font...`),e.addFileToVFS(A,x),e.addFont(A,l,s),console.log(`${l} ${s} font registered successfully`),!0}catch(o){return console.error("Font loading error:",o),console.warn("Falling back to Times font"),e.setFont("times",n==="bold"?"bold":"normal"),!1}},H=async e=>{try{return await E(e,"normal"),await E(e,"bold"),await E(e,"italic"),e.setFont("Roboto","normal"),!0}catch(n){return console.error("Error registering all fonts:",n),e.setFont("times","normal"),!1}},R=e=>!e&&e!==0?"0,00 ₺":e.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")+" ₺",xt=()=>{const[e,n]=h.useState([]),[o,l]=h.useState([]),[s,y]=h.useState(""),[S,i]=h.useState(!1),[g,x]=h.useState(null);h.useEffect(()=>{(async()=>{i(!0),x(null);try{const r=await at.get(`${gt}/musteriSatis/musteriSatis-last-six-months`,{headers:{"Cache-Control":"no-cache"}});let u=[];Array.isArray(r.data)?u=r.data:r.data&&Array.isArray(r.data.data)?u=r.data.data:r.data&&r.data.items?u=r.data.items:console.warn("Beklenmeyen API yanıt formatı:",r.data),n(u),l(u)}catch(r){console.error("Satış verileri alınırken hata oluştu:",r),x("Veriler yüklenirken hata oluştu."),n([]),l([])}finally{i(!1)}})()},[]);const A=t=>{const r=t.target.value.toLowerCase();if(y(r),r==="")l(e);else{const u=e.filter(D=>Object.values(D).some(c=>c==null?!1:typeof c=="object"?Object.values(c).some(p=>p&&p.toString().toLowerCase().includes(r)):c.toString().toLowerCase().includes(r)));l(u)}},C=Array(6).fill(0).map((t,r)=>{const u=F().subtract(5-r,"month");let D=0;return Array.isArray(e)&&(D=e.filter(c=>c&&F(c.eklenmeTarihi).isSame(u,"month")).reduce((c,p)=>c+(p.toplamFiyat||0),0)),{month:u.format("MMM YYYY"),total:D}}),P={labels:C.map(t=>t.month),datasets:[{label:"Toplam Satış (₺)",data:C.map(t=>t.total),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(75, 192, 192, 1)","rgba(255, 206, 86, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},T={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Son 6 Ayın Aylık Satışları"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Toplam Satış (₺)"}},x:{title:{display:!0,text:"Ay"}}}},d=async()=>{if(!Array.isArray(e)||e.length===0){x("PDF oluşturmak için veri yok.");return}i(!0);try{const t=new L({orientation:"landscape",unit:"mm",format:"a4"});await H(t),t.setFontSize(18),t.setFont("Roboto","bold"),t.text("6 Aylık Satış Raporu",148.5,15,{align:"center"}),t.setFontSize(10),t.setFont("Roboto","normal");const u=F().format("DD/MM/YYYY HH:mm:ss");t.text(`Oluşturulma Tarihi: ${u}`,148.5,25,{align:"center"}),t.setFontSize(14),t.setFont("Roboto","bold"),t.text("Satış Verileri",14,35),t.setFont("Roboto","normal");const D=e.map(f=>{var N;return[f.id||"N/A",f.satisId||"N/A",f.eklenmeTarihi?F(f.eklenmeTarihi).format("DD/MM/YYYY"):"N/A",((N=f.musteris)==null?void 0:N.unvani)||f.musteriUnvani||"Bilinmeyen Müşteri",R(f.toplamFiyat)]});t.autoTable({startY:40,head:[["ID","Satış ID","Tarih","Müşteri","Tutar"]],body:D,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255],font:"Roboto",valign:"middle"},styles:{font:"Roboto",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:20},1:{cellWidth:50},2:{cellWidth:40},3:{cellWidth:100},4:{cellWidth:50}},didDrawPage:f=>{t.getFontList().Roboto||t.setFont("times")}});const c=e.reduce((f,N)=>f+(N.toplamFiyat||0),0),p=e.length?c/e.length:0,Y=e.length,j=[["Toplam Satış",R(c)],["Ortalama Satış",R(p)],["Belge Sayısı",`${Y} adet`]];t.setFontSize(14),t.setFont("Roboto","bold"),t.text("Özet",14,t.autoTable.previous.finalY+15),t.setFont("Roboto","normal"),t.autoTable({startY:t.autoTable.previous.finalY+20,body:j,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255],font:"Roboto",valign:"middle"},styles:{font:"Roboto",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:70,fontStyle:"bold"},1:{cellWidth:70}},didDrawPage:f=>{t.getFontList().Roboto||t.setFont("times")}});const b=t.output("blob"),m=URL.createObjectURL(b);window.open(m,"_blank")}catch(t){console.error("PDF oluşturma hatası:",t),x("PDF oluşturulamadı! Hata: "+t.message)}finally{i(!1)}},k=async()=>{if(!Array.isArray(e)||e.length===0){x("PDF indirmek için veri yok.");return}i(!0);try{const t=new L({orientation:"landscape",unit:"mm",format:"a4"});await H(t),t.setFontSize(18),t.setFont("Roboto","bold"),t.text("6 Aylık Satış Raporu",148.5,15,{align:"center"}),t.setFontSize(10),t.setFont("Roboto","normal");const u=F().format("DD/MM/YYYY HH:mm:ss");t.text(`Oluşturulma Tarihi: ${u}`,148.5,25,{align:"center"}),t.setFontSize(14),t.setFont("Roboto","bold"),t.text("Satış Verileri",14,35),t.setFont("Roboto","normal");const D=e.map(b=>{var m;return[b.id||"N/A",b.satisId||"N/A",b.eklenmeTarihi?F(b.eklenmeTarihi).format("DD/MM/YYYY"):"N/A",((m=b.musteris)==null?void 0:m.unvani)||b.musteriUnvani||"Bilinmeyen Müşteri",R(b.toplamFiyat)]});t.autoTable({startY:40,head:[["ID","Satış ID","Tarih","Müşteri","Tutar"]],body:D,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255],font:"Roboto",valign:"middle"},styles:{font:"Roboto",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:20},1:{cellWidth:50},2:{cellWidth:40},3:{cellWidth:100},4:{cellWidth:50}},didDrawPage:b=>{t.getFontList().Roboto||t.setFont("times")}});const c=e.reduce((b,m)=>b+(m.toplamFiyat||0),0),p=e.length?c/e.length:0,Y=e.length,j=[["Toplam Satış",R(c)],["Ortalama Satış",R(p)],["Belge Sayısı",`${Y} adet`]];t.setFontSize(14),t.setFont("Roboto","bold"),t.text("Özet",14,t.autoTable.previous.finalY+15),t.setFont("Roboto","normal"),t.autoTable({startY:t.autoTable.previous.finalY+20,body:j,theme:"grid",headStyles:{fillColor:[41,101,168],fontStyle:"bold",textColor:[255,255,255],font:"Roboto",valign:"middle"},styles:{font:"Roboto",fontStyle:"normal",cellPadding:3,fontSize:10,overflow:"linebreak"},columnStyles:{0:{cellWidth:70,fontStyle:"bold"},1:{cellWidth:70}},didDrawPage:b=>{t.getFontList().Roboto||t.setFont("times")}}),t.save(`6_Aylık_Satış_Raporu_${F().format("YYYYMMDD_HHmmss")}.pdf`)}catch(t){console.error("PDF indirme hatası:",t),x("PDF indirilemedi! Hata: "+t.message)}finally{i(!1)}},w=()=>{if(!Array.isArray(e)||e.length===0){x("Excel oluşturmak için veri yok.");return}const t=e.map(m=>{var f;return{ID:m.id||"N/A","Satış ID":m.satisId||"N/A",Tarih:m.eklenmeTarihi?F(m.eklenmeTarihi).format("DD/MM/YYYY"):"N/A",Müşteri:((f=m.musteris)==null?void 0:f.unvani)||m.musteriUnvani||"Bilinmeyen Müşteri",Tutar:R(m.toplamFiyat)}}),r=e.reduce((m,f)=>m+(f.toplamFiyat||0),0),u=e.length?r/e.length:0,D=e.length,c=[{Kriter:"Toplam Satış",Değer:R(r)},{Kriter:"Ortalama Satış",Değer:R(u)},{Kriter:"Belge Sayısı",Değer:`${D} adet`}],p=_.book_new(),Y=_.json_to_sheet(t);_.book_append_sheet(p,Y,"Satış Verileri");const j=_.json_to_sheet(c);_.book_append_sheet(p,j,"Özet");const b=`6_Aylık_Satış_Raporu_${F().format("YYYYMMDD_HHmmss")}.xlsx`;ot(p,b)};return a.jsxs(Z,{children:[a.jsx(q,{style:{backgroundColor:"#2965A8",color:"#fff"},children:"6 Aylık Satış Raporu"}),a.jsxs(G,{children:[a.jsxs(J,{className:"mb-3",children:[a.jsx(z,{md:6,children:a.jsx(Q,{placeholder:"Tabloda Ara...",value:s,onChange:A})}),a.jsxs(z,{md:6,className:"text-end",children:[a.jsx(B,{color:"info",onClick:d,className:"me-2",disabled:S,children:"Raporla"}),a.jsx(B,{color:"success",onClick:k,className:"me-2",disabled:S,children:"PDF İndir"}),a.jsx(B,{color:"warning",onClick:w,disabled:S,children:"Excel İndir"})]})]}),a.jsx("h4",{className:"mt-4",children:"Son 6 Ayın Satış Verileri"}),g&&a.jsx("div",{className:"alert alert-danger",children:g}),S?a.jsx("p",{children:"Yükleniyor..."}):a.jsx(a.Fragment,{children:Array.isArray(o)&&o.length>0?a.jsxs(X,{striped:!0,hover:!0,children:[a.jsx(tt,{children:a.jsxs($,{children:[a.jsx(v,{children:"ID"}),a.jsx(v,{children:"Satış ID"}),a.jsx(v,{children:"Tarih"}),a.jsx(v,{children:"Müşteri"}),a.jsx(v,{children:"Tutar"})]})}),a.jsx(et,{children:o.map(t=>{var r;return a.jsxs($,{children:[a.jsx(M,{children:t.id||"N/A"}),a.jsx(M,{children:t.satisId||"N/A"}),a.jsx(M,{children:t.eklenmeTarihi?F(t.eklenmeTarihi).format("DD/MM/YYYY"):"N/A"}),a.jsx(M,{children:((r=t.musteris)==null?void 0:r.unvani)||t.musteriUnvani||"Bilinmeyen Müşteri"}),a.jsx(M,{children:R(t.toplamFiyat)})]},t.id||Math.random())})})]}):a.jsx("p",{children:"Satış verisi bulunamadı."})}),a.jsx("h4",{className:"mt-4",children:"Aylık Satış İstatistikleri"}),a.jsx("div",{style:{height:"400px",marginBottom:"20px"},children:a.jsx(yt,{data:P,options:T})})]})]})};export{xt as default};
