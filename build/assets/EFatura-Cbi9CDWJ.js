import{r as c,j as e,C as Ee,q as h,g as De,s as we,h as Se,$ as W,a0 as _,a1 as L,a2 as f,a3 as J,a4 as p,N as w,Q as S,S as N,T as M,m as Q,X as Ne,a6 as Me,W as I,i as X,e as j,f as r,U as n,o as d,ag as Z,aA as Ie,a as Te,b as Be,c as Ae}from"./index-DvA_wB1j.js";import Fe from"./html2canvas.esm-CBrSDip1.js";const C="https://speedsofttest.com/api",$=()=>{try{return(JSON.parse(localStorage.getItem("user"))||{id:0}).id}catch(v){return console.error("Kullanıcı ID'si alınırken hata:",v),0}},P=()=>{try{return parseInt(localStorage.getItem("selectedEdmId"))||null}catch(v){return console.error("Seçili EDM ID'si alınırken hata:",v),null}},ee=v=>{try{localStorage.setItem("selectedEdmId",v)}catch(H){console.error("Seçili EDM ID'si kaydedilirken hata:",H)}},He=()=>{const[v,H]=c.useState([]),se=c.useRef(),[Y,ie]=c.useState([]),[le,T]=c.useState(!1),[ae,B]=c.useState(!1),[re,A]=c.useState(!1),[ne,b]=c.useState(!1),[y,F]=c.useState(null),[V,K]=c.useState(P()),[m,x]=c.useState(!1),[u,G]=c.useState($()),[i,k]=c.useState({unvan:"",vergiDairesi:"",vergiNumrasi:"",adres:"",il:"",ilce:"",postaKodu:"",email:"",telefon:"",kullaniciAdi:"",sifre:"",kullaniciId:u}),[R,oe]=c.useState([]),[te,de]=c.useState(""),[ce,z]=c.useState(!1),[q,he]=c.useState("");c.useEffect(()=>{const s=t=>{if(t.key==="user"){const g=$();G(g),k(D=>({...D,kullaniciId:g}))}t.key==="selectedEdmId"&&K(P())};window.addEventListener("storage",s);const l=$();return G(l),k(t=>({...t,kullaniciId:l})),K(P()),()=>window.removeEventListener("storage",s)},[]);const o=(s,l="success")=>{const t=Date.now(),g=e.jsxs(Te,{autohide:!0,visible:!0,delay:5e3,className:l==="error"?"bg-danger text-white":"bg-success text-white",children:[e.jsx(Be,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:l==="error"?"Hata":"Başarılı"})}),e.jsx(Ae,{children:s})]},t);return H(D=>[...D,g]),t},E=async()=>{x(!0);try{const s=await fetch(`${C}/edmBilgileri/edmBilgileri-get-all`,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.ok){const l=await s.json();console.log("EDM Data:",l),ie(l),console.log("Filtered EDM List:",l)}else o("EDM bilgileri yüklenirken hata oluştu!","error")}catch(s){console.error("Fetch EDM Error:",s),o("Sunucuya bağlanılamadı.","error")}finally{x(!1)}},ue=async()=>{x(!0);try{const s=await fetch(`${C}/EFatura/invoices`);if(s.ok){const l=await s.json();oe(l.invoices||[])}else o("Faturalar yüklenirken hata oluştu!","error")}catch(s){console.error("Fetch Invoices Error:",s),o("Sunucuya bağlanılamadı.","error")}finally{x(!1)}},me=async s=>{x(!0);try{const l=await fetch(`${C}/EFatura/invoice-html/${s}`);if(l.ok){const t=await l.json();de(t.htmlContent||""),z(!0)}else o("Fatura HTML'i yüklenirken hata oluştu!","error")}catch(l){console.error("Fetch Invoice HTML Error:",l),o("Sunucuya bağlanılamadı.","error")}finally{x(!1)}},xe=()=>{const s=document.getElementById("invoice-html").innerHTML,l=window.open("","","height=800, width=1000");l.document.write(`
      <html>
        <head>
          <title>Yazdır</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              color: #000;
              background-color: #fff;
              margin: 0;
              padding: 20px;
            }
            .invoice-container {
              border: 1px solid #ddd;
              padding: 20px;
              background-color: #fff;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 20px;
            }
            th, td {
              border: 1px solid #ddd;
              padding: 8px;
              text-align: left;
            }
            th {
              background-color: #f2f2f2;
            }
          </style>
        </head>
        <body>
          ${s}
        </body>
      </html>
    `),l.document.close(),l.print()},je=()=>{const s=document.getElementById("invoice-html"),l=s.innerHTML,t=`
      <style>
        body {
          font-family: Arial, sans-serif;
          color: #000;
          background-color: #fff;
          margin: 0;
          padding: 20px;
        }
        .invoice-container {
          border: 1px solid #ddd;
          padding: 20px;
          background-color: #fff;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px;
          text-align: left;
        }
        th {
          background-color: #f2f2f2;
        }
      </style>
    `;s.innerHTML=t+l,Fe(s,{scale:2}).then(g=>{s.innerHTML=l;const D=g.toDataURL("image/png"),U=new Ie("p","mm","a4"),O=U.internal.pageSize.getWidth(),Ce=g.height*O/g.width;U.addImage(D,"PNG",0,0,O,Ce),U.save(`fatura_${q}.pdf`)})},ge=async()=>{if(!u||u===0){o("Kullanıcı kimliği bulunamadı. Lütfen oturum açın.","error");return}if(!i.unvan||!i.vergiNumrasi){o("Ünvan ve Vergi Numarası zorunludur.","error");return}x(!0);try{const s={unvan:i.unvan,vergiDairesi:i.vergiDairesi,vergiNumrasi:i.vergiNumrasi,adres:i.adres,il:i.il,ilce:i.ilce,postaKodu:i.postaKodu,email:i.email,telefon:i.telefon,kullaniciAdi:i.kullaniciAdi,sifre:i.sifre,kullaniciId:u},l=await fetch(`${C}/edmBilgileri/edmBilgileri-create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(l.ok){const t=await l.json();o(t.message||"EDM bilgisi başarıyla eklendi.","success"),T(!1),k({unvan:"",vergiDairesi:"",vergiNumrasi:"",adres:"",il:"",ilce:"",postaKodu:"",email:"",telefon:"",kullaniciAdi:"",sifre:"",kullaniciId:u}),E()}else{const t=await l.json();o(t.message||"EDM bilgisi eklenemedi.","error")}}catch(s){console.error("Add EDM Error:",s),o("EDM bilgisi eklenirken hata oluştu.","error")}finally{x(!1)}},fe=async()=>{if(!u||u===0){o("Kullanıcı kimliği bulunamadı. Lütfen oturum açın.","error");return}if(!i.unvan||!i.vergiNumrasi){o("Ünvan ve Vergi Numarası zorunludur.","error");return}x(!0);try{const s={id:y.id,unvan:i.unvan,vergiDairesi:i.vergiDairesi,vergiNumrasi:i.vergiNumrasi,adres:i.adres,il:i.il,ilce:i.ilce,postaKodu:i.postaKodu,email:i.email,telefon:i.telefon,kullaniciAdi:i.kullaniciAdi,sifre:i.sifre,kullaniciId:u},l=await fetch(`${C}/edmBilgileri/edmBilgileri-update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(l.ok){const t=await l.json();o(t.message||"EDM bilgisi başarıyla güncellendi.","success"),B(!1),F(null),E()}else{const t=await l.json();o(t.message||"EDM bilgisi güncellenemedi.","error")}}catch(s){console.error("Update EDM Error:",s),o("EDM bilgisi güncellenirken hata oluştu.","error")}finally{x(!1)}},pe=async()=>{if(!u||u===0){o("Kullanıcı kimliği bulunamadı. Lütfen oturum açın.","error");return}x(!0);try{const s=await fetch(`${C}/edmBilgileri/edmBilgileri-delete/${y.id}?kullaniciId=${u}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(s.ok){const l=await s.json();o(l.message||"EDM bilgisi başarıyla silindi.","success"),A(!1),F(null),V===y.id&&(K(null),ee(null)),E()}else{const l=await s.json();o(l.message||"EDM bilgisi silinemedi.","error")}}catch(s){console.error("Delete EDM Error:",s),o("EDM bilgisi silinirken hata oluştu.","error")}finally{x(!1)}},ve=s=>{F(s),k({unvan:s.unvan||"",vergiDairesi:s.vergiDairesi||"",vergiNumrasi:s.vergiNumrasi||"",adres:s.adres||"",il:s.il||"",ilce:s.ilce||"",postaKodu:s.postaKodu||"",email:s.email||"",telefon:s.telefon||"",kullaniciAdi:s.kullaniciAdi||"",sifre:s.sifre||"",kullaniciId:u}),B(!0)},be=s=>{K(s.id),ee(s.id),o(`${s.unvan} seçildi.`,"success"),b(!1)},a=s=>{const{name:l,value:t}=s.target;k(g=>({...g,[l]:t}))},ye=()=>{b(!0),E()},ke=s=>{he(s.faturaNumarasi),me(s.faturaNumarasi)};return c.useEffect(()=>{E(),ue()},[]),e.jsxs(e.Fragment,{children:[e.jsx(Ee,{ref:se,placement:"top-end",className:"p-3",children:v.map(s=>s)}),e.jsx("div",{style:{display:"flex",gap:"10px",marginBottom:"1rem"},children:e.jsx(h,{style:{width:"150px",color:"white",backgroundColor:"#2965A8"},onClick:ye,disabled:m,children:"EDM Bilgileri"})}),e.jsxs(De,{children:[e.jsx(we,{children:"Faturalar"}),e.jsx(Se,{children:m?e.jsx("p",{children:"Yükleniyor..."}):R.length===0?e.jsx("p",{children:"Fatura bulunamadı."}):e.jsxs(W,{responsive:!0,children:[e.jsx(_,{children:e.jsxs(L,{children:[e.jsx(f,{children:"Fatura Numarası"}),e.jsx(f,{children:"Fatura Tarihi"}),e.jsx(f,{children:"Unvan"}),e.jsx(f,{children:"İşlemler"})]})}),e.jsx(J,{children:R.map(s=>e.jsxs(L,{children:[e.jsx(p,{children:s.faturaNumarasi||"Bilinmiyor"}),e.jsx(p,{children:s.faturaTarih||"Yok"}),e.jsx(p,{children:s.unvan||"Yok"}),e.jsx(p,{children:e.jsx(h,{color:"info",size:"sm",onClick:()=>ke(s),style:{color:"white"},disabled:m,children:"Göster"})})]},s.id))})]})})]}),e.jsxs(w,{visible:ne,onClose:()=>b(!1),size:"xl",children:[e.jsx(S,{children:e.jsx(N,{children:"EDM Bilgileri"})}),e.jsxs(M,{children:[e.jsx(h,{color:"primary",style:{color:"white",backgroundColor:"#2965A8",marginBottom:"1rem"},onClick:()=>{k({unvan:"",vergiDairesi:"",vergiNumrasi:"",adres:"",il:"",ilce:"",postaKodu:"",email:"",telefon:"",kullaniciAdi:"",sifre:"",kullaniciId:u}),T(!0),b(!1)},disabled:m||!u||u===0,children:"Yeni EDM Bilgisi Ekle"}),m?e.jsx("p",{children:"Yükleniyor..."}):Y.length===0?e.jsx("p",{children:"EDM bilgisi bulunamadı."}):e.jsxs(W,{responsive:!0,children:[e.jsx(_,{children:e.jsxs(L,{children:[e.jsx(f,{children:"Ünvan"}),e.jsx(f,{children:"Vergi Numarası"}),e.jsx(f,{children:"E-Posta"}),e.jsx(f,{children:"Telefon"}),e.jsx(f,{children:"Durum"}),e.jsx(f,{children:"İşlemler"})]})}),e.jsx(J,{children:Y.map(s=>e.jsxs(L,{children:[e.jsx(p,{children:s.unvan||"Bilinmiyor"}),e.jsx(p,{children:s.vergiNumrasi||"Yok"}),e.jsx(p,{children:s.email||"Yok"}),e.jsx(p,{children:s.telefon||"Yok"}),e.jsx(p,{children:V===s.id?e.jsx("span",{style:{color:"green",fontWeight:"bold"},children:"Seçili"}):e.jsx("span",{children:"-"})}),e.jsx(p,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{color:"info",size:"sm",onClick:()=>{ve(s),b(!1)},style:{color:"white"},disabled:m,children:e.jsx(Q,{icon:Ne})}),e.jsx(h,{color:"danger",size:"sm",onClick:()=>{F(s),A(!0),b(!1)},style:{color:"white"},disabled:m,children:e.jsx(Q,{icon:Me})}),e.jsx(h,{color:"success",size:"sm",onClick:()=>be(s),style:{color:"white"},disabled:m,children:"Seç"})]})})]},s.id))})]})]}),e.jsx(I,{children:e.jsx(h,{color:"secondary",onClick:()=>b(!1),children:"Kapat"})})]}),e.jsxs(w,{visible:le,onClose:()=>T(!1),size:"lg",children:[e.jsx(S,{children:e.jsx(N,{children:"Yeni EDM Bilgisi Ekle"})}),e.jsx(M,{children:e.jsxs(X,{children:[e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Ünvan"}),e.jsx(d,{name:"unvan",value:i.unvan,onChange:a,required:!0})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Vergi Dairesi"}),e.jsx(d,{name:"vergiDairesi",value:i.vergiDairesi,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Vergi Numarası"}),e.jsx(d,{name:"vergiNumrasi",value:i.vergiNumrasi,onChange:a,required:!0})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Adres"}),e.jsx(Z,{name:"adres",value:i.adres,onChange:a,rows:"4"})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"İl"}),e.jsx(d,{name:"il",value:i.il,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"İlçe"}),e.jsx(d,{name:"ilce",value:i.ilce,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Posta Kodu"}),e.jsx(d,{name:"postaKodu",value:i.postaKodu,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"E-Posta"}),e.jsx(d,{type:"email",name:"email",value:i.email,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Telefon"}),e.jsx(d,{type:"tel",name:"telefon",value:i.telefon,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Kullanıcı Adı"}),e.jsx(d,{name:"kullaniciAdi",value:i.kullaniciAdi,onChange:a})]})]}),e.jsx(j,{className:"mb-3",children:e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Şifre"}),e.jsx(d,{type:"password",name:"sifre",value:i.sifre,onChange:a})]})})]})}),e.jsxs(I,{children:[e.jsx(h,{color:"secondary",onClick:()=>T(!1),children:"İptal"}),e.jsx(h,{color:"primary",onClick:ge,disabled:m||!i.unvan||!i.vergiNumrasi,children:"Kaydet"})]})]}),e.jsxs(w,{visible:ae,onClose:()=>B(!1),size:"lg",children:[e.jsx(S,{children:e.jsx(N,{children:"EDM Bilgisini Güncelle"})}),e.jsx(M,{children:e.jsxs(X,{children:[e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Ünvan"}),e.jsx(d,{name:"unvan",value:i.unvan,onChange:a,required:!0})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Vergi Dairesi"}),e.jsx(d,{name:"vergiDairesi",value:i.vergiDairesi,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Vergi Numarası"}),e.jsx(d,{name:"vergiNumrasi",value:i.vergiNumrasi,onChange:a,required:!0})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Adres"}),e.jsx(Z,{name:"adres",value:i.adres,onChange:a,rows:"4"})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"İl"}),e.jsx(d,{name:"il",value:i.il,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"İlçe"}),e.jsx(d,{name:"ilce",value:i.ilce,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Posta Kodu"}),e.jsx(d,{name:"postaKodu",value:i.postaKodu,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"E-Posta"}),e.jsx(d,{type:"email",name:"email",value:i.email,onChange:a})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Telefon"}),e.jsx(d,{type:"tel",name:"telefon",value:i.telefon,onChange:a})]}),e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Kullanıcı Adı"}),e.jsx(d,{name:"kullaniciAdi",value:i.kullaniciAdi,onChange:a})]})]}),e.jsx(j,{className:"mb-3",children:e.jsxs(r,{md:6,children:[e.jsx(n,{children:"Şifre"}),e.jsx(d,{type:"password",name:"sifre",value:i.sifre,onChange:a})]})})]})}),e.jsxs(I,{children:[e.jsx(h,{color:"secondary",onClick:()=>B(!1),children:"İptal"}),e.jsx(h,{color:"primary",onClick:fe,disabled:m||!i.unvan||!i.vergiNumrasi,children:"Güncelle"})]})]}),e.jsxs(w,{visible:re,onClose:()=>A(!1),children:[e.jsx(S,{children:e.jsx(N,{children:"EDM Bilgisini Sil"})}),e.jsx(M,{children:e.jsxs("p",{children:[y==null?void 0:y.unvan," adlı EDM bilgisini silmek istediğinizden emin misiniz?"]})}),e.jsxs(I,{children:[e.jsx(h,{color:"secondary",onClick:()=>A(!1),children:"İptal"}),e.jsx(h,{color:"danger",onClick:pe,disabled:m,children:"Sil"})]})]}),e.jsxs(w,{visible:ce,onClose:()=>z(!1),size:"xl",children:[e.jsx(S,{children:e.jsxs(N,{children:["Fatura Görüntüle - ",q]})}),e.jsx(M,{style:{backgroundColor:"white",color:"black"},children:e.jsx("div",{id:"invoice-html",dangerouslySetInnerHTML:{__html:te},style:{backgroundColor:"white",color:"black",padding:"20px",border:"1px solid #ddd"}})}),e.jsxs(I,{children:[e.jsx(h,{color:"secondary",onClick:()=>z(!1),children:"Kapat"}),e.jsx(h,{color:"info",onClick:xe,disabled:m,children:"Yazdır"}),e.jsx(h,{color:"success",onClick:je,disabled:m,children:"PDF İndir"})]})]})]})};export{He as default};
