import{r as o,j as r,N as E,Q as A,S as N,T,i as K,aq as G,q as x,W as z,ar as w,as as O,at as R,au as U,t as Y}from"./index-DtN76qeb.js";const $="https://speedsofttest.com/api",H=({visible:b,onClose:C,onSubmit:j,customer:i,addToast:m})=>{const[a,v]=o.useState({id:0,unvani:"",fotograf:null,vergiDairesi:"",vergiNumarasi:"",vergiMuaf:!1,iban:"",paraBirimi:"TRY",riskLimiti:0,vade:0,iskonto:0,acilisBakiye:0,yetkiliKisi:"",email:"",adres:"",telefon:"",telefon2:"",diger:"",musteriSiniflandirmaId:0,kodu:"",aciklama:""}),[y,B]=o.useState("identity"),[c,F]=o.useState(!1),[u,d]=o.useState({}),[h]=o.useState({id:1002,aktiflikDurumu:1,durumu:1,yetkiId:1,kullaniciAdi:"gizem"});o.useEffect(()=>{console.log("Gelen customer prop'u:",i),i&&v({id:i.id||0,unvani:i.name||i.unvani||"",fotograf:i.fotograf||null,vergiDairesi:i.taxOffice||i.vergiDairesi||"",vergiNumarasi:i.taxOrIdNumber||i.vergiNumarasi||"",vergiMuaf:i.isTaxExempt||i.vergiMuaf||!1,iban:i.bankInfo||i.iban||"",paraBirimi:i.currency||i.paraBirimi||"TRY",riskLimiti:i.riskLimit||i.riskLimiti||0,vade:i.dueDate||i.vade||0,iskonto:i.iskonto||0,acilisBakiye:i.openBalance||i.acilisBakiye||0,yetkiliKisi:i.contactPerson||i.yetkiliKisi||"",email:i.email||"",adres:i.address||i.adres||"",telefon:i.phone||i.telefon||"",telefon2:i.phone2||i.telefon2||"",diger:i.otherContact||i.diger||"",musteriSiniflandirmaId:i.musteriSiniflandirmaId||0,kodu:i.accountingCode||i.kodu||"",aciklama:i.note||i.aciklama||""})},[i]),o.useEffect(()=>{console.log("Giriş yapan kullanıcı bilgileri:",h)},[h]);const p=e=>{const{name:t,value:l,type:g,checked:k}=e.target;v(n=>({...n,[t]:g==="checkbox"?k:l})),d(n=>({...n,[t]:""}))},M=e=>{const t=e.target.files[0];t&&v(l=>({...l,fotograf:t}))},D=()=>{var t,l;const e={};return(t=a.unvani)!=null&&t.trim()||(e.unvani="Müşteri unvanı zorunlu"),(l=a.email)!=null&&l.trim()||(e.email="E-posta zorunlu"),d(e),Object.keys(e).length===0},S=async e=>{var t,l,g,k;if(e.preventDefault(),!D()){m("Lütfen zorunlu alanları doldurun.","error");return}try{F(!0);const n={id:a.id,unvani:a.unvani,fotograf:a.fotograf,vergiDairesi:a.vergiDairesi,vergiNumarasi:a.vergiNumarasi,vergiMuaf:a.vergiMuaf?1:0,iban:a.iban,paraBirimi:a.paraBirimi,riskLimiti:parseFloat(a.riskLimiti)||0,vade:parseInt(a.vade)||0,iskonto:parseFloat(a.iskonto)||0,acilisBakiye:parseFloat(a.acilisBakiye)||0,yetkiliKisi:a.yetkiliKisi,email:a.email,adres:a.adres,telefon:a.telefon,telefon2:a.telefon2,diger:a.diger,musteriSiniflandirmaId:parseInt(a.musteriSiniflandirmaId)||0,kodu:a.kodu,aciklama:a.aciklama,durumu:1,aktif:1},f=new FormData;if(n)for(const s in n)s==="fotograf"&&n[s]?f.append(s,n[s]):f.append(s,n[s]===null?"":n[s]);f.append("kullaniciId",h.id),console.log("Gönderilen FormData içeriği:");for(let[s,L]of f.entries())console.log(`${s}: ${L}`);await Y.put(`${$}/musteri/musteri-update`,f,{headers:{"Content-Type":"multipart/form-data"}}),j({id:a.id,...n}),m("Müşteri başarıyla güncellendi.","success")}catch(n){console.error("Müşteri Güncelleme Hatası:",{message:n.message,status:(t=n.response)==null?void 0:t.status,data:(l=n.response)==null?void 0:l.data}),m(((k=(g=n.response)==null?void 0:g.data)==null?void 0:k.message)||"Müşteri güncellenemedi. Lütfen veri formatını kontrol edin.","error")}finally{F(!1)}},I=()=>{switch(y){case"identity":return r.jsx(U,{formData:a,handleChange:p,handleImageUpload:M,errors:u,setErrors:d});case"financial":return r.jsx(R,{formData:a,handleChange:p,errors:u,setErrors:d});case"contact":return r.jsx(O,{formData:a,handleChange:p,errors:u});case"other":return r.jsx(w,{formData:a,handleChange:p,errors:u,setErrors:d});default:return null}};return r.jsxs(E,{visible:b,onClose:C,backdrop:"static",size:"lg",children:[r.jsx(A,{style:{backgroundColor:"#2965A8",color:"#fff"},children:r.jsx(N,{children:"Müşteri Bilgilerini Güncelle"})}),r.jsxs(T,{children:[c&&r.jsx("p",{children:"Yükleniyor..."}),r.jsxs(K,{id:"customerUpdateForm",onSubmit:S,children:[r.jsx(G,{role:"group",className:"mb-3",children:["identity","financial","contact","other"].map(e=>r.jsx(x,{style:{backgroundColor:y===e?"#FFFFFF":"#2965A8",color:y===e?"#2965A8":"#FFFFFF",border:"1px solid #2965A8"},onClick:()=>B(e),disabled:c,children:e==="identity"?"Kimlik Bilgileri":e==="financial"?"Cari":e==="contact"?"İletişim":"Diğer"},e))}),I()]})]}),r.jsxs(z,{children:[r.jsx(x,{type:"submit",form:"customerUpdateForm",color:"primary",disabled:c,children:"Kaydet"}),r.jsx(x,{color:"secondary",onClick:C,disabled:c,children:"İptal"})]})]})};export{H as C};
