import{r as i,j as s,f as w,g as C,h as k,m as b,n as B,u as I,ad as R,A as D,C as W,q as j,M as $,s as F,e as H,N as A,Q as L,S as O,T as Y,W as P,a as U,b as _,c as G}from"./index-DAwD_DDx.js";import{c as q}from"./cil-reload-6LI_qKMh.js";const K="https://speedsofttest.com",E="/default-profile.png",Q=e=>{const d=Date.now();if(!e||typeof e!="string"||e==="null")return E;if(e.startsWith("https"))return`${e}?t=${d}`;const t=e.startsWith("/")?e:`/${e}`;return`${K}${t}?t=${d}`},J=({employee:e,onClick:d})=>{const[t,h]=i.useState(!1),[x,l]=i.useState(!1);if(i.useEffect(()=>{h(!1),l(!1)},[e.fotograf]),!(e!=null&&e.id))return console.error("EmployeeCard - Geçersiz çalışan verisi:",e),null;const m=Q(e.fotograf);return s.jsx(w,{xs:12,sm:6,md:4,lg:3,className:"mb-3",children:s.jsx(C,{className:"h-100 shadow-sm",style:{cursor:"pointer",transition:"background-color 0.2s, transform 0.2s",minWidth:"250px"},onClick:d,onMouseEnter:n=>{n.currentTarget.style.backgroundColor="#f8f9fa",n.currentTarget.style.transform="scale(1.02)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="white",n.currentTarget.style.transform="scale(1)"},children:s.jsxs(k,{className:"d-flex align-items-center",children:[s.jsxs("div",{style:{width:"70px",height:"70px",borderRadius:"50%",overflow:"hidden",marginRight:"20px",backgroundColor:"#e9ecef",display:"flex",alignItems:"center",justifyContent:"center"},children:[!t&&s.jsx("div",{style:{fontSize:"12px"},children:"Yükleniyor..."}),s.jsx("img",{src:x?E:m,alt:"Çalışan Fotoğrafı",style:{width:"100%",height:"100%",objectFit:"cover",display:t?"block":"none",opacity:t?1:0,transition:"opacity 0.3s"},onLoad:()=>h(!0),onError:()=>{l(!0),h(!0),console.log("Fotoğraf yüklenemedi, varsayılan kullanıldı:",m)}}),s.jsx(b,{icon:B,size:"xl",style:{display:t&&!x?"none":"block"}})]}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[" ",s.jsx("h6",{className:"mb-0 text-break",children:(e==null?void 0:e.adiSoyadi)||"-"})," ",s.jsx("p",{className:"mb-0 text-muted text-break",children:(e==null?void 0:e.email)||"-"})," "]})]})})})},Z=()=>{const[e,d]=i.useState([]),t=i.useRef(),h=I(),{employees:x,fetchEmployees:l,loading:m,error:n,deleteEmployee:N}=R(),{user:u}=D(),[v,f]=i.useState(!1),[o,y]=i.useState(null),g=(a,c="success")=>{const r=Date.now(),p=s.jsxs(U,{autohide:!0,visible:!0,delay:5e3,className:c==="error"?"bg-danger text-white":"bg-success text-white",children:[s.jsx(_,{closeButton:!0,children:s.jsx("strong",{className:"me-auto",children:c==="error"?"Hata":"Başarılı"})}),s.jsx(G,{children:a})]},r);return d(M=>[...M,p]),r},S=async()=>{var a,c;if(!(o!=null&&o.id)){g("Çalışan ID'si eksik","error"),f(!1);return}try{const r=await N(o.id);g(r.message,r.success?"success":"error"),r.success&&await l()}catch(r){const p=((c=(a=r.response)==null?void 0:a.data)==null?void 0:c.message)||r.message;console.error("Silme hatası:",p),g(`Çalışan silinirken hata oluştu: ${p}`,"error")}finally{f(!1),y(null)}},z=()=>{if((u==null?void 0:u.yetkiId)!==1){g("Yeni çalışan ekleme yetkiniz yok","error");return}h("/app/employee-update",{state:{employee:null}})},T=a=>{if(!a.id){g("Çalışan ID'si bulunamadı","error"),console.error("Employees - Geçersiz çalışan ID:",a);return}h(`/app/employee-detail/${a.id}`,{state:{employee:a}})};return i.useEffect(()=>{l()},[l]),s.jsxs(s.Fragment,{children:[s.jsx(W,{ref:t,placement:"top-end",className:"p-3",children:e.map(a=>a)}),s.jsxs("div",{className:"d-flex gap-2 mb-3",children:[s.jsxs(j,{color:"success",className:"text-light",onClick:z,disabled:(u==null?void 0:u.yetkiId)!==1,children:[s.jsx(b,{icon:$,size:"m"})," Yeni Çalışan Ekle"]}),s.jsxs(j,{color:"primary",className:"text-light",onClick:l,disabled:m,children:[s.jsx(b,{icon:q,size:"m"})," Çalışanları Yenile"]})]}),m&&s.jsx(C,{className:"mb-3",children:s.jsx(k,{children:"Yükleniyor..."})}),n&&s.jsxs(C,{className:"mt-3",children:[s.jsx(F,{children:"Hata"}),s.jsxs(k,{children:[s.jsx("p",{children:n}),s.jsx(j,{color:"primary",onClick:l,children:"Tekrar Dene"})]})]}),s.jsxs(C,{className:"my-3",children:[s.jsx(F,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},size:"xl",children:s.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[s.jsx("span",{children:"Çalışan Kartları"}),s.jsxs("div",{style:{backgroundColor:"#FFFFFF",color:"#2965A8",padding:"5px 10px",borderRadius:"4px",fontWeight:"bold",fontSize:"14px",minWidth:"40px",textAlign:"center"},children:["Toplam Çalışan: ",x.length]})]})}),s.jsxs(k,{children:[s.jsx("p",{children:"Bir çalışana tıklayarak detaylarını görüntüleyebilir veya düzenleyebilirsiniz."}),x.length>0?s.jsx(H,{children:x.map((a,c)=>s.jsx(w,{xs:12,sm:6,md:4,lg:3,children:s.jsx(J,{employee:a,onClick:()=>T(a)})},a.id||c))}):s.jsx("p",{children:"Çalışan bulunamadı."})]})]}),s.jsxs(A,{visible:v,onClose:()=>{f(!1),y(null)},className:"shadow-sm",backdrop:"static",children:[s.jsx(L,{style:{backgroundColor:"#dc3545",color:"#FFFFFF"},children:s.jsx(O,{children:"Silme Onayı"})}),s.jsx(Y,{children:s.jsxs("p",{children:['Çalışan "',s.jsx("strong",{children:(o==null?void 0:o.adiSoyadi)||"Bilinmiyor"}),'" silinecek, emin misiniz? Bu işlem geri alınamaz.']})}),s.jsxs(P,{children:[s.jsx(j,{color:"secondary",onClick:()=>{f(!1),y(null)},children:"İptal"}),s.jsx(j,{color:"danger",onClick:S,className:"text-white",children:"Sil"})]})]})]})};export{Z as default};
