import{r as h,j as t,g as k,s as F,h as j,e as T,f as v,q as x,$ as P,a0 as E,a1 as w,a2 as b,a3 as A,a4 as g,al as L,aA as C,ay as R,az as M}from"./index-DvA_wB1j.js";const p=async(o,c="normal")=>{try{let a,r,d;switch(c){case"bold":a="/fonts/Roboto-Bold.ttf",r="Roboto",d="bold";break;case"italic":a="/fonts/Roboto-Italic.ttf",r="Roboto",d="italic";break;default:a="/fonts/Roboto-Regular.ttf",r="Roboto",d="normal"}console.log(`Attempting to fetch ${a}...`);const s=await fetch(a);if(!s.ok)throw new Error(`Font file could not be loaded: ${s.statusText}`);const y=await s.arrayBuffer(),f=new Uint8Array(y);let m="";for(let i=0;i<f.byteLength;i++)m+=String.fromCharCode(f[i]);const e=btoa(m),l=a.split("/").pop();return console.log(`Registering ${r} ${d} font...`),o.addFileToVFS(l,e),o.addFont(l,r,d),console.log(`${r} ${d} font registered successfully`),!0}catch(a){return console.error("Font loading error:",a),console.warn("Falling back to Times font"),o.setFont("times",c==="bold"?"bold":"normal"),!1}},S=async o=>{try{return await p(o,"normal"),await p(o,"bold"),await p(o,"italic"),o.setFont("Roboto","normal"),!0}catch(c){return console.error("Error registering all fonts:",c),o.setFont("times","normal"),!1}},O="https://speedsofttest.com/api",$=()=>{const[o,c]=h.useState([]),[a,r]=h.useState(!1),[d,s]=h.useState(null);h.useEffect(()=>{(async()=>{r(!0);try{const l=await L.get(`${O}/musteriSatis/satisolmayanmusteri-get-all`,{headers:{"Cache-Control":"no-cache"}});c(l.data),s(null)}catch(l){console.error("API hatası:",l),s("Müşteri verileri yüklenemedi.")}finally{r(!1)}})()},[]);const y=async()=>{if(!o.length){s("PDF oluşturmak için veri yok.");return}r(!0);try{const e=new C({orientation:"landscape",unit:"mm",format:"a4"});await S(e),e.setFontSize(16),e.setFont("Roboto","bold"),e.text("Satış Olmayan Müşteriler Raporu",14,20),e.setFont("Roboto","normal");const l=["Müşteri Ünvanı","Telefon","Adres","Eklenme Tarihi"],i=o.map(u=>[u.unvani||"-",u.telefon||"-",u.adres||"-",u.eklenmeDurumu?new Date(u.eklenmeDurumu).toLocaleDateString("tr-TR"):"-"]);e.autoTable({head:[l],body:i,startY:30,theme:"grid",styles:{font:"Roboto",fontSize:8,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:u=>{e.getFontList().Roboto||e.setFont("times")}});const n=e.output("blob"),D=URL.createObjectURL(n);window.open(D,"_blank")}catch(e){console.error("PDF oluşturma hatası:",e),s("PDF oluşturulamadı! Hata: "+e.message)}finally{r(!1)}},f=async()=>{if(!o.length){s("PDF indirmek için veri yok.");return}r(!0);try{const e=new C({orientation:"landscape",unit:"mm",format:"a4"});await S(e),e.setFontSize(16),e.setFont("Roboto","bold"),e.text("Satış Olmayan Müşteriler Raporu",14,20),e.setFont("Roboto","normal");const l=["Müşteri Ünvanı","Telefon","Adres","Eklenme Tarihi"],i=o.map(n=>[n.unvani||"-",n.telefon||"-",n.adres||"-",n.eklenmeDurumu?new Date(n.eklenmeDurumu).toLocaleDateString("tr-TR"):"-"]);e.autoTable({head:[l],body:i,startY:30,theme:"grid",styles:{font:"Roboto",fontSize:8,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:n=>{e.getFontList().Roboto||e.setFont("times")}}),e.save(`SatışOlmayanMüşterilerRaporu_${new Date().toISOString().slice(0,10)}.pdf`)}catch(e){console.error("PDF indirme hatası:",e),s("PDF indirilemedi! Hata: "+e.message)}finally{r(!1)}},m=()=>{if(!o.length){s("Excel oluşturmak için veri yok.");return}const e=[["Müşteri Ünvanı","Telefon","Adres","Eklenme Tarihi"],...o.map(n=>[n.unvani||"-",n.telefon||"-",n.adres||"-",n.eklenmeDurumu?new Date(n.eklenmeDurumu).toLocaleDateString("tr-TR"):"-"])],l=R.aoa_to_sheet(e),i=R.book_new();R.book_append_sheet(i,l,"Satış Olmayan Müşteriler"),M(i,`SatışOlmayanMüşterilerRaporu_${new Date().toISOString().slice(0,10)}.xlsx`)};return t.jsxs(k,{children:[t.jsx(F,{style:{backgroundColor:"#2965A8",color:"#fff"},children:"Satış Olmayan Müşteriler"}),t.jsxs(j,{children:[t.jsx(T,{className:"mb-3",children:t.jsxs(v,{className:"d-flex justify-content-start gap-3",children:[t.jsx(x,{color:"info",onClick:y,disabled:a,children:a?"Yükleniyor...":"Raporla"}),t.jsx(x,{color:"success",onClick:f,disabled:a,children:"PDF İndir"}),t.jsx(x,{color:"warning",onClick:m,disabled:a,children:"Excel İndir"})]})}),a?t.jsx("p",{children:"Yükleniyor..."}):d?t.jsx("p",{style:{color:"red"},children:d}):o.length===0?t.jsx("p",{children:"Satış olmayan müşteri bulunamadı."}):t.jsxs(P,{striped:!0,hover:!0,children:[t.jsx(E,{children:t.jsxs(w,{children:[t.jsx(b,{children:"Müşteri Ünvanı"}),t.jsx(b,{children:"Telefon"}),t.jsx(b,{children:"Adres"}),t.jsx(b,{children:"Eklenme Tarihi"})]})}),t.jsx(A,{children:o.map(e=>t.jsxs(w,{children:[t.jsx(g,{children:e.unvani||"-"}),t.jsx(g,{children:e.telefon||"-"}),t.jsx(g,{children:e.adres||"-"}),t.jsx(g,{children:e.eklenmeDurumu?new Date(e.eklenmeDurumu).toLocaleDateString("tr-TR"):"-"})]},e.id))})]})]})]})};export{$ as default};
