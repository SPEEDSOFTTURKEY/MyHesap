import{r as t,j as e,$ as me,a0 as xe,a1 as W,a2 as p,a3 as fe,a4 as y,q as u,m as g,a5 as pe,a6 as ye,N as K,Q as V,S as J,T as Q,W as X,am as Z,t as w,u as je,C as ge,e as be,f as Ce,M as ke,g as Se,s as we,an as G,V as ve,o as q,h as Me,ao as Te,a as Be,b as Ee,c as Fe}from"./index-DvA_wB1j.js";import{C as ee}from"./CustomerModal-CMzspKBE.js";import{c as H}from"./cil-cloud-upload-Ca9_6_ej.js";const Ne="https://speedsofttest.com/api",Ae=({customers:A,onCustomerClick:D,fetchCustomers:v})=>{const[M,h]=t.useState(!1),[T,c]=t.useState(!1),[B,b]=t.useState(null),[E,m]=t.useState(null),[x,C]=t.useState(!1),[k,F]=t.useState(null);t.useEffect(()=>{const l=localStorage.getItem("user");if(l){const o=JSON.parse(l);F(o),console.log("Giriş yapan kullanıcı bilgileri:",o)}},[]);const f=(l,o="success")=>{alert(l)},I=async()=>{var l,o;if(!k||!k.id){f("Kullanıcı bilgileri bulunamadı.","error");return}try{C(!0),await w.delete(`${Ne}/musteri/musteri-delete/${B}?kullaniciId=${k.id}`),v(),h(!1),f("Müşteri başarıyla silindi.","success")}catch(S){console.error("Silme Hatası:",S),f(((o=(l=S.response)==null?void 0:l.data)==null?void 0:o.message)||"Müşteri silinemedi.","error")}finally{C(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(me,{responsive:!0,hover:!0,children:[e.jsx(xe,{children:e.jsxs(W,{children:[e.jsx(p,{children:"Adı"}),e.jsx(p,{children:"Telefon"}),e.jsx(p,{children:"E-Posta"}),e.jsx(p,{children:"Açık Bakiye"}),e.jsx(p,{children:"Sınıflandırma"}),e.jsx(p,{children:"İşlem"})]})}),e.jsx(fe,{children:A.map(l=>e.jsxs(W,{onClick:()=>D(l),className:"customer-table-row",style:{cursor:"pointer"},children:[e.jsx(y,{children:l.name}),e.jsx(y,{children:l.phone||"Yok"}),e.jsx(y,{children:l.email||"Yok"}),e.jsxs(y,{children:[(l.openBalance||0).toLocaleString("tr-TR")," TRY"]}),e.jsx(y,{children:l.classification}),e.jsxs(y,{children:[e.jsx(u,{color:"info",size:"sm",style:{color:"white",marginRight:"5px"},onClick:o=>{o.stopPropagation(),m(l),c(!0)},children:e.jsx(g,{icon:pe})}),e.jsx(u,{color:"danger",size:"sm",style:{color:"white"},onClick:o=>{o.stopPropagation(),b(l.id),h(!0)},children:e.jsx(g,{icon:ye})})]})]},l.id))})]}),e.jsxs(K,{visible:M,onClose:()=>h(!1),children:[e.jsx(V,{style:{backgroundColor:"#DC3545",color:"white"},children:e.jsx(J,{children:"Müşteriyi Sil"})}),e.jsx(Q,{children:"Silinmesini istediğinizden emin misiniz?"}),e.jsxs(X,{children:[e.jsx(u,{color:"danger",style:{color:"white"},onClick:I,disabled:x,children:x?"Siliniyor...":"Sil"}),e.jsx(u,{color:"secondary",onClick:()=>h(!1),disabled:x,children:"İptal"})]})]}),e.jsx(Z,{children:e.jsx(ee,{visible:T,onClose:()=>c(!1),onSubmit:l=>{v(l.id),c(!1)},customer:E,addToast:f})})]})},j="https://speedsofttest.com/api",Re=()=>{const[A,D]=t.useState([]),[v,M]=t.useState([]),[h,T]=t.useState([]),[c,B]=t.useState(!1),[b,E]=t.useState(null),[m,x]=t.useState(!0),[C,k]=t.useState("all"),[F,f]=t.useState(""),[I,l]=t.useState(!1),[o,S]=t.useState(null),[L,P]=t.useState(!1),[se,R]=t.useState(!1),[ae,U]=t.useState(null),le=t.useRef(),Y=je(),[te]=t.useState({id:1002,aktiflikDurumu:1,durumu:1,yetkiId:1,kullaniciAdi:"gizem"}),d=(s,i="success")=>{const a=e.jsxs(Be,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Ee,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:i==="error"?"Hata":"Başarılı"})}),e.jsx(Fe,{children:s})]},Date.now());D(n=>[...n,a])},O=async(s,i)=>{var a,n;try{const{data:r}=await w.get(s);return i(Array.isArray(r)?r:[r]),r}catch(r){return d(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Veriler yüklenemedi.","error"),null}},ie=async s=>{let i="Bilinmiyor";try{if(s.musteriSiniflandirmaId){const a=h.find(n=>n.id===s.musteriSiniflandirmaId);if(a)i=a.adi;else{const n=await O(`${j}/musteriSiniflandirma/get-by-id/${s.musteriSiniflandirmaId}`,T);i=n&&n.length>0?n[0].adi:"Bilinmiyor"}}}catch(a){console.error("Dönüşüm Hatası:",a),i="Bilinmiyor"}return{id:s.id,name:s.unvani||"Bilinmiyor",openBalance:s.acilisBakiye||0,chequeBondBalance:0,phone:s.telefon||"",phone2:s.telefon2||"",classification:i,email:s.email||"",address:s.adres||"",taxOffice:s.vergiDairesi||"",taxOrIdNumber:s.vergiNumarasi||"",accountingCode:s.kodu||"",note:s.aciklama||"",currency:s.paraBirimi||"TRY",riskLimit:s.riskLimiti||0,dueDate:s.vade||"",isTaxExempt:s.vergiMuaf||!1,bankInfo:s.iban||s.bankaBilgileri||"",contactPerson:s.yetkiliKisi||"",otherContact:s.diger||"",image:s.fotograf||"",branches:s.subeler||[],musteriSiniflandirmaId:s.musteriSiniflandirmaId||0}},$=async(s=null)=>{var i,a;B(!0);try{await O(`${j}/musteriSiniflandirma/get-all`,T);const n=m?`${j}/musteri/musteri-get-all`:`${j}/musteri/musteri-get-allaktif`,{data:r}=await w.get(n),N=await Promise.all(r.map(ie));if(M(N),E(null),s){const z=N.find(he=>he.id===s);z&&(console.log("Seçilen müşteri:",z),U(z),R(!0))}}catch(n){E(((a=(i=n.response)==null?void 0:i.data)==null?void 0:a.message)||"Müşteriler yüklenemedi."),d("Müşteriler yüklenemedi.","error")}finally{B(!1)}},ne=s=>{Y(`/app/customer-detail/${s.id}`,{state:{customer:s}})},re=()=>{Y("/app/customer-new")},oe=()=>{l(!0)},ce=async()=>{var s,i;try{const a=await w.get(`${j}/musteri/download-template`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=n,r.setAttribute("download","musteri_sablonu.xlsx"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n),d("Excel şablonu başarıyla indirildi.","success")}catch(a){d(((i=(s=a.response)==null?void 0:s.data)==null?void 0:i.message)||"Excel şablonu indirilemedi.","error")}},de=s=>{S(s.target.files[0])},ue=async()=>{var s,i;if(!o){d("Lütfen bir Excel dosyası seçin.","error");return}P(!0);try{const a=new FormData;a.append("file",o),a.append("kullaniciId",te.id),console.log("Gönderilen FormData içeriği:");for(let[r,N]of a.entries())console.log(`${r}: ${N}`);const n=await w.post(`${j}/musteri/upload-excel`,a,{headers:{"Content-Type":"multipart/form-data",accept:"*/*"}});await $(),d("Excel dosyası başarıyla yüklendi.","success"),l(!1),S(null)}catch(a){d(((i=(s=a.response)==null?void 0:s.data)==null?void 0:i.message)||"Excel dosyası yüklenemedi.","error")}finally{P(!1)}};t.useEffect(()=>{$()},[m]);const _=v.filter(s=>s.name.toLowerCase().includes(F.toLowerCase())).filter(s=>C==="balance"?s.openBalance>0:!0);return e.jsxs(Z,{children:[e.jsx(ge,{ref:le,placement:"top-end",className:"p-3",children:A}),e.jsxs(be,{className:"mb-3",children:[e.jsxs(Ce,{children:[e.jsxs(u,{color:"success",style:{color:"white"},onClick:re,children:[e.jsx(g,{icon:ke})," Yeni Müşteri Ekle"]}),e.jsxs(u,{color:"primary",style:{color:"white"},onClick:oe,className:"ms-2",children:[e.jsx(g,{icon:H})," Excel'den Müşteri Yükle"]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",color:"#2965A8",padding:"5px 8px",borderRadius:"4px",fontWeight:"bold",fontSize:"14px",maxWidth:"200px",textAlign:"center",margin:"10px 15px 0 0"},children:["Toplam Müşteri: ",_.length]})]}),e.jsxs(Se,{className:"my-3",children:[e.jsx(we,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsxs("div",{className:"d-flex flex-row justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-2",children:e.jsx(G,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterAll",autoComplete:"off",label:"Tüm Müşteriler",checked:m,onChange:()=>x(!0)})}),e.jsx("div",{children:e.jsx(G,{type:"radio",button:{color:"light",variant:"outline"},name:"statusFilter",id:"filterActive",autoComplete:"off",label:"Aktif Müşteriler",checked:!m,onChange:()=>x(!1)})})]}),e.jsx("div",{className:"d-flex flex-row",children:e.jsxs(ve,{value:C,onChange:s=>k(s.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"all",children:"Hepsini Göster"}),e.jsx("option",{value:"balance",children:"Bakiyesi Olanlar"})]})}),e.jsx(q,{type:"text",placeholder:"Müşteri ara...",value:F,onChange:s=>f(s.target.value),style:{width:"200px"}})]})}),e.jsxs(Me,{children:[c&&e.jsx("p",{children:"Yükleniyor..."}),b&&e.jsx("p",{className:"text-danger",children:b}),!c&&!b&&e.jsx(Ae,{customers:_,onCustomerClick:ne,fetchCustomers:$})]})]}),e.jsxs(K,{size:"lg",visible:I,backdrop:"static",keyboard:!1,onClose:()=>l(!1),children:[e.jsx(V,{children:e.jsx(J,{children:"Excel ile Müşteri Yükleme"})}),e.jsxs(Q,{children:[e.jsxs(u,{color:"primary",style:{color:"white"},onClick:ce,disabled:c,children:[e.jsx(g,{icon:H})," Excel Şablonu İndir"]}),e.jsx("p",{className:"mt-3",children:"Müşterilerinizi tek tek tanımlamak yerine, Excel şablonunu indirin ve doldurun."}),e.jsx(q,{type:"file",accept:".xlsx,.xls",onChange:de,className:"mb-3"}),e.jsx(u,{color:"success",style:{color:"white"},onClick:ue,disabled:L||c,children:L?e.jsx(Te,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:H})," Excel Şablonu Yükle"]})})]}),e.jsx(X,{children:e.jsx(u,{color:"secondary",onClick:()=>l(!1),disabled:L||c,children:"İptal"})})]}),e.jsx(ee,{visible:se,onClose:()=>{R(!1),U(null)},onSubmit:s=>{M(i=>i.map(a=>a.id===s.id?{...a,...s}:a)),d("Müşteri güncellendi.","success"),R(!1),U(null)},customer:ae,addToast:d})]})};export{Re as default};
