import{r as k,Z as l,j as a,g as ea,s as ra,h as sa,e as ta,f as P,U as A,V as U,o as z,q as E,$ as na,a0 as oa,a1 as O,a2 as c,an as K,a3 as la,a4 as d,al as ia,aA as W,ay as V,az as ca}from"./index-DvA_wB1j.js";const da="https://speedsofttest.com/api",C=ia.create({baseURL:da}),u=e=>!e&&e!==0?"-":`${e.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")} TL`,_=async(e,R="normal")=>{try{let j,Y,b;switch(R){case"bold":j="/fonts/Roboto-Bold.ttf",Y="Roboto",b="bold";break;case"italic":j="/fonts/Roboto-Italic.ttf",Y="Roboto",b="italic";break;default:j="/fonts/Roboto-Regular.ttf",Y="Roboto",b="normal"}console.log(`Attempting to fetch ${j}...`);const w=await fetch(j);if(!w.ok)throw new Error(`Font file could not be loaded: ${w.statusText}`);const v=await w.arrayBuffer(),B=new Uint8Array(v);let h="";for(let g=0;g<B.byteLength;g++)h+=String.fromCharCode(B[g]);const S=btoa(h),p=j.split("/").pop();return console.log(`Registering ${Y} ${b} font...`),e.addFileToVFS(p,S),e.addFont(p,Y,b),console.log(`${Y} ${b} font registered successfully`),!0}catch(j){return console.error("Font loading error:",j),console.warn("Falling back to Times font"),e.setFont("times",R==="bold"?"bold":"normal"),!1}},G=async e=>{try{return await _(e,"normal"),await _(e,"bold"),await _(e,"italic"),e.setFont("Roboto","normal"),!0}catch(R){return console.error("Error registering all fonts:",R),e.setFont("times","normal"),!1}},ha=()=>{const[e,R]=k.useState({transactionType:"",dateRangeStart:l(),dateRangeEnd:l(),documentStatus:"",customer:"",supplier:"",warehouse:""}),[j,Y]=k.useState([]),[b,w]=k.useState([]),[v,B]=k.useState([]),[h,S]=k.useState([]),[p,g]=k.useState([]),[L,q]=k.useState(""),[N,y]=k.useState(!1);k.useEffect(()=>{(async()=>{y(!0);try{const[t,i,o]=await Promise.all([C.get("/depo/get-all",{headers:{"Cache-Control":"no-cache"}}),C.get("/musteri/musteri-get-all",{headers:{"Cache-Control":"no-cache"}}),C.get("/tedarikci/tedarikci-get-all",{headers:{"Cache-Control":"no-cache"}})]);Y(t.data),w(i.data),B(o.data)}catch(t){console.error("API hatası:",t),alert("Veriler yüklenemedi!")}finally{y(!1)}})()},[]),k.useEffect(()=>{(async()=>{if(!e.transactionType||e.transactionType==="purchases"&&!e.supplier){S([]),g([]);return}y(!0);try{let t;if(e.transactionType==="purchases"){const o=v.find(r=>r.unvan===e.supplier);if(!o){alert("Seçilen tedarikçi bulunamadı!"),S([]),g([]),y(!1);return}t=await C.get(`/alis/alis-get-by-tedarikci-id/${o.id}`,{headers:{"Cache-Control":"no-cache"}})}else if(e.customer){const o=b.find(r=>r.unvani===e.customer);if(!o){alert("Seçilen müşteri bulunamadı!"),S([]),g([]),y(!1);return}t=await C.get(`/musteriSatis/musteriSatis-get-by-musteri/${o.id}`,{headers:{"Cache-Control":"no-cache"}})}else t=await C.get("/musteriSatis/musteriSatis-get-all",{headers:{"Cache-Control":"no-cache"}});const i=t.data.filter(o=>{var f,M;const r=l(o.tarih||o.eklenmeTarihi),m=l(e.dateRangeStart).startOf("day"),n=l(e.dateRangeEnd).endOf("day"),x=!e.documentStatus||o.durumu.toString()===e.documentStatus,T=!e.warehouse||((f=o.depo)==null?void 0:f.adi)===e.warehouse,D=e.transactionType==="sales"?!e.customer||((M=o.musteris)==null?void 0:M.unvani)===e.customer:!0;return r.isAfter(m.subtract(1,"day"))&&r.isBefore(n.add(1,"day"))&&x&&T&&D});S(i),g([])}catch(t){console.error("API hatası:",t),alert("Veriler yüklenemedi!"),S([]),g([])}finally{y(!1)}})()},[e.transactionType,e.supplier,e.customer,e.dateRangeStart,e.dateRangeEnd,e.documentStatus,e.warehouse,v,b]);const $=s=>{const{name:t,value:i}=s.target;R(o=>({...o,[t]:i}))},I=(s,t)=>{R(i=>({...i,[s]:t}))},J=s=>{g(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},Z=()=>{g(F.length===p.length?[]:F.map(s=>s.id))},Q=async()=>{if(h.length===0){alert("Rapor için veri bulunamadı!");return}const s=p.length>0?h.filter(t=>p.includes(t.id)):h;if(s.length===0){alert("Lütfen en az bir satır seçiniz!");return}y(!0);try{console.log("Starting PDF generation...");const t=new W({orientation:"landscape",unit:"mm",format:"a4"});await G(t),t.setFontSize(18),t.setFont("Roboto","bold"),t.text(e.transactionType==="sales"?"Ürün Satış Raporu":"Ürün Alış Raporu",t.internal.pageSize.getWidth()/2,15,{align:"center"}),t.setFont("Roboto","normal");const i=e.transactionType==="purchases"?[["ID","Ürün","Barkod","Tarih","Tedarikçi","Miktar","Birim Fiyat","İndirim (%)","Toplam","KDV (%)","Para Birimi","Belge No","Vade Tarih","Depo"]]:[["ID","Ürün","Barkod","Tarih","Müşteri","Miktar","Birim Fiyat","Toplam"]],o=s.map((n,x)=>{var T,D,f,M,H;return e.transactionType==="purchases"?[x+1,((T=n.urun)==null?void 0:T.adi)||"-",((D=n.urun)==null?void 0:D.barkod)||"-",l(n.tarih||n.eklenmeTarihi).format("DD/MM/YYYY"),((f=n.tedarikci)==null?void 0:f.unvan)||"-",n.miktar||0,u(n.fiyat),n.indirim||0,u(n.toplam),n.kDV||0,n.paraBirimi||"TRY",n.belgeNo||"-",n.vadeTarih?l(n.vadeTarih).format("DD/MM/YYYY"):"-",((M=n.depo)==null?void 0:M.adi)||"-"]:[x+1,n.urunAdi||"-",n.barkod||"-",l(n.eklenmeTarihi).format("DD/MM/YYYY"),((H=n.musteris)==null?void 0:H.unvani)||"-",n.miktar||0,u(n.fiyat),u(n.toplamFiyat)]});console.log("Generating autoTable..."),t.autoTable({startY:25,head:i,body:o,theme:"grid",styles:{font:"Roboto",fontSize:9,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:n=>{t.getFontList().Roboto||t.setFont("times")}}),console.log("Table generated, opening in new tab...");const r=t.output("blob"),m=URL.createObjectURL(r);window.open(m,"_blank"),console.log("PDF opened in new tab successfully")}catch(t){console.error("PDF creation error:",t),alert("PDF oluşturulamadı! Hata: "+t.message)}finally{y(!1)}},X=async()=>{if(h.length===0){alert("Rapor için veri bulunamadı!");return}const s=p.length>0?h.filter(t=>p.includes(t.id)):h;if(s.length===0){alert("Lütfen en az bir satır seçiniz!");return}y(!0);try{const t=new W({orientation:"landscape",unit:"mm",format:"a4"});await G(t),t.setFontSize(18),t.setFont("Roboto","bold"),t.text(e.transactionType==="sales"?"Ürün Satış Raporu":"Ürün Alış Raporu",t.internal.pageSize.getWidth()/2,15,{align:"center"}),t.setFont("Roboto","normal");const i=e.transactionType==="purchases"?[["ID","Ürün","Barkod","Tarih","Tedarikçi","Miktar","Birim Fiyat","İndirim (%)","Toplam","KDV (%)","Para Birimi","Belge No","Vade Tarih","Depo"]]:[["ID","Ürün","Barkod","Tarih","Müşteri","Miktar","Birim Fiyat","Toplam"]],o=s.map((r,m)=>{var n,x,T,D,f;return e.transactionType==="purchases"?[m+1,((n=r.urun)==null?void 0:n.adi)||"-",((x=r.urun)==null?void 0:x.barkod)||"-",l(r.tarih||r.eklenmeTarihi).format("DD/MM/YYYY"),((T=r.tedarikci)==null?void 0:T.unvan)||"-",r.miktar||0,u(r.fiyat),r.indirim||0,u(r.toplam),r.kDV||0,r.paraBirimi||"TRY",r.belgeNo||"-",r.vadeTarih?l(r.vadeTarih).format("DD/MM/YYYY"):"-",((D=r.depo)==null?void 0:D.adi)||"-"]:[m+1,r.urunAdi||"-",r.barkod||"-",l(r.eklenmeTarihi).format("DD/MM/YYYY"),((f=r.musteris)==null?void 0:f.unvani)||"-",r.miktar||0,u(r.fiyat),u(r.toplamFiyat)]});t.autoTable({startY:25,head:i,body:o,theme:"grid",styles:{font:"Roboto",fontSize:9,cellPadding:3,valign:"middle"},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold",font:"Roboto",valign:"middle"},didDrawPage:r=>{t.getFontList().Roboto||t.setFont("times")}}),t.save(`${e.transactionType==="sales"?"Satış_Raporu":"Alış_Raporu"}_${l().format("YYYYMMDD_HHmmss")}.pdf`)}catch(t){console.error("PDF download error:",t),alert("PDF indirilemedi! Hata: "+t.message)}finally{y(!1)}},aa=()=>{if(h.length===0){alert("Rapor için veri bulunamadı!");return}const s=p.length>0?h.filter(r=>p.includes(r.id)):h;if(s.length===0){alert("Lütfen en az bir satır seçiniz!");return}const t=s.map((r,m)=>{var n,x,T,D,f;return e.transactionType==="purchases"?{ID:m+1,Ürün:((n=r.urun)==null?void 0:n.adi)||"-",Barkod:((x=r.urun)==null?void 0:x.barkod)||"-",Tarih:l(r.tarih||r.eklenmeTarihi).format("DD/MM/YYYY"),Tedarikçi:((T=r.tedarikci)==null?void 0:T.unvan)||"-",Miktar:r.miktar||0,"Birim Fiyat":u(r.fiyat),"İndirim (%)":r.indirim||0,Toplam:u(r.toplam),"KDV (%)":r.kDV||0,"Para Birimi":r.paraBirimi||"TRY","Belge No":r.belgeNo||"-","Vade Tarih":r.vadeTarih?l(r.vadeTarih).format("DD/MM/YYYY"):"-",Depo:((D=r.depo)==null?void 0:D.adi)||"-"}:{ID:m+1,Ürün:r.urunAdi||"-",Barkod:r.barkod||"-",Tarih:l(r.eklenmeTarihi).format("DD/MM/YYYY"),Müşteri:((f=r.musteris)==null?void 0:f.unvani)||"-",Miktar:r.miktar||0,"Birim Fiyat":u(r.fiyat),Toplam:u(r.toplamFiyat)}}),i=V.json_to_sheet(t),o=V.book_new();V.book_append_sheet(o,i,"Rapor"),ca(o,`${e.transactionType==="sales"?"Satış_Raporu":"Alış_Raporu"}_${l().format("YYYYMMDD_HHmmss")}.xlsx`)},F=h.filter(s=>JSON.stringify(s).toLowerCase().includes(L.toLowerCase()));return a.jsx("div",{className:"container mx-auto p-4",children:a.jsxs(ea,{className:"shadow-lg rounded-lg",children:[a.jsx(ra,{className:"bg-blue-600 text-white text-lg font-semibold p-4",children:"Ürün Alış-Satış Raporu"}),a.jsxs(sa,{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs(ta,{className:"g-4",children:[a.jsxs(P,{md:4,children:[a.jsx(A,{className:"text-sm font-medium text-gray-700",children:"İşlem Tipi"}),a.jsxs(U,{name:"transactionType",value:e.transactionType,onChange:$,className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:N,children:[a.jsx("option",{value:"",children:"Seçiniz"}),a.jsx("option",{value:"sales",children:"Satışlar"}),a.jsx("option",{value:"purchases",children:"Alışlar"})]})]}),a.jsxs(P,{md:4,children:[a.jsx(A,{className:"text-sm font-medium text-gray-700",children:"Başlangıç Tarihi"}),a.jsx(z,{type:"date",value:e.dateRangeStart.format("YYYY-MM-DD"),onChange:s=>I("dateRangeStart",l(s.target.value)),className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:N})]}),a.jsxs(P,{md:4,children:[a.jsx(A,{className:"text-sm font-medium text-gray-700",children:"Bitiş Tarihi"}),a.jsx(z,{type:"date",value:e.dateRangeEnd.format("YYYY-MM-DD"),onChange:s=>I("dateRangeEnd",l(s.target.value)),className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:N})]}),a.jsxs(P,{md:4,children:[a.jsx(A,{className:"text-sm font-medium text-gray-700",children:e.transactionType==="sales"?"Müşteri":e.transactionType==="purchases"?"Tedarikçi":"Müşteri/Tedarikçi"}),a.jsxs(U,{name:e.transactionType==="sales"?"customer":"supplier",value:e.transactionType==="sales"?e.customer:e.supplier,onChange:$,className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:N||!e.transactionType,children:[a.jsx("option",{value:"",children:"Seçiniz"}),(e.transactionType==="sales"?b:v).map(s=>a.jsx("option",{value:e.transactionType==="sales"?s.unvani:s.unvan,children:e.transactionType==="sales"?s.unvani:s.unvan},s.id))]})]})]}),a.jsxs("div",{className:"mt-4 flex space-x-4",children:[a.jsx(E,{color:"primary",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md",disabled:N,onClick:Q,children:N?"Yükleniyor...":"Rapor Hazırla"}),a.jsx(E,{color:"success",className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md",disabled:N,onClick:X,children:"PDF İndir"}),a.jsx(E,{color:"warning",className:"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-md",disabled:N,onClick:aa,children:"Excel Oluştur"})]})]}),h.length>0&&a.jsxs("div",{className:"mt-6",children:[a.jsx(z,{placeholder:"Tablo içinde ara...",value:L,onChange:s=>q(s.target.value),className:"mb-4 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"}),a.jsxs(na,{striped:!0,hover:!0,responsive:!0,className:"border rounded-lg",children:[a.jsx(oa,{className:"bg-blue-100",children:a.jsxs(O,{children:[a.jsx(c,{className:"p-3",children:a.jsx(K,{checked:p.length===F.length&&F.length>0,onChange:Z})}),a.jsx(c,{className:"p-3",children:"Sıra"}),a.jsx(c,{className:"p-3",children:"Ürün"}),a.jsx(c,{className:"p-3",children:"Barkod"}),a.jsx(c,{className:"p-3",children:"Tarih"}),a.jsx(c,{className:"p-3",children:e.transactionType==="sales"?"Müşteri":"Tedarikçi"}),a.jsx(c,{className:"p-3",children:"Miktar"}),a.jsx(c,{className:"p-3",children:"Birim Fiyat"}),a.jsx(c,{className:"p-3",children:"Toplam"}),e.transactionType==="purchases"&&a.jsxs(a.Fragment,{children:[a.jsx(c,{className:"p-3",children:"İndirim (%)"}),a.jsx(c,{className:"p-3",children:"KDV (%)"}),a.jsx(c,{className:"p-3",children:"Para Birimi"}),a.jsx(c,{className:"p-3",children:"Belge No"}),a.jsx(c,{className:"p-3",children:"Vade Tarih"}),a.jsx(c,{className:"p-3",children:"Depo"})]})]})}),a.jsx(la,{children:F.map((s,t)=>{var i,o,r,m,n;return a.jsxs(O,{className:"hover:bg-gray-50",children:[a.jsx(d,{className:"p-3",children:a.jsx(K,{checked:p.includes(s.id),onChange:()=>J(s.id)})}),a.jsx(d,{className:"p-3",children:t+1}),a.jsx(d,{className:"p-3",children:e.transactionType==="purchases"?((i=s.urun)==null?void 0:i.adi)||"-":s.urunAdi||"-"}),a.jsx(d,{className:"p-3",children:e.transactionType==="purchases"?((o=s.urun)==null?void 0:o.barkod)||"-":s.barkod||"-"}),a.jsx(d,{className:"p-3",children:l(s.tarih||s.eklenmeTarihi).format("DD/MM/YYYY")}),a.jsx(d,{className:"p-3",children:e.transactionType==="sales"?((r=s.musteris)==null?void 0:r.unvani)||"-":((m=s.tedarikci)==null?void 0:m.unvan)||"-"}),a.jsx(d,{className:"p-3",children:s.miktar||0}),a.jsx(d,{className:"p-3",children:u(s.fiyat)}),a.jsx(d,{className:"p-3",children:e.transactionType==="purchases"?u(s.toplam):u(s.toplamFiyat)}),e.transactionType==="purchases"&&a.jsxs(a.Fragment,{children:[a.jsx(d,{className:"p-3",children:s.indirim||0}),a.jsx(d,{className:"p-3",children:s.kDV||0}),a.jsx(d,{className:"p-3",children:s.paraBirimi||"TRY"}),a.jsx(d,{className:"p-3",children:s.belgeNo||"-"}),a.jsx(d,{className:"p-3",children:s.vadeTarih?l(s.vadeTarih).format("DD/MM/YYYY"):"-"}),a.jsx(d,{className:"p-3",children:((n=s.depo)==null?void 0:n.adi)||"-"})]})]},s.id)})})]})]})]})]})})};export{ha as default};
