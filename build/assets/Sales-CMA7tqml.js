import{r as t,j as e,t as w,an as Le,C as Re,e as y,f as h,q as x,m as ce,M as ue,g as Ge,s as He,B as he,D as me,E as xe,F as S,ak as Pe,h as $e,$ as K,a0 as Y,a1 as F,a2 as n,a3 as q,a4 as i,N as je,Q as Ce,S as ge,T as ye,i as Se,U as g,o as p,V as U,W as pe,a as ze,b as Ke,c as Ye}from"./index-DAwD_DDx.js";import{C as qe}from"./CDropdownDivider-CxDfJebD.js";const f="https://speedsofttest.com/api",Je=()=>{var te;const[fe,ke]=t.useState([]),[be,ve]=t.useState([]),[V,_]=t.useState(!1),[R,Q]=t.useState(null),[G,we]=t.useState(!1),[W,Ue]=t.useState(""),[D,Ve]=t.useState("Tümünü seç"),[k,b]=t.useState("Tamamını Göster"),[N,_e]=t.useState("Müşteri İsmi / Belge No"),[Fe,B]=t.useState(!1),[Te,A]=t.useState(!1),[H,Me]=t.useState([]),[P,De]=t.useState([]),[I,J]=t.useState(""),[T,O]=t.useState(""),[o,X]=t.useState({unvani:"",email:"",telefon:"",vergiDairesi:"",vergiNumarasi:"",adres:""}),[j,M]=t.useState([]),[E,$]=t.useState(""),Ne=t.useRef(),l=t.useCallback((r,s="success")=>{const a=e.jsxs(ze,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(Ke,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:s==="error"?"Hata":"Başarılı"})}),e.jsx(Ye,{children:r})]},Date.now());ke(c=>[...c,a])},[]),L=t.useCallback(async()=>{var r,s;_(!0);try{let a=`${f}/musteriSatis/musteriSatis-get-all`;T&&(a=`${f}/musteriSatis/musteriSatis-get-by-musteri/${T}`);const{data:c}=await w.get(a);ve(c),Q(null)}catch(a){console.error("Satışları Getirme Hatası:",a),Q(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.message)||"Satışlar yüklenemedi."),l("Satışlar yüklenemedi.","error")}finally{_(!1)}},[l,T]),z=t.useCallback(async()=>{try{const{data:r}=await w.get(`${f}/musteri/musteri-get-allaktif`);Me(r)}catch(r){console.error("Müşterileri Getirme Hatası:",r),l("Müşteriler yüklenemedi.","error")}},[l]),Z=t.useCallback(async()=>{try{const{data:r}=await w.get(`${f}/urun/urun-get-all`);De(r)}catch(r){console.error("Ürünleri Getirme Hatası:",r),l("Ürünler yüklenemedi.","error")}},[l]);t.useEffect(()=>{L(),z()},[L,z]);const Be=()=>{B(!0),X({unvani:"",email:"",telefon:"",vergiDairesi:"",vergiNumarasi:"",adres:""}),M([]),Z()},Ae=()=>{A(!0),J(""),M([]),z(),Z()},v=r=>{const{name:s,value:a}=r.target;X(c=>({...c,[s]:a}))},ee=()=>{if(!E){l("Lütfen bir ürün seçin.","error");return}const r=P.find(s=>s.id===parseInt(E));if(!r){l("Ürün bulunamadı.","error");return}if(j.some(s=>s.barkod===r.barkod)){l("Bu ürün zaten eklenmiş.","error");return}M(s=>[...s,{barkod:r.barkod,urunAdi:r.adi,fiyat:r.satisFiyat,birim:r.birimAdi,miktar:1,toplamFiyat:r.satisFiyat}]),$("")},re=(r,s)=>{const a=parseInt(s)||1;M(c=>c.map((u,d)=>d===r?{...u,miktar:a,toplamFiyat:a*u.fiyat}:u))},se=r=>{M(s=>s.filter((a,c)=>c!==r))},Ie=async()=>{var r,s;try{if(!o.unvani||!o.email){l("Unvan ve e-posta zorunlu.","error");return}if(j.length===0){l("En az bir ürün eklenmeli.","error");return}const a={unvani:o.unvani,email:o.email,telefon:o.telefon,vergiDairesi:o.vergiDairesi,vergiNumarasi:o.vergiNumarasi,adres:o.adres,durumu:1,aktif:1},u=(await w.post(`${f}/musteri/musteri-create`,a)).data.Data.id,d=j.map(C=>({musteriId:u,barkod:C.barkod,urunAdi:C.urunAdi,fiyat:C.fiyat,birim:C.birim,miktar:C.miktar,toplamFiyat:C.toplamFiyat})),m=await w.post(`${f}/musteriSatis/musteriSatis-create`,d);l(m.data.Message||"Satış başarıyla kaydedildi."),B(!1),L()}catch(a){console.error("Yeni Müşteri Satış Hatası:",a),l(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.Message)||"Satış kaydedilemedi.","error")}},Ee=async()=>{var r,s;if(!I){l("Lütfen bir müşteri seçin.","error");return}if(j.length===0){l("En az bir ürün eklenmeli.","error");return}try{const a=j.map(u=>({musteriId:parseInt(I),barkod:u.barkod,urunAdi:u.urunAdi,fiyat:u.fiyat,birim:u.birim,miktar:u.miktar,toplamFiyat:u.toplamFiyat})),c=await w.post(`${f}/musteriSatis/musteriSatis-create`,a);l(c.data.Message||"Satış başarıyla kaydedildi."),A(!1),L()}catch(a){console.error("Kayıtlı Müşteri Satış Hatası:",a),l(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.Message)||"Satış kaydedilemedi.","error")}},ae=be.filter(r=>{const s=D==="Tümünü seç"||r.docType===D||D==="E-Faturalaşmış"&&r.durumu===1||D==="E-Faturalaşmamış"&&r.durumu===0,a=()=>{const d=new Date(r.eklenmeTarihi),m=new Date;return k==="Bu yılın Satışlarını Göster"?d.getFullYear()===m.getFullYear():k==="Son 1 Ay"?d>=new Date(m.setMonth(m.getMonth()-1)):k==="Son 3 Ay"?d>=new Date(m.setMonth(m.getMonth()-3)):k==="Bugün"?d.toDateString()===new Date().toDateString():k==="İleri Tarihli Planlı Satışlar"?d>m:!0},c=()=>{var m,C,ne,ie,le,oe,de;if(W.length<3)return!0;const d=W.toLowerCase();return N==="Müşteri İsmi / Belge No"?((C=(m=r.musteri)==null?void 0:m.unvani)==null?void 0:C.toLowerCase().includes(d))||((ne=r.satisId)==null?void 0:ne.toLowerCase().includes(d)):N==="Ürün Adı / Kodu / Barkodu"?((ie=r.urunAdi)==null?void 0:ie.toLowerCase().includes(d))||((le=r.barkod)==null?void 0:le.toLowerCase().includes(d)):N==="Belge Açıklaması"?(oe=r.aciklama)==null?void 0:oe.toLowerCase().includes(d):N==="Satır Açıklaması"?(de=r.aciklama)==null?void 0:de.toLowerCase().includes(d):!0},u=G?!0:r.durumu!==0;return s&&a()&&c()&&u});return e.jsxs(Le,{children:[e.jsx(Re,{ref:Ne,placement:"top-end",className:"p-3",children:fe}),e.jsx(y,{className:"mb-3",children:e.jsxs(h,{children:[e.jsxs(x,{color:"primary",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:Be,children:[e.jsx(ce,{icon:ue})," Yeni Müşteriye Satış Gir"]}),e.jsxs(x,{color:"info",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:Ae,children:[e.jsx(ce,{icon:ue})," Kayıtlı Müşteriye Satış Gir"]})]})}),e.jsxs(Ge,{className:"mb-3",children:[e.jsx(He,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsx(y,{className:"d-flex justify-content-between align-items-center",children:e.jsxs(h,{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(he,{children:[e.jsx(me,{color:"light",children:k}),e.jsxs(xe,{children:[e.jsx(S,{onClick:()=>b("Bu yılın Satışlarını Göster"),children:"Bu yılın Satışlarını Göster"}),e.jsx(S,{onClick:()=>b("Son 1 Ay"),children:"Son 1 Ay"}),e.jsx(S,{onClick:()=>b("Son 3 Ay"),children:"Son 3 Ay"}),e.jsx(S,{onClick:()=>b("Bugün"),children:"Bugün"}),e.jsx(S,{onClick:()=>b("Tamamını Göster"),children:"Tamamını Göster"}),e.jsx(S,{onClick:()=>b("İleri Tarihli Planlı Satışlar"),children:"İleri Tarihli Planlı Satışlar"})]})]}),e.jsxs(he,{children:[e.jsx(me,{color:"light",children:T&&((te=H.find(r=>r.id===parseInt(T)))==null?void 0:te.unvani)||"Müşteri Seç"}),e.jsxs(xe,{children:[e.jsx(S,{onClick:()=>O(""),children:"Tüm Müşteriler"}),e.jsx(qe,{}),H.map(r=>e.jsx(S,{onClick:()=>O(r.id.toString()),children:r.unvani},r.id))]})]})]}),e.jsx(Pe,{label:"İptalleri de göster",checked:G,onChange:()=>we(!G)})]})})}),e.jsxs($e,{children:[V&&e.jsx("p",{children:"Yükleniyor..."}),R&&e.jsx("p",{className:"text-danger",children:R}),!V&&!R&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Satış Sayısı: ",ae.length]}),e.jsxs(K,{hover:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(F,{children:[e.jsx(n,{children:"Tarih"}),e.jsx(n,{children:"Müşteri"}),e.jsx(n,{children:"Belge No"}),e.jsx(n,{children:"Ürün Adı"}),e.jsx(n,{children:"Adet"}),e.jsx(n,{children:"Tutar"}),e.jsx(n,{children:"Durumu"})]})}),e.jsx(q,{children:ae.map(r=>{var s;return e.jsxs(F,{children:[e.jsx(i,{children:new Date(r.eklenmeTarihi).toLocaleDateString()}),e.jsx(i,{children:(s=r.musteri)==null?void 0:s.unvani}),e.jsx(i,{children:r.satisId}),e.jsx(i,{children:r.urunAdi}),e.jsx(i,{children:r.miktar}),e.jsx(i,{children:r.toplamFiyat}),e.jsx(i,{children:r.durumu===1?"Aktif":"İptal"})]},r.id)})})]})]})]})]}),e.jsxs(je,{visible:Fe,onClose:()=>B(!1),size:"lg",children:[e.jsx(Ce,{children:e.jsx(ge,{children:"Yeni Müşteriye Satış"})}),e.jsx(ye,{children:e.jsxs(Se,{children:[e.jsxs(y,{className:"mb-3",children:[e.jsxs(h,{md:6,children:[e.jsx(g,{children:"Unvan"}),e.jsx(p,{name:"unvani",value:o.unvani,onChange:v,required:!0})]}),e.jsxs(h,{md:6,children:[e.jsx(g,{children:"E-posta"}),e.jsx(p,{name:"email",type:"email",value:o.email,onChange:v,required:!0})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(h,{md:6,children:[e.jsx(g,{children:"Telefon"}),e.jsx(p,{name:"telefon",value:o.telefon,onChange:v})]}),e.jsxs(h,{md:6,children:[e.jsx(g,{children:"Adres"}),e.jsx(p,{name:"adres",value:o.adres,onChange:v})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(h,{md:6,children:[e.jsx(g,{children:"Vergi Dairesi"}),e.jsx(p,{name:"vergiDairesi",value:o.vergiDairesi,onChange:v})]}),e.jsxs(h,{md:6,children:[e.jsx(g,{children:"Vergi Numarası"}),e.jsx(p,{name:"vergiNumarasi",value:o.vergiNumarasi,onChange:v})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(h,{md:8,children:[e.jsx(g,{children:"Ürün Seç"}),e.jsxs(U,{value:E,onChange:r=>$(r.target.value),children:[e.jsx("option",{value:"",children:"Ürün Seçin"}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.adi," (Barkod: ",r.barkod,", Fiyat: ",r.satisFiyat,")"]},r.id))]})]}),e.jsx(h,{md:4,className:"d-flex align-items-end",children:e.jsx(x,{color:"primary",onClick:ee,children:"Ürün Ekle"})})]}),e.jsxs(K,{hover:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(F,{children:[e.jsx(n,{children:"Ürün Adı"}),e.jsx(n,{children:"Barkod"}),e.jsx(n,{children:"Fiyat"}),e.jsx(n,{children:"Birim"}),e.jsx(n,{children:"Miktar"}),e.jsx(n,{children:"Toplam Fiyat"}),e.jsx(n,{children:"İşlem"})]})}),e.jsx(q,{children:j.map((r,s)=>e.jsxs(F,{children:[e.jsx(i,{children:r.urunAdi}),e.jsx(i,{children:r.barkod}),e.jsx(i,{children:r.fiyat}),e.jsx(i,{children:r.birim}),e.jsx(i,{children:e.jsx(p,{type:"number",min:"1",value:r.miktar,onChange:a=>re(s,a.target.value),style:{width:"100px"}})}),e.jsx(i,{children:r.toplamFiyat}),e.jsx(i,{children:e.jsx(x,{color:"danger",onClick:()=>se(s),children:"Sil"})})]},s))})]})]})}),e.jsxs(pe,{children:[e.jsx(x,{color:"secondary",onClick:()=>B(!1),children:"İptal"}),e.jsx(x,{color:"primary",onClick:Ie,disabled:j.length===0||!o.unvani||!o.email,children:"Satışı Kaydet"})]})]}),e.jsxs(je,{visible:Te,onClose:()=>A(!1),size:"lg",children:[e.jsx(Ce,{children:e.jsx(ge,{children:"Kayıtlı Müşteriye Satış"})}),e.jsx(ye,{children:e.jsxs(Se,{children:[e.jsx(y,{className:"mb-3",children:e.jsxs(h,{children:[e.jsx(g,{children:"Müşteri Seç"}),e.jsxs(U,{value:I,onChange:r=>J(r.target.value),children:[e.jsx("option",{value:"",children:"Müşteri Seçin"}),H.map(r=>e.jsx("option",{value:r.id,children:r.unvani},r.id))]})]})}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(h,{md:8,children:[e.jsx(g,{children:"Ürün Seç"}),e.jsxs(U,{value:E,onChange:r=>$(r.target.value),children:[e.jsx("option",{value:"",children:"Ürün Seçin"}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.adi," (Barkod: ",r.barkod,", Fiyat: ",r.satisFiyat,")"]},r.id))]})]}),e.jsx(h,{md:4,className:"d-flex align-items-end",children:e.jsx(x,{color:"primary",onClick:ee,children:"Ürün Ekle"})})]}),e.jsxs(K,{hover:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(F,{children:[e.jsx(n,{children:"Ürün Adı"}),e.jsx(n,{children:"Barkod"}),e.jsx(n,{children:"Fiyat"}),e.jsx(n,{children:"Birim"}),e.jsx(n,{children:"Miktar"}),e.jsx(n,{children:"Toplam Fiyat"}),e.jsx(n,{children:"İşlem"})]})}),e.jsx(q,{children:j.map((r,s)=>e.jsxs(F,{children:[e.jsx(i,{children:r.urunAdi}),e.jsx(i,{children:r.barkod}),e.jsx(i,{children:r.fiyat}),e.jsx(i,{children:r.birim}),e.jsx(i,{children:e.jsx(p,{type:"number",min:"1",value:r.miktar,onChange:a=>re(s,a.target.value),style:{width:"100px"}})}),e.jsx(i,{children:r.toplamFiyat}),e.jsx(i,{children:e.jsx(x,{color:"danger",onClick:()=>se(s),children:"Sil"})})]},s))})]})]})}),e.jsxs(pe,{children:[e.jsx(x,{color:"secondary",onClick:()=>A(!1),children:"İptal"}),e.jsx(x,{color:"primary",onClick:Ee,disabled:j.length===0||!I,children:"Satışı Kaydet"})]})]})]})};export{Je as default};
