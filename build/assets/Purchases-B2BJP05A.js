import{r as n,u as Se,j as e,N as ne,C as Te,Q as oe,S as ce,T as de,e as ue,f as re,ap as Ae,q as D,i as Ue,W as me,m as V,ae as Fe,au as Be,av as Ie,aw as Ee,ax as Ne,al as Ce,a as De,b as be,c as we,M as fe,$ as Pe,a0 as Ye,a1 as je,a2 as N,a3 as Le,a4 as P,X as ze,a6 as $e,ay as ae,az as Me,aA as Ge,B as Z,D as ee,E as te,F as b,aj as He,an as ke,o as We,g as Ke,s as _e,h as Oe,J as Je,am as Ve,t as ie}from"./index-DvA_wB1j.js";import{c as qe}from"./cil-reload-6LI_qKMh.js";import{c as Xe}from"./cil-file-CeQgYs_D.js";import{C as Qe,a as se}from"./CPaginationItem-WywkvXIg.js";import{C as Ze}from"./CDropdownDivider-Cs8l3po-.js";const X=n.createContext({}),et=Ce.create({baseURL:"https://speedsofttest.com/api",headers:{"Content-Type":"multipart/form-data"}}),tt=({visible:u,onClose:p,onSupplierCreated:h})=>{const T=Se(),[s,c]=n.useState({unvan:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:"",durumu:1,aktif:0,fotograf:null,kullaniciId:0}),[Y,y]=n.useState([]),[j,k]=n.useState("identity"),[F,I]=n.useState({}),C=(B,g="success")=>{const A=e.jsxs(De,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(be,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:g==="error"?"Hata":"Başarılı"})}),e.jsx(we,{children:B})]},Date.now());y(R=>[...R,A])},d=B=>{const{name:g,value:A,type:R,checked:G}=B.target;c(w=>({...w,[g]:R==="checkbox"?G:A})),I(w=>({...w,[g]:""}))},v=B=>{const g=B.target.files[0];if(g){if(!["image/jpeg","image/png","image/gif"].includes(g.type)){C("Lütfen yalnızca JPEG, PNG veya GIF formatında resim yükleyin.","error");return}c(R=>({...R,fotograf:g}))}},M=async B=>{var g,A,R,G,w,H,W,K,_,O,U,z,J;B.preventDefault();try{const x=JSON.parse(localStorage.getItem("user"))||{id:0};if(!x.id){C("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}const $={unvan:((g=s.unvan)==null?void 0:g.trim())||"",fotograf:s.fotograf,vergiDairesi:s.vergiDairesi||"",vergiNo:s.vergiNo||"",vergiMuaf:s.vergiMuaf?1:0,bankaBilgileri:s.bankaBilgileri||"",paraBirimi:s.paraBirimi||"TRY",vadeGun:parseInt(s.vadeGun)||0,acilisBakiyesi:parseFloat(s.acilisBakiyesi)||0,yetkiliKisi:s.yetkiliKisi||"",email:((A=s.email)==null?void 0:A.trim())||"",adres:s.adres||"",telefon:s.telefon||"",diger:s.diger||"",tedarikciSiniflandirmaId:parseInt(s.tedarikciSiniflandirmaId)||0,kodu:s.kodu||"",aciklama:s.aciklama||"",durumu:1,aktif:0,kullaniciId:x.id};console.log("Supplier data payload:",$);const l=new FormData;Object.entries($).forEach(([t,r])=>{t==="fotograf"&&r?l.append("fotograf",r):l.append(t,r??"")}),console.log("FormData contents:");for(let[t,r]of l.entries())console.log(t,r);const m=await et.post("/tedarikci/tedarikci-create",l);console.log("API Response (tedarikci/tedarikci-create):",m.data),console.log("API OK",m.status),C("Tedarikçi başarıyla eklendi.","success"),h(m.data);const S=((G=(R=m.data)==null?void 0:R.Data)==null?void 0:G.id)||((H=(w=m.data)==null?void 0:w.data)==null?void 0:H.id);if(S&&S!==0){console.log("Yönlendirme yapılıyor, supplierId:",S);const t="/app/purchases/registered-supplier-purchase";setTimeout(()=>{try{T(t,{state:{supplierId:S}}),console.log("Yönlendirme tamamlandı, URL:",window.location.href),p()}catch(r){console.error("Yönlendirme hatası:",r),C("Yönlendirme başarısız oldu, lütfen tekrar deneyin.","error")}},100)}else console.error("Tedarikçi ID'si alınamadı veya sıfır, API cevabı:",m.data),C("Tedarikçi ID'si alınamadı veya geçersiz, lütfen tekrar deneyin.","error")}catch(x){console.error("Tedarikçi Ekleme Hatası:",{message:((K=(W=x==null?void 0:x.response)==null?void 0:W.data)==null?void 0:K.message)||x.message,status:(_=x==null?void 0:x.response)==null?void 0:_.status,data:(O=x==null?void 0:x.response)==null?void 0:O.data});let $=((z=(U=x==null?void 0:x.response)==null?void 0:U.data)==null?void 0:z.message)||"Tedarikçi eklenemedi.";((J=x.response)==null?void 0:J.status)===415&&($="Sunucu dosya tipini desteklemiyor. Lütfen doğru formatta veri gönderin."),C($,"error")}},L=()=>{switch(j){case"identity":return e.jsx(Ne,{formData:s,handleChange:d,handleImageUpload:v,errors:F,setErrors:I});case"financial":return e.jsx(Ee,{formData:s,handleChange:d});case"contact":return e.jsx(Ie,{formData:s,handleChange:d});case"other":return e.jsx(Be,{formData:s,handleChange:d});default:return null}};return e.jsxs(ne,{visible:u,onClose:p,backdrop:"static",size:"lg",children:[e.jsx(Te,{placement:"top-end",className:"p-3",children:Y}),e.jsx(oe,{children:e.jsx(ce,{children:"Yeni Tedarikçi Ekle"})}),e.jsxs(de,{children:[e.jsx(ue,{className:"mb-3",children:e.jsx(re,{children:e.jsxs(Ae,{role:"group",className:"mb-0",children:[e.jsx(D,{style:{backgroundColor:j==="identity"?"#FFFFFF":"#2965A8",color:j==="identity"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>k("identity"),children:"Kimlik Bilgileri"}),e.jsx(D,{style:{backgroundColor:j==="financial"?"#FFFFFF":"#2965A8",color:j==="financial"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>k("financial"),children:"Cari"}),e.jsx(D,{style:{backgroundColor:j==="contact"?"#FFFFFF":"#2965A8",color:j==="contact"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>k("contact"),children:"İletişim"}),e.jsx(D,{style:{backgroundColor:j==="other"?"#FFFFFF":"#2965A8",color:j==="other"?"#2965A8":"#FFFFFF",border:"1px solid #FFFFFF"},onClick:()=>k("other"),children:"Diğer"})]})})}),e.jsx(Ue,{id:"supplierForm",onSubmit:M,children:L()})]}),e.jsxs(me,{children:[e.jsxs(D,{type:"submit",form:"supplierForm",style:{width:"150px",color:"white",backgroundColor:"#1D9030"},children:[e.jsx(V,{icon:Fe})," Kaydet"]}),e.jsx(D,{color:"secondary",onClick:p,children:"İptal"})]})]})},rt=()=>{const{setShowSupplierModal:u,navigate:p}=n.useContext(X),[h,T]=n.useState(!1),s=()=>{u(!0)},c=()=>{T(!0)},Y=y=>{p("/app/purchases/registered-supplier-purchase",{state:{supplier:y}}),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{color:"success",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:s,children:[e.jsx(V,{icon:fe})," Kayıtlı Tedarikçiden Ürün/Hizmet Gir"]}),e.jsxs(D,{color:"info",style:{color:"white",marginRight:"10px",marginBottom:"10px"},onClick:c,children:[e.jsx(V,{icon:fe})," Yeni Tedarikçiden Ürün/Hizmet Gir"]}),e.jsx(tt,{visible:h,onClose:()=>T(!1),onSupplierCreated:Y})]})},Re="https://speedsofttest.com/api",at=Ce.create({baseURL:Re}),it=()=>{const{filteredPurchases:u,navigate:p,addToast:h,suppliers:T,handleCancelPurchase:s,products:c}=n.useContext(X),[Y,y]=n.useState(!1),[j,k]=n.useState(null),[F,I]=n.useState(1),[C]=n.useState(10),[d,v]=n.useState({USD:32.5,EUR:35.2,lastUpdated:new Date,loading:!1,error:null}),M="doviz_kurlari_cache",L=()=>{try{return(JSON.parse(localStorage.getItem("user"))||{id:0}).id}catch(t){return console.error("Kullanıcı ID'si alınırken hata:",t),0}},B=async()=>{const t=localStorage.getItem(M);if(t){const a=JSON.parse(t),i=new Date(a.lastUpdated).getTime();if(new Date().getTime()-i<5*60*1e3)return a}const r=[{url:"https://api.fastforex.io/fetch-multi?from=TRY&to=USD,EUR&api_key=demo",parser:a=>{var i,f;return{USD:(i=a.results)!=null&&i.USD?1/a.results.USD:32.5,EUR:(f=a.results)!=null&&f.EUR?1/a.results.EUR:35.2}}},{url:"https://api.exchangerate.host/latest?base=TRY&symbols=USD,EUR",parser:a=>{var i,f;return{USD:(i=a.rates)!=null&&i.USD?1/a.rates.USD:32.5,EUR:(f=a.rates)!=null&&f.EUR?1/a.rates.EUR:35.2}}},{url:"https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/try.json",parser:a=>{var i,f;return{USD:(i=a.try)!=null&&i.usd?1/a.try.usd:32.5,EUR:(f=a.try)!=null&&f.eur?1/a.try.eur:35.2}}}],o=new Promise((a,i)=>setTimeout(()=>i(new Error("Timeout")),3e3));for(const a of r)try{const i=fetch(a.url).then(Q=>{if(!Q.ok)throw new Error("API error");return Q.json()}),f=await Promise.race([i,o]),E=a.parser(f),q={USD:E.USD,EUR:E.EUR,lastUpdated:new Date,loading:!1,error:null};return localStorage.setItem(M,JSON.stringify(q)),q}catch(i){console.log(`API ${a.url} çalışmadı:`,i);continue}throw new Error("Tüm hızlı API'ler çalışmadı")},g=async()=>{try{v(r=>({...r,loading:!0,error:null}));const t=await B();v(t),h("Döviz kurları güncellendi.","success")}catch{console.log("Hızlı API'ler çalışmadı, fallback kullanılıyor");const r=localStorage.getItem(M);if(r){const o=JSON.parse(r);v(o),h("Güncel kurlar alınamadı, önbellek kullanılıyor","warning");return}v({USD:32.5,EUR:35.2,lastUpdated:new Date,loading:!1,error:"Gerçek kurlar alınamadı, yaklaşık değerler kullanılıyor"}),h("Döviz kurları alınamadı, yaklaşık değerler kullanılıyor.","warning")}};n.useEffect(()=>{const t=localStorage.getItem(M);if(t){const r=JSON.parse(t);v(r)}setTimeout(g,100)},[]);const A=F*C,R=A-C,G=u.slice(R,A),w=Math.ceil(u.length/C),H=u.reduce((t,r)=>r.paraBirimi==="TRY"?t+(r.toplam||0):t,0),W=u.reduce((t,r)=>r.paraBirimi==="EUR"?t+(r.toplam||0):t,0),K=u.reduce((t,r)=>r.paraBirimi==="USD"?t+(r.toplam||0):t,0),_=W*d.EUR,O=K*d.USD,U=H+_+O,z=t=>{const r=T.find(o=>o.id===t);return r?r.unvan:"Bilinmiyor"},J=t=>{if(t.urun&&t.urun.adi)return t.urun.adi;if(t.urunId&&c&&c.length>0){const r=c.find(o=>o.id===t.urunId);if(r&&r.adi)return r.adi}return t.urunId?`Ürün ID: ${t.urunId}`:"Bilinmiyor"},x=t=>new Date(t).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),$=()=>{const t=u.map((i,f)=>({No:f+1,Tarih:new Date(i.tarih).toLocaleDateString("tr-TR"),Tedarikçi:z(i.tedarikciId),"Ürün Adı":J(i),Miktar:i.miktar||0,"Belge No":i.belgeNo||"","Para Birimi":i.paraBirimi||"TRY",Tutar:i.toplam?`${i.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} ${i.paraBirimi||"TRY"}`:`0 ${i.paraBirimi||"TRY"}`,Durumu:i.durumu===1?"Faturalaşmış":"İptal"})),r=ae.json_to_sheet(t),o=ae.book_new();ae.book_append_sheet(o,r,"Alışlar");const a=[{wch:5},{wch:12},{wch:30},{wch:40},{wch:15},{wch:25},{wch:15},{wch:20},{wch:15}];r["!cols"]=a,Me(o,`Alışlar_${new Date().toLocaleDateString("tr-TR").replace(/\./g,"-")}.xlsx`),h("Excel dosyası başarıyla indirildi.","success")},l=()=>{const t=new Ge("landscape");t.setFontSize(16),t.text("Alislar Raporu",14,20),t.setFontSize(10),t.text(`Olusturulma Tarihi: ${new Date().toLocaleDateString("tr-TR")}`,14,30),t.text(`Döviz Kurları: USD: ${d.USD.toFixed(2)} TRY, EUR: ${d.EUR.toFixed(2)} TRY`,14,37),t.text(`Kur Güncelleme: ${d.lastUpdated?x(d.lastUpdated):"Bilinmiyor"}`,14,44),d.error&&(t.setTextColor(220,53,69),t.text(`Uyarı: ${d.error}`,14,51),t.setTextColor(0,0,0));let r=d.error?58:51;t.text(`Toplam TRY: ${H.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY`,14,r),t.text(`Toplam EUR: ${W.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} EUR (${_.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY)`,14,r+7),t.text(`Toplam USD: ${K.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} USD (${O.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY)`,14,r+14),t.text(`Genel Toplam (TRY): ${U.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} TRY`,14,r+21);const o=u.map((a,i)=>[i+1,new Date(a.tarih).toLocaleDateString("tr-TR"),z(a.tedarikciId),J(a),a.miktar||0,a.belgeNo||"",a.paraBirimi||"TRY",a.toplam?`${a.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})} ${a.paraBirimi||"TRY"}`:`0 ${a.paraBirimi||"TRY"}`,a.durumu===1?"Faturalasmis":"Iptal"]);t.autoTable({startY:r+28,head:[["No","Tarih","Tedarikci","Urun Adi","Miktar","Belge No","Para Birimi","Tutar","Durumu"]],body:o,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,101,168],textColor:255,fontStyle:"bold"},columnStyles:{0:{cellWidth:15},1:{cellWidth:25},2:{cellWidth:55},3:{cellWidth:75},4:{cellWidth:20},5:{cellWidth:30},6:{cellWidth:20},7:{cellWidth:30},8:{cellWidth:25}}}),t.save(`Alışlar_${new Date().toLocaleDateString("tr-TR").replace(/\./g,"-")}.pdf`),h("PDF dosyası başarıyla indirildi.","success")},m=t=>{k(t),y(!0)},S=async()=>{var r,o,a,i,f;const t=L();if(!t){h("Geçerli bir kullanıcı oturumu bulunamadı.","error"),y(!1),k(null);return}try{await at.delete(`${Re}/alis/alis-delete/${j}/${t}`,{headers:{accept:"*/*"}}),h("Alış başarıyla silindi.","success"),s(j),y(!1),k(null)}catch(E){console.error("Alış silinirken hata:",E);const q=((r=E.response)==null?void 0:r.status)===404?`Alış ID ${j} bulunamadı.`:((a=(o=E.response)==null?void 0:o.data)==null?void 0:a.message)||((f=(i=E.response)==null?void 0:i.data)==null?void 0:f.error)||"Alış silinemedi. Lütfen tekrar deneyin.";h(q,"error"),y(!1),k(null)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",marginBottom:"20px",borderRadius:"5px",border:"1px solid #dee2e6"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h5",{style:{margin:0,color:"#2965A8",marginBottom:"10px"},children:["Genel Toplam (TRY):"," ",U.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"},children:[e.jsxs("span",{style:{color:"#2965A8",fontWeight:"bold"},children:["TRY:"," ",H.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("span",{style:{color:"#28a745",fontWeight:"bold"},children:["EUR:"," ",W.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","EUR ≈"," ",_.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]}),e.jsxs("span",{style:{color:"#dc3545",fontWeight:"bold"},children:["USD:"," ",K.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","USD ≈"," ",O.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","TRY"]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",minWidth:"250px"},children:[e.jsxs("div",{style:{backgroundColor:"#e9ecef",padding:"10px",borderRadius:"5px",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#495057"},children:"Döviz Kurları"}),e.jsxs("div",{style:{fontSize:"13px",color:"#6c757d"},children:[e.jsxs("div",{children:["USD: ",d.USD.toFixed(2)," TRY"]}),e.jsxs("div",{children:["EUR: ",d.EUR.toFixed(2)," TRY"]}),d.lastUpdated&&e.jsxs("div",{style:{fontSize:"12px",marginTop:"5px",color:"#868e96"},children:["Son güncelleme: ",x(d.lastUpdated)]}),d.error&&e.jsx("div",{style:{fontSize:"12px",color:"#dc3545",marginTop:"5px"},children:d.error})]}),e.jsxs(D,{color:"secondary",size:"sm",onClick:g,disabled:d.loading,style:{marginTop:"8px",fontSize:"12px"},children:[e.jsx(V,{icon:qe,style:{marginRight:"5px"}}),d.loading?"Güncelleniyor...":"Kurları Güncelle"]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs(D,{color:"success",size:"sm",onClick:$,style:{color:"white",flex:1},children:[e.jsx(V,{icon:Xe,style:{marginRight:"5px"}}),"Excel"]}),e.jsxs(D,{color:"danger",size:"sm",onClick:l,style:{color:"white",flex:"1"},children:[e.jsx(V,{icon:Fe,style:{marginRight:"5px"}}),"PDF"]})]})]})]})}),e.jsxs(Pe,{hover:!0,responsive:!0,children:[e.jsx(Ye,{children:e.jsxs(je,{children:[e.jsx(N,{children:"No"}),e.jsx(N,{children:"Tarih"}),e.jsx(N,{children:"Tedarikçi"}),e.jsx(N,{children:"Ürün Adı"}),e.jsx(N,{children:"Miktar"}),e.jsx(N,{children:"Belge No"}),e.jsx(N,{children:"Para Birimi"}),e.jsx(N,{children:"Tutar"}),e.jsx(N,{children:"Durumu"}),e.jsx(N,{children:"İşlemler"})]})}),e.jsx(Le,{children:G.map((t,r)=>e.jsxs(je,{children:[e.jsx(P,{children:R+r+1}),e.jsx(P,{children:new Date(t.tarih).toLocaleDateString("tr-TR")}),e.jsx(P,{children:z(t.tedarikciId)}),e.jsx(P,{children:J(t)}),e.jsx(P,{children:t.miktar}),e.jsx(P,{children:t.belgeNo||"-"}),e.jsx(P,{children:t.paraBirimi||"TRY"}),e.jsx(P,{children:t.toplam?t.toplam.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+` ${t.paraBirimi||"TRY"}`:`0 ${t.paraBirimi||"TRY"}`}),e.jsx(P,{children:t.durumu===1?"Faturalaşmış":"İptal"}),e.jsx(P,{children:e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(D,{color:"info",size:"sm",onClick:()=>p("/app/purchases/purchase-detail",{state:{purchaseId:t.id||null}}),style:{color:"white"},children:e.jsx(V,{icon:ze})}),e.jsx(D,{color:"danger",size:"sm",onClick:()=>m(t.id),style:{color:"white"},children:e.jsx(V,{icon:$e})})]})})]},t.id))})]}),w>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px",alignItems:"center",gap:"10px"},children:[e.jsxs("span",{style:{color:"#6c757d"},children:["Sayfa ",F," / ",w," (",u.length," ","kayıt)"]}),e.jsxs(Qe,{"aria-label":"Sayfalama",children:[e.jsx(se,{"aria-label":"Önceki",disabled:F===1,onClick:()=>I(F-1),style:{cursor:F===1?"not-allowed":"pointer"},children:"Önceki"}),Array.from({length:w},(t,r)=>r+1).map(t=>e.jsx(se,{active:t===F,onClick:()=>I(t),style:{cursor:"pointer"},children:t},t)),e.jsx(se,{"aria-label":"Sonraki",disabled:F===w,onClick:()=>I(F+1),style:{cursor:F===w?"not-allowed":"pointer"},children:"Sonraki"})]})]}),e.jsxs(ne,{visible:Y,onClose:()=>{y(!1),k(null)},children:[e.jsx(oe,{children:e.jsx(ce,{children:"Alışı Sil"})}),e.jsx(de,{children:"Bu alışı silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."}),e.jsxs(me,{children:[e.jsx(D,{color:"secondary",onClick:()=>{y(!1),k(null)},children:"Hayır"}),e.jsx(D,{color:"danger",onClick:S,children:"Evet"})]})]})]})},st=()=>{const{showCancelled:u,setShowCancelled:p,docTypeFilter:h,setDocTypeFilter:T,timeFilter:s,setTimeFilter:c,searchType:Y,setSearchType:y,contentType:j,setContentType:k,searchTerm:F,setSearchTerm:I}=n.useContext(X);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"d-flex",children:e.jsxs(re,{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(Z,{children:[e.jsxs(ee,{color:"light",children:["Tüm Belge Tipleri: ",h]}),e.jsxs(te,{children:[e.jsx(b,{onClick:()=>T("Tümünü seç"),children:"Tümünü seç"}),e.jsx(Ze,{}),e.jsx(b,{onClick:()=>T("Sipariş"),children:"Sipariş"}),e.jsx(b,{onClick:()=>T("İrsaliye"),children:"İrsaliye"}),e.jsx(b,{onClick:()=>T("Faturalaşmış"),children:"Faturalaşmış"})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{color:"light",children:s}),e.jsxs(te,{children:[e.jsx(b,{onClick:()=>c("Bu yılın Satışlarını Göster"),children:"Bu yılın Satışlarını Göster"}),e.jsx(b,{onClick:()=>c("Son 1 Ay"),children:"Son 1 Ay"}),e.jsx(b,{onClick:()=>c("Son 3 Ay"),children:"Son 3 Ay"}),e.jsx(b,{onClick:()=>c("Bugün"),children:"Bugün"}),e.jsx(b,{onClick:()=>c("Tamamını Göster"),children:"Tamamını Göster"})]})]})]}),e.jsx(He,{label:"İptalleri de göster",checked:u,onChange:()=>p(!u)})]})}),e.jsxs(re,{className:"d-flex flex-wrap align-items-center justify-content-between mt-2 gap-3",children:[e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(ke,{type:"radio",button:{color:"light",variant:"outline"},name:"contentType",id:"products",label:"Ürünler",checked:j==="Ürünler",onChange:()=>k("Ürünler")}),e.jsx(ke,{type:"radio",button:{color:"light",variant:"outline"},name:"contentType",id:"services",label:"Hizmetler",checked:j==="Hizmetler",onChange:()=>k("Hizmetler"),disabled:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",flexWrap:"wrap"},children:[e.jsx("span",{children:"Ara:"}),e.jsxs(Z,{children:[e.jsx(ee,{color:"light",children:Y}),e.jsxs(te,{children:[e.jsx(b,{onClick:()=>y("Tedarikçi İsmi / Belge No"),children:"Tedarikçi İsmi / Belge No"}),e.jsx(b,{onClick:()=>y("Ürün Adı / Kodu / Barkodu"),children:"Ürün Adı / Kodu / Barkodu"}),e.jsx(b,{onClick:()=>y("Belge Açıklaması"),children:"Belge Açıklaması"}),e.jsx(b,{onClick:()=>y("Satır Açıklaması"),children:"Satır Açıklaması"})]})]})]}),e.jsx(We,{type:"text",placeholder:"Arama... (en az 3 karakter)",value:F,onChange:C=>I(C.target.value),style:{width:"240px"}})]})]})},lt=()=>{const{loading:u,error:p,filteredPurchases:h}=n.useContext(X);return e.jsxs(Ke,{className:"my-3",children:[e.jsx(_e,{style:{backgroundColor:"#2965A8",color:"#FFFFFF",fontSize:"large",fontWeight:"bold"},children:e.jsx(st,{})}),e.jsxs(Oe,{children:[u&&e.jsx("p",{children:"Yükleniyor..."}),p&&e.jsx("p",{className:"text-danger",children:p}),!u&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Alış Sayısı: ",h.length]}),e.jsx(it,{})]})]})]})},nt=()=>{const{showSupplierModal:u,setShowSupplierModal:p,suppliers:h,navigate:T}=n.useContext(X),s=c=>{p(!1),T("/app/purchases/registered-supplier-purchase",{state:{supplier:c}})};return e.jsxs(ne,{visible:u,onClose:()=>p(!1),backdrop:"static",size:"lg",children:[e.jsx(oe,{children:e.jsx(ce,{children:"Tedarikçi Arama"})}),e.jsxs(de,{children:[e.jsx("p",{style:{backgroundColor:"#FFC107",padding:"15px",borderRadius:"8px",marginBottom:"25px",fontWeight:"500"},children:"Alış yaptığınız tedarikçiyi bulun"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Tedarikçi Seçimi"}),e.jsxs(Z,{style:{width:"100%"},children:[e.jsx(ee,{color:"light",style:{width:"100%",textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"1px solid #ced4da",borderRadius:"6px",backgroundColor:"#fff",minHeight:"48px"},children:"Tedarikçi Seç"}),e.jsx(te,{style:{width:"100%",maxHeight:"300px",overflowY:"auto",border:"1px solid #ced4da",borderRadius:"6px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:h.length===0?e.jsx(b,{disabled:!0,style:{padding:"12px 16px"},children:"Tedarikçi bulunamadı"}):h.map(c=>e.jsx(b,{onClick:()=>s(c),style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid #f8f9fa"},children:e.jsxs("div",{children:[e.jsx("strong",{children:c.unvan}),c.vergiNo&&e.jsxs("div",{style:{fontSize:"0.875rem",color:"#6c757d"},children:["Vergi No: ",c.vergiNo]})]})},c.id))})]})]})]}),e.jsx(me,{children:e.jsx(D,{color:"secondary",onClick:()=>p(!1),style:{color:"white"},children:"İptal"})})]})},le="https://speedsofttest.com/api",ht=()=>{const[u,p]=n.useState([]),[h,T]=n.useState([]),[s,c]=n.useState([]),[Y,y]=n.useState(!1),[j,k]=n.useState(null),[F,I]=n.useState(!1),[C,d]=n.useState(""),[v,M]=n.useState("Tümünü seç"),[L,B]=n.useState("Tamamını Göster"),[g,A]=n.useState("Tedarikçi İsmi / Belge No"),[R,G]=n.useState("Ürünler"),[w,H]=n.useState(!1),W=n.useRef(),K=Se(),_=Je(),O=()=>{try{return(JSON.parse(localStorage.getItem("user"))||{id:0}).id}catch(l){return console.error("Kullanıcı ID'si alınırken hata:",l),0}},U=(l,m="success")=>{const S=e.jsxs(De,{autohide:!0,visible:!0,delay:5e3,children:[e.jsx(be,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:m==="error"?"Hata":"Başarılı"})}),e.jsx(we,{children:l})]},Date.now());p(t=>[...t,S])},z=async()=>{var l,m,S;y(!0);try{console.log("metod:fetchPurchases");const{data:t}=await ie.get(`${le}/alis/alis-get-all`,{headers:{accept:"*/*"}});console.log("Fetched Purchases (Full Data):",JSON.stringify(t,null,2)),t.forEach((r,o)=>{var a;console.log(`Purchase ${o+1}:`,{id:r.id,toplam:r.toplam,urunAdi:((a=r.Urun)==null?void 0:a.Adi)||"Bilinmiyor",tedarikciId:r.tedarikciId,belgeNo:r.belgeNo,tarih:r.tarih,durumu:r.durumu,urun:r.Urun})}),T(t),k(null)}catch(t){console.error("Fetch Purchases Error:",((l=t.response)==null?void 0:l.data)||t),k(((S=(m=t.response)==null?void 0:m.data)==null?void 0:S.message)||"Alışlar yüklenemedi."),U("Alışlar yüklenemedi.","error")}finally{y(!1)}},J=async()=>{var l;try{const{data:m}=await ie.get(`${le}/tedarikci/tedarikci-get-all`,{headers:{accept:"*/*"}});c(m.filter(S=>S.durumu===1))}catch(m){console.error("Fetch Suppliers Error:",((l=m.response)==null?void 0:l.data)||m),U("Tedarikçiler yüklenemedi.","error")}},x=async l=>{var S;const m=O();if(!m){U("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}try{await ie.delete(`${le}/alis/alis-delete/${l}/${m}`,{headers:{accept:"*/*"}}),U("Alış başarıyla iptal edildi.","success"),z()}catch(t){console.error("Alış iptal edilirken hata:",((S=t.response)==null?void 0:S.data)||t),U("Alış iptal edilemedi.","error")}};n.useEffect(()=>{z(),J()},[_]);const $=h.filter(l=>{const m=v==="Tümünü seç"||l.docType===v||v==="Faturalaşmış"&&l.durumu===1,S=()=>{const o=new Date(l.tarih),a=new Date;return L==="Bu yılın Satışlarını Göster"?o.getFullYear()===a.getFullYear():L==="Son 1 Ay"?o>=new Date(a.setMonth(a.getMonth()-1)):L==="Son 3 Ay"?o>=new Date(a.setMonth(a.getMonth()-3)):L==="Bugün"?o.toDateString()===new Date().toDateString():!0},t=()=>{var a,i,f,E,q,Q,he,xe,pe,ge,ye;if(C.length<3)return!0;const o=C.toLowerCase();return g==="Tedarikçi İsmi / Belge No"?l.tedarikciId&&((i=(a=s.find(ve=>ve.id===l.tedarikciId))==null?void 0:a.unvan)==null?void 0:i.toLowerCase().includes(o))||((f=l.belgeNo)==null?void 0:f.toLowerCase().includes(o)):g==="Ürün Adı / Kodu / Barkodu"?((q=(E=l.Urun)==null?void 0:E.Adi)==null?void 0:q.toLowerCase().includes(o))||((he=(Q=l.Urun)==null?void 0:Q.UrunKodu)==null?void 0:he.toLowerCase().includes(o))||((pe=(xe=l.Urun)==null?void 0:xe.Barkod)==null?void 0:pe.toLowerCase().includes(o)):g==="Belge Açıklaması"?(ge=l.aciklamaAlis)==null?void 0:ge.toLowerCase().includes(o):g==="Satır Açıklaması"?(ye=l.aciklamaUrun)==null?void 0:ye.toLowerCase().includes(o):!0},r=F?!0:l.durumu!==0;return m&&S()&&t()&&r});return e.jsx(Ve,{children:e.jsxs(X.Provider,{value:{toasts:u,setToasts:p,purchases:h,setPurchases:T,suppliers:s,setSuppliers:c,loading:Y,setLoading:y,error:j,setError:k,showCancelled:F,setShowCancelled:I,searchTerm:C,setSearchTerm:d,docTypeFilter:v,setDocTypeFilter:M,timeFilter:L,setTimeFilter:B,searchType:g,setSearchType:A,contentType:R,setContentType:G,showSupplierModal:w,setShowSupplierModal:H,addToast:U,navigate:K,filteredPurchases:$,handleCancelPurchase:x},children:[e.jsx(Te,{ref:W,placement:"top-end",className:"p-3",children:u}),e.jsx(ue,{className:"mb-3",children:e.jsx(re,{children:e.jsx(rt,{})})}),e.jsx(lt,{}),e.jsx(nt,{})]})})};export{ht as default};
