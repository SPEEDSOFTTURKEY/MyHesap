import{r as s,j as r,N as L,Q as Y,S as z,T as P,i as $,aq as q,q as B,W as H,t as j,av as _,aw as J,ax as Q,ay as W}from"./index-DtN76qeb.js";const I="https://speedsofttest.com/api",X=({visible:M,onClose:D,onSubmit:w,addToast:f,supplier:i=null})=>{const[a,m]=s.useState({id:0,unvan:"",image:null,fotograf:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:"",kullaniciId:0}),[x,E]=s.useState("identity"),[g,k]=s.useState(!1),[T,C]=s.useState(null),[v,c]=s.useState({}),[G,N]=s.useState([]);s.useEffect(()=>{i&&m({id:i.id||0,unvan:i.name||"",image:null,fotograf:i.fotograf||"",vergiDairesi:i.taxOffice||"",vergiNo:i.taxOrIdNumber||"",vergiMuaf:i.isTaxExempt||!1,bankaBilgileri:i.bankInfo||"",paraBirimi:i.currency||"TRY",vadeGun:i.dueDate||"",acilisBakiyesi:i.openBalance||"",yetkiliKisi:i.contactPerson||"",email:i.email||"",adres:i.address||"",telefon:i.phone||"",diger:i.otherContact||"",tedarikciSiniflandirmaId:i.classification||"",kodu:i.accountingCode||"",aciklama:i.note||"",kullaniciId:0})},[i]);const R=async()=>{var e,t,n;try{k(!0);const{data:o}=await j.get(`${I}/tedarikciSiniflandirma/get-all`);console.log("Classifications API response (tedarikciSiniflandirma/get-all):",o),N(o.filter(l=>l.durumu===1)),C(null)}catch(o){const l=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"Sınıflandırmalar yüklenemedi.";console.error("Sınıflandırma yükleme hatası:",((n=o.response)==null?void 0:n.data)||o.message),C(l),f(l,"error")}finally{k(!1)}};s.useEffect(()=>{R()},[]);const y=e=>{const{name:t,value:n,type:o,checked:l}=e.target;m(u=>({...u,[t]:o==="checkbox"?l:n})),c(u=>({...u,[t]:""}))},K=e=>{const t=e.target.files[0];t&&m(n=>({...n,image:t,fotograf:URL.createObjectURL(t)}))},O=()=>{var t,n;const e={};return(t=a.unvan)!=null&&t.trim()||(e.unvan="Tedarikçi unvanı zorunlu"),(n=a.email)!=null&&n.trim()?/\S+@\S+\.\S+/.test(a.email)||(e.email="Geçerli bir e-posta adresi giriniz"):e.email="E-posta adı zorunlu",c(e),Object.keys(e).length===0},U=async e=>{var t,n,o,l,u;if(e.preventDefault(),!O()){f("Lütfen zorunlu alanları doğru şekilde doldurun.","error");return}try{k(!0);const d=JSON.parse(localStorage.getItem("user"))||{id:0};if(!d.id){f("Geçerli bir kullanıcı oturumu bulunamadı.","error");return}const p={id:a.id||0,unvan:a.unvan||"",vergiDairesi:a.vergiDairesi||"",vergiNo:a.vergiNo||"",vergiMuaf:a.vergiMuaf?1:0,bankaBilgileri:a.bankaBilgileri||"",paraBirimi:a.paraBirimi||"TRY",vadeGun:parseInt(a.vadeGun)||0,acilisBakiyesi:parseFloat(a.acilisBakiyesi)||0,yetkiliKisi:a.yetkiliKisi||"",email:a.email||"",adres:a.adres||"",telefon:a.telefon||"",diger:a.diger||"",tedarikciSiniflandirmaId:parseInt(a.tedarikciSiniflandirmaId)||0,kodu:a.kodu||"",aciklama:a.aciklama||"",fotograf:a.image||a.fotograf||"",kullaniciId:d.id},h=new FormData;for(const S in p)S==="fotograf"&&a.image?h.append("fotograf",a.image):h.append(S,p[S]===null?"":p[S]);const F=a.id?await j.put(`${I}/tedarikci/tedarikci-update`,h,{headers:{"Content-Type":"multipart/form-data"}}):await j.post(`${I}/tedarikci/tedarikci-create`,h,{headers:{"Content-Type":"multipart/form-data"}});console.log(a.id?"Update API response (tedarikci/tedarikci-update):":"Create API response (tedarikci/tedarikci-create):",F.data),w({...p,fotograf:((t=F.data.data)==null?void 0:t.fotograf)||a.fotograf}),f(a.id?"Tedarikçi başarıyla güncellendi.":"Tedarikçi başarıyla oluşturuldu.","success"),b()}catch(d){console.error("Tedarikçi Güncelleme/Oluşturma Hatası:",{message:d.message,status:(n=d.response)==null?void 0:n.status,data:(o=d.response)==null?void 0:o.data}),f(((u=(l=d.response)==null?void 0:l.data)==null?void 0:u.message)||"Tedarikçi güncellenemedi/oluşturulamadı. Lütfen veri formatını kontrol edin.","error")}finally{k(!1)}},b=()=>{m({id:0,unvan:"",image:null,fotograf:"",vergiDairesi:"",vergiNo:"",vergiMuaf:!1,bankaBilgileri:"",paraBirimi:"TRY",vadeGun:"",acilisBakiyesi:"",yetkiliKisi:"",email:"",adres:"",telefon:"",diger:"",tedarikciSiniflandirmaId:"",kodu:"",aciklama:"",kullaniciId:0}),c({}),C(null),D()},A=()=>{switch(x){case"identity":return r.jsx(W,{formData:a,handleChange:y,handleImageUpload:K,errors:v,setErrors:c,classifications:G});case"financial":return r.jsx(Q,{formData:a,handleChange:y,errors:v,setErrors:c});case"contact":return r.jsx(J,{formData:a,handleChange:y,errors:v});case"other":return r.jsx(_,{formData:a,handleChange:y,errors:v,setErrors:c});default:return null}};return r.jsxs(L,{visible:M,onClose:b,backdrop:"static",size:"lg",children:[r.jsx(Y,{style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},children:r.jsx(z,{children:a.id?"Tedarikçi Bilgilerini Güncelle":"Yeni Tedarikçi Ekle"})}),r.jsxs(P,{children:[g&&r.jsx("p",{children:"Yükleniyor..."}),T&&r.jsx("div",{className:"text-danger",children:T}),r.jsxs($,{id:"supplierUpdateForm",onSubmit:U,children:[r.jsx(q,{role:"group",className:"mb-3",children:["identity","financial","contact","other"].map(e=>r.jsx(B,{style:{backgroundColor:x===e?"#FFFFFF":"var(--primary-color)",color:x===e?"var(--primary-color)":"var(--white-color)",border:"1px solid var(--primary-color)"},onClick:()=>E(e),disabled:g,children:e==="identity"?"Kimlik Bilgileri":e==="financial"?"Cari":e==="contact"?"İletişim":"Diğer"},e))}),A()]})]}),r.jsxs(H,{children:[r.jsx(B,{type:"submit",form:"supplierUpdateForm",style:{backgroundColor:"var(--primary-color)",color:"var(--white-color)"},disabled:g,children:"Kaydet"}),r.jsx(B,{style:{backgroundColor:"var(--secondary-color)",color:"var(--white-color)"},onClick:b,disabled:g,children:"İptal"})]})]})};export{X as S};
