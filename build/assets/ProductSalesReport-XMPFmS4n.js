import{r as h,Z as o,j as a,g as J,s as Z,h as Q,e as X,f as v,U as R,V as z,o as B,q as L,$ as aa,a0 as ea,a1 as U,a2 as c,ao as _,a3 as sa,a4 as d,am as ra,aB as ta,az as F,aA as na}from"./index-DtN76qeb.js";const la={Ç:"C",ç:"c",Ğ:"G",ğ:"g",İ:"I",ı:"i",Ö:"O",ö:"o",Ş:"S",ş:"s",Ü:"U",ü:"u"},u=e=>e&&e.replace(/[ÇçĞğİıÖöŞşÜü]/g,j=>la[j]||j),ia=e=>{try{e.setFont("times","normal")}catch{e.setFont("helvetica","normal")}},oa="https://speedsofttest.com/api",N=ra.create({baseURL:oa}),ua=()=>{const[e,j]=h.useState({transactionType:"",dateRangeStart:o(),dateRangeEnd:o(),documentStatus:"",customer:"",supplier:"",warehouse:""}),[ca,I]=h.useState([]),[M,O]=h.useState([]),[w,H]=h.useState([]),[k,C]=h.useState([]),[D,f]=h.useState([]),[E,$]=h.useState(""),[m,g]=h.useState(!1);h.useEffect(()=>{(async()=>{g(!0);try{const[t,i,l]=await Promise.all([N.get("/depo/get-all",{headers:{"Cache-Control":"no-cache"}}),N.get("/musteri/musteri-get-all",{headers:{"Cache-Control":"no-cache"}}),N.get("/tedarikci/tedarikci-get-all",{headers:{"Cache-Control":"no-cache"}})]);I(t.data),O(i.data),H(l.data)}catch(t){console.error("API hatası:",t),alert("Veriler yüklenemedi!")}finally{g(!1)}})()},[]),h.useEffect(()=>{(async()=>{if(!e.transactionType||e.transactionType==="purchases"&&!e.supplier){C([]),f([]);return}g(!0);try{let t;if(e.transactionType==="purchases"){const l=w.find(r=>r.unvan===e.supplier);if(!l){alert("Seçilen tedarikçi bulunamadı!"),C([]),f([]),g(!1);return}t=await N.get(`/alis/alis-get-by-tedarikci-id/${l.id}`,{headers:{"Cache-Control":"no-cache"}})}else if(e.customer){const l=M.find(r=>r.unvani===e.customer);if(!l){alert("Seçilen müşteri bulunamadı!"),C([]),f([]),g(!1);return}t=await N.get(`/musteriSatis/musteriSatis-get-by-musteri/${l.id}`,{headers:{"Cache-Control":"no-cache"}})}else t=await N.get("/musteriSatis/musteriSatis-get-all",{headers:{"Cache-Control":"no-cache"}});const i=t.data.filter(l=>{var x,Y;const r=o(l.tarih||l.eklenmeTarihi),p=o(e.dateRangeStart).startOf("day"),n=o(e.dateRangeEnd).endOf("day"),y=!e.documentStatus||l.durumu.toString()===e.documentStatus,b=!e.warehouse||((x=l.depo)==null?void 0:x.adi)===e.warehouse,T=e.transactionType==="sales"?!e.customer||((Y=l.musteris)==null?void 0:Y.unvani)===e.customer:!0;return r.isAfter(p.subtract(1,"day"))&&r.isBefore(n.add(1,"day"))&&y&&b&&T});C(i),f([])}catch(t){console.error("API hatası:",t),alert("Veriler yüklenemedi!"),C([]),f([])}finally{g(!1)}})()},[e.transactionType,e.supplier,e.customer,e.dateRangeStart,e.dateRangeEnd,e.documentStatus,e.warehouse,w,M]);const A=s=>{const{name:t,value:i}=s.target;j(l=>({...l,[t]:i}))},P=(s,t)=>{j(i=>({...i,[s]:t}))},K=s=>{f(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},W=()=>{f(S.length===D.length?[]:S.map(s=>s.id))},q=()=>{if(k.length===0){alert("Rapor için veri bulunamadı!");return}const s=k.filter(t=>D.includes(t.id));if(s.length===0){alert("Lütfen en az bir satır seçiniz!");return}g(!0);try{const t=new ta({orientation:"landscape",unit:"mm",format:"a4"});ia(t),t.setFontSize(18),t.text(e.transactionType==="sales"?"Ürün Satış Raporu":"Ürün Alış Raporu",t.internal.pageSize.getWidth()/2,15,{align:"center"});const i=e.transactionType==="purchases"?[["ID","Ürün","Barkod","Tarih","Tedarikçi","Miktar","Birim Fiyat","İndirim (%)","Toplam","KDV (%)","Para Birimi","Belge No","Vade Tarih","Depo"]]:[["ID","Ürün","Barkod","Tarih","Müşteri","Miktar","Birim Fiyat","Toplam"]],l=s.map((n,y)=>{var b,T,x,Y,V;return e.transactionType==="purchases"?[y+1,u(((b=n.urun)==null?void 0:b.adi)||"-"),((T=n.urun)==null?void 0:T.barkod)||"-",o(n.tarih||n.eklenmeTarihi).format("DD/MM/YYYY"),u(((x=n.tedarikci)==null?void 0:x.unvan)||"-"),n.miktar||0,n.fiyat||0,n.indirim||0,n.toplam||0,n.kDV||0,n.paraBirimi||"TRY",n.belgeNo||"-",n.vadeTarih?o(n.vadeTarih).format("DD/MM/YYYY"):"-",u(((Y=n.depo)==null?void 0:Y.adi)||"-")]:[y+1,u(n.urunAdi||"-"),n.barkod||"-",o(n.eklenmeTarihi).format("DD/MM/YYYY"),u(((V=n.musteris)==null?void 0:V.unvani)||"-"),n.miktar||0,n.fiyat||0,n.toplamFiyat||0]});t.autoTable({startY:25,head:i,body:l,theme:"grid",styles:{font:"times",fontSize:9,cellPadding:3},headStyles:{fillColor:[41,101,168],textColor:[255,255,255],fontStyle:"bold"}});const r=t.output("blob"),p=URL.createObjectURL(r);window.open(p,"_blank")}catch(t){console.error("PDF oluşturma hatası:",t),alert("PDF oluşturulamadı!")}finally{g(!1)}},G=()=>{if(k.length===0){alert("Rapor için veri bulunamadı!");return}const s=k.filter(r=>D.includes(r.id));if(s.length===0){alert("Lütfen en az bir satır seçiniz!");return}const t=s.map((r,p)=>{var n,y,b,T,x;return e.transactionType==="purchases"?{ID:p+1,Ürün:u(((n=r.urun)==null?void 0:n.adi)||"-"),Barkod:((y=r.urun)==null?void 0:y.barkod)||"-",Tarih:o(r.tarih||r.eklenmeTarihi).format("DD/MM/YYYY"),Tedarikçi:u(((b=r.tedarikci)==null?void 0:b.unvan)||"-"),Miktar:r.miktar||0,"Birim Fiyat":r.fiyat||0,"İndirim (%)":r.indirim||0,Toplam:r.toplam||0,"KDV (%)":r.kDV||0,"Para Birimi":r.paraBirimi||"TRY","Belge No":r.belgeNo||"-","Vade Tarih":r.vadeTarih?o(r.vadeTarih).format("DD/MM/YYYY"):"-",Depo:u(((T=r.depo)==null?void 0:T.adi)||"-")}:{ID:p+1,Ürün:u(r.urunAdi||"-"),Barkod:r.barkod||"-",Tarih:o(r.eklenmeTarihi).format("DD/MM/YYYY"),Müşteri:u(((x=r.musteris)==null?void 0:x.unvani)||"-"),Miktar:r.miktar||0,"Birim Fiyat":r.fiyat||0,Toplam:r.toplamFiyat||0}}),i=F.json_to_sheet(t),l=F.book_new();F.book_append_sheet(l,i,"Rapor"),na(l,`${e.transactionType==="sales"?"Satis_Raporu":"Alis_Raporu"}.xlsx`)},S=k.filter(s=>JSON.stringify(s).toLowerCase().includes(E.toLowerCase()));return a.jsx("div",{className:"container mx-auto p-4",children:a.jsxs(J,{className:"shadow-lg rounded-lg",children:[a.jsx(Z,{className:"bg-blue-600 text-white text-lg font-semibold p-4",children:"Ürün Alış-Satış Raporu"}),a.jsxs(Q,{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs(X,{className:"g-4",children:[a.jsxs(v,{md:4,children:[a.jsx(R,{className:"text-sm font-medium text-gray-700",children:"İşlem Tipi"}),a.jsxs(z,{name:"transactionType",value:e.transactionType,onChange:A,className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:m,children:[a.jsx("option",{value:"",children:"Seçiniz"}),a.jsx("option",{value:"sales",children:"Satışlar"}),a.jsx("option",{value:"purchases",children:"Alışlar"})]})]}),a.jsxs(v,{md:4,children:[a.jsx(R,{className:"text-sm font-medium text-gray-700",children:"Başlangıç Tarihi"}),a.jsx(B,{type:"date",value:e.dateRangeStart.format("YYYY-MM-DD"),onChange:s=>P("dateRangeStart",o(s.target.value)),className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:m})]}),a.jsxs(v,{md:4,children:[a.jsx(R,{className:"text-sm font-medium text-gray-700",children:"Bitiş Tarihi"}),a.jsx(B,{type:"date",value:e.dateRangeEnd.format("YYYY-MM-DD"),onChange:s=>P("dateRangeEnd",o(s.target.value)),className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:m})]}),a.jsxs(v,{md:4,children:[a.jsx(R,{className:"text-sm font-medium text-gray-700",children:e.transactionType==="sales"?"Müşteri":e.transactionType==="purchases"?"Tedarikçi":"Müşteri/Tedarikçi"}),a.jsxs(z,{name:e.transactionType==="sales"?"customer":"supplier",value:e.transactionType==="sales"?e.customer:e.supplier,onChange:A,className:"mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:m||!e.transactionType,children:[a.jsx("option",{value:"",children:"Seçiniz"}),(e.transactionType==="sales"?M:w).map(s=>a.jsx("option",{value:e.transactionType==="sales"?s.Unvani:s.Unvan,children:e.transactionType==="sales"?s.unvani:s.unvan},s.id))]})]})]}),a.jsxs("div",{className:"mt-4 flex space-x-4",children:[a.jsx(L,{color:"primary",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md",disabled:m,onClick:q,children:m?"Yükleniyor...":"Rapor Hazırla"}),a.jsx(L,{color:"success",className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md",disabled:m,onClick:G,children:m?"Yükleniyor...":"Excel Oluştur"})]})]}),k.length>0&&a.jsxs("div",{className:"mt-6",children:[a.jsx(B,{placeholder:"Tablo içinde ara...",value:E,onChange:s=>$(s.target.value),className:"mb-4 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"}),a.jsxs(aa,{striped:!0,hover:!0,responsive:!0,className:"border rounded-lg",children:[a.jsx(ea,{className:"bg-blue-100",children:a.jsxs(U,{children:[a.jsx(c,{className:"p-3",children:a.jsx(_,{checked:D.length===S.length&&S.length>0,onChange:W})}),a.jsx(c,{className:"p-3",children:"Sıra"}),a.jsx(c,{className:"p-3",children:"Ürün"}),a.jsx(c,{className:"p-3",children:"Barkod"}),a.jsx(c,{className:"p-3",children:"Tarih"}),a.jsx(c,{className:"p-3",children:e.transactionType==="sales"?"Müşteri":"Tedarikçi"}),a.jsx(c,{className:"p-3",children:"Miktar"}),a.jsx(c,{className:"p-3",children:"Birim Fiyat"}),a.jsx(c,{className:"p-3",children:"Toplam"}),e.transactionType==="purchases"&&a.jsxs(a.Fragment,{children:[a.jsx(c,{className:"p-3",children:"İndirim (%)"}),a.jsx(c,{className:"p-3",children:"KDV (%)"}),a.jsx(c,{className:"p-3",children:"Para Birimi"}),a.jsx(c,{className:"p-3",children:"Belge No"}),a.jsx(c,{className:"p-3",children:"Vade Tarih"}),a.jsx(c,{className:"p-3",children:"Depo"})]})]})}),a.jsx(sa,{children:S.map((s,t)=>{var i,l,r,p,n;return a.jsxs(U,{className:"hover:bg-gray-50",children:[a.jsx(d,{className:"p-3",children:a.jsx(_,{checked:D.includes(s.id),onChange:()=>K(s.id)})}),a.jsx(d,{className:"p-3",children:t+1}),a.jsx(d,{className:"p-3",children:u(e.transactionType==="purchases"?((i=s.urun)==null?void 0:i.adi)||"-":s.urunAdi||"-")}),a.jsx(d,{className:"p-3",children:e.transactionType==="purchases"?((l=s.urun)==null?void 0:l.barkod)||"-":s.barkod||"-"}),a.jsx(d,{className:"p-3",children:o(s.tarih||s.eklenmeTarihi).format("DD/MM/YYYY")}),a.jsx(d,{className:"p-3",children:u(e.transactionType==="sales"?((r=s.musteris)==null?void 0:r.unvani)||"-":((p=s.tedarikci)==null?void 0:p.unvan)||"-")}),a.jsx(d,{className:"p-3",children:s.miktar||0}),a.jsx(d,{className:"p-3",children:s.fiyat||0}),a.jsx(d,{className:"p-3",children:e.transactionType==="purchases"?s.toplam||0:s.toplamFiyat||0}),e.transactionType==="purchases"&&a.jsxs(a.Fragment,{children:[a.jsx(d,{className:"p-3",children:s.indirim||0}),a.jsx(d,{className:"p-3",children:s.kDV||0}),a.jsx(d,{className:"p-3",children:s.paraBirimi||"TRY"}),a.jsx(d,{className:"p-3",children:s.belgeNo||"-"}),a.jsx(d,{className:"p-3",children:s.vadeTarih?o(s.vadeTarih).format("DD/MM/YYYY"):"-"}),a.jsx(d,{className:"p-3",children:u(((n=s.depo)==null?void 0:n.adi)||"-")})]})]},s.id)})})]})]})]})]})})};export{ua as default};
